<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Rắn Săn Mồi Cấp Số Nhân</title>
  <style>
    body {
      margin: 0;
      background-color: #fff9f0;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      text-align: center;
    }
    canvas {
      border: 4px solid #ff69b4;
      background-color: #fff;
      display: block;
      margin: auto;
    }
    #icons {
      display: flex;
      justify-content: space-between;
      width: 900px;
      margin: 10px auto;
    }
    .side-icon {
      width: 120px;
      height: 120px;
    }
  </style>
</head>
<body>
  <div id="icons">
    <img class="side-icon" src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="Heo">
    <img class="side-icon" src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="Heo">
  </div>

  <canvas id="gameCanvas" width="900" height="600"></canvas>

  <audio id="correctSound" src="https://cdn.jsdelivr.net/gh/jonobr1/tone-audio/correct.mp3"></audio>
  <audio id="wrongSound" src="https://cdn.jsdelivr.net/gh/jonobr1/tone-audio/wrong.mp3"></audio>
  <audio autoplay loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/11/03/audio_90d0f67dbe.mp3?filename=video-game-arcade-116447.mp3" type="audio/mpeg">
  </audio>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const box = 30;
    let snake = [{ x: 9 * box, y: 10 * box }];
    let direction = "RIGHT";

    document.addEventListener("keydown", directionControl);

    function directionControl(event) {
      if (event.key === "ArrowLeft" && direction !== "RIGHT") direction = "LEFT";
      else if (event.key === "ArrowUp" && direction !== "DOWN") direction = "UP";
      else if (event.key === "ArrowRight" && direction !== "LEFT") direction = "RIGHT";
      else if (event.key === "ArrowDown" && direction !== "UP") direction = "DOWN";
    }

    let current = 2;
    let ratio = 2;
    let score = 0;

    const correctSound = document.getElementById("correctSound");
    const wrongSound = document.getElementById("wrongSound");

    let food = [];
    function spawnFood() {
      food = [];
      let correctFood = {
        x: Math.floor(Math.random() * 27 + 1) * box,
        y: Math.floor(Math.random() * 17 + 3) * box,
        value: current * ratio,
        correct: true,
      };
      food.push(correctFood);

      while (food.length < 5) {
        let value = Math.floor(Math.random() * 30) + 1;
        if (value !== correctFood.value) {
          food.push({
            x: Math.floor(Math.random() * 27 + 1) * box,
            y: Math.floor(Math.random() * 17 + 3) * box,
            value,
            correct: false,
          });
        }
      }
    }

    spawnFood();

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw snake
      for (let i = 0; i < snake.length; i++) {
        ctx.fillStyle = i === 0 ? "#ff69b4" : "#ffa07a";
        ctx.fillRect(snake[i].x, snake[i].y, box, box);
        ctx.strokeStyle = "#fff";
        ctx.strokeRect(snake[i].x, snake[i].y, box, box);
      }

      // Draw food
      for (let i = 0; i < food.length; i++) {
        ctx.fillStyle = food[i].correct ? "#90ee90" : "#ffcccb";
        ctx.beginPath();
        ctx.arc(food[i].x + box / 2, food[i].y + box / 2, box / 2 - 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "#000";
        ctx.font = "18px Arial";
        ctx.fillText(food[i].value, food[i].x + 6, food[i].y + 20);
      }

      // Move snake
      let headX = snake[0].x;
      let headY = snake[0].y;

      if (direction === "LEFT") headX -= box;
      if (direction === "UP") headY -= box;
      if (direction === "RIGHT") headX += box;
      if (direction === "DOWN") headY += box;

      let newHead = { x: headX, y: headY };

      // Check collision with wall
      if (
        headX < 0 ||
        headX >= canvas.width ||
        headY < 0 ||
        headY >= canvas.height ||
        collision(newHead, snake)
      ) {
        clearInterval(game);
        alert("Game Over!");
        return;
      }

      // Check if food eaten
      let ate = false;
      for (let i = 0; i < food.length; i++) {
        if (headX === food[i].x && headY === food[i].y) {
          if (food[i].correct) {
            score++;
            current *= ratio;
            correctSound.play();
            spawnFood();
            ate = true;
          } else {
            wrongSound.play();
          }
        }
      }

      if (!ate) snake.pop();
      snake.unshift(newHead);

      // Draw score
      ctx.fillStyle = "#000";
      ctx.font = "20px Comic Sans MS";
      ctx.fillText("Điểm: " + score, box, box);
    }

    function collision(head, array) {
      for (let i = 0; i < array.length; i++) {
        if (head.x === array[i].x && head.y === array[i].y) return true;
      }
      return false;
    }

    let game = setInterval(draw, 180);
  </script>
</body>
</html>
