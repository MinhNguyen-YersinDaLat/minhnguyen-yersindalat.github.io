<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>R·∫Øn sƒÉn s·ªë</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(20, 20px);
      gap: 1px;
      margin-top: 20px;
    }
    .cell {
      width: 20px;
      height: 20px;
      border: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    .snake {
      background-color: green;
    }
    .food {
      background-color: yellow;
    }
    .game-over {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>üêç R·∫Øn sƒÉn s·ªë (C·∫•p s·ªë nh√¢n)</h1>
  <div id="info"></div>
  <div class="grid" id="grid"></div>
  <div class="game-over" id="game-over"></div>

  <script>
    const gridEl = document.getElementById("grid");
    const infoEl = document.getElementById("info");
    const gameOverEl = document.getElementById("game-over");

    const gridSize = 20;
    let snake = [{ x: 5, y: 5 }];
    let dir = { x: 0, y: 0 };
    let gameOver = false;

    const start = Math.floor(Math.random() * 4 + 2); // 2 - 5
    const ratio = Math.floor(Math.random() * 3 + 2); // 2 - 4
    let expected = start;

    let food = { x: 10, y: 10, value: start };

    function drawGrid() {
      gridEl.innerHTML = "";
      for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          if (snake.some(s => s.x === x && s.y === y)) {
            cell.classList.add("snake");
          } else if (food.x === x && food.y === y) {
            cell.classList.add("food");
            cell.textContent = food.value;
          }
          gridEl.appendChild(cell);
        }
      }
    }

    function update() {
      if (gameOver) return;
      const head = { ...snake[0] };
      head.x += dir.x;
      head.y += dir.y;

      if (head.x < 0 || head.y < 0 || head.x >= gridSize || head.y >= gridSize ||
        snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        gameOver = true;
        gameOverEl.textContent = "üíÄ Game Over! Nh·∫•n F5 ƒë·ªÉ ch∆°i l·∫°i!";
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        if (food.value !== expected) {
          gameOver = true;
          gameOverEl.textContent = "üíÄ Sai s·ªë! Game Over!";
          return;
        }
        expected *= ratio;
        food = {
          x: Math.floor(Math.random() * gridSize),
          y: Math.floor(Math.random() * gridSize),
          value: expected
        };
      } else {
        snake.pop();
      }

      drawGrid();
      infoEl.textContent = `üéØ Quy lu·∫≠t: c·∫•p s·ªë nh√¢n b·∫Øt ƒë·∫ßu t·ª´ ${start}, c√¥ng b·ªôi ${ratio}`;
    }

    window.addEventListener("keydown", e => {
      switch (e.key) {
        case "ArrowUp": dir = { x: 0, y: -1 }; break;
        case "ArrowDown": dir = { x: 0, y: 1 }; break;
        case "ArrowLeft": dir = { x: -1, y: 0 }; break;
        case "ArrowRight": dir = { x: 1, y: 0 }; break;
      }
    });

    drawGrid();
    setInterval(update, 200);
  </script>
</body>
</html>
