<!-- snake-math.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>üêç R·∫Øn sƒÉn s·ªë h·ªçc - C·∫•p s·ªë nh√¢n</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fff9f5;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-top: 20px;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(20, 30px);
      grid-template-rows: repeat(20, 30px);
      gap: 1px;
      margin-top: 20px;
    }

    .cell {
      width: 30px;
      height: 30px;
      background-color: #fafafa;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      border-radius: 4px;
      font-weight: bold;
    }

    .snake {
      background-color: #ff5e78;
    }

    .number {
      background-color: #fceabb;
    }

    #info {
      margin-top: 10px;
    }

    #gameOver {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }

    button {
      margin-top: 10px;
      padding: 6px 12px;
      background-color: #48c9b0;
      border: none;
      color: white;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>üêç R·∫Øn sƒÉn s·ªë h·ªçc</h1>
  <div id="board"></div>
  <div id="info"></div>
  <div id="gameOver"></div>
  <button onclick="startGame()">üîÅ Ch∆°i l·∫°i</button>

  <script>
    const board = document.getElementById("board");
    const info = document.getElementById("info");
    const gameOverText = document.getElementById("gameOver");
    const width = 20;
    const height = 20;

    let snake, dir, correctNumber, ratio, numbers, score, highScore, gameOver;
    const emoji = "üç≠"; // Bi·ªÉu t∆∞·ª£ng ch·ªß ƒë·ªÅ chung cho t·∫•t c·∫£ s·ªë

    function randomCoord() {
      return { x: Math.floor(Math.random() * width), y: Math.floor(Math.random() * height) };
    }

    function sameCell(a, b) {
      return a.x === b.x && a.y === b.y;
    }

    function createBoard() {
      board.innerHTML = "";
      for (let i = 0; i < width * height; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        board.appendChild(cell);
      }
    }

    function draw() {
      const cells = document.querySelectorAll(".cell");
      cells.forEach(cell => {
        cell.className = "cell";
        cell.textContent = "";
      });

      // Draw snake
      for (let part of snake) {
        const idx = part.y * width + part.x;
        cells[idx].classList.add("snake");
      }

      // Draw all numbers
      for (let obj of numbers) {
        const idx = obj.y * width + obj.x;
        cells[idx].classList.add("number");
        cells[idx].textContent = emoji + obj.value;
      }
    }

    function generateNumberSet() {
      const result = [];
      const placed = [];

      // Add the correct number
      let pos;
      do {
        pos = randomCoord();
      } while (snake.some(s => sameCell(s, pos)));
      result.push({ ...pos, value: correctNumber });
      placed.push(`${pos.x}-${pos.y}`);

      // Add noise numbers
      while (result.length < 6) {
        let randVal = Math.floor(Math.random() * 50 + 2);
        let randPos;
        do {
          randPos = randomCoord();
        } while (
          snake.some(s => sameCell(s, randPos)) ||
          placed.includes(`${randPos.x}-${randPos.y}`)
        );
        if (randVal !== correctNumber) {
          result.push({ ...randPos, value: randVal });
          placed.push(`${randPos.x}-${randPos.y}`);
        }
      }

      return result;
    }

    function startGame() {
      snake = [{ x: 5, y: 5 }];
      dir = { x: 0, y: 0 };
      let first = Math.floor(Math.random() * 4 + 2);
      ratio = Math.floor(Math.random() * 3 + 2);
      correctNumber = first;
      numbers = generateNumberSet();
      score = 0;
      highScore = parseInt(localStorage.getItem("snakeHighScore") || "0");
      gameOver = false;
      gameOverText.textContent = "";

      createBoard();
      draw();
      updateInfo();
    }

    function updateInfo() {
      info.textContent = `üëâ B·∫Øt ƒë·∫ßu t·ª´ ${correctNumber / ratio}, c√¥ng b·ªôi ${ratio} | üéØ ƒêi·ªÉm: ${score} | üèÜ K·ª∑ l·ª•c: ${highScore}`;
    }

    function move() {
      if (gameOver) return;

      const head = { ...snake[0] };
      head.x += dir.x;
      head.y += dir.y;

      // Va ch·∫°m t∆∞·ªùng ho·∫∑c th√¢n
      if (
        head.x < 0 || head.x >= width || head.y < 0 || head.y >= height ||
        snake.some(s => s.x === head.x && s.y === head.y)
      ) {
        endGame();
        return;
      }

      snake.unshift(head);

      const idx = numbers.findIndex(n => sameCell(n, head));
      if (idx >= 0) {
        const value = numbers[idx].value;
        if (value == correctNumber) {
          score += correctNumber;
          correctNumber *= ratio;
          numbers = generateNumberSet();
        } else {
          endGame();
          return;
        }
      } else {
        snake.pop();
      }

      draw();
      updateInfo();
    }

    function endGame() {
      gameOver = true;
      gameOverText.textContent = "üíÄ Game over! Nh·∫•n Ch∆°i l·∫°i ƒë·ªÉ th·ª≠ l·∫°i!";
      if (score > highScore) {
        localStorage.setItem("snakeHighScore", score);
      }
    }

    document.addEventListener("keydown", e => {
      if (gameOver) return;
      if (e.key === "ArrowUp" && dir.y === 0) dir = { x: 0, y: -1 };
      else if (e.key === "ArrowDown" && dir.y === 0) dir = { x: 0, y: 1 };
      else if (e.key === "ArrowLeft" && dir.x === 0) dir = { x: -1, y: 0 };
      else if (e.key === "ArrowRight" && dir.x === 0) dir = { x: 1, y: 0 };
    });

    startGame();
    setInterval(move, 200);
  </script>
</body>
</html>
