<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>üêç R·∫Øn sƒÉn s·ªë (C·∫•p s·ªë nh√¢n)</title>
  <style>
    body {
      background-color: #fefae0;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin-top: 20px;
      font-size: 2rem;
      color: #606c38;
    }
    #game {
      display: grid;
      grid-template-columns: repeat(20, 24px);
      grid-template-rows: repeat(20, 24px);
      gap: 1px;
      justify-content: center;
      margin: 20px auto;
    }
    .cell {
      width: 24px;
      height: 24px;
      background-color: #fefae0;
      border: 1px solid #d4a373;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      color: #283618;
    }
    .snake {
      background-color: #40916c;
    }
    .food {
      background-color: #ffdac1;
    }
    .controls {
      margin: 10px;
    }
    .info {
      font-size: 1rem;
      margin-top: 10px;
      color: #606c38;
    }
    button {
      padding: 8px 16px;
      background-color: #f4a261;
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    .game-over {
      font-size: 1.2rem;
      color: red;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>üêç R·∫Øn sƒÉn s·ªë - C·∫•p s·ªë nh√¢n</h1>
  <div id="game"></div>
  <div class="info" id="status"></div>
  <div class="controls">
    <button onclick="restartGame()">üîÅ Ch∆°i l·∫°i</button>
  </div>
  <audio id="bgm" src="https://www.bensound.com/bensound-music/bensound-funkyelement.mp3" autoplay loop></audio>

  <script>
    const gridSize = 20;
    const game = document.getElementById("game");
    const status = document.getElementById("status");
    const bgm = document.getElementById("bgm");

    let snake = [{ x: 5, y: 5 }];
    let dir = { x: 0, y: 0 };
    let food = [];
    let expected = 2;
    let ratio = 2;
    let score = 0;
    let highScore = localStorage.getItem("highScore") || 0;
    let interval;

    function rand(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    }

    function placeFoods() {
      food = [];
      let correct = { x: rand(0, gridSize), y: rand(0, gridSize), value: expected };
      food.push(correct);
      for (let i = 0; i < 4; i++) {
        let val;
        do {
          val = expected + rand(-5, 5) * ratio;
        } while (val === expected || val <= 0);
        food.push({ x: rand(0, gridSize), y: rand(0, gridSize), value: val });
      }
    }

    function draw() {
      game.innerHTML = "";
      for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          if (snake.some(s => s.x === x && s.y === y)) {
            cell.classList.add("snake");
          } else {
            const f = food.find(f => f.x === x && f.y === y);
            if (f) {
              cell.classList.add("food");
              cell.textContent = f.value;
            }
          }
          game.appendChild(cell);
        }
      }
    }

    function tick() {
      const head = { ...snake[0] };
      head.x += dir.x;
      head.y += dir.y;

      if (
        head.x < 0 || head.x >= gridSize ||
        head.y < 0 || head.y >= gridSize ||
        snake.some(s => s.x === head.x && s.y === head.y)
      ) {
        gameOver();
        return;
      }

      snake.unshift(head);
      const foodIndex = food.findIndex(f => f.x === head.x && f.y === head.y);

      if (foodIndex !== -1) {
        if (food[foodIndex].value === expected) {
          score += expected;
          expected *= ratio;
          placeFoods();
        } else {
          gameOver();
          return;
        }
      } else {
        snake.pop();
      }

      updateStatus();
      draw();
    }

    function updateStatus() {
      status.innerHTML = `
        üåü S·ªë ƒë·∫ßu ti√™n: <b>${expected / ratio}</b> | 
        üåÄ C√¥ng b·ªôi: <b>${ratio}</b> |
        üéØ ƒêi·ªÉm: <b>${score}</b> | 
        üèÜ K·ª∑ l·ª•c: <b>${highScore}</b>
      `;
    }

    function gameOver() {
      clearInterval(interval);
      status.innerHTML += "<div class='game-over'>üíÄ Game Over! Nh·∫•n 'Ch∆°i l·∫°i'</div>";
      if (score > highScore) {
        localStorage.setItem("highScore", score);
      }
    }

    function restartGame() {
      snake = [{ x: 5, y: 5 }];
      dir = { x: 0, y: 0 };
      expected = rand(2, 5);
      ratio = rand(2, 4);
      score = 0;
      placeFoods();
      updateStatus();
      draw();
      clearInterval(interval);
      interval = setInterval(tick, 200);
    }

    document.addEventListener("keydown", (e) => {
      switch (e.key) {
        case "ArrowUp": if (dir.y === 0) dir = { x: 0, y: -1 }; break;
        case "ArrowDown": if (dir.y === 0) dir = { x: 0, y: 1 }; break;
        case "ArrowLeft": if (dir.x === 0) dir = { x: -1, y: 0 }; break;
        case "ArrowRight": if (dir.x === 0) dir = { x: 1, y: 0 }; break;
      }
    });

    restartGame();
  </script>
</body>
</html>
