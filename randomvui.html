<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Random H·ªçc Sinh - ƒêua Th√∫ 5 H√†ng 50 Em</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #ffe6f0, #ffb6c1);
    margin: 0; padding: 20px;
    text-align: center;
    color: #5a2a47;
  }
  h1 {
    margin-bottom: 10px;
  }
  textarea {
    width: 80%;
    max-width: 600px;
    height: 150px;
    padding: 10px;
    font-size: 1.1rem;
    border-radius: 10px;
    border: 2px solid #ff69b4;
    resize: vertical;
  }
  #raceArea {
    margin: 25px auto;
    width: 90%;
    max-width: 900px;
    background: #fff0f5;
    border-radius: 15px;
    padding: 20px;
    min-height: 360px;
    max-height: 700px;
    overflow-y: auto;
    box-shadow: 0 0 15px rgba(255,105,180,0.3);
    position: relative;
  }
  .lane {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    height: 70px;
    margin-bottom: 10px;
    position: relative;
    background: #ffe1f3;
    border-radius: 12px;
    padding-left: 160px;
  }
  .runnerName {
    width: 150px;
    text-align: left;
    font-weight: 600;
    font-size: 1.1rem;
    color: #bf2e74;
    user-select: none;
    position: absolute;
    left: 10px;
  }
  .runnerEmoji {
    font-size: 40px;
    filter: drop-shadow(2px 4px 3px rgba(255, 105, 180, 0.4));
    position: relative;
    transition: transform 0.05s linear;
  }
  /* Rung l·∫Øc animation khi v·ªÅ ƒë√≠ch */
  @keyframes shake {
    0%, 100% { transform: translateX(0) rotate(0deg); }
    20%, 60% { transform: translateX(-5px) rotate(-10deg); }
    40%, 80% { transform: translateX(5px) rotate(10deg); }
  }
  .shake {
    animation: shake 0.5s ease-in-out 4;
  }
  #buttons {
    margin-top: 20px;
  }
  button {
    background: #ff69b4;
    border: none;
    color: white;
    padding: 12px 25px;
    margin: 0 10px;
    font-size: 1rem;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 3px 8px rgba(255,105,180,0.6);
    transition: background-color 0.3s;
  }
  button:hover:not(:disabled) {
    background: #d81e6e;
  }
  button:disabled {
    background: #ffc1dc;
    cursor: default;
  }
  #history {
    margin-top: 30px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    background: #fff0f5;
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 0 10px rgba(255,105,180,0.25);
    color: #a12e62;
    font-size: 1rem;
    max-height: 180px;
    overflow-y: auto;
    text-align: left;
  }
  #history h2 {
    margin-top: 0;
  }
  #history ul {
    padding-left: 20px;
    margin: 0;
  }
  #history li {
    margin-bottom: 6px;
  }
</style>
</head>
<body>

<h1>üéâ G·ªçi Ng·∫´u Nhi√™n H·ªçc Sinh B·∫±ng ƒêua Th√∫ 5 H√†ng üê∞üê∑üê®</h1>
<p>Nh·∫≠p danh s√°ch t·ªëi ƒëa 50 h·ªçc sinh, m·ªói t√™n m·ªôt d√≤ng. H·ªçc sinh s·∫Ω ƒë∆∞·ª£c chia ƒë·ªÅu v√†o 5 h√†ng, m·ªói h√†ng 10 b·∫°n ch·∫°y ƒëua song song.</p>

<textarea id="namesInput" placeholder="Nh·∫≠p t√™n h·ªçc sinh v√†o ƒë√¢y, m·ªói t√™n tr√™n 1 d√≤ng..."></textarea>

<div id="buttons">
  <button id="startBtn">üöÄ B·∫Øt ƒë·∫ßu</button>
  <button id="pauseBtn" disabled>‚è∏Ô∏è T·∫°m d·ª´ng</button>
  <button id="resetBtn" disabled>üîÑ L√†m m·ªõi</button>
</div>

<div id="raceArea" aria-live="polite" aria-atomic="true" aria-relevant="additions"></div>

<section id="history" aria-live="polite" aria-atomic="true">
  <h2>L·ªãch s·ª≠ k·∫øt qu·∫£</h2>
  <ul id="historyList"></ul>
</section>

<audio id="winSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>

<script>
  const animalEmojis = ['üê∞','üê∑','üê®','üêº','üê∏','üêØ','ü¶ä','üêµ','üê∂','üê±','ü¶Ñ','üê≠','üêπ','üêª','üêî','üê¥','üêó','üêù','üê¨','üê¢'];
  const namesInput = document.getElementById('namesInput');
  const raceArea = document.getElementById('raceArea');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const historyList = document.getElementById('historyList');
  const winSound = document.getElementById('winSound');

  let lanes = [];
  let raceInterval = null;
  let paused = false;
  let finished = false;

  function createRunner(name, emoji, laneDiv) {
    const runnerDiv = document.createElement('div');
    runnerDiv.className = 'runnerEmoji';
    runnerDiv.textContent = emoji;
    runnerDiv.style.transform = 'translateX(0)';
    laneDiv.appendChild(runnerDiv);

    const nameDiv = document.createElement('div');
    nameDiv.className = 'runnerName';
    nameDiv.textContent = name;
    laneDiv.appendChild(nameDiv);

    return {
      name,
      runnerDiv,
      position: 0,
      speed: 2 + Math.random() * 2 // px per tick
    };
  }

  function startRace() {
    if (raceInterval) return;

    let names = namesInput.value.trim().split('\n').map(n => n.trim()).filter(n => n !== '');
    if (names.length === 0) {
      alert('B·∫°n ch∆∞a nh·∫≠p t√™n h·ªçc sinh!');
      return;
    }
    if (names.length > 50) {
      alert('Ch·ªâ h·ªó tr·ª£ t·ªëi ƒëa 50 h·ªçc sinh, s·∫Ω l·∫•y 50 t√™n ƒë·∫ßu ti√™n.');
      names = names.slice(0, 50);
    }

    raceArea.innerHTML = '';
    lanes = [];

    // T·∫°o 5 lanes
    for(let i=0; i<5; i++) {
      const laneDiv = document.createElement('div');
      laneDiv.className = 'lane';
      raceArea.appendChild(laneDiv);
      lanes.push({ laneDiv, runners: [] });
    }

    // Chia ƒë·ªÅu h·ªçc sinh cho 5 lanes
    for (let i=0; i<names.length; i++) {
      const laneIndex = Math.floor(i / 10);
      if(laneIndex >= 5) break; // ch·ªâ 5 lane th√¥i
      const emoji = animalEmojis[i % animalEmojis.length];
      const runner = createRunner(names[i], emoji, lanes[laneIndex].laneDiv);
      lanes[laneIndex].runners.push(runner);
    }

    finished = false;
    paused = false;

    startBtn.disabled = true;
    pauseBtn.disabled = false;
    resetBtn.disabled = false;
    pauseBtn.textContent = '‚è∏Ô∏è T·∫°m d·ª´ng';

    raceInterval = setInterval(() => {
      if(paused || finished) return;

      lanes.forEach(lane => {
        lane.runners.forEach(runner => {
          runner.position += runner.speed;
          const finishLine = raceArea.clientWidth - 70;
          if(runner.position >= finishLine && !finished) {
            runner.position = finishLine;
            finishRace(runner);
          }
          runner.runnerDiv.style.transform = `translateX(${runner.position}px)`;
        });
      });
    }, 50);
  }

  function finishRace(winner) {
    finished = true;
    clearInterval(raceInterval);
    raceInterval = null;

    // Rung l·∫Øc th√∫ c∆∞ng v·ªÅ ƒë√≠ch
    winner.runnerDiv.classList.add('shake');

    // Ph√°t √¢m thanh chi·∫øn th·∫Øng
    winSound.currentTime = 0;
    winSound.play();

    alert(`üéâ Ch√∫c m·ª´ng h·ªçc sinh ƒë∆∞·ª£c ch·ªçn: ${winner.name}! üèÜ`);
    addToHistory(winner.name);

    startBtn.disabled = false;
    pauseBtn.disabled = true;
  }

  function pauseRace() {
    paused = !paused;
    pauseBtn.textContent = paused ? '‚ñ∂Ô∏è Ti·∫øp t·ª•c' : '‚è∏Ô∏è T·∫°m d·ª´ng';
  }

  function resetRace() {
    if(raceInterval) clearInterval(raceInterval);
    raceInterval = null;
    paused = false;
    finished = false;
    lanes = [];
    raceArea.innerHTML = '';
    startBtn.disabled = false;
    pauseBtn.disabled = true;
    resetBtn.disabled = true;
  }

  function addToHistory(name) {
    let history = JSON.parse(localStorage.getItem('raceHistory') || '[]');
    const timeStr = new Date().toLocaleString('vi-VN');
    history.unshift(`${timeStr}: ${name}`);
    if(history.length > 20) history.pop();
    localStorage.setItem('raceHistory', JSON.stringify(history));
    renderHistory();
  }

  function renderHistory() {
    let history = JSON.parse(localStorage.getItem('raceHistory') || '[]');
    historyList.innerHTML = '';
    if(history.length === 0) {
      historyList.innerHTML = '<li>Ch∆∞a c√≥ k·∫øt qu·∫£ n√†o.</li>';
      return;
    }
    history.forEach(entry => {
      const li = document.createElement('li');
      li.textContent = entry;
      historyList.appendChild(li);
    });
  }

  renderHistory();

  startBtn.addEventListener('click', startRace);
  pauseBtn.addEventListener('click', pauseRace);
  resetBtn.addEventListener('click', resetRace);
</script>

</body>
</html>
