<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SÃ n Äáº¥u Váº­t NuÃ´i Ngang - Party Animals phiÃªn báº£n ToÃ¡n</title>
<style>
  body {
    margin:0; background:#f0f8ff; font-family: Arial, sans-serif; text-align:center;
  }
  #canvas-container {
    position: relative; margin: 20px auto; width: 1000px; height: 400px; 
    border: 3px solid #333; border-radius: 15px; background: #fff;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
    overflow: hidden;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: transparent !important;
  }
  #winner {
    font-size: 24px; font-weight: bold; color: #d63384; margin: 15px 0;
  }
  #startBtn, #resetBtn {
    padding: 12px 24px; font-size: 16px; border:none; border-radius: 25px; cursor:pointer;
    margin: 10px 8px;
    background: #ff69b4; color: white;
    box-shadow: 0 4px 8px rgba(255,105,180,0.6);
    transition: background-color 0.3s ease;
  }
  #startBtn:hover, #resetBtn:hover {
    background: #d63384;
  }
  #inputNames {
    width: 980px; height: 120px; margin: 10px auto; font-size: 16px; padding: 8px;
    border-radius: 8px; border: 2px solid #ff69b4; resize: none;
  }
  label {
    font-weight: bold; color: #444; font-size: 18px;
  }
</style>
</head>
<body>

<h1>ğŸ‰ SÃ n Äáº¥u Váº­t NuÃ´i Ngang - Chá»n Há»c Sinh Ngáº«u NhiÃªn ğŸ‰</h1>

<label for="inputNames">Nháº­p danh sÃ¡ch tÃªn há»c sinh (tá»‘i Ä‘a 50), má»—i tÃªn má»™t dÃ²ng:</label><br/>
<textarea id="inputNames" placeholder="VÃ­ dá»¥: Nguyá»…n VÄƒn A&#10;Tráº§n Thá»‹ B&#10;LÃª VÄƒn C"></textarea><br/>

<button id="startBtn">ğŸš€ Báº¯t Ä‘áº§u Ä‘ua</button>
<button id="resetBtn" disabled>ğŸ”„ LÃ m láº¡i</button>

<div id="canvas-container"></div>

<div id="winner"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script>
  const { Engine, Render, Runner, Bodies, Composite, Events, Body, Vector } = Matter;

  const container = document.getElementById('canvas-container');
  const winnerDiv = document.getElementById('winner');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const inputNames = document.getElementById('inputNames');

  let engine, render, runner;
  let balls = [];
  let isRunning = false;

  const maxPlayers = 50;
  const arenaWidth = container.clientWidth;
  const arenaHeight = container.clientHeight;
  const animalRadius = 25;
  const startX = 50;
  const endX = arenaWidth - 50;

  // MÃ u thÃº
  function getRandomColor(seed) {
    const colors = [
      '#ff6f91', '#ff9671', '#ffc75f', '#f9f871', '#5bd1a6',
      '#00bcd4', '#8067c9', '#b36ac9', '#ff9a76', '#ff7f50',
      '#7fffd4', '#ffdab9', '#e0ffff', '#afeeee', '#dda0dd'
    ];
    return colors[seed % colors.length];
  }

  // Táº¡o thÃº (hÃ¬nh trÃ²n + tÃªn), Ä‘áº·t dá»c theo chiá»u ngang, 10 thÃº 1 hÃ ng, nhiá»u hÃ ng
  function createAnimal(name, index) {
    const row = Math.floor(index / 10);
    const col = index % 10;
    const spacingX = 90; // khoáº£ng cÃ¡ch ngang giá»¯a thÃº
    const spacingY = 70; // khoáº£ng cÃ¡ch dá»c giá»¯a hÃ ng

    let x = startX + col * spacingX;
    let y = 50 + row * spacingY;

    let ball = Bodies.circle(x, y, animalRadius, {
      restitution: 0.8,
      friction: 0.3,
      density: 0.002,
      label: name
    });
    ball.render.fillStyle = getRandomColor(index);
    ball.name = name;
    return ball;
  }

  // Váº½ tÃªn trÃªn canvas
  function drawNames(render, balls) {
    let ctx = render.context;
    ctx.font = "14px Arial";
    ctx.textAlign = "center";
    ctx.fillStyle = "black";
    balls.forEach(ball => {
      let pos = ball.position;
      ctx.fillText(ball.name, pos.x, pos.y - animalRadius - 10);
    });
  }

  // Giá»›i háº¡n thÃº trong sÃ n ngang (bÃªn dÆ°á»›i khung)
  function keepInArena(ball) {
    return (ball.position.x >= -animalRadius && ball.position.x <= arenaWidth + animalRadius
      && ball.position.y >= -animalRadius && ball.position.y <= arenaHeight + animalRadius);
  }

  // Khá»Ÿi táº¡o game
  function initGame(names) {
    if (engine) {
      Matter.Render.stop(render);
      Matter.Runner.stop(runner);
      Composite.clear(engine.world);
      Engine.clear(engine);
      render.canvas.remove();
      render.textures = {};
      balls = [];
      isRunning = false;
      winnerDiv.textContent = '';
    }

    engine = Engine.create();
    engine.world.gravity.y = 0; // khÃ´ng rÆ¡i xuá»‘ng

    render = Render.create({
      element: container,
      engine: engine,
      options: {
        width: arenaWidth,
        height: arenaHeight,
        wireframes: false,
        background: 'transparent',
      }
    });

    // TÆ°á»ng 2 bÃªn trÃ¡i pháº£i, trÃªn dÆ°á»›i thÃ¬ khÃ´ng cáº§n
    const leftWall = Bodies.rectangle(-20, arenaHeight/2, 40, arenaHeight, { isStatic: true });
    const rightWall = Bodies.rectangle(arenaWidth + 20, arenaHeight/2, 40, arenaHeight, { isStatic: true });

    Composite.add(engine.world, [leftWall, rightWall]);

    // Táº¡o cÃ¡c thÃº váº­t theo vá»‹ trÃ­ hÃ ng ngang
    names.forEach((name, i) => {
      let animal = createAnimal(name, i);
      Composite.add(engine.world, animal);
      balls.push(animal);
    });

    // Táº¡o runner vÃ  render
    runner = Runner.create();
    Render.run(render);
    Runner.run(runner, engine);

    // Váº½ tÃªn má»—i frame
    Events.on(render, 'afterRender', function() {
      drawNames(render, balls);
    });

    resetBtn.disabled = true;
  }

  // Äáº©y thÃº cháº¡y liÃªn tá»¥c sang pháº£i, táº¡o va cháº¡m Ä‘áº©y nhau
  function startRace() {
    isRunning = true;

    // Má»—i thÃº Ä‘áº©y lá»±c nháº¹, hÆ°á»›ng sang pháº£i
    const forceMag = 0.0003;

    const interval = setInterval(() => {
      if (!isRunning) {
        clearInterval(interval);
        return;
      }
      balls.forEach(ball => {
        Body.applyForce(ball, ball.position, { x: forceMag, y: 0 });
      });

      // Loáº¡i bá» thÃº ra khá»i mÃ n náº¿u Ä‘i ra ngoÃ i bÃªn trÃ¡i
      balls = balls.filter(ball => {
        if (ball.position.x < -animalRadius) {
          Composite.remove(engine.world, ball);
          return false;
        }
        return true;
      });

      // Náº¿u cÃ²n 1 hoáº·c 0 thÃº thÃ¬ dá»«ng
      if (balls.length <= 1) {
        isRunning = false;
        if (balls.length === 1) {
          winnerDiv.textContent = `ğŸ‰ NgÆ°á»i chiáº¿n tháº¯ng lÃ : ${balls[0].name} ğŸ‰`;
          playWinSound();
        } else {
          winnerDiv.textContent = `KhÃ´ng cÃ³ ngÆ°á»i chiáº¿n tháº¯ng!`;
        }
        resetBtn.disabled = false;
        startBtn.disabled = false;
      }
    }, 100);
  }

  // PhÃ¡t Ã¢m thanh tháº¯ng
  function playWinSound() {
    const audio = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
    audio.volume = 0.5;
    audio.play();
  }

  startBtn.addEventListener('click', () => {
    let rawNames = inputNames.value.trim();
    if (!rawNames) {
      alert('Vui lÃ²ng nháº­p danh sÃ¡ch tÃªn há»c sinh!');
      return;
    }
    let names = rawNames.split('\n').map(n => n.trim()).filter(n => n.length > 0).slice(0, 50);
    if (names.length < 2) {
      alert('Pháº£i nháº­p Ã­t nháº¥t 2 tÃªn!');
      return;
    }
    winnerDiv.textContent = '';
    initGame(names);
    startRace();
    startBtn.disabled = true;
    resetBtn.disabled = true;
  });

  resetBtn.addEventListener('click', () => {
    winnerDiv.textContent = '';
    balls = [];
    Composite.clear(engine.world);
    Engine.clear(engine);
    render.canvas.remove();
    render.textures = {};
    startBtn.disabled = false;
    resetBtn.disabled = true;
  });
</script>

</body>
</html>
