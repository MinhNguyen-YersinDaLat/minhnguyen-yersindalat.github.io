<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üé≤ Random G·ªçi T√™n H·ªçc Sinh - Th√∫ Chibi D·ªÖ Th∆∞∆°ng</title>
<style>
  body {
    font-family: 'Comic Sans MS', cursive, Arial, sans-serif;
    background: linear-gradient(135deg, #ffe6f0 0%, #ffccd5 100%);
    margin: 0; padding: 0;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
    user-select: none;
  }
  h1 {
    color: #d63384;
    margin: 20px 0 10px 0;
    text-align: center;
  }
  #container {
    position: relative;
    width: 90vw; max-width: 900px; height: 520px;
    background: #fff0f5;
    border-radius: 20px;
    box-shadow: 0 0 30px rgba(214, 51, 132, 0.3);
    overflow: hidden;
  }
  .animal {
    position: absolute;
    width: 70px; height: 70px;
    text-align: center;
    cursor: default;
    user-select: none;
    transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.5s ease;
  }
  .animal img, .animal .icon {
    width: 60px;
    height: 60px;
    border-radius: 15px;
    box-shadow: 0 0 8px rgba(214, 51, 132, 0.6);
    filter: drop-shadow(0 0 4px #d63384);
    font-size: 60px;
    line-height: 60px;
    user-select: none;
    display: inline-block;
  }
  .animal .name {
    font-size: 12px;
    font-weight: 900;
    color: #d63384;
    margin-top: 4px;
    user-select: none;
    width: 70px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    text-transform: uppercase;
  }

  /* Hi·ªáu ·ª©ng ng∆∞·ªùi th·∫Øng ph√≥ng to */
  @keyframes winnerZoom {
    0%, 100% { transform: scale(4) rotate(0deg); }
    50% { transform: scale(4.3) rotate(15deg); }
  }
  /* Hi·ªáu ·ª©ng l·∫•p l√°nh t√™n th·∫Øng */
  @keyframes sparkle {
    0%, 100% { text-shadow: 0 0 8px #ff8fc9, 0 0 12px #ff0080; }
    50% { text-shadow: 0 0 20px #ff9ad0, 0 0 30px #ff33a6; }
  }

  .selected {
    z-index: 1000 !important;
    cursor: default;
  }
  .winner {
    animation: winnerZoom 1.5s infinite ease-in-out;
    z-index: 2000 !important;
  }
  .winner .name {
    animation: sparkle 2s infinite ease-in-out;
    font-size: 20px;
  }
  .faded {
    opacity: 0.25;
    transition: opacity 0.5s ease;
  }

  /* Nh·∫£y nh√≥t, l·ªôn x·ªôn */
  @keyframes jitterX {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(5px); }
    50% { transform: translateX(-5px); }
    75% { transform: translateX(3px); }
  }
  @keyframes jitterY {
    0%, 100% { transform: translateY(0); }
    25% { transform: translateY(5px); }
    50% { transform: translateY(-5px); }
    75% { transform: translateY(3px); }
  }

  #btnRandom, #btnContinue, #btnLoadList {
    margin: 15px 5px 15px 5px;
    padding: 12px 30px;
    background-color: #ff69b4;
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255,105,180,0.6);
    transition: background-color 0.3s ease;
    user-select: none;
  }
  #btnRandom:hover, #btnContinue:hover, #btnLoadList:hover {
    background-color: #d63384;
  }
  #result {
    margin-top: 10px;
    font-size: 28px;
    color: #d63384;
    font-weight: bold;
    min-height: 90px;
    user-select: none;
    text-align: center;
  }
  #history {
    max-width: 900px;
    margin: 0 auto 30px auto;
    padding: 10px 20px;
    background: #ffd7eb;
    border-radius: 15px;
    box-shadow: 0 0 10px rgba(214, 51, 132, 0.15);
    color: #d63384;
    font-size: 16px;
    font-weight: 600;
  }
  #history h3 {
    margin-top: 0;
  }
  #history ul {
    list-style: none;
    padding: 0;
    margin: 0;
    max-height: 140px;
    overflow-y: auto;
  }
  #history li {
    padding: 4px 0;
    border-bottom: 1px solid #ffa3cc;
  }

  #nameList {
    margin: 10px auto 0 auto;
    width: 90vw; max-width: 900px;
    height: 120px;
    border-radius: 12px;
    border: 2px solid #d63384;
    padding: 10px;
    font-size: 14px;
    font-family: monospace;
    resize: vertical;
  }
  label[for="nameList"] {
    display: block;
    margin-top: 20px;
    font-weight: bold;
    color: #d63384;
    font-size: 18px;
  }
</style>
</head>
<body>

<h1>üé≤ Random G·ªçi T√™n H·ªçc Sinh - Th√∫ Chibi D·ªÖ Th∆∞∆°ng</h1>

<label for="nameList">Nh·∫≠p danh s√°ch t√™n h·ªçc sinh (m·ªói t√™n m·ªôt d√≤ng):</label>
<textarea id="nameList" placeholder="V√≠ d·ª•:&#10;Nguy·ªÖn VƒÉn A&#10;Tr·∫ßn Th·ªã B&#10;L√™ VƒÉn C"></textarea>
<button id="btnLoadList">üì• Load Danh S√°ch</button>

<div id="container" aria-label="Khu v·ª±c th√∫ nh·∫£y"></div>

<div>
  <button id="btnRandom" disabled>üéØ Ch·ªçn Ng·∫´u Nhi√™n</button>
  <button id="btnContinue" style="display:none;">‚ñ∂Ô∏è Ti·∫øp T·ª•c (Lo·∫°i Ng∆∞·ªùi ƒê√£ Ch·ªçn)</button>
</div>

<div id="result" aria-live="polite"></div>

<section id="history" aria-label="L·ªãch s·ª≠ k·∫øt qu·∫£">
  <h3>üèÜ L·ªãch S·ª≠ K·∫øt Qu·∫£:</h3>
  <ul id="historyList"></ul>
</section>

<script>
  const container = document.getElementById('container');
  const btnRandom = document.getElementById('btnRandom');
  const btnContinue = document.getElementById('btnContinue');
  const btnLoadList = document.getElementById('btnLoadList');
  const result = document.getElementById('result');
  const historyList = document.getElementById('historyList');
  const nameList = document.getElementById('nameList');

  const animalIcons = ['üê∞', 'üê±', 'üêª', 'üê∏', 'ü¶ä', 'üê®', 'üê•', 'üêµ', 'üêØ', 'üêπ', 'üêº', 'üê∂', 'üêî', 'ü¶Ñ', 'üêß', 'üê¢', 'üêù', 'ü¶â', 'üê∫', 'ü¶ã', 'üê¨', 'üê†', 'ü¶¶', 'üêøÔ∏è', 'üê¶', 'üê≠'];

  let activeStudents = [];
  let selectedStudent = null;
  let history = [];

  // H√†m r√∫t g·ªçn t√™n: "V√µ Minh Th·ªãnh" -> "VM TH·ªäNH"
  function shortenName(fullName) {
    const parts = fullName.trim().split(/\s+/);
    if(parts.length === 1) return fullName.toUpperCase();
    const lastName = parts.pop().toUpperCase();
    const initials = parts.map(p => p[0].toUpperCase()).join('');
    return (initials + ' ' + lastName).toUpperCase();
  }

  function createAnimals() {
    container.innerHTML = "";
    activeStudents.forEach(stu => {
      const div = document.createElement("div");
      div.classList.add("animal");
      div.style.left = Math.random() * (container.clientWidth - 70) + "px";
      div.style.top = Math.random() * (container.clientHeight - 70) + "px";
      const icon = animalIcons[Math.floor(Math.random() * animalIcons.length)];
      stu.icon = icon;
      div.innerHTML = `<div class="icon">${icon}</div><div class="name" title="${stu.name}">${shortenName(stu.name)}</div>`;
      container.appendChild(div);
      stu.element = div;
    });
    startJitter();
  }

  // Di chuy·ªÉn l·ªôn x·ªôn d·ªÖ th∆∞∆°ng nhi·ªÅu h∆°n
  let jitterIntervals = [];
  function startJitter() {
    clearJitter();
    jitterIntervals = activeStudents.map(stu => {
      return setInterval(() => {
        if(stu.element.classList.contains('selected') || stu.element.classList.contains('winner')) return;
        const maxX = container.clientWidth - 70;
        const maxY = container.clientHeight - 70;
        let currentX = parseFloat(stu.element.style.left);
        let currentY = parseFloat(stu.element.style.top);
        let newX = Math.min(maxX, Math.max(0, currentX + (Math.random() * 20 - 10)));
        let newY = Math.min(maxY, Math.max(0, currentY + (Math.random() * 20 - 10)));
        stu.element.style.left = newX + "px";
        stu.element.style.top = newY + "px";
      }, 80);
    });
  }
  function clearJitter() {
    jitterIntervals.forEach(i => clearInterval(i));
    jitterIntervals = [];
  }

  function updateHistory(name, icon) {
    history.unshift({ name, icon });
    if(history.length > 10) history.pop();
    historyList.innerHTML = "";
    history.forEach((item, idx) => {
      const li = document.createElement('li');
      li.textContent = `${idx+1}. ${item.icon} ${item.name}`;
      historyList.appendChild(li);
    });
  }

  function selectRandomStudent() {
    if(activeStudents.length === 0){
      alert("H·∫øt h·ªçc sinh ƒë·ªÉ ch·ªçn! Vui l√≤ng nh·∫≠p danh s√°ch m·ªõi ho·∫∑c t·∫£i l·∫°i trang.");
      btnRandom.disabled = true;
      return;
    }
    activeStudents.forEach(s => {
      s.element.classList.remove('selected', 'winner', 'faded');
      s.element.style.opacity = '1';
    });
    result.textContent = "ƒêang ch·ªçn...";
    clearJitter();

    // Nh·∫£y nh√≥t li√™n t·ª•c 3.5s tr∆∞·ªõc khi ch·ªçn
    let jumps = 35;
    let jumpCount = 0;
    const jumpInterval = setInterval(() => {
      activeStudents.forEach(stu => {
        const maxX = container.clientWidth - 70;
        const maxY = container.clientHeight - 70;
        let currentX = parseFloat(stu.element.style.left);
        let currentY = parseFloat(stu.element.style.top);
        let newX = Math.min(maxX, Math.max(0, currentX + (Math.random() * 20 - 10)));
        let newY = Math.min(maxY, Math.max(0, currentY + (Math.random() * 20 - 10)));
        stu.element.style.left = newX + "px";
        stu.element.style.top = newY + "px";
      });
      jumpCount++;
      if(jumpCount >= jumps) {
        clearInterval(jumpInterval);

        // Ch·ªçn ng·∫´u nhi√™n
        const idx = Math.floor(Math.random() * activeStudents.length);
        selectedStudent = activeStudents[idx];
        selectedStudent.element.classList.add('selected', 'winner');

        // M·ªù ƒëi c√°c th√∫ kh√°c
        activeStudents.forEach(s => {
          if(s !== selectedStudent) {
            s.element.classList.add('faded');
          }
        });

        result.textContent = `üéâ ƒê√£ ch·ªçn: ${selectedStudent.icon} ${selectedStudent.name} üéâ`;
        updateHistory(selectedStudent.name, selectedStudent.icon);

        const audio = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
        audio.volume = 0.6;
        audio.play();

        btnRandom.style.display = "none";
        btnContinue.style.display = "inline-block";
      }
    }, 100);
  }

  function continueGame() {
    if(!selectedStudent) return;
    activeStudents = activeStudents.filter(s => s !== selectedStudent);
    selectedStudent = null;
    result.textContent = "";
    btnRandom.style.display = "inline-block";
    btnContinue.style.display = "none";
    createAnimals();
  }

  btnRandom.addEventListener('click', selectRandomStudent);
  btnContinue.addEventListener('click', continueGame);
  btnLoadList.addEventListener('click', () => {
    const rawNames = nameList.value.trim();
    if(!rawNames){
      alert("Vui l√≤ng nh·∫≠p danh s√°ch t√™n h·ªçc sinh.");
      return;
    }
    const names = rawNames.split('\n').map(n => n.trim()).filter(n => n.length > 0);
    activeStudents = names.map(n => ({ name: n }));
    selectedStudent = null;
    history = [];
    historyList.innerHTML = "";
    result.textContent = "";
    btnRandom.disabled = false;
    btnRandom.style.display = "inline-block";
    btnContinue.style.display = "none";
    createAnimals();
  });
</script>

</body>
</html>
