<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SÃ n Äáº¥u Váº­t NuÃ´i - Party Animals phiÃªn báº£n ToÃ¡n</title>
<style>
  body {
    margin:0; background:#f0f8ff; font-family: Arial, sans-serif; text-align:center;
  }
  #canvas-container {
    position: relative; margin: 20px auto; width: 800px; height: 800px; 
    border: 3px solid #333; border-radius: 50%; background: #fff;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: transparent !important;
  }
  #winner {
    font-size: 24px; font-weight: bold; color: #d63384; margin: 15px 0;
  }
  #startBtn, #resetBtn {
    padding: 12px 24px; font-size: 16px; border:none; border-radius: 25px; cursor:pointer;
    margin: 10px 8px;
    background: #ff69b4; color: white;
    box-shadow: 0 4px 8px rgba(255,105,180,0.6);
    transition: background-color 0.3s ease;
  }
  #startBtn:hover, #resetBtn:hover {
    background: #d63384;
  }
  #inputNames {
    width: 800px; height: 120px; margin: 10px auto; font-size: 16px; padding: 8px;
    border-radius: 8px; border: 2px solid #ff69b4; resize: none;
  }
  label {
    font-weight: bold; color: #444; font-size: 18px;
  }
</style>
</head>
<body>

<h1>ğŸ‰ SÃ n Äáº¥u Váº­t NuÃ´i - Chá»n Há»c Sinh Ngáº«u NhiÃªn ğŸ‰</h1>

<label for="inputNames">Nháº­p danh sÃ¡ch tÃªn há»c sinh (tá»‘i Ä‘a 50), má»—i tÃªn má»™t dÃ²ng:</label><br/>
<textarea id="inputNames" placeholder="VÃ­ dá»¥: Nguyá»…n VÄƒn A&#10;Tráº§n Thá»‹ B&#10;LÃª VÄƒn C"></textarea><br/>

<button id="startBtn">ğŸš€ Báº¯t Ä‘áº§u Ä‘ua</button>
<button id="resetBtn" disabled>ğŸ”„ LÃ m láº¡i</button>

<div id="canvas-container"></div>

<div id="winner"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script>
  const { Engine, Render, Runner, Bodies, Composite, Events, Body, Vector } = Matter;

  const container = document.getElementById('canvas-container');
  const winnerDiv = document.getElementById('winner');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const inputNames = document.getElementById('inputNames');

  let engine, render, runner;
  let balls = [];
  let isRunning = false;

  const maxPlayers = 50;
  const arenaRadius = 380;

  // Táº¡o mÃ u sáº¯c khÃ¡c nhau cho tá»«ng thÃº
  function getRandomColor(seed) {
    const colors = [
      '#ff6f91', '#ff9671', '#ffc75f', '#f9f871', '#5bd1a6',
      '#00bcd4', '#8067c9', '#b36ac9', '#ff9a76', '#ff7f50',
      '#7fffd4', '#ffdab9', '#e0ffff', '#afeeee', '#dda0dd'
    ];
    return colors[seed % colors.length];
  }

  // Táº¡o thÃº (hÃ¬nh trÃ²n + tÃªn)
  function createAnimal(name, index) {
    // Random vá»‹ trÃ­ trong vÃ²ng trÃ²n arena
    let angle = Math.random() * 2 * Math.PI;
    let r = Math.random() * (arenaRadius - 30);
    let x = container.clientWidth/2 + r * Math.cos(angle);
    let y = container.clientHeight/2 + r * Math.sin(angle);

    let ball = Bodies.circle(x, y, 30, {
      restitution: 0.8,
      friction: 0.2,
      density: 0.002,
      label: name
    });
    ball.render.fillStyle = getRandomColor(index);
    ball.name = name;
    return ball;
  }

  // Váº½ tÃªn trÃªn canvas
  function drawNames(render, balls) {
    let ctx = render.context;
    ctx.font = "16px Arial";
    ctx.textAlign = "center";
    ctx.fillStyle = "black";
    balls.forEach(ball => {
      let pos = ball.position;
      ctx.fillText(ball.name, pos.x, pos.y - 40);
    });
  }

  // Táº¡o sÃ n Ä‘áº¥u hÃ¬nh trÃ²n ranh giá»›i
  function createArenaWalls() {
    let walls = [];

    // 4 cáº¡nh vuÃ´ng lá»›n chá»©a sÃ n
    walls.push(Bodies.rectangle(container.clientWidth/2, -50, container.clientWidth, 100, { isStatic: true }));
    walls.push(Bodies.rectangle(container.clientWidth/2, container.clientHeight + 50, container.clientWidth, 100, { isStatic: true }));
    walls.push(Bodies.rectangle(-50, container.clientHeight/2, 100, container.clientHeight, { isStatic: true }));
    walls.push(Bodies.rectangle(container.clientWidth + 50, container.clientHeight/2, 100, container.clientHeight, { isStatic: true }));

    return walls;
  }

  // Giá»›i háº¡n váº­t thá»ƒ trong vÃ²ng trÃ²n arena
  function keepInsideArena(ball) {
    let center = { x: container.clientWidth/2, y: container.clientHeight/2 };
    let dist = Matter.Vector.magnitude(Matter.Vector.sub(ball.position, center));
    if (dist > arenaRadius) {
      return false; // out of arena
    }
    return true;
  }

  // Khá»Ÿi táº¡o game
  function initGame(names) {
    if (engine) {
      Matter.Render.stop(render);
      Matter.Runner.stop(runner);
      Composite.clear(engine.world);
      Engine.clear(engine);
      render.canvas.remove();
      render.textures = {};
      balls = [];
      isRunning = false;
      winnerDiv.textContent = '';
    }

    engine = Engine.create();

    render = Render.create({
      element: container,
      engine: engine,
      options: {
        width: container.clientWidth,
        height: container.clientHeight,
        wireframes: false,
        background: 'transparent',
      }
    });

    // Äáº·t background sÃ n Ä‘áº¥u mÃ u tráº¯ng trÃ²n
    let ctx = render.context;
    ctx.canvas.style.borderRadius = '50%';

    Composite.add(engine.world, createArenaWalls());

    // Táº¡o cÃ¡c thÃº váº­t
    names.forEach((name, i) => {
      let animal = createAnimal(name, i);
      Composite.add(engine.world, animal);
      balls.push(animal);
    });

    // Táº¡o runner vÃ  render
    runner = Runner.create();
    Render.run(render);
    Runner.run(runner, engine);

    // Va cháº¡m táº¡o lá»±c ngáº«u nhiÃªn Ä‘áº©y nhau
    Events.on(engine, 'beforeUpdate', function() {
      balls.forEach(ball => {
        // Äáº©y ngáº«u nhiÃªn 1 lá»±c nhá» Ä‘á»ƒ Ä‘á»™ng váº­t khÃ´ng Ä‘á»©ng yÃªn
        let force = Vector.create((Math.random() - 0.5)*0.0006, (Math.random() - 0.5)*0.0006);
        Body.applyForce(ball, ball.position, force);
      });

      // Loáº¡i bá» thÃº ra khá»i vÃ²ng trÃ²n
      balls = balls.filter(ball => {
        if (!keepInsideArena(ball)) {
          Composite.remove(engine.world, ball);
          return false;
        }
        return true;
      });

      // Náº¿u cÃ²n 1 con duy nháº¥t thÃ¬ dá»«ng game
      if (balls.length === 1 && isRunning) {
        isRunning = false;
        winnerDiv.textContent = `ğŸ‰ NgÆ°á»i chiáº¿n tháº¯ng lÃ : ${balls[0].name} ğŸ‰`;
        resetBtn.disabled = false;
        startBtn.disabled = false;
        playWinSound();
      }
    });

    // Váº½ tÃªn má»—i frame
    Events.on(render, 'afterRender', function() {
      drawNames(render, balls);
    });

    resetBtn.disabled = true;
  }

  // PhÃ¡t Ã¢m thanh tháº¯ng
  function playWinSound() {
    const audio = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
    audio.volume = 0.5;
    audio.play();
  }

  // Báº¯t Ä‘áº§u game
  startBtn.addEventListener('click', () => {
    let rawNames = inputNames.value.trim();
    if (!rawNames) {
      alert('Vui lÃ²ng nháº­p danh sÃ¡ch tÃªn há»c sinh!');
      return;
    }
    let names = rawNames.split('\n').map(n => n.trim()).filter(n => n.length > 0).slice(0, 50);
    if (names.length < 2) {
      alert('Pháº£i nháº­p Ã­t nháº¥t 2 tÃªn!');
      return;
    }
    winnerDiv.textContent = '';
    initGame(names);
    isRunning = true;
    startBtn.disabled = true;
    resetBtn.disabled = false;
  });

  // Reset game
  resetBtn.addEventListener('click', () => {
    winnerDiv.textContent = '';
    balls = [];
    Composite.clear(engine.world);
    Engine.clear(engine);
    render.canvas.remove();
    render.textures = {};
    startBtn.disabled = false;
    resetBtn.disabled = true;
  });

</script>
</body>
</html>
