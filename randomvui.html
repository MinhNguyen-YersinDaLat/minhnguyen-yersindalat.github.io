<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Random Chọn Học Sinh - Thầy Nguyên</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f8ff;
    margin: 0; padding: 20px;
    text-align: center;
    overflow-x: hidden;
  }
  h1 {
    color: #d63384;
  }
  #inputSection {
    margin-bottom: 15px;
    max-width: 960px;
    margin-left: auto;
    margin-right: auto;
    text-align: left;
  }
  textarea {
    width: 100%;
    height: 100px;
    font-size: 16px;
    padding: 10px;
    border-radius: 10px;
    border: 2px solid #d63384;
    resize: vertical;
    box-sizing: border-box;
  }
  button {
    background: #d63384;
    border: none;
    color: white;
    padding: 12px 28px;
    font-size: 18px;
    margin: 10px 6px 20px;
    border-radius: 25px;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(214,51,132,0.7);
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #a30052;
  }
  #container {
    position: relative;
    width: 100%;
    max-width: 960px;
    margin: 0 auto 40px;
    height: 600px;
    border: 3px solid #d63384;
    border-radius: 15px;
    background: white;
    overflow: hidden;
  }
  .student {
    position: absolute;
    width: 50px;
    height: 50px;
    font-size: 40px;
    line-height: 50px;
    cursor: default;
    user-select: none;
    transition: all 0.5s ease;
    border-radius: 50%;
    background: #ffb6c1;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #880e4f;
    font-weight: 700;
    text-transform: uppercase;
  }
  .name {
    font-size: 11px;
    font-weight: 700;
    margin-top: 2px;
    user-select: none;
  }
  .dimmed {
    opacity: 0.3;
    transform: scale(0.7);
    filter: grayscale(70%);
  }
  .selected {
    border: 3px solid #d63384;
    box-shadow: 0 0 15px 4px #d63384;
  }
  .winner {
    animation: dizzySpin 2s linear infinite;
    z-index: 9999 !important;
    position: fixed !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) scale(4) rotate(0deg);
    transition: all 0.5s ease;
    background: #ff69b4 !important;
    color: white !important;
    font-size: 160px !important;
    width: 160px !important;
    height: 160px !important;
    line-height: 160px !important;
    border-radius: 50% !important;
    box-shadow: 0 0 40px 8px #ff1493 !important;
    flex-direction: column !important;
    user-select: none;
  }
  @keyframes dizzySpin {
    from { transform: translate(-50%, -50%) scale(4) rotate(0deg);}
    to { transform: translate(-50%, -50%) scale(4) rotate(360deg);}
  }
  #result {
    font-size: 22px;
    margin-top: 15px;
    min-height: 36px;
    color: #d63384;
    font-weight: 700;
  }
  #history {
    max-width: 960px;
    margin: 0 auto;
    text-align: left;
    color: #555;
  }
  #history h2 {
    color: #d63384;
  }
  #historyList {
    list-style: none;
    padding-left: 0;
    font-size: 16px;
  }
  #historyList li {
    padding: 4px 0;
    border-bottom: 1px solid #eee;
  }
</style>
</head>
<body>

<h1>🎲 Chọn ngẫu nhiên học sinh vui nhộn 🎉</h1>

<div id="inputSection">
  <label for="namesInput" style="font-weight:bold; color:#d63384;">Nhập tên học sinh mỗi dòng một tên (tối đa 50):</label><br>
  <textarea id="namesInput" placeholder="VD: Nguyễn Văn A&#10;Trần Thị B&#10;Lê Minh C"></textarea><br>
  <button id="btnUpdateList">Cập nhật danh sách học sinh</button>
</div>

<div id="container"></div>

<div>
  <button id="btnRandom">🚀 Chọn Ngẫu Nhiên</button>
  <button id="btnContinue" style="display:none;">🔄 Tiếp tục</button>
</div>

<div id="result"></div>

<section id="history">
  <h2>Lịch sử kết quả</h2>
  <ul id="historyList"></ul>
</section>

<script>
  // 50 icon dễ thương làm con vật đại diện
  const animalIcons = [
    '🐶','🐱','🐭','🐹','🐰','🦊','🐻','🐼','🐨','🐯',
    '🦁','🐮','🐷','🐸','🐵','🐔','🐧','🐦','🐤','🐣',
    '🦆','🦅','🦉','🦇','🐺','🐗','🐴','🦄','🐝','🐛',
    '🦋','🐌','🐞','🐜','🕷️','🦂','🐢','🐍','🦎','🐙',
    '🦀','🐠','🐬','🐳','🐋','🦈','🐊','🐅','🐆','🦓'
  ];

  let students = [
    "Nguyễn Văn An", "Trần Thị Bình", "Lê Minh Cường", "Phạm Thị Duyên", "Hoàng Văn Đông",
    "Võ Minh Thịnh", "Bùi Thị Hồng", "Đặng Văn Khoa", "Phan Thị Lan", "Trương Văn Nam",
    "Lý Thị Oanh", "Ngô Văn Phúc", "Vũ Thị Quỳnh", "Đỗ Văn Sơn", "Phùng Thị Thanh",
    "Lâm Văn Tuấn", "Trịnh Thị Uyên", "Hồ Văn Vinh", "Dương Thị Xinh", "Mai Văn Yên",
    "Trần Văn Anh", "Nguyễn Thị Bình", "Lê Văn Cường", "Phạm Thị Dung", "Hoàng Thị Dung",
    "Võ Văn Thịnh", "Bùi Thị Hoa", "Đặng Văn Kiên", "Phan Thị Linh", "Trương Văn Nam",
    "Lý Thị Oanh", "Ngô Văn Phong", "Vũ Thị Quang", "Đỗ Văn Sơn", "Phùng Thị Thanh",
    "Lâm Văn Tú", "Trịnh Thị Uyên", "Hồ Văn Vĩnh", "Dương Thị Xinh", "Mai Văn Yến",
    "Trần Văn Anh", "Nguyễn Thị Bình", "Lê Văn Cường", "Phạm Thị Dung", "Hoàng Thị Dung",
    "Võ Văn Thịnh", "Bùi Thị Hoa", "Đặng Văn Kiên", "Phan Thị Linh", "Trương Văn Nam"
  ];

  // Chuẩn hóa tên: VD "Võ Minh Thịnh" thành "VM THỊNH"
  function shortName(fullName) {
    fullName = fullName.trim();
    const parts = fullName.split(/\s+/);
    if(parts.length === 1) return fullName.toUpperCase();
    const firstInitial = parts[0][0].toUpperCase();
    const lastName = parts[parts.length-1].toUpperCase();
    return firstInitial + lastName;
  }

  let activeStudents = [];

  const container = document.getElementById('container');
  const btnRandom = document.getElementById('btnRandom');
  const btnContinue = document.getElementById('btnContinue');
  const result = document.getElementById('result');
  const historyList = document.getElementById('historyList');
  const namesInput = document.getElementById('namesInput');
  const btnUpdateList = document.getElementById('btnUpdateList');

  // Tạo vị trí ngẫu nhiên trong container, không chồng lên nhau
  function randomPosition(existingPositions, width=50, height=50) {
    const maxX = container.clientWidth - width;
    const maxY = container.clientHeight - height;
    let tries = 0;
    while(tries < 1000){
      const x = Math.floor(Math.random()*maxX);
      const y = Math.floor(Math.random()*maxY);
      if(existingPositions.every(p => {
        const dx = p.x - x;
        const dy = p.y - y;
        return Math.sqrt(dx*dx + dy*dy) > 60;
      })) {
        return {x,y};
      }
      tries++;
    }
    return {x:0,y:0};
  }

  // Tạo icon học sinh lên màn hình
  function createStudents(){
    activeStudents = [];
    container.innerHTML = '';
    let positions = [];
    for(let i=0; i<students.length && i<50; i++){
      const icon = animalIcons[i % animalIcons.length];
      const name = students[i];
      const short = shortName(name);
      const pos = randomPosition(positions);
      positions.push(pos);

      const el = document.createElement('div');
      el.classList.add('student');
      el.style.left = pos.x + 'px';
      el.style.top = pos.y + 'px';
      el.innerHTML = `<div class="icon">${icon}</div><div class="name">${short}</div>`;

      container.appendChild(el);

      activeStudents.push({name, short, icon, x: pos.x, y: pos.y, element: el});
    }
  }

  createStudents();

  // Xáo trộn vị trí và nhảy nhót (lộn xộn)
  function shufflePositions(){
    let positions = [];
    activeStudents.forEach(s => {
      const pos = randomPosition(positions);
      positions.push(pos);
      s.x = pos.x;
      s.y = pos.y;
      s.element.style.left = s.x + 'px';
      s.element.style.top = s.y + 'px';
      s.element.classList.remove('selected','winner','dimmed');
      s.element.style.opacity = '1';
      s.element.style.transform = 'scale(1) rotate(0deg)';
    });
  }

  let selectedStudent = null;
  let jumpCount = 0;
  let jumpInterval = null;
  const jumps = 30;

  function selectRandomStudent(){
    if(activeStudents.length === 0) {
      alert("Danh sách học sinh trống. Vui lòng nhập tên học sinh.");
      return;
    }
    btnRandom.disabled = true;
    btnContinue.style.display = 'none';
    result.textContent = '';

    jumpCount = 0;

    jumpInterval = setInterval(() => {
      shufflePositions();
      jumpCount++;

      if(jumpCount >= jumps){
        clearInterval(jumpInterval);

        const idx = Math.floor(Math.random() * activeStudents.length);
        selectedStudent = activeStudents[idx];

        activeStudents.forEach(s=>{
          s.element.classList.remove('selected','winner','dimmed');
          s.element.style.position = 'absolute';
        });

        selectedStudent.element.classList.add('selected','winner');

        activeStudents.forEach(s=>{
          if(s !== selectedStudent){
            s.element.classList.add('dimmed');
            s.element.style.position = 'relative';
          }
        });

        result.textContent = `🎉 Đã chọn: ${selectedStudent.icon} ${selectedStudent.name.toUpperCase()} 🎉`;
        updateHistory(selectedStudent.name.toUpperCase(), selectedStudent.icon);

        const audio = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
        audio.volume = 0.6;
        audio.play();

        btnRandom.style.display = "none";
        btnContinue.style.display = "inline-block";
        btnRandom.disabled = false;
      }
    }, 150);
  }

  btnRandom.addEventListener('click', selectRandomStudent);

  let history = [];

  function updateHistory(name, icon){
    history.unshift({name, icon});
    if(history.length > 10) history.pop();
    historyList.innerHTML = '';
    history.forEach((item) => {
      const li = document.createElement('li');
      li.textContent = `${item.icon}  ${item.name}`;
      historyList.appendChild(li);
    });
  }

  btnContinue.addEventListener('click', () => {
    if(selectedStudent){
      students = students.filter(s => s !== selectedStudent.name);
      createStudents();
      selectedStudent = null;
      result.textContent = '';
      btnRandom.style.display = "inline-block";
      btnContinue.style.display = "none";
    }
  });

  btnUpdateList.addEventListener('click', () => {
    let inputText = namesInput.value.trim();
    if(!inputText){
      alert("Vui lòng nhập tên học sinh.");
      return;
    }
    let namesArray = inputText.split('\n')
      .map(name => name.trim())
      .filter(name => name.length > 0)
      .slice(0,50); // tối đa 50 tên
    students = namesArray;
    createStudents();
    selectedStudent = null;
    result.textContent = '';
    btnRandom.style.display = "inline-block";
    btnContinue.style.display = "none";
    history = [];
    historyList.innerHTML = '';
  });

  // Gán giá trị mặc định vào textarea
  namesInput.value = students.join('\n');
</script>

</body>
</html>
