<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vòng Quay Vui Vẻ - Chọn ngẫu nhiên học sinh</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);
    margin: 0; padding: 20px;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
    color: #333;
  }

  h1 {
    margin-bottom: 12px;
    color: #d6336c;
    font-weight: 900;
    text-shadow: 1px 1px 2px #fff;
  }

  #input-area {
    width: 100%;
    max-width: 600px;
    margin-bottom: 20px;
  }
  #input-area textarea {
    width: 100%;
    height: 100px;
    border-radius: 10px;
    border: 2px solid #ff77aa;
    font-size: 16px;
    padding: 10px;
    resize: vertical;
  }
  #input-area button {
    margin-top: 10px;
    background-color: #ff4b81;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 25px;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #input-area button:hover {
    background-color: #d62e5a;
  }

  #animal-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 900px;
    gap: 15px;
    margin-bottom: 30px;
    min-height: 110px;
  }

  .animal-card {
    width: 60px;
    height: 90px;
    background: #fff0f5;
    border-radius: 15px;
    box-shadow: 0 3px 7px rgba(214, 50, 90, 0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: all 0.4s ease;
    position: relative;
    cursor: default;
    user-select: none;
  }

  .animal-icon {
    font-size: 2.5rem;
    line-height: 1;
    user-select: none;
    transition: transform 0.4s ease;
    filter: drop-shadow(1px 2px 1px rgba(214, 50, 90, 0.7));
  }
  .animal-name {
    font-size: 0.9rem;
    margin-top: 6px;
    color: #d6336c;
    font-weight: 600;
    user-select: none;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  .dimmed {
    opacity: 0.3;
    filter: grayscale(100%);
  }

  .winner {
    position: fixed !important;
    top: 50%; left: 50%;
    transform-origin: center center;
    z-index: 1000 !important;
    box-shadow: 0 0 40px 10px #ff2e8c inset;
    border-radius: 50%;
    width: 150px !important;
    height: 210px !important;
    font-size: 7rem !important;
    background: #fff0f5;
    animation: winnerRotate 3s linear forwards;
    cursor: default !important;
  }

  .winner .animal-name {
    font-size: 2.8rem !important;
    margin-top: 10px;
    color: #ff2e8c;
    font-weight: 900;
    text-shadow: 0 0 4px #ff75b1;
  }

  #winner-display {
    display: none;
    flex-direction: column;
    align-items: center;
    margin-bottom: 25px;
  }

  #next-btn {
    display: none;
    background-color: #ff2e8c;
    color: white;
    border: none;
    padding: 14px 30px;
    border-radius: 30px;
    font-size: 1.2rem;
    cursor: pointer;
    font-weight: 700;
    box-shadow: 0 4px 8px rgba(255, 46, 140, 0.5);
    transition: background-color 0.3s ease;
  }
  #next-btn:hover {
    background-color: #d1236a;
  }

  #history {
    max-width: 600px;
    width: 90%;
    background: #fff0f5;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(214, 50, 90, 0.2);
    padding: 15px 20px;
    margin-top: auto;
    text-align: left;
    font-weight: 600;
    color: #c40a66;
  }
  #history h3 {
    margin-top: 0;
    font-weight: 900;
    font-size: 1.4rem;
  }
  #history ul {
    padding-left: 20px;
    margin: 5px 0 0 0;
  }
  #history li {
    list-style-type: disc;
    margin-bottom: 6px;
    font-size: 1rem;
  }

  @keyframes winnerRotate {
    0% { transform: rotate(0deg) scale(1); }
    100% { transform: rotate(360deg) scale(2.5); }
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }
  .blink {
    animation: blink 1s infinite;
  }
</style>
</head>
<body>

<h1>🎉 Vòng Quay Vui Vẻ</h1>

<div id="input-area">
  <textarea id="names-input" placeholder="Nhập danh sách tên học sinh, mỗi tên một dòng (tối đa 50)"></textarea>
  <button id="start-btn">Bắt đầu chọn</button>
</div>

<div id="animal-container"></div>

<div id="winner-display"></div>

<button id="next-btn">Chọn tiếp</button>

<div id="history">
  <h3>Lịch sử kết quả</h3>
  <ul id="history-list"></ul>
</div>

<audio id="win-sound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>

<script>
  const maxStudents = 50;
  const animalIcons = ['🐰','🐷','🐸','🐵','🐥','🐝','🐴','🐭','🐶','🐱','🐰','🐷','🐸','🐵','🐥','🐝','🐴','🐭','🐶','🐱','🐰','🐷','🐸','🐵','🐥','🐝','🐴','🐭','🐶','🐱','🐰','🐷','🐸','🐵','🐥','🐝','🐴','🐭','🐶','🐱','🐰','🐷','🐸','🐵','🐥','🐝','🐴','🐭','🐶','🐱'];

  const namesInput = document.getElementById('names-input');
  const startBtn = document.getElementById('start-btn');
  const animalContainer = document.getElementById('animal-container');
  const winnerDisplay = document.getElementById('winner-display');
  const nextBtn = document.getElementById('next-btn');
  const historyList = document.getElementById('history-list');
  const winSound = document.getElementById('win-sound');

  let animals = [];
  let winner = null;
  let history = [];
  let choosingInProgress = false;

  // Xử lý tên: lấy chữ cuối, in hoa
  function formatName(fullName) {
    let parts = fullName.trim().split(/\s+/);
    if(parts.length === 0) return '';
    let lastName = parts[parts.length-1];
    return lastName.toUpperCase();
  }

  // Tạo thẻ thú với tên
  function createAnimalCard(name, icon) {
    const card = document.createElement('div');
    card.classList.add('animal-card');
    card.innerHTML = `
      <div class="animal-icon">${icon}</div>
      <div class="animal-name">${name}</div>
    `;
    return card;
  }

  // Hiển thị danh sách thú
  function displayAnimals(){
    animalContainer.innerHTML = '';
    animals.forEach(({name, icon}) => {
      const card = createAnimalCard(name, icon);
      animalContainer.appendChild(card);
      animals.find(a => a.name === name).card = card;
    });
  }

  // Cập nhật lịch sử
  function updateHistory(){
    historyList.innerHTML = '';
    history.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      historyList.appendChild(li);
    });
  }

  // Bắt đầu chọn người thắng
  function chooseWinner(){
    if(choosingInProgress) return;
    if(animals.length === 0) {
      alert('Không còn ai để chọn!');
      nextBtn.style.display = 'none';
      return;
    }
    choosingInProgress = true;

    const winnerIndex = Math.floor(Math.random() * animals.length);
    winner = animals[winnerIndex];

    animals.forEach(({card}, idx) => {
      if(idx === winnerIndex){
        card.classList.add('winner', 'blink');
        card.style.transform = 'translate(0,0)';
        card.style.zIndex = '1000';
      } else {
        card.classList.add('dimmed');
        card.style.transform = 'none';
      }
    });

    winnerDisplay.style.display = 'flex';
    winnerDisplay.innerHTML = '';

    const winnerCard = createAnimalCard(winner.name, winner.icon);
    winnerCard.classList.add('winner');
    winnerCard.style.width = '150px';
    winnerCard.style.height = '210px';
    winnerCard.style.fontSize = '7rem';
    winnerCard.style.borderRadius = '50%';
    winnerCard.style.boxShadow = '0 0 25px #ff1493 inset';
    winnerCard.style.animation = 'winnerRotate 3s linear forwards';

    winnerDisplay.appendChild(winnerCard);

    const winnerName = document.createElement('p');
    winnerName.textContent = winner.name;
    winnerName.style.color = '#ff1493';
    winnerName.style.fontSize = '2.5rem';
    winnerName.style.fontWeight = '900';
    winnerName.style.textTransform = 'uppercase';
    winnerName.style.marginTop = '12px';
    winnerName.style.userSelect = 'text';
    winnerDisplay.appendChild(winnerName);

    winSound.currentTime = 0;
    winSound.play();

    history.unshift(winner.name);
    if(history.length > 20) history.pop();
    updateHistory();

    nextBtn.style.display = 'none';

    setTimeout(() => {
      winnerDisplay.style.display = 'none';
      nextBtn.style.display = 'inline-block';
      choosingInProgress = false;
    }, 3000);
  }

  startBtn.onclick = () => {
    let rawNames = namesInput.value.trim().split('\n').filter(n => n.trim() !== '');
    if(rawNames.length === 0) {
      alert("Vui lòng nhập ít nhất một tên!");
      return;
    }
    if(rawNames.length > maxStudents){
      alert(`Chỉ được nhập tối đa ${maxStudents} tên thôi nha!`);
      rawNames = rawNames.slice(0, maxStudents);
    }

    animals = rawNames.map((fullName, i) => {
      return {
        name: formatName(fullName),
        icon: animalIcons[i % animalIcons.length],
        card: null
      };
    });

    winner = null;
    history = [];
    updateHistory();
    displayAnimals();

    nextBtn.style.display = 'inline-block';
  };

  nextBtn.onclick = () => {
    chooseWinner();
  };
</script>

</body>
</html>
