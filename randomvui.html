<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üé≤ G·ªçi ng·∫´u nhi√™n h·ªçc sinh - D·ª± √°n Th·∫ßy Nguy√™n</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    margin: 0; padding: 0;
    display: flex; flex-direction: column;
    align-items: center;
    min-height: 100vh;
    user-select: none;
  }
  h1 {
    margin-top: 30px;
    color: #333;
    font-weight: 700;
  }
  #inputArea {
    margin: 20px 0 10px 0;
    max-width: 600px;
    width: 90%;
    text-align: center;
  }
  textarea {
    width: 100%;
    height: 100px;
    font-size: 1rem;
    padding: 10px;
    border-radius: 10px;
    border: 1.5px solid #aaa;
    resize: vertical;
    box-sizing: border-box;
    font-family: monospace;
  }
  button {
    margin-top: 12px;
    padding: 10px 30px;
    font-size: 1.1rem;
    background: #ff69b4;
    color: white;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(255,105,180,0.4);
    transition: background 0.3s ease;
  }
  button:hover {
    background: #e04893;
  }
  #animalContainer {
    margin-top: 25px;
    max-width: 980px;
    width: 95%;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
  }
  .animal-card {
    position: relative;
    width: 90px;
    height: 130px; /* ƒë·ªß ch·ªó cho icon + t√™n */
    background: white;
    border-radius: 30px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.12);
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    padding-top: 10px;
    gap: 6px;
    user-select: none;
    cursor: default;
    transition: transform 0.35s ease, filter 0.35s ease;
    will-change: transform, filter;
    animation: gentleJump 1.5s ease-in-out infinite;
  }
  .animal-icon {
    font-size: 4.5rem;
    line-height: 1;
    width: 90px;
    height: 90px;
    text-align: center;
    user-select: none;
    pointer-events: none;
  }
  .animal-name {
    margin: 0;
    font-weight: 900;
    font-size: 1rem;
    color: #444;
    user-select: text;
    text-transform: uppercase;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 85px;
    text-align: center;
  }

  /* Hi·ªáu ·ª©ng nh·∫£y nh·∫π */
  @keyframes gentleJump {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  /* Khi th·∫Øng */
  .winner {
    animation: winnerScaleRotate 4s ease forwards;
    z-index: 10;
  }
  @keyframes winnerScaleRotate {
    0% { transform: scale(1) rotate(0deg); filter: drop-shadow(0 0 2px #ff69b4); }
    50% { transform: scale(4) rotate(720deg); filter: drop-shadow(0 0 15px #ff1493); }
    100% { transform: scale(3) rotate(1440deg); filter: drop-shadow(0 0 10px #ff69b4); }
  }

  /* M·ªù ƒëi c√°c con c√≤n l·∫°i khi c√≥ winner */
  .dimmed {
    filter: brightness(0.6);
    transition: filter 0.4s ease;
  }

  /* Hi·ªáu ·ª©ng ch·ªõp l·∫•p l√°nh winner */
  .winner::after {
    content: '';
    position: absolute;
    top: 5px; left: 5px; right: 5px; bottom: 5px;
    border-radius: 30px;
    box-shadow: 0 0 15px 5px #ff69b4;
    animation: sparkle 1.2s infinite;
    pointer-events: none;
    z-index: 20;
  }
  @keyframes sparkle {
    0%, 100% { box-shadow: 0 0 15px 5px #ff69b4; }
    50% { box-shadow: 0 0 30px 10px #ff1493; }
  }

  /* Ph·∫ßn b·∫£ng k·∫øt qu·∫£ */
  #resultArea {
    margin-top: 25px;
    max-width: 600px;
    width: 90%;
    text-align: center;
  }
  #resultArea h2 {
    color: #d63384;
    margin-bottom: 10px;
  }
  #historyList {
    max-height: 180px;
    overflow-y: auto;
    background: white;
    border-radius: 10px;
    padding: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    font-family: monospace;
    color: #222;
  }
  #historyList li {
    margin-bottom: 5px;
    border-bottom: 1px solid #eee;
    padding-bottom: 3px;
  }

  /* Gi·ªØ winner gi·ªØa m√†n h√¨nh */
  #winnerDisplay {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 100;
  }

</style>
</head>
<body>

<h1>üéâ G·ªçi ng·∫´u nhi√™n h·ªçc sinh d·ªÖ th∆∞∆°ng üéâ</h1>

<div id="inputArea">
  <textarea id="namesInput" placeholder="Nh·∫≠p danh s√°ch t√™n h·ªçc sinh, m·ªói t√™n 1 d√≤ng (t·ªëi ƒëa 50 h·ªçc sinh)"></textarea>
  <br />
  <button id="startBtn">üé¨ B·∫Øt ƒë·∫ßu cu·ªôc ƒëua th√∫!</button>
  <button id="nextBtn" style="display:none; margin-left:15px; background:#ff1493;">‚û° Ti·∫øp t·ª•c (lo·∫°i ng∆∞·ªùi th·∫Øng)</button>
</div>

<div id="animalContainer"></div>

<div id="winnerDisplay" style="display:none;">
  <!-- Winner icon + name s·∫Ω hi·ªán ·ªü ƒë√¢y -->
</div>

<div id="resultArea">
  <h2>üìã L·ªãch s·ª≠ k·∫øt qu·∫£</h2>
  <ul id="historyList"></ul>
</div>

<script>
  const animalIcons = [
    'üê∞','üê∑','üê∏','üêµ','üêº','üê®','ü¶ä','üêØ','üêÆ','üêî',
    'ü¶Ñ','üê≠','üêπ','üêª','üê§','ü¶â','üêô','ü¶Ä','üê¢','ü¶ã',
    'üêù','üêû','ü¶Ü','üêß','ü¶î','üê¥','ü¶å','üê∫','üêó','ü¶â',
    'üê¨','üê†','üê°','ü¶¢','üêì','ü¶ù','üêï','üê©','üêà','ü¶ú',
    'üêá','ü¶•','ü¶®','üê¶','ü¶ö','üêøÔ∏è','ü¶•','ü¶¶','üêâ','ü¶Ñ'
  ];

  let animals = [];
  let winner = null;
  let history = [];

  const container = document.getElementById('animalContainer');
  const startBtn = document.getElementById('startBtn');
  const nextBtn = document.getElementById('nextBtn');
  const namesInput = document.getElementById('namesInput');
  const winnerDisplay = document.getElementById('winnerDisplay');
  const historyList = document.getElementById('historyList');

  function normalizeName(name) {
    name = name.trim();
    if (name.length === 0) return null;
    // In hoa ƒë·∫ßy ƒë·ªß
    return name.toUpperCase();
  }

  function createAnimalCard(name, icon) {
    const card = document.createElement('div');
    card.classList.add('animal-card');

    const iconEl = document.createElement('div');
    iconEl.classList.add('animal-icon');
    iconEl.textContent = icon;

    const nameEl = document.createElement('p');
    nameEl.classList.add('animal-name');
    nameEl.textContent = name;

    card.appendChild(iconEl);
    card.appendChild(nameEl);

    return card;
  }

  function shuffleArray(arr) {
    for(let i = arr.length -1; i > 0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function startRace() {
    const namesRaw = namesInput.value.split('\n');
    let cleanNames = namesRaw.map(normalizeName).filter(n => n !== null);
    if(cleanNames.length === 0){
      alert("Vui l√≤ng nh·∫≠p √≠t nh·∫•t m·ªôt t√™n h·ªçc sinh.");
      return;
    }
    if(cleanNames.length > 50){
      alert("T·ªëi ƒëa 50 h·ªçc sinh th√¥i nha!");
      cleanNames = cleanNames.slice(0, 50);
    }
    animals = [];
    container.innerHTML = '';
    winnerDisplay.style.display = 'none';
    winner = null;

    // G√°n icon tu·∫ßn t·ª± ho·∫∑c random n·∫øu h·ªçc sinh > s·ªë icon
    for(let i = 0; i < cleanNames.length; i++){
      const icon = animalIcons[i % animalIcons.length];
      const card = createAnimalCard(cleanNames[i], icon);
      container.appendChild(card);
      animals.push({name: cleanNames[i], icon, card});
    }

    nextBtn.style.display = 'none';

    animateRace();
  }

  // Hi·ªáu ·ª©ng nh·∫£y nh√≥t l·ªôn x·ªôn
  function animateRace(){
    let moves = 100; // s·ªë b∆∞·ªõc l·∫Øc l∆∞
    let interval = 80; // ms cho m·ªói b∆∞·ªõc

    let count = 0;
    const moveInterval = setInterval(() => {
      animals.forEach(({card}) => {
        const dx = (Math.random()-0.5)*20;
        const dy = (Math.random()-0.5)*15;
        card.style.transform = `translate(${dx}px, ${dy}px)`;
      });
      count++;
      if(count >= moves){
        clearInterval(moveInterval);
        chooseWinner();
      }
    }, interval);
  }

  function chooseWinner(){
    const winnerIndex = Math.floor(Math.random() * animals.length);
    winner = animals[winnerIndex];

    animals.forEach(({card}, idx) => {
      if(idx === winnerIndex){
        card.classList.add('winner');
        card.style.transform = 'translate(0,0)';
        card.style.zIndex = '100';
      } else {
        card.classList.add('dimmed');
        card.style.transform = 'none';
      }
    });

    winnerDisplay.style.display = 'block';
    winnerDisplay.innerHTML = '';

    const winnerCard = createAnimalCard(winner.name, winner.icon);
    winnerCard.style.width = '180px';
    winnerCard.style.height = '240px';
    winnerCard.style.fontSize = '9rem';
    winnerCard.style.borderRadius = '40px';
    winnerCard.style.boxShadow = '0 0 30px #ff1493';
    winnerCard.style.animation = 'winnerScaleRotate 4s ease forwards';

    winnerDisplay.appendChild(winnerCard);

    history.unshift(winner.name);
    if(history.length > 20) history.pop();
    updateHistory();

    nextBtn.style.display = 'inline-block';
  }

  function updateHistory(){
    historyList.innerHTML = '';
    history.forEach((name, idx) => {
      const li = document.createElement('li');
      li.textContent = `${history.length - idx}. ${name}`;
      historyList.appendChild(li);
    });
  }

  nextBtn.addEventListener('click', () => {
    animals = animals.filter(a => a.name !== winner.name);
    winner = null;
    winnerDisplay.style.display = 'none';
    nextBtn.style.display = 'none';
    container.innerHTML = '';
    animals.forEach(({name, icon}) => {
      const card = createAnimalCard(name, icon);
      container.appendChild(card);
    });
    if(animals.length === 0){
      alert("H·∫øt h·ªçc sinh ƒë·ªÉ ch·ªçn r·ªìi!");
      return;
    }
    animateRace();
  });

  startBtn.addEventListener('click', startRace);

</script>

</body>
</html>
