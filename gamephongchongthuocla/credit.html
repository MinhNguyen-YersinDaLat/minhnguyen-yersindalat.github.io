<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit - Cuộc Chiến Không Khói</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(45deg, #000000, #0a0a0a, #000000);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            color: #fff;
            font-family: 'Arial', 'Helvetica', sans-serif;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* --- GIAO DIỆN NÚT MỚI --- */
        .ui-button {
            position: fixed;
            z-index: 9999;
            width: 44px;
            height: 44px;
            background: rgba(10, 20, 30, 0.5);
            border: 1px solid rgba(224, 194, 109, 0.3);
            border-radius: 50%;
            color: rgba(224, 194, 109, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(224, 194, 109, 0.2), inset 0 0 5px rgba(224, 194, 109, 0.1);
        }
        .ui-button:hover {
            background: rgba(20, 40, 60, 0.7);
            color: white;
            border-color: rgba(224, 194, 109, 0.8);
            box-shadow: 0 0 25px rgba(224, 194, 109, 0.5), inset 0 0 10px rgba(224, 194, 109, 0.2);
            transform: scale(1.1);
        }
        #fullscreen-btn {
            top: 1rem;
            right: 1rem;
        }
        #back-to-main-btn {
            bottom: 1rem;
            left: 1rem;
        }


        .credits-container {
            position: absolute;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .credits-content {
            width: 85%;
            max-width: 800px;
            text-align: center;
            line-height: 1.8;
            position: absolute; 
        }

        .title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            animation: glow 3s ease-in-out infinite alternate;
        }

        .subtitle {
            font-size: 1.5rem;
            margin-bottom: 3rem;
            font-style: italic;
            opacity: 0.9;
        }

        .section {
            margin-bottom: 3rem;
            padding: 1rem 0;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .author-name {
            font-size: 2rem;
            font-weight: bold;
            margin: 1rem 0;
            text-shadow: 0 0 25px rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .quote {
            font-size: 1.3rem;
            font-style: italic;
            margin: 2rem 0;
            padding: 2rem;
            border-left: 3px solid rgba(224, 194, 109, 0.5);
            background: rgba(224, 194, 109, 0.05);
            border-radius: 10px;
            text-shadow: 0 0 10px rgba(224, 194, 109, 0.2);
        }

        .message {
            font-size: 1.2rem;
            margin: 1.5rem 0;
            padding: 1rem;
        }

        .final-message {
            font-size: 1.4rem;
            font-style: italic;
            margin-top: 3rem;
            padding: 2rem;
            background: linear-gradient(45deg, rgba(224, 194, 109, 0.1), rgba(224, 194, 109, 0.05));
            border-radius: 15px;
            text-shadow: 0 0 15px rgba(224, 194, 109, 0.4);
        }
        
        .metaphor-block {
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(80, 70, 45, 0.15);
            border-radius: 10px;
            text-align: left;
            border: 1px solid rgba(224, 194, 109, 0.2);
        }
        .metaphor-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #E0C26D;
            margin-bottom: 0.5rem;
        }
        .metaphor-desc {
            font-size: 1.1rem;
            line-height: 1.7;
        }

        .reference-list {
            list-style: none;
            padding: 0;
            margin: 1.5rem 0;
        }
        .reference-list li {
            margin: 0.5rem 0;
        }
        .reference-list a {
            color: #E0C26D;
            text-decoration: none;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        .reference-list a:hover {
            color: #fff;
            text-shadow: 0 0 10px #E0C26D;
        }


        @keyframes glow {
            0% { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
            100% { text-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 40px rgba(255, 255, 255, 0.6); }
        }

        .light-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 20%, rgba(224, 194, 109, 0.08) 0%, transparent 50%);
            pointer-events: none;
            animation: lightPulse 8s ease-in-out infinite;
        }

        @keyframes lightPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #fff, transparent),
                radial-gradient(2px 2px at 40px 70px, #fff, transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, #fff, transparent),
                radial-gradient(2px 2px at 160px 30px, #fff, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: twinkle 4s linear infinite;
            opacity: 0.6;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(224, 194, 109, 0.7);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(0px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(100px); opacity: 0; }
        }

        .lens-flare {
            position: absolute;
            top: 10%;
            left: 20%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(224, 194, 109, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: flareMove 25s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes flareMove {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.3; }
            25% { transform: translate(300px, 200px) scale(1.5); opacity: 0.6; }
            50% { transform: translate(-100px, 400px) scale(0.8); opacity: 0.4; }
            75% { transform: translate(400px, -100px) scale(1.2); opacity: 0.5; }
        }

        .timeline-controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            opacity: 1;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .timeline-controls.hidden {
            opacity: 0;
            transform: translateX(-50%) translateY(20px);
            pointer-events: none;
        }

        .timeline-slider {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timeline-slider:hover {
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
        }

        .timeline-progress {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #E0C26D);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
            box-shadow: 0 0 10px rgba(224, 194, 109, 0.5);
        }

        .timeline-thumb {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background: linear-gradient(45deg, #ffd700, #E0C26D);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(224, 194, 109, 0.7);
            transition: all 0.3s ease;
        }

        .timeline-thumb:hover {
            width: 20px;
            height: 20px;
            box-shadow: 0 0 20px rgba(224, 194, 109, 0.9);
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .control-btn svg {
            width: 22px;
            height: 22px;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        .control-btn.active {
            background: linear-gradient(45deg, #ffd700, #E0C26D);
            border-color: transparent;
            box-shadow: 0 0 20px rgba(224, 194, 109, 0.5);
        }

        .time-display {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-family: monospace;
            min-width: 80px;
            text-align: center;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .speed-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 5px 10px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .speed-btn:hover, .speed-btn.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-color: rgba(255, 255, 255, 0.4);
        }

        .end-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 1s ease;
        }

        .end-screen.show {
            opacity: 1;
            visibility: visible;
        }

        .end-message {
            text-align: center;
            color: #fff;
            font-size: 2.5rem;
            font-weight: bold;
            line-height: 1.4;
            margin-bottom: 2rem;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
            animation: starGlow 2s ease-in-out infinite alternate;
        }

        .end-message .highlight {
            background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: goldShimmer 3s ease-in-out infinite;
        }

        .end-sparkle {
            width: 100px;
            height: 100px;
            margin: 1rem 0;
        }
        
        .end-sparkle .sparkle-main {
            animation: sparkle-main-anim 1.5s ease-in-out infinite;
            transform-origin: center;
        }
        .end-sparkle .sparkle-halo {
            animation: sparkle-halo-anim 1.5s ease-in-out infinite;
            transform-origin: center;
        }
        .end-sparkle .sparkle-small {
            animation: sparkle-small-anim 1.5s ease-in-out infinite;
            transform-origin: center;
        }
        @keyframes sparkle-main-anim {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(90deg); }
        }
        @keyframes sparkle-halo-anim {
            0%, 100% { transform: scale(0.8); opacity: 0.3; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
        @keyframes sparkle-small-anim {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(-90deg); opacity: 0.5; }
        }


        @keyframes starGlow {
            0% { text-shadow: 0 0 20px rgba(255, 255, 255, 0.6), 0 0 40px rgba(255, 215, 0, 0.4); }
            100% { text-shadow: 0 0 40px rgba(255, 255, 255, 0.9), 0 0 60px rgba(255, 215, 0, 0.7); }
        }

        @keyframes goldShimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }


        .end-buttons {
            display: flex;
            gap: 1.5rem;
            margin-top: 2rem;
            opacity: 0;
            animation: fadeInButtons 1s ease 3s forwards;
            flex-wrap: wrap;
            justify-content: center;
            padding: 0 1rem;
        }

        @keyframes fadeInButtons { to { opacity: 1; } }

        .end-btn {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.2), rgba(255, 255, 255, 0.1));
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 25px;
            padding: 15px 30px;
            color: #ffd700;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .end-btn svg {
            width: 20px;
            height: 20px;
        }

        .end-btn:hover {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.3), rgba(255, 255, 255, 0.2));
            border-color: rgba(255, 215, 0, 0.8);
            transform: translateY(-3px);
            box-shadow: 0 5px 30px rgba(255, 215, 0, 0.5);
            color: #fff;
        }
        .end-btn:hover svg {
            filter: drop-shadow(0 0 5px #fff);
        }

        .end-btn.primary {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            border-color: #ffd700;
        }

        .end-btn.primary:hover {
            background: linear-gradient(45deg, #ffed4e, #ffd700);
            box-shadow: 0 5px 30px rgba(255, 215, 0, 0.7);
        }
        
        .end-btn.extra-primary {
            background: linear-gradient(45deg, #ffd700, #E0C26D);
            color: #000;
            border-color: #E0C26D;
            animation: pulseButton 2s infinite;
            font-size: 1.2rem; /* Make it slightly bigger */
            padding: 18px 35px;
        }
        .end-btn.extra-primary svg {
             width: 24px;
             height: 24px;
        }

        .end-btn.extra-primary:hover {
            background: linear-gradient(45deg, #E0C26D, #ffd700);
            box-shadow: 0 5px 30px rgba(224, 194, 109, 0.7);
        }

        @keyframes pulseButton {
            0% {
                transform: scale(1);
                box-shadow: 0 0 20px rgba(224, 194, 109, 0.3);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 35px rgba(224, 194, 109, 0.6);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 20px rgba(224, 194, 109, 0.3);
            }
        }

        #startOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            cursor: pointer;
            color: white;
            text-align: center;
            transition: opacity 0.5s ease;
        }

        #startOverlayContent h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.7);
        }

        #startOverlayContent p {
            font-size: 1.5rem;
            opacity: 0.8;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        .hidden {
            display: none !important;
        }
        
        .icon-svg {
            width: 1em;
            height: 1em;
            vertical-align: -0.15em;
            fill: currentColor;
        }

        .sparkling-icon {
            animation: icon-sparkle 2.5s ease-in-out infinite;
        }

        @keyframes icon-sparkle {
            0%, 100% {
                filter: drop-shadow(0 0 4px rgba(224, 194, 109, 0.7));
                transform: scale(1);
            }
            50% {
                filter: drop-shadow(0 0 12px rgba(224, 194, 109, 1));
                transform: scale(1.1);
            }
        }
        
        /* --- CONFFETI EFFECT --- */
        #confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3000;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 20px;
            background-color: #f00;
            opacity: 0.7;
            animation: confetti-fall 4s linear infinite;
        }
        @keyframes confetti-fall {
            0% {
                transform: translateY(-10vh) rotateZ(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(110vh) rotateZ(720deg);
                opacity: 0;
            }
        }

    </style>
</head>
<body>
    <div id="copyright">
        © <span id="year"></span> Thầy Thái Minh Nguyên - Trường Tiểu học, THCS & THPT Yersin Đà Lạt. All rights reserved.
    </div>
    
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap');
    
    #copyright {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        text-align: center;
        font-size: 13px;
        padding: 6px 0;
        font-family: 'Roboto', Arial, Helvetica, sans-serif;
        z-index: 9999;
        pointer-events: none;
    
        color: rgba(255, 255, 255, 0.85);
        background: transparent;
    
        opacity: 0;
        animation: fadeIn 2s ease forwards;
    }
    
    @keyframes fadeIn {
        to { opacity: 1; }
    }
    </style>
    
    <script>
    document.getElementById("year").textContent = new Date().getFullYear();
    </script>

    <div id="confetti-container"></div>

    <!-- Nút toàn màn hình -->
    <button id="fullscreen-btn" class="ui-button" title="Toàn màn hình">
        <svg id="fullscreen-icon-open" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
        <svg id="fullscreen-icon-close" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>
    </button>
    
    <!-- Nút quay lại trang chủ -->
    <button id="back-to-main-btn" onclick="goToMainMenu()" class="ui-button" title="Về màn hình chính">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
    </button>

    <!-- Start Overlay -->
    <div id="startOverlay">
        <div id="startOverlayContent">
            <h1>Cuộc Chiến Không Khói</h1>
            <p>Nhấn để bắt đầu</p>
        </div>
    </div>

    <div class="particles" id="particles"></div>
    <div class="lens-flare"></div>
    <div class="stars"></div>
    <div class="light-effect"></div>
    
    <!-- Timeline Controls -->
    <div class="timeline-controls">
        <div class="control-btn" id="playPauseBtn">
            <svg id="play-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 5.14v14l11-7-11-7z"/></svg>
            <svg id="pause-icon" class="hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
        </div>
        <div class="control-btn" id="restartBtn">
            <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M19 20L9 12l10-8v16zM5 19V5"/></svg>
        </div>
        <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
        <div class="timeline-slider" id="timelineSlider">
            <div class="timeline-progress" id="timelineProgress"></div>
            <div class="timeline-thumb" id="timelineThumb"></div>
        </div>
        <div class="speed-control">
            <div class="speed-btn" data-speed="1">1x</div>
            <div class="speed-btn" data-speed="1.5">1.5x</div>
            <div class="speed-btn" data-speed="2">2x</div>
            <div class="speed-btn active" data-speed="0.5">0.5x</div>
        </div>
    </div>

    <!-- End Screen -->
    <div class="end-screen" id="endScreen">
        <div class="end-message">
            <span class="highlight">Thuốc lá không phải đáp số.</span><br>
            <span class="highlight">Tương lai khỏe mạnh mới là lời giải đúng.</span>
        </div>
        <div class="end-sparkle">
             <svg class="sparkle-svg" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <radialGradient id="gold-gradient" cx="50%" cy="50%" r="50%">
                        <stop offset="0%" stop-color="#FFED4E"/>
                        <stop offset="100%" stop-color="#FFD700"/>
                    </radialGradient>
                </defs>
                <path class="sparkle-main" d="M30 0 L35 25 L60 30 L35 35 L30 60 L25 35 L0 30 L25 25 Z" fill="url(#gold-gradient)"/>
                <circle class="sparkle-halo" cx="30" cy="30" r="15" fill="url(#gold-gradient)" opacity="0.5"/>
                <g class="sparkle-small-group">
                     <path class="sparkle-small" d="M50 10 L52 15 L58 16 L52 17 L50 22 L48 17 L42 16 L48 15 Z" fill="white"/>
                     <path class="sparkle-small" d="M10 40 L12 45 L18 46 L12 47 L10 52 L8 47 L2 46 L8 45 Z" fill="white"/>
                </g>
            </svg>
        </div>
        <div class="end-buttons">
            <button class="end-btn extra-primary" onclick="goToPhieuHocTap()">
                <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
                PHIẾU HỌC TẬP
            </button>
            <button class="end-btn primary" onclick="restartCredit()">
                <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                Xem lại Credit
            </button>
            <button class="end-btn" onclick="goToMainMenu()">
                <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                Về màn hình chính
            </button>
        </div>
    </div>

    <div class="credits-container">
        <div class="credits-content" id="creditsContent">
            <div class="title">
                 CUỘC CHIẾN KHÔNG KHÓI
            </div>
            
            <div class="subtitle">
                Bảo vệ từng nhịp thở - Nói không với thuốc lá
            </div>

            <div class="section">
                <div class="section-title">
                    <svg class="icon-svg sparkling-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L9.19 8.62 2 11l5.51 4.73L5.82 22 12 17.31 18.18 22l-1.69-6.27L22 11l-7.19-2.38L12 2z"/></svg>
                    Người Sáng Tạo & Đồng Hành
                </div>
                <div class="author-name">
                    <svg class="icon-svg" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    Thầy Thái Minh Nguyên
                </div>
                <div class="message">Giáo viên Toán – Trường Tiểu học, THCS & THPT Yersin Đà Lạt</div>
            </div>

             <div class="section">
                <div class="section-title">
                     <svg class="icon-svg sparkling-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21.58 16.09l-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19h0c.68 0 1.32-.27 1.8-.75L9 16h6l2.25 2.25c.48.48 1.13.75 1.8.75h0c1.55 0 2.74-1.37 2.53-2.91zM11 11H9v2H8v-2H6v-1h2V8h1v2h2v1zm4-1h-1V8h1v2zm2 2h-1V8h1v4z"/></svg>
                    Giải Mã Hành Trình Của Bạn
                </div>
                 <div class="metaphor-block">
                    <div class="metaphor-title">Màn 1: Lắng Nghe Lời Thì Thầm Của Sự Sống</div>
                    <div class="metaphor-desc">Cuộc hành trình vĩ đại luôn bắt đầu từ sự thấu cảm. Khi bạn đến từng cơ quan và lắng nghe tiếng kêu cứu của họ, đó là lúc bạn học cách <b>trân trọng chính cơ thể mình</b>. Bạn không chỉ chiến đấu cho bản thân, mà còn chiến đấu vì một cộng đồng đang bị tổn thương. Đây chính là ngọn lửa thắp lên ý chí của anh hùng.</div>
                </div>
                <div class="metaphor-block">
                    <div class="metaphor-title">Màn 2: Hành Động Phản Công - Dùng Tri Thức Làm Vũ Khí</div>
                    <div class="metaphor-desc">Màn chơi bắn súng không chỉ là giải trí. Mỗi viên đạn bạn bắn ra không phải là thuốc súng, mà là một <b>tia sáng của sự thật</b>. Mỗi kẻ địch bị tiêu diệt là một lời nói dối về thuốc lá bị lật tẩy. Bạn đã học được rằng, hành động mạnh mẽ nhất chính là trang bị cho mình tri thức.</div>
                </div>
                 <div class="metaphor-block">
                    <div class="metaphor-title">Màn 3: Giải Cứu Trái Tim - Bảo Vệ Tình Yêu Thương</div>
                    <div class="metaphor-desc">Trái tim mong manh giữa vòng vây của Quái vật Thuốc lá không chỉ là một mục tiêu trong game. Nó là biểu tượng của <b>tình yêu thương, của những cảm xúc trong sáng nhất</b>. Mỗi lần bạn ghép kim cương để giải cứu trái tim, bạn đang khẳng định rằng tình yêu – dành cho bản thân, gia đình và bạn bè – sẽ luôn là sức mạnh để chiến thắng bóng tối của sự nghiện ngập.</div>
                </div>
                <div class="metaphor-block">
                    <div class="metaphor-title">Màn 4: Trận Đấu Trí Tuệ - Khẳng Định Chân Lý</div>
                    <div class="metaphor-desc">Ở chặng cuối, bạn đã tiến hoá từ một chiến binh thành một nhà thông thái. Bạn không dùng súng, mà dùng chính <b>sự hiểu biết của mình</b> để đánh bại Quái vật Nicotine. Đây là bài học cuối cùng: khi đối mặt với những lời dụ dỗ, tri thức và sự thật sẽ luôn là vũ khí tối thượng giúp bạn chiến thắng.</div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <svg class="icon-svg sparkling-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                    Lời Nhắn Từ Trái Tim
                </div>
                <div class="quote">
                    "Các em học sinh thân mến,<br><br>
                    Trong Toán học, chúng ta học cách suy luận, chứng minh, tìm ra đáp số đúng.<br>
                    Trong cuộc đời, các em cũng sẽ đứng trước nhiều lựa chọn.<br><br>
                    Hãy nhớ rằng:<br>
                    – Đáp số đúng không bao giờ là thuốc lá hay thuốc lá điện tử.<br>
                    – Đáp số đúng chính là sức khỏe, ý chí và ước mơ của các em.<br><br>
                    Các em chính là những chiến binh ánh sáng.<br>
                    Hãy mạnh mẽ, thông minh và luôn chọn con đường sáng."
                </div>
            </div>

            <div class="section">
                <div class="section-title">
                    <svg class="icon-svg sparkling-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V6h5.17l2 2H20v10z"/></svg>
                    Hành Trình Không Kết Thúc
                </div>
                <div class="message">
                    Chiến thắng này thật vĩ đại, nhưng hành trình của một Chiến binh Ánh sáng thì chưa dừng lại! Hãy tiếp tục rèn luyện bản thân qua các nhiệm vụ:
                </div>
                <div class="metaphor-block" style="text-align: center;">
                    <b>Thư viện Tri thức & Game Flash Card:</b> Nơi bạn mài sắc thanh gươm tri thức.
                </div>
                <div class="metaphor-block" style="text-align: center;">
                    <b>Ngoại truyện Xe Tăng Phổi Xanh:</b> Nhiệm vụ đặc biệt để quét sạch tận gốc mầm mống độc hại!
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <svg class="icon-svg sparkling-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm1.13-4.97L4 9l.87.03c.27-.99.63-1.92 1.08-2.77L5.08 5.4l1.42-1.42 1.41 1.41c.85-.45 1.78-.81 2.77-1.08L11 2h2v1.13c.99.27 1.92.63 2.77 1.08l1.41-1.41 1.42 1.42-1.41 1.41c.45.85.81 1.78 1.08 2.77L21 9h-2l-1.13-.03c-.27.99-.63 1.92-1.08 2.77l1.41 1.41-1.42 1.42-1.41-1.41c-.85.45-1.78.81-2.77 1.08L13 22h-2v-1.13c-.99-.27-1.92-.63-2.77-1.08l-1.41 1.41-1.42-1.42 1.41-1.41c-.45-.85-.81-1.78-1.08-2.77L5 13H4z"/></svg>
                    Nền Tảng Tri Thức Khoa Học
                </div>
                <div class="message">
                    Trò chơi được xây dựng dựa trên những thông tin y tế chính xác và đáng tin cậy từ các tổ chức hàng đầu thế giới:
                </div>
                <ul class="reference-list">
                    <li><a href="https://www.who.int" target="_blank">Tổ chức Y tế Thế giới (WHO)</a></li>
                    <li><a href="https://www.cdc.gov" target="_blank">Trung tâm Kiểm soát và Phòng ngừa Dịch bệnh Hoa Kỳ (CDC)</a></li>
                    <li><a href="https://moh.gov.vn" target="_blank">Bộ Y tế Việt Nam</a></li>
                </ul>
            </div>

            <div class="final-message section">
                <svg class="icon-svg" style="margin-bottom: -5px; margin-right: 5px;" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M18 4h-2v7.5c0 1.93-1.57 3.5-3.5 3.5S9 13.43 9 11.5V4H7v7.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V4zM4 4h2v16H4V4zm14 16h2V4h-2v16z"/></svg>
                Trò chơi này được tạo nên bằng tình yêu của một người thầy,<br>
                để tri thức không chỉ nằm trên bảng đen,<br>
                mà còn trở thành ánh sáng dẫn lối cho cuộc đời.
            </div>
        </div>
    </div>



    <script>
        // Create particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // UPGRADE: Create Confetti
        function createConfetti() {
            const container = document.getElementById('confetti-container');
            const colors = ['#f94144', '#f3722c', '#f8961e', '#f9c74f', '#90be6d', '#43aa8b', '#577590'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                container.appendChild(confetti);
            }
        }

        // Create cinematic background music using Web Audio API
        let audioContext;
        let isPlaying = false;
        let endMusicGain;
        let backgroundMusicGain;

        function createBeautifulMusic() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            const beautifulMelody = [
                { freq: 440.00, time: 0, duration: 2 },       // A4
                { freq: 493.88, time: 2, duration: 2 },       // B4
                { freq: 523.25, time: 4, duration: 3 },       // C5
                { freq: 587.33, time: 7, duration: 2 },       // D5
                { freq: 523.25, time: 9, duration: 2 },       // C5
                { freq: 440.00, time: 11, duration: 3 },      // A4
            ];

            const gentleHarmony = [
                { freq: 329.63, time: 0, duration: 4 },       // E4
                { freq: 349.23, time: 4, duration: 4 },       // F4
                { freq: 392.00, time: 8, duration: 6 },       // G4
            ];

            const warmBass = [
                { freq: 220.00, time: 0, duration: 7 },       // A3
                { freq: 196.00, time: 7, duration: 7 },       // G3
            ];

            backgroundMusicGain = audioContext.createGain();
            // Adjust volume here
            backgroundMusicGain.gain.setValueAtTime(0.12, audioContext.currentTime);
            backgroundMusicGain.connect(audioContext.destination);

            const convolver = audioContext.createConvolver();
            const reverbGain = audioContext.createGain();
            reverbGain.gain.setValueAtTime(0.4, audioContext.currentTime);
            
            const impulseLength = audioContext.sampleRate * 1.5;
            const impulse = audioContext.createBuffer(2, impulseLength, audioContext.sampleRate);
            for (let channel = 0; channel < 2; channel++) {
                const channelData = impulse.getChannelData(channel);
                for (let i = 0; i < impulseLength; i++) {
                    channelData[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / impulseLength, 1.5);
                }
            }
            convolver.buffer = impulse;

            function playBeautifulNote(freq, startTime, duration, waveType = 'sine', volume = 0.3, useReverb = true) {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                const filter = audioContext.createBiquadFilter();
                
                osc.type = waveType;
                osc.frequency.setValueAtTime(freq, audioContext.currentTime + startTime);
                
                const vibrato = audioContext.createOscillator();
                const vibratoGain = audioContext.createGain();
                vibrato.frequency.setValueAtTime(4, audioContext.currentTime);
                vibratoGain.gain.setValueAtTime(1.5, audioContext.currentTime);
                vibrato.connect(vibratoGain);
                vibratoGain.connect(osc.frequency);
                
                gain.gain.setValueAtTime(0, audioContext.currentTime + startTime);
                gain.gain.linearRampToValueAtTime(volume, audioContext.currentTime + startTime + 0.5);
                gain.gain.setValueAtTime(volume * 0.9, audioContext.currentTime + startTime + duration - 1);
                gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + startTime + duration);
                
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(1500, audioContext.currentTime);
                filter.Q.setValueAtTime(0.7, audioContext.currentTime);
                
                osc.connect(filter);
                filter.connect(gain);
                
                if (useReverb) {
                    const dryGain = audioContext.createGain();
                    const wetGain = audioContext.createGain();
                    dryGain.gain.setValueAtTime(0.7, audioContext.currentTime);
                    wetGain.gain.setValueAtTime(0.3, audioContext.currentTime);
                    
                    gain.connect(dryGain);
                    gain.connect(convolver);
                    convolver.connect(wetGain);
                    
                    dryGain.connect(backgroundMusicGain);
                    wetGain.connect(backgroundMusicGain);
                } else {
                    gain.connect(backgroundMusicGain);
                }
                
                vibrato.start(audioContext.currentTime + startTime);
                osc.start(audioContext.currentTime + startTime);
                osc.stop(audioContext.currentTime + startTime + duration);
                vibrato.stop(audioContext.currentTime + startTime + duration);
            }

            function playAmbientPad() {
                const padFreqs = [220, 329.63, 440, 523.25]; // A3, E4, A4, C5 chord
                padFreqs.forEach((freq, index) => {
                    setTimeout(() => {
                        playBeautifulNote(freq, 0, 14, 'sine', 0.03, true);
                    }, index * 100);
                });
            }

            function playMelodyLayer() {
                beautifulMelody.forEach(note => {
                    playBeautifulNote(note.freq, note.time, note.duration, 'sine', 0.12, true);
                });
            }

            function playHarmonyLayer() {
                gentleHarmony.forEach(note => {
                    playBeautifulNote(note.freq, note.time, note.duration, 'triangle', 0.08, true);
                });
            }

            function playBassLayer() {
                warmBass.forEach(note => {
                    playBeautifulNote(note.freq, note.time, note.duration, 'sine', 0.1, false);
                });
            }

            function playBeautifulComposition() {
                if (isPlaying) {
                    playMelodyLayer();
                    playHarmonyLayer();
                    playBassLayer();
                    playAmbientPad();
                    setTimeout(playBeautifulComposition, 14000); // Repeat every 14 seconds
                }
            }

            playBeautifulComposition();
        }

        function createEndMusic() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            const inspiringMelody = [
                { freq: 523.25, time: 0, duration: 1.5 },     // C5
                { freq: 587.33, time: 1.5, duration: 1.5 },   // D5
                { freq: 659.25, time: 3, duration: 2 },       // E5
                { freq: 698.46, time: 5, duration: 1.5 },     // F5
                { freq: 783.99, time: 6.5, duration: 2.5 },   // G5
                { freq: 659.25, time: 9, duration: 3 },       // E5
            ];

            const richHarmony = [
                { freq: 392.00, time: 0, duration: 3 },       // G4
                { freq: 440.00, time: 3, duration: 3 },       // A4
                { freq: 493.88, time: 6, duration: 6 },       // B4
            ];

            const strongBass = [
                { freq: 261.63, time: 0, duration: 6 },       // C4
                { freq: 329.63, time: 6, duration: 6 },       // E4
            ];

            endMusicGain = audioContext.createGain();
            endMusicGain.gain.setValueAtTime(0, audioContext.currentTime);
            // Adjust volume here
            endMusicGain.gain.linearRampToValueAtTime(0.18, audioContext.currentTime + 1);
            endMusicGain.connect(audioContext.destination);

            function playInspirationalNote(freq, startTime, duration, waveType = 'sine', volume = 0.4) {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                const filter = audioContext.createBiquadFilter();
                
                osc.type = waveType;
                osc.frequency.setValueAtTime(freq, audioContext.currentTime + startTime);
                
                gain.gain.setValueAtTime(0, audioContext.currentTime + startTime);
                gain.gain.linearRampToValueAtTime(volume, audioContext.currentTime + startTime + 0.3);
                gain.gain.setValueAtTime(volume, audioContext.currentTime + startTime + duration - 0.5);
                gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + startTime + duration);
                
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(2000, audioContext.currentTime);
                filter.Q.setValueAtTime(1, audioContext.currentTime);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(endMusicGain);
                
                osc.start(audioContext.currentTime + startTime);
                osc.stop(audioContext.currentTime + startTime + duration);
            }

            inspiringMelody.forEach(note => {
                playInspirationalNote(note.freq, note.time, note.duration, 'sine', 0.25);
            });

            richHarmony.forEach(note => {
                playInspirationalNote(note.freq, note.time, note.duration, 'triangle', 0.15);
            });

            strongBass.forEach(note => {
                playInspirationalNote(note.freq, note.time, note.duration, 'sine', 0.2);
            });
        }

        // --- TIMELINE CONTROL LOGIC ---
        let animationFrameId;
        let animationPaused = true; // Start as paused
        let currentSpeed = 0.5; // Default speed set to 0.5x
        let animationStartTime = 0;
        let pausedTime = 0;
        
        let totalDuration = 60000; // Default value
        let scrollDistance = 0;
        let viewportHeight = 0;

        const creditsContent = document.getElementById('creditsContent');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const restartBtn = document.getElementById('restartBtn');
        const timeDisplay = document.getElementById('timeDisplay');
        const timelineProgress = document.getElementById('timelineProgress');
        const timelineThumb = document.getElementById('timelineThumb');
        const timelineSlider = document.getElementById('timelineSlider');
        const speedBtns = document.querySelectorAll('.speed-btn');

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function updateTimeline() {
            if (!animationPaused) {
                const elapsed = (Date.now() - animationStartTime) * currentSpeed + pausedTime;
                const progress = Math.min(elapsed / totalDuration, 1);
                
                timelineProgress.style.width = `${progress * 100}%`;
                timelineThumb.style.left = `calc(${progress * 100}% - 8px)`;
                timeDisplay.textContent = `${formatTime(elapsed)} / ${formatTime(totalDuration)}`;
                
                const currentPosition = viewportHeight - (progress * scrollDistance);
                creditsContent.style.transform = `translateY(${currentPosition}px)`;

                if (progress >= 1) {
                    showEndScreen();
                    return; 
                }
            }
            animationFrameId = requestAnimationFrame(updateTimeline);
        }
        
        function pauseAnimation() {
            if (!animationPaused) {
                cancelAnimationFrame(animationFrameId);
                animationPaused = true;
                pausedTime += (Date.now() - animationStartTime) * currentSpeed;
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                playPauseBtn.classList.remove('active');
                if (audioContext && audioContext.state === 'running') {
                    audioContext.suspend();
                }
            }
        }

        function resumeAnimation() {
            if (animationPaused) {
                animationPaused = false;
                animationStartTime = Date.now();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                playPauseBtn.classList.add('active');
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                updateTimeline();
            }
        }
        
        function restartAnimation() {
            cancelAnimationFrame(animationFrameId);
            pausedTime = 0;
            animationStartTime = Date.now();
            if(animationPaused) resumeAnimation();
            else updateTimeline();
        }

        function setSpeed(speed) {
            if (!animationPaused) {
                 pausedTime += (Date.now() - animationStartTime) * currentSpeed;
                 animationStartTime = Date.now();
            }
            currentSpeed = speed;
            speedBtns.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-speed="${speed}"]`).classList.add('active');
        }

        function seekTo(progress) {
            const targetTime = progress * totalDuration;
            pausedTime = targetTime;
            animationStartTime = Date.now();

            if (animationPaused) {
                 const elapsed = pausedTime;
                 const currentPosition = viewportHeight - ((elapsed / totalDuration) * scrollDistance);
                 creditsContent.style.transform = `translateY(${currentPosition}px)`;
                 timelineProgress.style.width = `${progress * 100}%`;
                 timelineThumb.style.left = `calc(${progress * 100}% - 8px)`;
                 timeDisplay.textContent = `${formatTime(elapsed)} / ${formatTime(totalDuration)}`;
            }
        }

        playPauseBtn.addEventListener('click', () => {
            if (animationPaused) {
                resumeAnimation();
            } else {
                pauseAnimation();
            }
        });

        restartBtn.addEventListener('click', () => {
            restartAnimation();
        });

        speedBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                setSpeed(parseFloat(btn.dataset.speed));
            });
        });

        let isDragging = false;
        timelineSlider.addEventListener('mousedown', (e) => {
            isDragging = true;
            const rect = timelineSlider.getBoundingClientRect();
            const progress = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            seekTo(progress);
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const rect = timelineSlider.getBoundingClientRect();
                const progress = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                seekTo(progress);
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        let hideControlsTimeout;
        const timelineControlsElement = document.querySelector('.timeline-controls');

        function showControls() {
            timelineControlsElement.classList.remove('hidden');
            clearTimeout(hideControlsTimeout);
            hideControlsTimeout = setTimeout(() => {
                timelineControlsElement.classList.add('hidden');
            }, 3000);
        }

        timelineControlsElement.addEventListener('mouseenter', () => clearTimeout(hideControlsTimeout));
        timelineControlsElement.addEventListener('mouseleave', showControls);
        document.addEventListener('mousemove', showControls);
        document.addEventListener('click', showControls);


        function startMusicImmediately() {
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().catch(e => console.error("Resume failed:", e));
            }
            if (!isPlaying) {
                isPlaying = true;
                createBeautifulMusic();
            }
        }
        
        function init() {
            createParticles();
            showControls();
            
            viewportHeight = window.innerHeight;
            creditsContent.style.transform = `translateY(${viewportHeight}px)`;
            timeDisplay.textContent = `00:00 / --:--`;
            
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            playPauseBtn.classList.remove('active');

            const startOverlay = document.getElementById('startOverlay');
            startOverlay.addEventListener('click', () => {
                const contentHeight = creditsContent.offsetHeight;
                viewportHeight = window.innerHeight;
                scrollDistance = viewportHeight + contentHeight;
                const scrollSpeed = 60; // Tốc độ cơ bản đã được làm chậm lại (trước đó là 80)
                totalDuration = (scrollDistance / scrollSpeed) * 1000;
                timeDisplay.textContent = `${formatTime(0)} / ${formatTime(totalDuration)}`;

                startOverlay.style.opacity = '0';
                setTimeout(() => {
                    startOverlay.style.display = 'none';
                }, 500);

                startMusicImmediately();
                resumeAnimation();
            }, { once: true });
            
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            fullscreenBtn.addEventListener('click', toggleFullScreen);
            document.addEventListener('fullscreenchange', updateFullscreenIcons);
        }

        function showEndScreen() {
            cancelAnimationFrame(animationFrameId);
            animationPaused = true;
            
            if (backgroundMusicGain) {
                backgroundMusicGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1);
            }
            isPlaying = false;
            
            document.querySelector('.timeline-controls').style.display = 'none';
            
            setTimeout(() => {
                document.getElementById('endScreen').classList.add('show');
                createConfetti();
                try {
                    createEndMusic();
                } catch (error) {
                    console.log('End music needs user interaction');
                }
            }, 1000);
        }

        function restartCredit() {
            const endScreen = document.getElementById('endScreen');
            endScreen.classList.remove('show');
            document.getElementById('confetti-container').innerHTML = '';
            
            document.querySelector('.timeline-controls').style.display = 'flex';
            
            restartAnimation();
            startMusicImmediately();
            
            if (endMusicGain) {
                endMusicGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
            }
        }

        function goToMainMenu() {
            if (audioContext) {
                audioContext.close();
            }
            isPlaying = false;
            window.location.href = 'index.html';
        }

        function goToPhieuHocTap() {
            if (audioContext) {
                audioContext.close();
            }
            isPlaying = false;
            window.location.href = 'phieuhoctap.html';
        }

        // --- Fullscreen Logic ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function updateFullscreenIcons() {
            const fullscreenIconOpen = document.getElementById('fullscreen-icon-open');
            const fullscreenIconClose = document.getElementById('fullscreen-icon-close');
            if (document.fullscreenElement) {
                fullscreenIconOpen.classList.add('hidden');
                fullscreenIconClose.classList.remove('hidden');
            } else {
                fullscreenIconOpen.classList.remove('hidden');
                fullscreenIconClose.classList.add('hidden');
            }
        }

        window.onload = init;
    </script>
</body>
</html>


