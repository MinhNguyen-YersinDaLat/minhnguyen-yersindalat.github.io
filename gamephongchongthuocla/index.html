<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuộc Chiến Không Khói</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Font cho các nút bấm -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font cho slogan nút chính -->
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@700;900&display=swap" rel="stylesheet">
    <!-- Font cho tiêu đề game và slogan chính -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@900&display=swap" rel="stylesheet">
    
    <style>
        /* --- CÀI ĐẶT CƠ BẢN --- */
        html, body {
            overflow: hidden; /* Chặn cuộn trang */
            height: 100%;
            background-color: #000010; /* Màu nền vũ trụ */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* --- CONTAINER CO GIÃN THEO MÀN HÌNH --- */
        #scaling-container {
            width: 1280px;
            height: 720px;
            position: relative;
            transform-origin: center center;
            transition: transform 0.2s ease-out;
        }
        
        .main-panel {
            background: transparent;
        }

        /* --- HIỆU ỨNG LOGO, TIÊU ĐỀ & SLOGAN (TỪ FILE GỐC) --- */
        .game-logo {
            width: clamp(100px, 12vw, 120px); /* Thu nhỏ logo */
            height: auto;
            margin: 0 auto 0.5rem; /* Giảm khoảng cách dưới logo */
            cursor: pointer;
            animation: logo-breathe-glow 4s ease-in-out infinite;
        }
        @keyframes logo-breathe-glow {
             0%, 100% { 
                transform: scale(1);
                filter: drop-shadow(0 0 8px #f59e0b);
            }
            50% { 
                transform: scale(1.05);
                filter: drop-shadow(0 0 20px #ef4444);
            }
        }
        #game-title {
            font-family: 'Exo 2', sans-serif;
            font-weight: 900;
            font-size: clamp(2.2rem, 5vw, 3.2rem); /* Điều chỉnh font size */
            color: white;
            letter-spacing: 0.05em;
            text-transform: uppercase; 
            animation: title-glow 4s ease-in-out infinite;
            margin-bottom: 0.25rem;
        }
        #game-subtitle {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: clamp(0.7rem, 2vw, 1rem); /* Điều chỉnh font size */
            color: #FBBF24;
            text-shadow: 0 0 8px #F59E0B;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            animation: subtitle-glow 4s ease-in-out infinite;
            animation-delay: 0.2s;
            margin-bottom: 0.5rem; /* Giảm khoảng cách dưới slogan */
        }
        @keyframes title-glow {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 0 0 10px #EC4899, 0 0 20px #EC4899, 0 0 40px #EC4899, 0 0 80px #D946EF; 
            }
            50% { 
                transform: scale(1.02);
                text-shadow: 0 0 15px #f472b6, 0 0 25px #f472b6, 0 0 50px #f472b6, 0 0 90px #e879f9; 
            }
        }
        @keyframes subtitle-glow {
            0%, 100% {
                transform: scale(1);
                text-shadow: 0 0 8px #F59E0B;
            }
            50% {
                transform: scale(1.03);
                text-shadow: 0 0 12px #FBBF24, 0 0 20px #F59E0B;
            }
        }
        
        /* --- HIỆU ỨNG CHUNG CHO CÁC NÚT BẤM SVG --- */
        .svg-btn {
            border: none;
            background: transparent;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s cubic-bezier(0.22, 1, 0.36, 1), filter 0.3s ease-out;
            animation: button-breathing 4s infinite ease-in-out;
        }

        @keyframes button-breathing {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 4px 15px rgba(173, 216, 230, 0.4));
            }
            50% {
                transform: scale(1.02);
                filter: drop-shadow(0 6px 22px rgba(173, 216, 230, 0.6));
            }
        }

        .svg-btn:hover {
            animation-play-state: paused;
            transform: translateY(-12px) scale(1.1);
            filter: drop-shadow(0 12px 30px rgba(173, 216, 230, 1));
        }

        .svg-btn:active {
            transform: translateY(-2px) scale(0.98);
            filter: drop-shadow(0 2px 10px rgba(173, 216, 230, 0.5));
        }
        
        @keyframes pulsing-glow-click {
            0% {
                filter: drop-shadow(0 12px 30px rgba(173, 216, 230, 1));
                transform: translateY(-12px) scale(1.1);
            }
            50% {
                filter: drop-shadow(0 0 40px rgba(255, 255, 255, 1)) drop-shadow(0 0 20px rgba(173, 216, 230, 1));
                transform: translateY(-14px) scale(1.15);
            }
            100% {
                filter: drop-shadow(0 12px 30px rgba(173, 216, 230, 1));
                transform: translateY(-12px) scale(1.1);
            }
        }

        .svg-btn.clicked-effect {
            animation: pulsing-glow-click 0.6s ease-in-out;
        }

        /* --- HIỆU ỨNG CHO NÚT BẤM CHÍNH (ORRERY BUTTON) --- */
        @keyframes rotate-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes shockwave { 0% { transform: scale(1); opacity: 0.7; } 100% { transform: scale(2.5); opacity: 0; } }
        @keyframes pulse-core { 0%, 100% { fill: url(#core-grad); r: 55; } 50% { fill: url(#core-grad-pulse); r: 58; } }
        @keyframes cosmic-dust-float { 0%, 100% { transform: translateY(0) translateX(0) scale(1); opacity: 0; } 50% { transform: translateY(-10px) translateX(5px) scale(1.2); opacity: 0.6; } 90% { opacity: 0.1; } }
        @keyframes glint-sparkle { 0%, 100% { opacity: 0; transform: scale(0.5) rotate(0deg); } 50% { opacity: 1; transform: scale(1.2) rotate(180deg); } }

        .orrery-btn .ring-3 { animation: rotate-slow 60s linear infinite; }
        .orrery-btn .core { animation: pulse-core 4s infinite ease-in-out; }
        .orrery-btn .core-flare { opacity: 0.7; mix-blend-mode: screen; }
        .orrery-btn .shockwave { transform-origin: center; animation: shockwave 3s ease-out infinite; animation-delay: 1s; }
        .orrery-btn .cosmic-dust circle { animation: cosmic-dust-float 6s infinite ease-in-out; }
        .orrery-btn .cosmic-dust circle:nth-child(2) { animation-delay: -2s; }
        .orrery-btn .cosmic-dust circle:nth-child(3) { animation-delay: -4s; }
        .orrery-btn .glints path { animation: glint-sparkle 2.5s infinite ease-in-out; transform-origin: center; fill: #fff; }
        .orrery-btn .glints path:nth-child(2) { animation-delay: -1.5s; }
        .orrery-btn .glints path:nth-child(3) { animation-delay: -0.8s; }
        
        @keyframes pulse-light-ring {
            0%, 100% { transform: scale(1); stroke-opacity: 0.5; stroke-width: 2; }
            50% { transform: scale(1.05); stroke-opacity: 1; stroke-width: 3; }
        }
        .orrery-btn .pulsing-light-ring { transform-origin: center; animation: pulse-light-ring 4s infinite ease-in-out; }

        @keyframes gate-flash-anim {
            0% { r: 0; opacity: 0.8; stroke-width: 20; stroke: white; }
            100% { r: 250; opacity: 0; stroke-width: 0; stroke: white; }
        }
        @keyframes core-flash-anim {
            0%, 100% { transform: scale(1); fill: url(#core-grad); }
            20%, 80% { transform: scale(1.5); fill: url(#core-grad-pulse); }
        }
        .orrery-btn.is-opening .gate-flash { animation: gate-flash-anim 1s cubic-bezier(0.25, 1, 0.5, 1) forwards; }
        .orrery-btn.is-opening .core { animation: core-flash-anim 1s ease-in-out forwards; }
        .orrery-btn.is-opening { filter: drop-shadow(0 0 35px white) drop-shadow(0 0 60px #fef08a); transition: filter 0.5s ease-out; }

        .orrery-btn .btn-text { font-size: 20px; font-weight: 700; fill: #ffffff; text-shadow: 0 0 5px black; letter-spacing: 1px; transition: all 0.3s ease; }
        .orrery-btn:hover .btn-text { fill: #fef08a; text-shadow: 0 0 8px #fef08a; }

        .slogan-text { fill: #a5f3fc; font-family: 'Be Vietnam Pro', sans-serif; font-weight: 700; font-size: 11.5px; text-transform: uppercase; animation: slogan-glow 5s infinite ease-in-out; }
        @keyframes slogan-glow {
            0%, 100% { opacity: 0.8; text-shadow: 0 0 4px #0ea5e9; }
            50% { opacity: 1; fill: #ffffff; text-shadow: 0 0 6px #fff, 0 0 12px #0ea5e9; }
        }
        
        /* --- HIỆU ỨNG CHO CÁC NÚT BẤM VỆ TINH (CONSTELLATION BUTTON) --- */
        @keyframes star-sequence-glow {
            0%, 20%, 100% { opacity: 0.5; filter: drop-shadow(0 0 1px #add8e6); r: var(--r-base); }
            10% { opacity: 1; r: calc(var(--r-base) * 2); filter: drop-shadow(0 0 6px #fff) drop-shadow(0 0 12px #89f7fe); }
        }
        @keyframes line-sequence-draw {
            0%, 5% { stroke-dashoffset: var(--line-length); opacity: 0; }
            15% { stroke-dashoffset: 0; opacity: 0.8; }
            95% { opacity: 0.4; }
            100% { stroke-dashoffset: var(--line-length); opacity: 0; }
        }
        .constellation-btn .stars circle, .constellation-btn .lines path { animation-duration: 12s; animation-timing-function: ease-in-out; animation-iteration-count: infinite; }
        .constellation-btn .stars circle { --r-base: 3px; animation-name: star-sequence-glow; }
        .constellation-btn .lines path { --line-length: 100; stroke-dasharray: var(--line-length); stroke: #89f7fe; animation-name: line-sequence-draw; }
        .svg-btn:hover .stars circle, .svg-btn:hover .lines path { animation-play-state: paused; }
        .constellation-btn.is-clicked .stars circle, .constellation-btn.is-clicked .lines path { animation: none; }
        .constellation-btn.is-clicked .stars circle { opacity: 1; r: calc(var(--r-base) * 1.8); filter: drop-shadow(0 0 8px #fff) drop-shadow(0 0 16px #89f7fe); }
        .constellation-btn.is-clicked .lines path { stroke-dashoffset: 0; opacity: 1; stroke: #fff; filter: drop-shadow(0 0 5px #89f7fe); }
        .constellation-btn .nebula { opacity: 0; transition: opacity 0.5s ease; }
        .constellation-btn:hover .nebula { opacity: 0.75; }
        .constellation-btn .btn-text { fill: rgba(255, 255, 255, 0.7); font-size: 16px; font-weight: 600; transition: all 0.3s ease; }
        .constellation-btn:hover .btn-text { fill: #ffffff; text-shadow: 0 0 8px #00aaff; }

        /* --- HIỆU ỨNG NỀN SAO RƠI --- */
        .star { position: absolute; background: #fff; border-radius: 50%; opacity: 0; animation: twinkle 10s infinite linear; }
        @keyframes twinkle { 0% { transform: translateY(100vh) scale(0.5); opacity: 1; } 100% { transform: translateY(-10vh) scale(1.2); opacity: 0; } }
        
        /* --- HIỆU ỨNG PHỤ --- */
        .anim-fade-in { animation: fadeIn 1.5s ease-out forwards; opacity: 0;}
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- CSS CHO CHUYỂN ĐỔI MENU --- */
        #main-menu-container, #game-menu-container, #intro-menu-container, #review-menu-container { transition: opacity 0.5s ease-out, transform 0.5s ease-out; }
        .cosmic-title-wrapper { transition: opacity 0.5s ease-out, transform 0.5s ease-out; }
        .menu-hidden { opacity: 0 !important; transform: scale(0.95); pointer-events: none; }

        /* --- HIỆU ỨNG SÁNG TOÀN MÀN HÌNH --- */
        #gate-flash-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 60%); opacity: 0; pointer-events: none; z-index: 9999; }
        @keyframes full-screen-flash-anim { 0%, 100% { opacity: 0; } 50% { opacity: 1; } }
        #gate-flash-overlay.is-flashing { animation: full-screen-flash-anim 1s ease-out forwards; }

        /* --- HỘP THÔNG BÁO --- */
        #notification-box { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: rgba(17, 94, 89, 0.8); color: white; padding: 1rem 2rem; border-radius: 0.75rem; z-index: 1000; font-weight: 600; transition: bottom 0.5s ease-in-out; backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 0 20px rgba(137, 247, 254, 0.3); }
        #notification-box.show { bottom: 30px; }

        /* --- CSS CHO CÁC MODAL (POPUP) --- */
        .modal-overlay {
            position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px);
            display: flex; align-items: center; justify-content: center; z-index: 50;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease-out;
        }
        .modal-overlay.visible { opacity: 1; pointer-events: auto; }
        .modal-container {
            background-color: #0a0a1a;
            background-image: radial-gradient(ellipse at center, rgba(173, 216, 230, 0.1) 0%, transparent 70%);
            border-radius: 1rem; padding: 2rem; width: 100%; max-width: 32rem;
            text-align: center; transition: opacity 0.3s ease-out, transform 0.3s ease-out;
            opacity: 0; transform: scale(0.95);
        }
        .modal-overlay.visible .modal-container { opacity: 1; transform: scale(1); }
        .modal-container h2 { font-family: 'Audiowide', sans-serif; }
        .modal-btn {
            padding: 0.75rem 1rem; border-radius: 0.75rem; font-weight: 600; font-size: 1.1rem;
            text-transform: uppercase; transition: all 0.2s ease-in-out; cursor: pointer;
            position: relative; overflow: hidden;
            background-color: rgba(180, 83, 9, 0.2); border: 1px solid rgba(251, 191, 36, 0.5);
            color: #fefce8; box-shadow: 0 0 10px rgba(251, 191, 36, 0.2);
        }
        .modal-btn:hover {
            transform: translateY(-2px); background-color: rgba(180, 83, 9, 0.5);
            color: #ffffff; border-color: rgba(251, 191, 36, 1);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }
        /* Style riêng cho modal thông tin trường */
        #school-info-modal .modal-container { 
            max-width: 40rem; 
            text-align: left;
            border: 1px solid rgba(56, 189, 248, 0.5); /* Thay màu viền */
            box-shadow: 0 0 40px rgba(56, 189, 248, 0.2), inset 0 0 15px rgba(56, 189, 248, 0.1);
        }
        #school-info-modal h2 { color: #7dd3fc; } /* Thay màu tiêu đề chính */
        #school-info-modal h3 { font-family: 'Orbitron', sans-serif; font-size: 1.25rem; color: #38bdf8; margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 0.75rem; }
        #school-info-modal p { margin-bottom: 1rem; color: #d1d5db; font-size: 0.95rem; line-height: 1.7; }
        #school-info-modal .hotline { font-weight: bold; color: #FBBF24; text-align: center; }
        #school-info-modal .modal-btn-close {
             background-color: rgba(10, 137, 171, 0.2); border: 1px solid rgba(102, 226, 255, 0.5); color: #e0f2fe; box-shadow: 0 0 10px rgba(102, 226, 255, 0.2);
        }
        #school-info-modal .modal-btn-close:hover {
            background-color: rgba(10, 137, 171, 0.5); color: #ffffff; border-color: rgba(102, 226, 255, 1); box-shadow: 0 0 20px rgba(102, 226, 255, 0.5);
        }
        
        /* --- CSS CHO BẢN QUYỀN --- */
        #copyright {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 13px;
            padding: 6px 0;
            font-family: 'Poppins', Arial, Helvetica, sans-serif;
            z-index: 9999;
            pointer-events: none;
            color: rgba(255, 255, 255, 0.5);
            background: transparent;
            opacity: 0;
            animation: fadeIn 2s 1s ease forwards;
        }

        /* --- NÚT CÀI ĐẶT & CHÚ THÍCH --- */
        #top-right-controls {
            position: fixed;
            top: 1.25rem;
            right: 1.25rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.5rem;
        }
        .icon-btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            cursor: pointer;
            backdrop-filter: blur(4px);
            transition: all 0.3s ease;
        }
        .icon-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        .icon-btn svg {
            width: 22px;
            height: 22px;
        }
        .settings-tooltip {
            color: #a5f3fc;
            font-size: 12px;
            text-shadow: 0 0 5px #0ea5e9;
            font-weight: 600;
            animation: pulse-tooltip 3s infinite ease-in-out;
        }
        @keyframes pulse-tooltip {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }


        /* --- CSS CHO CHẾ ĐỘ ĐỒ HỌA THẤP --- */
        body.low-quality-mode .constellation-btn .stars circle,
        body.low-quality-mode .constellation-btn .lines path {
            animation: none;
            opacity: 0.8; /* Hiển thị tĩnh */
        }
        body.low-quality-mode .constellation-btn .stars circle { r: var(--r-base); }
        body.low-quality-mode .constellation-btn .lines path { stroke-dashoffset: 0; }

        /* Tắt animation "thở" */
        body.low-quality-mode .svg-btn,
        body.low-quality-mode .game-logo,
        body.low-quality-mode #game-title,
        body.low-quality-mode #game-subtitle,
        body.low-quality-mode .orrery-btn .ring-3,
        body.low-quality-mode .orrery-btn .core,
        body.low-quality-mode .orrery-btn .shockwave,
        body.low-quality-mode .orrery-btn .cosmic-dust circle,
        body.low-quality-mode .slogan-text {
            animation: none;
        }
        
        /* Giảm hiệu ứng đổ bóng nặng */
        body.low-quality-mode .svg-btn:hover {
            filter: drop-shadow(0 6px 15px rgba(173, 216, 230, 0.7));
        }

        /* Tắt animation sao rơi nền */
        body.low-quality-mode .star {
            animation: none;
            opacity: 0.7; /* Cho sao hiện tĩnh */
        }

    </style>
</head>
<body class="relative">
    <!-- Lớp phủ cho hiệu ứng sáng toàn màn hình -->
    <div id="gate-flash-overlay"></div>
    <!-- Container cho các ngôi sao rơi (được tạo bằng JS) -->
    <div id="star-container-fixed" class="absolute inset-0 z-0"></div>

    <!-- Nút cài đặt đồ họa và chú thích -->
    <div id="top-right-controls">
        <button id="graphics-toggle-btn" class="icon-btn" title="Chuyển đổi chất lượng đồ họa">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        </button>
        <p id="settings-tooltip" class="settings-tooltip"></p>
    </div>

    <!-- Container chính co giãn theo màn hình -->
    <div id="scaling-container">
        <main class="main-panel relative z-10 w-full h-full text-center flex items-center justify-center p-4">
            <div class="w-full max-w-5xl mx-auto"> 
                <header class="text-center">
                    <!-- HƯỚNG DẪN: Nếu có file logo.png cùng cấp, nó sẽ tự được tải. -->
                    <img id="gameLogo" src="logo.png" alt="Game Logo" class="game-logo" title="Xem thông tin trường">
                    
                    <div class="cosmic-title-wrapper">
                        <h1 id="game-title">Cuộc Chiến Không Khói</h1>
                        <h2 id="game-subtitle">Bảo vệ từng nhịp thở — Nói không với thuốc lá.</h2>
                    </div>
                </header>

                <!-- CONTAINER CHO MENU CHÍNH -->
                <div id="main-menu-container">
                    <div class="grid grid-cols-3 gap-0 items-center">
                        <!-- Cột Trái -->
                        <div class="flex flex-col gap-2 anim-fade-in" style="animation-delay: 0.8s;">
                            <button onclick="activateConstellation(event, 'Mở Menu Game...')" class="svg-btn constellation-btn gemini w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"> <defs> <filter id="cosmic-glow" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur stdDeviation="3" result="coloredBlur"/><feMerge> <feMergeNode in="coloredBlur"/> <feMergeNode in="SourceGraphic"/> </feMerge> </filter> <radialGradient id="nebula-gemini"> <stop offset="0%" stop-color="#a855f7" /> <stop offset="100%" stop-color="transparent" /> </radialGradient> </defs> <rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-gemini)" /> 
                                <!-- Biểu tượng Game Controller chi tiết -->
                                <g class="lines">
                                    <path d="M 60 60 C 40 60, 40 90, 60 90 L 140 90 C 160 90, 160 60, 140 60 Z" fill="none" style="--line-length: 220; animation-delay: 0.8s;"></path>
                                    <path d="M 75 75 L 75 65" style="--line-length: 10; animation-delay: 0.2s;"></path> 
                                    <path d="M 80 70 L 70 70" style="--line-length: 10; animation-delay: 0.4s;"></path>
                                </g> 
                                <g class="stars"> 
                                    <circle cx="75" cy="70" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="60" cy="60" r="3" fill="#add8e6" style="animation-delay: 0.6s;"></circle> 
                                    <circle cx="140" cy="60" r="3" fill="#add8e6" style="animation-delay: 1s;"></circle> 
                                    <circle cx="60" cy="90" r="3" fill="#add8e6" style="animation-delay: 1.2s;"></circle> 
                                    <circle cx="140" cy="90" r="3" fill="#add8e6" style="animation-delay: 1.4s;"></circle> 
                                    <circle cx="125" cy="60" r="3" fill="#add8e6" style="animation-delay: 1.6s;"></circle> 
                                    <circle cx="115" cy="70" r="3" fill="#add8e6" style="animation-delay: 1.8s;"></circle> 
                                    <circle cx="135" cy="70" r="3" fill="#add8e6" style="animation-delay: 2s;"></circle> 
                                    <circle cx="125" cy="80" r="3" fill="#add8e6" style="animation-delay: 2.2s;"></circle>
                                    <circle cx="95" cy="80" r="3" fill="#add8e6" style="animation-delay: 2.4s;"></circle> 
                                </g> 
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Menu Game</text> </svg>
                            </button>
                             <button onclick="activateConstellation(event, 'Mở Giới thiệu...')" class="svg-btn constellation-btn leo w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"> <defs> <radialGradient id="nebula-leo"> <stop offset="0%" stop-color="#f59e0b" /> <stop offset="100%" stop-color="transparent" /> </radialGradient> </defs> <rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-leo)" /> 
                                <!-- Biểu tượng Cuốn sách mở chi tiết -->
                                <g class="lines">
                                    <path d="M 100 30 L 50 90" style="--line-length: 72; animation-delay: 0.2s;"></path>
                                    <path d="M 100 30 L 150 90" style="--line-length: 72; animation-delay: 0.4s;"></path>
                                    <path d="M 50 90 Q 100 80, 150 90" fill="none" style="--line-length: 102; animation-delay: 0.8s;"></path>
                                    <path d="M 90 45 L 65 55" style="--line-length: 27; animation-delay: 1.2s;"></path>
                                    <path d="M 110 45 L 135 55" style="--line-length: 27; animation-delay: 1.4s;"></path>
                                    <path d="M 90 60 L 65 70" style="--line-length: 27; animation-delay: 1.8s;"></path>
                                    <path d="M 110 60 L 135 70" style="--line-length: 27; animation-delay: 2.0s;"></path>
                                </g> 
                                <g class="stars"> 
                                    <circle cx="100" cy="30" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle> 
                                    <circle cx="50" cy="90" r="3" fill="#add8e6" style="animation-delay: 0.6s;"></circle> 
                                    <circle cx="150" cy="90" r="3" fill="#add8e6" style="animation-delay: 1.0s;"></circle> 
                                    <circle cx="100" cy="85" r="3" fill="#add8e6" style="animation-delay: 1.6s;"></circle>
                                    <circle cx="90" cy="45" r="3" fill="#add8e6" style="animation-delay: 1.1s;"></circle> 
                                    <circle cx="110" cy="45" r="3" fill="#add8e6" style="animation-delay: 1.3s;"></circle> 
                                    <circle cx="65" cy="55" r="3" fill="#add8e6" style="animation-delay: 1.5s;"></circle> 
                                    <circle cx="135" cy="55" r="3" fill="#add8e6" style="animation-delay: 1.7s;"></circle>
                                </g> 
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Giới Thiệu</text> </svg>
                            </button>
                        </div>
                        <!-- Cột Giữa (Nút chính) -->
                        <div class="flex flex-col items-center justify-center gap-2 anim-fade-in" style="animation-delay: 0.6s;">
                            <button onclick="activateConstellation(event, 'batdau.html')" class="svg-btn orrery-btn">
                                <svg viewBox="0 0 250 250" class="w-56 h-56">
                                     <defs>
                                         <radialGradient id="core-grad"> <stop offset="0%" stop-color="#89f7fe" /> <stop offset="60%" stop-color="#a855f7" /><stop offset="100%" stop-color="#66a6ff" /> </radialGradient>
                                         <radialGradient id="core-grad-pulse"> <stop offset="0%" stop-color="#ffffff" /> <stop offset="70%" stop-color="#c084fc" /> <stop offset="100%" stop-color="#66a6ff" /> </radialGradient>
                                         <radialGradient id="flare-grad"> <stop offset="0%" stop-color="white" stop-opacity="0.8" /> <stop offset="100%" stop-color="white" stop-opacity="0" /> </radialGradient>
                                         <path id="sloganCirclePath" d="M 0, 0 m -108, 0 a 108,108 0 1,1 216,0 a 108,108 0 1,1 -216,0" fill="none"/>
                                     </defs>
                                     <g transform="translate(125, 125)">
                                        <circle class="gate-flash" cx="0" cy="0" r="0" fill="none" />
                                        <circle class="pulsing-light-ring" cx="0" cy="0" r="70" fill="none" stroke="rgba(254, 240, 138, 0.5)" stroke-width="2"/>
                                        <g class="ring-3" transform-origin="center">
                                            <circle cx="0" cy="0" r="122" fill="none" stroke="rgba(168, 85, 247, 0.3)" stroke-width="0.5"/>
                                        </g>
                                        <circle cx="0" cy="0" r="120" fill="none" stroke="rgba(0, 191, 255, 0.1)" stroke-width="20"/>
                                        <circle class="core-flare" cx="0" cy="0" r="90" fill="url(#flare-grad)"/>
                                        <circle class="shockwave" cx="0" cy="0" r="55" fill="none" stroke="#c084fc" stroke-width="2" />
                                        <g style="animation: rotate-slow 60s linear infinite reverse;">
                                            <circle cx="0" cy="0" r="108" fill="none" stroke="rgba(165, 243, 252, 0.3)" stroke-width="0.5"/>
                                            <text class="slogan-text">
                                                <textPath href="#sloganCirclePath" startOffset="50%" text-anchor="middle" textLength="650">
                                                    ✧ BẢO VỆ TỪNG NHỊP THỞ - NÓI KHÔNG VỚI THUỐC LÁ ✧
                                                </textPath>
                                            </text>
                                        </g>
                                        <circle class="core" cx="0" cy="0" r="55" fill="url(#core-grad)" filter="url(#cosmic-glow)"/>
                                        <g class="cosmic-dust"> <circle cx="30" cy="-60" r="1" fill="#fff" /> <circle cx="-50" cy="40" r="1.5" fill="#fff" /> <circle cx="70" cy="70" r="1" fill="#fff" /> </g>
                                        <text x="0" y="8" class="btn-text" text-anchor="middle">Bắt Đầu Cốt Truyện</text>
                                        <g class="glints"> <path d="M 0 -4 L 4 0 L 0 4 L -4 0 Z" transform="translate(80, 0) rotate(45)"></path> <path d="M 0 -3 L 3 0 L 0 3 L -3 0 Z" transform="translate(0, -110) rotate(-30)"></path> <path d="M 0 -4 L 4 0 L 0 4 L -4 0 Z" transform="translate(-60, 60)"></path> </g>
                                     </g>
                                </svg>
                            </button>
                             <button onclick="activateConstellation(event, 'phieuhoctap.html')" class="svg-btn constellation-btn libra w-56 mx-auto">
                                 <svg viewBox="0 0 200 130"> <defs> <radialGradient id="nebula-libra"> <stop offset="0%" stop-color="#38bdf8" /> <stop offset="100%" stop-color="transparent" /> </radialGradient> </defs> <rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-libra)" /> 
                                 <!-- Biểu tượng Tờ giấy & Dấu tick -->
                                 <g class="lines">
                                    <path d="M 60 30 L 140 30 L 140 90 L 60 90 Z" fill="none" stroke-width="1.5" style="--line-length: 280; animation-delay: 0.2s;"></path>
                                    <path d="M 75 45 L 125 45" style="--line-length: 50; animation-delay: 1.2s;"></path>
                                    <path d="M 75 60 L 125 60" style="--line-length: 50; animation-delay: 1.4s;"></path>
                                    <path d="M 75 75 L 105 75" style="--line-length: 30; animation-delay: 1.6s;"></path>
                                    <path d="M 80 80 L 90 90 L 115 65" stroke-width="2" fill="none" style="--line-length: 40; animation-delay: 2.0s;"></path>
                                </g> 
                                <g class="stars"> 
                                    <circle cx="60" cy="30" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle> 
                                    <circle cx="140" cy="30" r="3" fill="#add8e6" style="animation-delay: 0.4s;"></circle> 
                                    <circle cx="140" cy="90" r="3" fill="#add8e6" style="animation-delay: 0.8s;"></circle> 
                                    <circle cx="60" cy="90" r="3" fill="#add8e6" style="animation-delay: 1.0s;"></circle>
                                    <circle cx="80" cy="80" r="3" fill="#add8e6" style="animation-delay: 1.8s;"></circle> 
                                    <circle cx="90" cy="90" r="3" fill="#add8e6" style="animation-delay: 2.2s;"></circle> 
                                    <circle cx="115" cy="65" r="3" fill="#add8e6" style="animation-delay: 2.4s;"></circle>
                                </g> 
                                 <text x="100" y="125" class="btn-text" text-anchor="middle">Phiếu Học Tập</text> </svg>
                             </button>
                        </div>
                        <!-- Cột Phải -->
                        <div class="flex flex-col gap-2 anim-fade-in" style="animation-delay: 1.2s;">
                            <button onclick="activateConstellation(event, 'Mở Ôn tập - Học tập...')" class="svg-btn constellation-btn virgo w-11/12 mx-auto">
                                 <svg viewBox="0 0 200 130"> <defs> <radialGradient id="nebula-virgo"> <stop offset="0%" stop-color="#22c55e" /> <stop offset="100%" stop-color="transparent" /> </radialGradient> </defs> <rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-virgo)" /> 
                                 <!-- Biểu tượng Mũ cử nhân -->
                                 <g class="lines">
                                    <path d="M 100 25 L 60 55" style="--line-length: 50; animation-delay: 0.2s;"></path>
                                    <path d="M 100 25 L 140 55" style="--line-length: 50; animation-delay: 0.4s;"></path>
                                    <path d="M 60 55 L 100 85" style="--line-length: 50; animation-delay: 0.8s;"></path>
                                    <path d="M 140 55 L 100 85" style="--line-length: 50; animation-delay: 1.0s;"></path>
                                    <path d="M 140 55 L 140 90" style="--line-length: 35; animation-delay: 1.4s;"></path>
                                </g> 
                                <g class="stars"> 
                                    <circle cx="100" cy="25" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="60" cy="55" r="3" fill="#add8e6" style="animation-delay: 0.6s;"></circle>
                                    <circle cx="140" cy="55" r="3" fill="#add8e6" style="animation-delay: 1.2s;"></circle>
                                    <circle cx="100" cy="85" r="3" fill="#add8e6" style="animation-delay: 1.6s;"></circle>
                                    <circle cx="140" cy="90" r="3" fill="#add8e6" style="animation-delay: 1.8s;"></circle>
                                </g> 
                                 <text x="100" y="125" class="btn-text" text-anchor="middle">Ôn Tập & Học Tập</text> </svg>
                             </button>
                             <button onclick="activateConstellation(event, 'ngoaitruyen.html')" class="svg-btn constellation-btn scorpius w-11/12 mx-auto">
                                 <svg viewBox="0 0 200 130"> <defs> <radialGradient id="nebula-scorpius"> <stop offset="0%" stop-color="#ef4444" /> <stop offset="100%" stop-color="transparent" /> </radialGradient> </defs> <rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-scorpius)" /> 
                                 <!-- Biểu tượng Cuộn phim & Play -->
                                 <g class="lines">
                                    <path d="M 60 35 L 140 35 L 140 85 L 60 85 Z" fill="none" style="--line-length: 260; animation-delay: 0.2s;"></path>
                                    <path d="M 60 45 L 140 45" style="--line-length: 80; animation-delay: 1.2s;"></path>
                                    <path d="M 60 75 L 140 75" style="--line-length: 80; animation-delay: 1.4s;"></path>
                                    <path d="M 90 55 L 115 65 L 90 75 Z" fill="none" stroke-width="1.5" style="--line-length: 60; animation-delay: 1.8s;"></path>
                                </g> 
                                <g class="stars"> 
                                    <circle cx="60" cy="35" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle> 
                                    <circle cx="140" cy="35" r="3" fill="#add8e6" style="animation-delay: 0.4s;"></circle> 
                                    <circle cx="140" cy="85" r="3" fill="#add8e6" style="animation-delay: 0.8s;"></circle> 
                                    <circle cx="60" cy="85" r="3" fill="#add8e6" style="animation-delay: 1.0s;"></circle> 
                                    <circle cx="90" cy="55" r="3" fill="#add8e6" style="animation-delay: 1.6s;"></circle> 
                                    <circle cx="115" cy="65" r="3" fill="#add8e6" style="animation-delay: 2.0s;"></circle> 
                                    <circle cx="90" cy="75" r="3" fill="#add8e6" style="animation-delay: 2.2s;"></circle>
                                </g> 
                                 <text x="100" y="125" class="btn-text" text-anchor="middle">Ngoại Truyện</text> </svg>
                             </button>
                        </div>
                    </div>
                </div>

                <!-- CONTAINER CHO MENU GAME (ẨN BAN ĐẦU) -->
                <div id="game-menu-container" class="hidden menu-hidden">
                    <div class="grid grid-cols-3 gap-0 items-center">
                        <!-- Cột Trái -->
                        <div class="flex flex-col gap-2">
                            <button onclick="window.location.href='khampha.html'" class="svg-btn constellation-btn w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"><defs><radialGradient id="nebula-compass"><stop offset="0%" stop-color="#38bdf8"></stop><stop offset="100%" stop-color="transparent"></stop></radialGradient></defs><rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-compass)"></rect>
                                <g class="lines">
                                    <path d="M 100 25 L 100 95" style="--line-length: 70; animation-delay: 0.2s;"></path>
                                    <path d="M 70 60 L 130 60" style="--line-length: 60; animation-delay: 0.6s;"></path>
                                    <path d="M 80 40 L 120 80" style="--line-length: 56.5; animation-delay: 1.0s;"></path>
                                    <path d="M 120 40 L 80 80" style="--line-length: 56.5; animation-delay: 1.4s;"></path>
                                </g>
                                <g class="stars">
                                    <circle cx="100" cy="25" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="100" cy="95" r="3" fill="#add8e6" style="animation-delay: 0.4s;"></circle>
                                    <circle cx="70" cy="60" r="3" fill="#add8e6" style="animation-delay: 0.8s;"></circle>
                                    <circle cx="130" cy="60" r="3" fill="#add8e6" style="animation-delay: 1.2s;"></circle>
                                    <circle cx="80" cy="40" r="3" fill="#add8e6" style="animation-delay: 1.6s;"></circle>
                                    <circle cx="120" cy="80" r="3" fill="#add8e6" style="animation-delay: 1.8s;"></circle>
                                    <circle cx="120" cy="40" r="3" fill="#add8e6" style="animation-delay: 2.0s;"></circle>
                                    <circle cx="80" cy="80" r="3" fill="#add8e6" style="animation-delay: 2.2s;"></circle>
                                </g>
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Game Khám Phá</text></svg>
                            </button>
                             <button onclick="window.location.href='bansung.html'" class="svg-btn constellation-btn w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"><defs><radialGradient id="nebula-archer"><stop offset="0%" stop-color="#ef4444"></stop><stop offset="100%" stop-color="transparent"></stop></radialGradient></defs><rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-archer)"></rect>
                                <g class="lines">
                                    <path d="M 140 30 L 70 100" style="--line-length: 99; animation-delay: 0.2s;"></path>
                                    <path d="M 140 30 L 110 35" style="--line-length: 30.4; animation-delay: 0.8s;"></path>
                                    <path d="M 70 100 L 75 70" style="--line-length: 30.4; animation-delay: 1.0s;"></path>
                                    <path d="M 90 50 q 50 10 60 40" stroke-width="1.5" fill="none" style="--line-length: 78; animation-delay: 1.4s;"></path>
                                </g>
                                <g class="stars">
                                    <circle cx="140" cy="30" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="70" cy="100" r="3" fill="#add8e6" style="animation-delay: 0.4s;"></circle>
                                    <circle cx="110" cy="35" r="3" fill="#add8e6" style="animation-delay: 0.6s;"></circle>
                                    <circle cx="75" cy="70" r="3" fill="#add8e6" style="animation-delay: 1.2s;"></circle>
                                    <circle cx="90" cy="50" r="3" fill="#add8e6" style="animation-delay: 1.6s;"></circle>
                                </g>
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Game Bắn Súng</text></svg>
                            </button>
                        </div>
                        <!-- Cột Giữa (Nút Quay Lại) -->
                        <div class="flex flex-col items-center justify-center gap-2">
                             <button onclick="showMainMenu()" class="svg-btn orrery-btn">
                                <svg viewBox="0 0 250 250" class="w-56 h-56"><defs><radialGradient id="back-grad-pulse"><stop offset="0%" stop-color="#ffffff"></stop><stop offset="70%" stop-color="#38bdf8"></stop><stop offset="100%" stop-color="#a855f7"></stop></radialGradient><filter id="back-glow"><feGaussianBlur stdDeviation="5" result="coloredBlur"></feGaussianBlur><feMerge><feMergeNode in="coloredBlur"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter></defs><g transform="translate(125, 125)"><g class="galaxy-arm" style="animation: rotate-slow 20s linear infinite;" transform-origin="center"><path d="M 0 0 C 40 20, 60 60, 50 100" stroke="url(#back-grad-pulse)" stroke-width="3" fill="none" opacity="0.8"></path><path d="M 0 0 C -40 -20, -60 -60, -50 -100" stroke="url(#back-grad-pulse)" stroke-width="3" fill="none" opacity="0.8"></path></g><g class="galaxy-arm" style="animation: rotate-slow 25s linear infinite reverse;" transform-origin="center"><path d="M 0 0 C 20 -40, 60 -60, 100 -50" stroke="white" stroke-width="1.5" fill="none" opacity="0.6"></path><path d="M 0 0 C -20 40, -60 60, -100 50" stroke="white" stroke-width="1.5" fill="none" opacity="0.6"></path></g><circle class="core" cx="0" cy="0" r="25" fill="url(#back-grad-pulse)" filter="url(#back-glow)"></circle><text x="0" y="8" class="btn-text" text-anchor="middle">Quay Lại</text></g></svg>
                            </button>
                        </div>
                        <!-- Cột Phải -->
                        <div class="flex flex-col gap-2">
                            <button onclick="window.location.href='kimcuong.html'" class="svg-btn constellation-btn w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"><defs><radialGradient id="nebula-diamond"><stop offset="0%" stop-color="#a5f3fc"></stop><stop offset="100%" stop-color="transparent"></stop></radialGradient></defs><rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-diamond)"></rect>
                                <g class="lines">
                                    <path d="M 100 25 L 140 60" style="--line-length: 53.8; animation-delay: 0.2s;"></path>
                                    <path d="M 140 60 L 100 95" style="--line-length: 53.8; animation-delay: 0.6s;"></path>
                                    <path d="M 100 95 L 60 60" style="--line-length: 53.8; animation-delay: 1.0s;"></path>
                                    <path d="M 60 60 L 100 25" style="--line-length: 53.8; animation-delay: 1.4s;"></path>
                                </g>
                                <g class="stars">
                                    <circle cx="100" cy="25" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="140" cy="60" r="3" fill="#add8e6" style="animation-delay: 0.4s;"></circle>
                                    <circle cx="100" cy="95" r="3" fill="#add8e6" style="animation-delay: 0.8s;"></circle>
                                    <circle cx="60" cy="60" r="3" fill="#add8e6" style="animation-delay: 1.2s;"></circle>
                                </g>
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Game Kim Cương</text></svg>
                            </button>
                             <button onclick="window.location.href='traloicauhoi.html'" class="svg-btn constellation-btn w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"><defs><radialGradient id="nebula-quiz"><stop offset="0%" stop-color="#fef08a"></stop><stop offset="100%" stop-color="transparent"></stop></radialGradient></defs><rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-quiz)"></rect>
                                <g class="lines">
                                    <path d="M 80 50 Q 100 20 120 50" fill="none" stroke-width="2" style="--line-length: 50; animation-delay: 0.2s;"></path>
                                    <path d="M 100 65 L 100 80" style="--line-length: 15; animation-delay: 0.8s;"></path>
                                </g>
                                <g class="stars">
                                    <circle cx="80" cy="50" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="120" cy="50" r="3" fill="#add8e6" style="animation-delay: 0.4s;"></circle>
                                    <circle cx="100" cy="35" r="3" fill="#add8e6" style="animation-delay: 0.6s;"></circle>
                                    <circle cx="100" cy="85" r="3" fill="#add8e6" style="animation-delay: 1.0s;"></circle>
                                </g>
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Game Trả Lời</text></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- CONTAINER CHO MENU GIỚI THIỆU (ẨN BAN ĐẦU) -->
                <div id="intro-menu-container" class="hidden menu-hidden">
                    <div class="grid grid-cols-3 gap-0 items-center">
                        <!-- Cột Trái -->
                        <div class="flex flex-col gap-2">
                            <button onclick="activateConstellation(event, 'openStoryModal')" class="svg-btn constellation-btn w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"><defs><radialGradient id="nebula-story"><stop offset="0%" stop-color="#f59e0b"></stop><stop offset="100%" stop-color="transparent"></stop></radialGradient></defs><rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-story)"></rect>
                                <!-- Biểu tượng Con đường uốn lượn và lá cờ -->
                                <g class="lines">
                                    <path d="M 60 90 Q 80 40, 100 60 T 140 30" stroke-width="1.5" fill="none" style="--line-length: 150; animation-delay: 0.2s;"></path>
                                    <path d="M 140 30 L 140 15" style="--line-length: 15; animation-delay: 1.2s;"></path>
                                    <path d="M 140 15 L 155 20 L 140 25 Z" fill="none" stroke-width="1" style="--line-length: 35; animation-delay: 1.6s;"></path>
                                </g>
                                <g class="stars">
                                    <circle cx="60" cy="90" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="75" cy="55" r="3" fill="#add8e6" style="animation-delay: 0.4s;"></circle>
                                    <circle cx="100" cy="60" r="3" fill="#add8e6" style="animation-delay: 0.6s;"></circle>
                                    <circle cx="120" cy="45" r="3" fill="#add8e6" style="animation-delay: 0.8s;"></circle>
                                    <circle cx="140" cy="30" r="3" fill="#add8e6" style="animation-delay: 1.0s;"></circle>
                                    <circle cx="155" cy="20" r="3" fill="#add8e6" style="animation-delay: 1.4s;"></circle>
                                </g>
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Cốt Truyện</text></svg>
                            </button>
                             <button onclick="window.location.href='credit.html'" class="svg-btn constellation-btn w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"><defs><radialGradient id="nebula-author"><stop offset="0%" stop-color="#f59e0b"></stop><stop offset="100%" stop-color="transparent"></stop></radialGradient></defs><rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-author)"></rect>
                                <!-- Chòm sao chữ Ng - Nguyên -->
                                <g class="lines">
                                    <!-- Chữ N -->
                                    <path d="M 60 90 L 60 40" style="--line-length: 50; animation-delay: 0.2s;"></path>
                                    <path d="M 60 40 L 90 90" style="--line-length: 58.3; animation-delay: 0.6s;"></path>
                                    <path d="M 90 90 L 90 40" style="--line-length: 50; animation-delay: 1.0s;"></path>
                                    <!-- Chữ g -->
                                    <path d="M 125 45 L 145 65" style="--line-length: 28.3; animation-delay: 1.4s;"></path>
                                    <path d="M 145 65 L 125 85" style="--line-length: 28.3; animation-delay: 1.8s;"></path>
                                    <path d="M 125 85 L 105 65" style="--line-length: 28.3; animation-delay: 2.2s;"></path>
                                    <path d="M 105 65 L 125 45" style="--line-length: 28.3; animation-delay: 2.6s;"></path>
                                    <path d="M 145 65 L 145 95" style="--line-length: 30; animation-delay: 3.0s;"></path>
                                    <path d="M 145 95 L 115 95" style="--line-length: 30; animation-delay: 3.4s;"></path>
                                </g>
                                <g class="stars">
                                    <!-- Chữ N -->
                                    <circle cx="60" cy="90" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="60" cy="40" r="3" fill="#add8e6" style="animation-delay: 0.4s;"></circle>
                                    <circle cx="90" cy="90" r="3" fill="#add8e6" style="animation-delay: 0.8s;"></circle>
                                    <circle cx="90" cy="40" r="3" fill="#add8e6" style="animation-delay: 1.2s;"></circle>
                                    <!-- Chữ g -->
                                    <circle cx="125" cy="45" r="3" fill="#add8e6" style="animation-delay: 1.6s;"></circle>
                                    <circle cx="145" cy="65" r="3" fill="#add8e6" style="animation-delay: 2.0s;"></circle>
                                    <circle cx="125" cy="85" r="3" fill="#add8e6" style="animation-delay: 2.4s;"></circle>
                                    <circle cx="105" cy="65" r="3" fill="#add8e6" style="animation-delay: 2.8s;"></circle>
                                    <circle cx="145" cy="95" r="3" fill="#add8e6" style="animation-delay: 3.2s;"></circle>
                                    <circle cx="115" cy="95" r="3" fill="#add8e6" style="animation-delay: 3.6s;"></circle>
                                </g>
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Tác Giả</text></svg>
                            </button>
                        </div>
                        <!-- Cột Giữa (Nút Quay Lại) -->
                        <div class="flex flex-col items-center justify-center gap-2">
                             <button onclick="showMainMenu()" class="svg-btn orrery-btn">
                                <svg viewBox="0 0 250 250" class="w-56 h-56"><defs><radialGradient id="back-grad-pulse-amber"><stop offset="0%" stop-color="#ffffff"></stop><stop offset="70%" stop-color="#f59e0b"></stop><stop offset="100%" stop-color="#facc15"></stop></radialGradient><filter id="back-glow-amber"><feGaussianBlur stdDeviation="5" result="coloredBlur"></feGaussianBlur><feMerge><feMergeNode in="coloredBlur"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter></defs><g transform="translate(125, 125)"><g class="galaxy-arm" style="animation: rotate-slow 20s linear infinite;" transform-origin="center"><path d="M 0 0 C 40 20, 60 60, 50 100" stroke="url(#back-grad-pulse-amber)" stroke-width="3" fill="none" opacity="0.8"></path><path d="M 0 0 C -40 -20, -60 -60, -50 -100" stroke="url(#back-grad-pulse-amber)" stroke-width="3" fill="none" opacity="0.8"></path></g><g class="galaxy-arm" style="animation: rotate-slow 25s linear infinite reverse;" transform-origin="center"><path d="M 0 0 C 20 -40, 60 -60, 100 -50" stroke="white" stroke-width="1.5" fill="none" opacity="0.6"></path><path d="M 0 0 C -20 40, -60 60, -100 50" stroke="white" stroke-width="1.5" fill="none" opacity="0.6"></path></g><circle class="core" cx="0" cy="0" r="25" fill="url(#back-grad-pulse-amber)" filter="url(#back-glow-amber)"></circle><text x="0" y="8" class="btn-text" text-anchor="middle">Quay Lại</text></g></svg>
                            </button>
                        </div>
                        <!-- Cột Phải -->
                        <div class="flex flex-col gap-6 justify-center">
                            <button onclick="window.location.href='phuluc.html'" class="svg-btn constellation-btn w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"><defs><radialGradient id="nebula-appendix"><stop offset="0%" stop-color="#f59e0b"></stop><stop offset="100%" stop-color="transparent"></stop></radialGradient></defs><rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-appendix)"></rect>
                                <!-- Biểu tượng Kính lúp chi tiết -->
                                <g class="lines">
                                    <path d="M 85 45 L 125 85" style="--line-length: 56.5; animation-delay: 1.2s;"></path>
                                    <path d="M 115 40 A 30 30 0 1 1 75 80" fill="none" stroke-width="1.5" style="--line-length: 141; animation-delay: 0.2s;"></path>
                                </g>
                                <g class="stars">
                                    <circle cx="85" cy="45" r="3" fill="#add8e6" style="animation-delay: 1.0s;"></circle>
                                    <circle cx="125" cy="85" r="3" fill="#add8e6" style="animation-delay: 1.4s;"></circle>
                                    <circle cx="115" cy="40" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="75" cy="80" r="3" fill="#add8e6" style="animation-delay: 0.6s;"></circle>
                                    <circle cx="100" cy="50" r="2" fill="#add8e6" style="animation-delay: 1.6s;"></circle> 
                                    <circle cx="90" cy="65" r="2" fill="#add8e6" style="animation-delay: 1.8s;"></circle> 
                                    <circle cx="110" cy="70" r="2" fill="#add8e6" style="animation-delay: 2.0s;"></circle> 
                                </g>
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Phụ Lục</text></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- CONTAINER CHO MENU ÔN TẬP (ẨN BAN ĐẦU) -->
                <div id="review-menu-container" class="hidden menu-hidden">
                    <div class="grid grid-cols-3 gap-0 items-center">
                        <!-- Cột Trái -->
                        <div class="flex flex-col gap-4 justify-center">
                            <button onclick="window.location.href='thuvientrithuc.html'" class="svg-btn constellation-btn w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"><defs><radialGradient id="nebula-library"><stop offset="0%" stop-color="#22c55e"></stop><stop offset="100%" stop-color="transparent"></stop></radialGradient></defs><rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-library)"></rect>
                                <!-- Biểu tượng Chồng sách chi tiết -->
                                <g class="lines">
                                    <path d="M 60 90 L 140 90 L 140 85 L 60 85 Z" stroke-width="1.5" fill="none" style="--line-length: 170; animation-delay: 0.2s;"></path>
                                    <path d="M 65 75 L 135 75 L 135 70 L 65 70 Z" stroke-width="1.5" fill="none" style="--line-length: 150; animation-delay: 0.8s;"></path>
                                    <path d="M 70 60 L 130 60 L 130 55 L 70 55 Z" stroke-width="1.5" fill="none" style="--line-length: 130; animation-delay: 1.4s;"></path>
                                </g>
                                <g class="stars">
                                    <circle cx="60" cy="90" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="140" cy="90" r="3" fill="#add8e6" style="animation-delay: 0.4s;"></circle>
                                    <circle cx="65" cy="75" r="3" fill="#add8e6" style="animation-delay: 0.6s;"></circle>
                                    <circle cx="135" cy="75" r="3" fill="#add8e6" style="animation-delay: 1.0s;"></circle>
                                    <circle cx="70" cy="60" r="3" fill="#add8e6" style="animation-delay: 1.2s;"></circle>
                                    <circle cx="130" cy="60" r="3" fill="#add8e6" style="animation-delay: 1.6s;"></circle>
                                </g>
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Thư Viện Tri Thức</text></svg>
                            </button>
                        </div>
                        <!-- Cột Giữa (Nút Quay Lại) -->
                        <div class="flex flex-col items-center justify-center gap-2">
                             <button onclick="showMainMenu()" class="svg-btn orrery-btn">
                                <svg viewBox="0 0 250 250" class="w-56 h-56"><defs><radialGradient id="back-grad-pulse-emerald"><stop offset="0%" stop-color="#ffffff"></stop><stop offset="70%" stop-color="#22c55e"></stop><stop offset="100%" stop-color="#34d399"></stop></radialGradient><filter id="back-glow-emerald"><feGaussianBlur stdDeviation="5" result="coloredBlur"></feGaussianBlur><feMerge><feMergeNode in="coloredBlur"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter></defs><g transform="translate(125, 125)"><g class="galaxy-arm" style="animation: rotate-slow 20s linear infinite;" transform-origin="center"><path d="M 0 0 C 40 20, 60 60, 50 100" stroke="url(#back-grad-pulse-emerald)" stroke-width="3" fill="none" opacity="0.8"></path><path d="M 0 0 C -40 -20, -60 -60, -50 -100" stroke="url(#back-grad-pulse-emerald)" stroke-width="3" fill="none" opacity="0.8"></path></g><g class="galaxy-arm" style="animation: rotate-slow 25s linear infinite reverse;" transform-origin="center"><path d="M 0 0 C 20 -40, 60 -60, 100 -50" stroke="white" stroke-width="1.5" fill="none" opacity="0.6"></path><path d="M 0 0 C -20 40, -60 60, -100 50" stroke="white" stroke-width="1.5" fill="none" opacity="0.6"></path></g><circle class="core" cx="0" cy="0" r="25" fill="url(#back-grad-pulse-emerald)" filter="url(#back-glow-emerald)"></circle><text x="0" y="8" class="btn-text" text-anchor="middle">Quay Lại</text></g></svg>
                            </button>
                        </div>
                        <!-- Cột Phải -->
                        <div class="flex flex-col gap-4 justify-center">
                            <button onclick="window.location.href='thegameontap.html'" class="svg-btn constellation-btn w-11/12 mx-auto">
                                <svg viewBox="0 0 200 130"><defs><radialGradient id="nebula-cards"><stop offset="0%" stop-color="#22c55e"></stop><stop offset="100%" stop-color="transparent"></stop></radialGradient></defs><rect class="nebula" x="0" y="0" width="200" height="120" fill="url(#nebula-cards)"></rect>
                                <!-- Biểu tượng Thẻ lật chi tiết -->
                                <g class="lines">
                                    <path d="M 70 35 L 130 35 L 130 85 L 70 85 Z" fill="none" stroke="#add8e6" stroke-width="1" style="--line-length: 220; animation-delay: 0.2s;"></path>
                                    <path d="M 60 45 L 120 45 L 120 95 L 60 95 Z" fill="none" stroke="#add8e6" stroke-width="1" style="--line-length: 220; animation-delay: 1.2s;"></path>
                                    <path d="M 100 60 A 15 15 0 1 1 115 75" fill="none" stroke-width="1.5" style="--line-length: 35; animation-delay: 2.2s;"></path>
                                    <path d="M 115 75 L 110 70" style="--line-length: 7; animation-delay: 2.6s;"></path>
                                    <path d="M 115 75 L 120 70" style="--line-length: 7; animation-delay: 2.8s;"></path>
                                </g>
                                <g class="stars">
                                    <circle cx="70" cy="35" r="3" fill="#add8e6" style="animation-delay: 0s;"></circle>
                                    <circle cx="130" cy="35" r="3" fill="#add8e6" style="animation-delay: 0.4s;"></circle>
                                    <circle cx="130" cy="85" r="3" fill="#add8e6" style="animation-delay: 0.8s;"></circle>
                                    <circle cx="70" cy="85" r="3" fill="#add8e6" style="animation-delay: 1.0s;"></circle>
                                    <circle cx="60" cy="45" r="3" fill="#add8e6" style="animation-delay: 1.4s;"></circle>
                                    <circle cx="120" cy="45" r="3" fill="#add8e6" style="animation-delay: 1.6s;"></circle>
                                    <circle cx="120" cy="95" r="3" fill="#add8e6" style="animation-delay: 1.8s;"></circle>
                                    <circle cx="60" cy="95" r="3" fill="#add8e6" style="animation-delay: 2.0s;"></circle>
                                    <circle cx="100" cy="60" r="3" fill="#add8e6" style="animation-delay: 2.4s;"></circle>
                                    <circle cx="115" cy="75" r="3" fill="#add8e6" style="animation-delay: 3.0s;"></circle>
                                </g>
                                <text x="100" y="125" class="btn-text" text-anchor="middle">Thẻ Ôn Tập</text></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL CỐT TRUYỆN -->
    <div id="story-modal-overlay" class="modal-overlay">
        <div class="modal-container border border-amber-400/50">
            <h2 class="text-3xl font-bold text-amber-300 uppercase mb-4">Cốt truyện game</h2>
            <p class="text-gray-300 mb-8">Lựa chọn hình thức bạn muốn khám phá.</p>
            <div class="grid sm:grid-cols-2 gap-4">
                 <button onclick="openLink('https://drive.google.com/file/d/14pvQEbsQZsATzxgsd_LJSTqN9R9rivFe/preview')" class="modal-btn flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    Xem Video
                 </button>
                <button onclick="openLink('https://drive.google.com/file/d/1OKXN-0ZA6_MLBLczM9aLUFxsrmJHaKjb/preview')" class="modal-btn flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                    Đọc PDF
                </button>
            </div>
            <button onclick="closeModal('story-modal-overlay')" class="modal-btn mt-8 bg-amber-600/50 hover:bg-amber-500/80">Quay lại</button>
        </div>
    </div>

    <!-- MODAL THÔNG TIN TRƯỜNG -->
    <div id="school-info-modal" class="modal-overlay">
        <div class="modal-container">
             <h2 class="text-3xl font-bold mb-4 text-center">Trường THPT Yersin Đà Lạt</h2>
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></svg>
                    Sứ mệnh & Lịch sử
                </h3>
                <p>Thành lập năm 2005, THPT Yersin là trường duy nhất trực thuộc Đại học Yersin tại Lâm Đồng, luôn nỗ lực trong công tác giảng dạy và giáo dục học sinh.</p>
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8V4H8"></path><path d="M8 4H4v16h4"></path><path d="M12 8h8v12h-8"></path></svg>
                    Chất lượng Giáo dục
                </h3>
                <p>Nhà trường chú trọng phát triển toàn diện, với tỉ lệ tốt nghiệp THPT đạt 100% và trên 80% học sinh vào Đại học – Cao đẳng trong nhiều năm liền.</p>
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                    Cơ sở vật chất
                </h3>
                <p>Tọa lạc tại Đà Lạt, trường có cơ sở vật chất hiện đại, khép kín với các phòng học, phòng thí nghiệm và sân bãi thể thao đạt tiêu chuẩn.</p>
                <p class="hotline mt-2">Hotline: 091 472 97 08</p>
                <button onclick="closeModal('school-info-modal')" class="modal-btn modal-btn-close mt-8 mx-auto block">Đóng</button>
        </div>
    </div>
    
    <!-- Hộp thông báo nhỏ ở dưới -->
    <div id="notification-box"></div>
    
    <!-- COPYRIGHT -->
    <div id="copyright">
        © <span id="year"></span> Thầy Thái Minh Nguyên - Trường Tiểu học, THCS & THPT Yersin Đà Lạt. All rights reserved.
    </div>

    <script>
        // --- CẬP NHẬT NĂM BẢN QUYỀN ---
        document.getElementById("year").textContent = new Date().getFullYear();

        // --- LOGIC TỐI ƯU HÓA ĐỒ HỌA ---
        const graphicsToggleBtn = document.getElementById('graphics-toggle-btn');
        const body = document.body;
        const tooltip = document.getElementById('settings-tooltip');

        // Hàm để áp dụng/xóa chế độ đồ họa thấp
        function applyGraphicsMode(isLow) {
            if (isLow) {
                body.classList.add('low-quality-mode');
                if (tooltip) tooltip.textContent = 'Nâng cấp đồ họa (cấu hình cao)';
            } else {
                body.classList.remove('low-quality-mode');
                if (tooltip) tooltip.textContent = 'Giảm đồ họa (cấu hình thấp)';
            }
        }

        // Xử lý khi click vào nút
        if (graphicsToggleBtn) {
            graphicsToggleBtn.addEventListener('click', () => {
                const isCurrentlyLow = body.classList.contains('low-quality-mode');
                const newModeIsLow = !isCurrentlyLow;
                applyGraphicsMode(newModeIsLow);
                // Lưu lựa chọn vào localStorage
                localStorage.setItem('graphicsMode', newModeIsLow ? 'low' : 'high');
                showNotification(newModeIsLow ? 'Đã bật: Chế độ đồ họa thấp.' : 'Đã bật: Chế độ đồ họa cao.');
            });
        }
        
        // --- LOGIC TẠO NỀN SAO RƠI ---
        document.addEventListener('DOMContentLoaded', () => {
            const savedMode = localStorage.getItem('graphicsMode');
            // Mặc định là chế độ thấp nếu chưa có lựa chọn nào được lưu
            const isLowMode = savedMode !== 'high';
            applyGraphicsMode(isLowMode);

            const container = document.getElementById('star-container-fixed');
            if (!container) return;
            // Giảm số lượng sao ở chế độ đồ họa thấp
            const starCount = isLowMode ? 30 : 100; 
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                const animationDuration = Math.random() * 10 + 8;
                const animationDelay = Math.random() * 8;
                star.style.animationDuration = `${animationDuration}s`;
                star.style.animationDelay = `-${animationDelay}s`;
                container.appendChild(star);
            }
        });

        // --- LOGIC CO GIÃN GIAO DIỆN ---
        function scaleContent() {
            const container = document.getElementById('scaling-container');
            if (!container) return;
            const baseWidth = 1280;
            const baseHeight = 720; 
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const scaleX = viewportWidth / baseWidth;
            const scaleY = viewportHeight / baseHeight;
            const scale = Math.min(scaleX, scaleY);
            container.style.transform = `scale(${scale})`;
        }
        window.addEventListener('resize', scaleContent);
        document.addEventListener('DOMContentLoaded', scaleContent);

        // --- LOGIC HIỂN THỊ HỘP THÔNG BÁO ---
        const notificationBox = document.getElementById('notification-box');
        let notificationTimeout;
        function showNotification(message) {
            if (notificationTimeout) clearTimeout(notificationTimeout);
            notificationBox.textContent = message;
            notificationBox.classList.add('show');
            notificationTimeout = setTimeout(() => {
                notificationBox.classList.remove('show');
            }, 3000);
        }

        // --- LOGIC CHUYỂN ĐỔI MENU ---
        const mainMenuContainer = document.getElementById('main-menu-container');
        const gameMenuContainer = document.getElementById('game-menu-container');
        const introMenuContainer = document.getElementById('intro-menu-container');
        const reviewMenuContainer = document.getElementById('review-menu-container');
        const cosmicTitleWrapper = document.querySelector('.cosmic-title-wrapper');
        const gameTitle = document.getElementById('game-title');
        const gateFlashOverlay = document.getElementById('gate-flash-overlay');

        function hideAllSubMenus() {
            gameMenuContainer.classList.add('hidden');
            introMenuContainer.classList.add('hidden');
            reviewMenuContainer.classList.add('hidden');
        }

        function showGameMenu() {
            mainMenuContainer.classList.add('menu-hidden');
            cosmicTitleWrapper.classList.add('menu-hidden');
            setTimeout(() => {
                mainMenuContainer.classList.add('hidden');
                gameMenuContainer.classList.remove('hidden');
                gameTitle.textContent = "CHỌN GAME";
                document.getElementById('game-subtitle').style.display = 'none'; // Ẩn slogan
                setTimeout(() => {
                    gameMenuContainer.classList.remove('menu-hidden');
                    cosmicTitleWrapper.classList.remove('menu-hidden');
                }, 50);
            }, 500);
        }
        
        function showIntroMenu() {
            mainMenuContainer.classList.add('menu-hidden');
            cosmicTitleWrapper.classList.add('menu-hidden');
            setTimeout(() => {
                mainMenuContainer.classList.add('hidden');
                introMenuContainer.classList.remove('hidden');
                gameTitle.textContent = "GIỚI THIỆU";
                document.getElementById('game-subtitle').style.display = 'none';
                setTimeout(() => {
                    introMenuContainer.classList.remove('menu-hidden');
                    cosmicTitleWrapper.classList.remove('menu-hidden');
                }, 50);
            }, 500);
        }

        function showReviewMenu() {
            mainMenuContainer.classList.add('menu-hidden');
            cosmicTitleWrapper.classList.add('menu-hidden');
            setTimeout(() => {
                mainMenuContainer.classList.add('hidden');
                reviewMenuContainer.classList.remove('hidden');
                gameTitle.textContent = "ÔN TẬP & HỌC TẬP";
                document.getElementById('game-subtitle').style.display = 'none';
                setTimeout(() => {
                    reviewMenuContainer.classList.remove('menu-hidden');
                    cosmicTitleWrapper.classList.remove('menu-hidden');
                }, 50);
            }, 500);
        }

        function showMainMenu() {
            gameMenuContainer.classList.add('menu-hidden');
            introMenuContainer.classList.add('menu-hidden');
            reviewMenuContainer.classList.add('menu-hidden');
            cosmicTitleWrapper.classList.add('menu-hidden');
            setTimeout(() => {
                hideAllSubMenus();
                mainMenuContainer.classList.remove('hidden');
                gameTitle.textContent = "Cuộc Chiến Không Khói";
                document.getElementById('game-subtitle').style.display = 'block'; // Hiện lại slogan
                setTimeout(() => {
                    mainMenuContainer.classList.remove('menu-hidden');
                    cosmicTitleWrapper.classList.remove('menu-hidden');
                }, 50);
            }, 500);
        }

        // --- LOGIC CHO CÁC MODAL ---
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.add('visible');
        }
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.remove('visible');
        }
        function openLink(url) {
            window.open(url, '_blank');
        }

        // Gán sự kiện click cho logo để mở modal thông tin trường
        const gameLogo = document.getElementById('gameLogo');
        if (gameLogo) {
            gameLogo.addEventListener('click', () => openModal('school-info-modal'));
        }

        // --- LOGIC XỬ LÝ KHI CLICK VÀO CÁC NÚT ---
        function activateConstellation(event, action) {
            const button = event.currentTarget.closest('.svg-btn');
            if (!button || button.classList.contains('is-clicked')) return;
            
            if (button.classList.contains('orrery-btn') && action.endsWith('.html')) {
                if (button.classList.contains('is-opening')) return;
                button.classList.add('is-opening');
                if (gateFlashOverlay) {
                    gateFlashOverlay.classList.add('is-flashing');
                    setTimeout(() => gateFlashOverlay.classList.remove('is-flashing'), 1000);
                }
                setTimeout(() => button.classList.remove('is-opening'), 1000);
            } else {
                button.classList.add('clicked-effect');
                setTimeout(() => button.classList.remove('clicked-effect'), 600);
            }

            button.classList.add('is-clicked');

            if (action === "Mở Menu Game...") {
                showGameMenu();
            } else if (action === "Mở Giới thiệu...") {
                showIntroMenu();
            } else if (action === "Mở Ôn tập - Học tập...") {
                showReviewMenu();
            } else if (action === 'openStoryModal') {
                setTimeout(() => openModal('story-modal-overlay'), 500);
            } else if (action.endsWith('.html')) {
                setTimeout(() => { window.location.href = action; }, 500);
            } else {
                setTimeout(() => { showNotification(action); }, 500);
            }
            
            setTimeout(() => {
                button.classList.remove('is-clicked');
            }, 1500);
        }

        // --- LOGIC ÂM THANH ---
        let audioInitialized = false;
        let clickSound;

        // Hàm khởi tạo và bắt đầu âm thanh
        async function initAndStartAudio() {
            if (audioInitialized) return;
            try {
                await Tone.start();
                console.log("Audio context started");

                // 1. Âm thanh click đơn giản
                clickSound = new Tone.Synth({
                    oscillator: { type: 'sine' },
                    envelope: { attack: 0.005, decay: 0.1, sustain: 0.05, release: 0.1 }
                }).toDestination();
                clickSound.volume.value = -12;

                // Gán sự kiện click cho tất cả các nút có thể bấm
                document.querySelectorAll('button').forEach(button => {
                    button.addEventListener('click', () => {
                        if (clickSound && Tone.context.state === 'running') {
                            clickSound.triggerAttackRelease('C5', '8n');
                        }
                    });
                });
                
                // 2. Nhạc nền du dương
                const reverb = new Tone.Reverb({ decay: 4, preDelay: 0.1 }).toDestination();
                const synth = new Tone.PolySynth(Tone.FMSynth, {
                    harmonicity: 1.5,
                    modulationIndex: 1.2,
                    envelope: { attack: 1, decay: 0.5, sustain: 0.8, release: 3 }
                }).connect(reverb);
                synth.volume.value = -20; // Giảm âm lượng nhạc nền

                const chords = [
                    {'time': '0:0', 'note': ['C4', 'E4', 'G4', 'B4']},
                    {'time': '0:2', 'note': ['G3', 'B3', 'D4', 'F#4']},
                    {'time': '1:0', 'note': ['A3', 'C4', 'E4', 'G4']},
                    {'time': '1:2', 'note': ['F3', 'A3', 'C4', 'E4']}
                ];

                const part = new Tone.Part((time, value) => {
                    synth.triggerAttackRelease(value.note, '2n', time);
                }, chords).start(0);
                part.loop = true;
                part.loopEnd = '2m';

                Tone.Transport.bpm.value = 75;
                Tone.Transport.start();

                audioInitialized = true;
                showNotification('Đã bật âm thanh.');
            } catch (e) {
                console.error("Could not start audio context:", e);
            }
        }

        // Lắng nghe tương tác đầu tiên của người dùng để bật âm thanh
        document.body.addEventListener('pointerdown', initAndStartAudio, { once: true });

    </script>
</body>
</html>

