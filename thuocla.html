<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£o v·ªá s·ª©c kh·ªèe - N√≥i kh√¥ng v·ªõi thu·ªëc l√°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fefcfb 0%, #fef3e2 30%, #fef0f0 70%, #fefefe 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Main Menu Styles */
        .main-menu {
            text-align: center;
            color: #92400e;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(251, 146, 60, 0.15);
            box-shadow: 0 25px 50px rgba(194, 65, 12, 0.08);
        }

        .logo {
            font-size: 2.5rem;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(194, 65, 12, 0.2);
            font-weight: bold;
            background: linear-gradient(45deg, #ef4444, #f97316, #fb923c, #fbbf24);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .title {
            font-size: 2.2rem;
            margin-bottom: 20px;
            line-height: 1.3;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
            font-weight: 600;
            color: #92400e;
        }

        .subtitle {
            font-size: 1.1rem;
            margin-bottom: 35px;
            color: #92400e;
            font-style: italic;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.7);
            padding: 15px 30px;
            background: rgba(254, 243, 199, 0.5);
            border-radius: 25px;
            border: 1px solid rgba(251, 146, 60, 0.2);
        }

        .author-info {
            margin-top: 40px;
            padding-top: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .author-line {
            flex: 1;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(148, 163, 184, 0.5), transparent);
            max-width: 100px;
        }

        .author-text {
            text-align: center;
            font-size: 0.95rem;
            line-height: 1.4;
            color: #92400e;
        }

        .author-title {
            font-weight: 300;
            font-size: 0.9rem;
            color: #a16207;
        }

        .author-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #b91c1c;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }

        .author-school {
            font-weight: 500;
            font-size: 0.95rem;
            color: #92400e;
        }

        .smoke-effect {
            position: absolute;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 5rem;
            opacity: 0.4;
            animation: smokeDisappear 4s ease-out infinite;
            z-index: -1;
        }

        .smoke-effect::before {
            content: 'üí®üí®üí®';
            position: absolute;
            top: -20px;
            left: -100px;
            font-size: 3rem;
            opacity: 0.2;
            animation: smokeDisappear 5s ease-out infinite 1s;
        }

        .smoke-effect::after {
            content: 'üö≠';
            position: absolute;
            top: 60px;
            left: 20px;
            font-size: 2rem;
            opacity: 0.6;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes smokeDisappear {
            0% { opacity: 0.6; transform: translateX(-50%) translateY(0) scale(1); }
            50% { opacity: 0.3; transform: translateX(-50%) translateY(-30px) scale(1.2); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-80px) scale(1.5); }
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 40px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.25);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f97316, #ea580c);
            color: white;
            box-shadow: 0 4px 15px rgba(234, 88, 12, 0.25);
        }

        .btn-tertiary {
            background: linear-gradient(45deg, #fb923c, #f97316);
            color: white;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.25);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
        }

        /* Instructions Styles */
        .instructions {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            color: #1e293b;
            box-shadow: 0 25px 50px rgba(15, 23, 42, 0.08);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .instructions h2 {
            color: #3b82f6;
            margin-bottom: 20px;
            font-size: 2rem;
            text-align: center;
        }

        .instructions p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .instructions ul {
            margin: 20px 0;
            padding-left: 30px;
        }

        .instructions li {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        /* Game Part 1 Styles */
        .game-part1 {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 30%, #334155 70%, #475569 100%);
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .intro-text {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(147, 51, 234, 0.15) 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            max-width: 650px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.1);
            backdrop-filter: blur(12px);
        }

        .intro-text h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .game-area {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 500px;
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.3) 0%, rgba(67, 56, 202, 0.2) 50%, rgba(79, 70, 229, 0.25) 100%);
            border-radius: 25px;
            margin: 20px auto;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(99, 102, 241, 0.4);
            box-shadow: 0 12px 40px rgba(30, 58, 138, 0.2);
            overflow: hidden;
        }

        /* Lighting Effects */
        .spotlight {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.1) 40%, transparent 70%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 5;
            transform: translate(-50%, -50%);
        }

        .spotlight.active {
            opacity: 1;
            animation: spotlightPulse 2s ease-in-out infinite;
        }

        @keyframes spotlightPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .organ-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .organ.nearby .organ-glow {
            opacity: 1;
            animation: organGlow 1.5s ease-in-out infinite;
        }

        @keyframes organGlow {
            0%, 100% { transform: scale(1); opacity: 0.4; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        .character {
            position: absolute;
            font-size: 3rem;
            transition: all 0.3s ease;
            z-index: 10;
            cursor: pointer;
            animation: bounce 2s ease-in-out infinite;
            left: 50%;
            top: 80%;
            transform: translate(-50%, -50%);
        }

        @keyframes bounce {
            0%, 100% { transform: translate(-50%, -50%) translateY(0px); }
            50% { transform: translate(-50%, -50%) translateY(-10px); }
        }

        .organ {
            position: absolute;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(196, 181, 253, 0.2) 100%);
            border-radius: 50%;
            padding: 20px;
            cursor: pointer;
            transition: all 0.4s ease;
            min-width: 120px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(12px);
            border: 3px solid rgba(139, 92, 246, 0.5);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.15);
        }

        .organ:hover, .organ.nearby {
            transform: scale(1.15);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(196, 181, 253, 0.35) 100%);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.3);
            border-color: rgba(168, 85, 247, 0.8);
            filter: brightness(1.1);
        }

        .organ.visited {
            opacity: 0;
            transform: scale(0.5);
            pointer-events: none;
        }

        /* NEW Organ Positions */
        .organ-eyes { top: 10%; left: 15%; }
        .organ-brain { top: 10%; left: 50%; transform: translateX(-50%); }
        .organ-lungs { top: 10%; right: 15%; }
        .organ-heart { top: 40%; left: 15%; }
        .organ-liver { top: 40%; left: 50%; transform: translateX(-50%); }
        .organ-stomach { top: 40%; right: 15%; }
        .organ-kidney { top: 70%; left: 50%; transform: translateX(-50%); }

        .organ-icon {
            font-size: 3rem;
            margin-bottom: 8px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
            to { text-shadow: 0 0 20px rgba(255, 255, 255, 0.8); }
        }

        .organ-name {
            font-size: 1rem;
            font-weight: bold;
            text-align: center;
        }

        .game-controls {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(147, 51, 234, 0.15) 100%);
            border-radius: 15px;
            padding: 12px;
            backdrop-filter: blur(12px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.1);
        }

        .control-hint {
            font-size: 0.8rem;
            text-align: center;
            margin-bottom: 8px;
            color: white;
            font-weight: bold;
        }

        .movement-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            max-width: 120px;
            margin: 0 auto;
        }

        .move-btn {
            padding: 6px;
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 6px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .move-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .move-btn:active {
            transform: scale(0.95);
        }

        .interaction-hint {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            white-space: nowrap;
        }

        .interaction-hint.show {
            opacity: 1;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            color: #1e293b;
            box-shadow: 0 25px 50px rgba(15, 23, 42, 0.15);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            font-size: 2rem;
            color: #3b82f6;
        }

        .modal-icon {
            font-size: 3rem;
            margin-right: 15px;
        }

        .modal-text {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 20px;
            min-height: 100px;
        }

        .conversation-progress {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: #3b82f6;
            transform: scale(1.2);
        }

        .progress-dot.completed {
            background: #10b981;
        }

        .conversation-controls {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .conversation-hint {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
            font-style: italic;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
        }

        .close-modal:hover {
            color: #ef4444;
        }

        /* Progress and Score */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.3);
            z-index: 100;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #06b6d4);
            width: 0%;
            transition: width 0.5s ease;
        }

        .score-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            color: #1e293b;
            z-index: 100;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .title { font-size: 1.5rem; }
            .organs-container { gap: 20px; }
            .organ { min-width: 150px; padding: 20px; }
            .modal-content { padding: 20px; margin: 10px; }
        }

        /* Navigation Buttons */
        .nav-buttons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .nav-btn {
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            color: #1e293b;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(15, 23, 42, 0.15);
        }

        .completion-screen {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            text-align: center;
        }

        .completion-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            backdrop-filter: blur(10px);
        }

        .completion-content h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .completion-content p {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        /* Game Part 2 & 3 Intro Styles */
        .part-intro-screen {
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .part-intro-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .part-intro-content h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: warningPulse 2s ease-in-out infinite;
        }

        #part2Intro { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); }
        #part3Intro { background: linear-gradient(135deg, #059669 0%, #047857 100%); }


        @keyframes warningPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .falling-toxins {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .falling-toxin {
            position: absolute;
            font-size: 2rem;
            animation: fallDown 3s linear infinite;
            opacity: 0.7;
        }

        @keyframes fallDown {
            0% { transform: translateY(-50px); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            100% { transform: translateY(100vh); opacity: 0; }
        }

        .shooting-game {
            background: linear-gradient(180deg, #1e1b4b 0%, #312e81 100%);
            color: white;
            position: relative;
            overflow: hidden;
            min-height: 100vh;
        }

        .game-canvas {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 600px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }

        .player-ship {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            z-index: 10;
            transition: left 0.1s ease;
        }

        .enemy {
            position: absolute;
            font-size: 2rem;
            z-index: 5;
            transition: all 0.1s ease;
            cursor: pointer;
        }

        .enemy:hover {
            transform: scale(1.2);
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8));
        }

        .bullet {
            position: absolute;
            width: 4px;
            height: 15px;
            background: linear-gradient(180deg, #fbbf24, #f59e0b);
            border-radius: 2px;
            z-index: 8;
        }

        .explosion {
            position: absolute;
            font-size: 3rem;
            z-index: 15;
            animation: explode 0.5s ease-out forwards;
            pointer-events: none;
        }

        @keyframes explode {
            0% { transform: scale(0.5); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.8; }
            100% { transform: scale(2); opacity: 0; }
        }

        .game-hud {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 20;
        }

        .lives-display {
            display: flex;
            gap: 10px;
            font-size: 2rem;
        }

        .life-icon {
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }

        .life-icon.lost {
            opacity: 0.3;
            filter: grayscale(100%);
        }

        .score-hud {
            font-size: 1.2rem;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .wave-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            z-index: 25;
            opacity: 0;
            animation: waveAnnounce 2s ease-out forwards;
        }

        @keyframes waveAnnounce {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        .toxin-info-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid #ef4444;
            z-index: 100;
            max-width: 350px;
            text-align: left;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
            opacity: 0;
            animation: popupSlideIn 3s ease-out forwards;
            backdrop-filter: blur(10px);
        }

        @keyframes popupSlideIn {
            0% { opacity: 0; transform: translateX(100%); }
            10% { opacity: 1; transform: translateX(0); }
            90% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(100%); }
        }

        .toxin-info-popup h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #fbbf24;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toxin-info-popup p {
            font-size: 0.9rem;
            line-height: 1.4;
            margin: 0;
        }

        .game-controls-info {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 20;
        }

        .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .game-over-screen.show {
            opacity: 1;
            pointer-events: all;
        }

        .game-over-content {
            text-align: center;
            background: rgba(220, 38, 38, 0.2);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid #dc2626;
            max-width: 600px;
        }

        .game-over-content h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ef4444;
        }

        .game-over-content p {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .victory-screen {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            text-align: center;
        }

        .victory-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto;
            backdrop-filter: blur(10px);
        }

        .victory-content h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            animation: victoryGlow 2s ease-in-out infinite;
        }

        @keyframes victoryGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(16, 185, 129, 0.8); }
            50% { text-shadow: 0 0 30px rgba(16, 185, 129, 1); }
        }
        
        /* --- CUTE QUIZ GAME STYLES --- */
        .quiz-game {
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
            color: #333;
            overflow: hidden;
        }

        .bubble {
            position: absolute;
            bottom: -100px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation: floatUp 10s infinite ease-in;
            z-index: 0;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh);
                opacity: 0;
            }
        }

        .quiz-container {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 30px;
            padding: 40px;
            max-width: 800px;
            width: 95%;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 1;
        }

        .quiz-progress {
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: bold;
            background: #ffc3a0;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .quiz-question {
            font-size: 1.6rem;
            color: #555;
            margin-bottom: 30px;
            line-height: 1.4;
            min-height: 80px;
        }
        
        .quiz-question::before {
            content: 'ü§î ';
        }

        .answer-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .answer-btn {
            padding: 20px;
            font-size: 1.1rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease-out;
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
            color: #555;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .answer-btn:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .answer-btn:active:not(:disabled) {
            transform: translateY(-2px) scale(0.98);
        }

        .answer-btn.correct {
            background: linear-gradient(145deg, #a8e6cf, #81c784);
            color: white;
            animation: correct-bounce 0.5s ease;
        }

        .answer-btn.wrong {
            background: linear-gradient(145deg, #ff9a9e, #fecfef);
            color: white;
            animation: wrong-shake 0.5s ease;
        }
        
        .answer-btn:disabled {
            cursor: not-allowed;
        }

        @keyframes correct-bounce {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(0.95); }
            50% { transform: scale(1.1); }
            75% { transform: scale(1.05); }
        }

        @keyframes wrong-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }

        .quiz-feedback {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 20px;
            min-height: 30px;
            animation: fade-in 0.5s ease;
        }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .next-question-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            visibility: hidden;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            background: #ffafbd;
            background: -webkit-linear-gradient(to right, #ffc3a0, #ffafbd);
            background: linear-gradient(to right, #ffc3a0, #ffafbd);
            color: white;
        }
        
        .next-question-btn.visible {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- Score Display -->
    <div class="score-display" id="scoreDisplay">ƒêi·ªÉm: 0</div>

    <!-- Main Menu Screen -->
    <div class="screen active" id="mainMenu">
        <div class="smoke-effect">üí®</div>
        <div class="main-menu">
            <div class="logo">üö≠‚ú® "H√ÄNH TR√åNH KH√îNG KH√ìI" ‚ú®üö≠</div>
            <h1 class="title">Cu·ªôc phi√™u l∆∞u qua c√°c c∆° quan<br><span style="font-size: 0.75em; color: #b91c1c; font-weight: 600; text-shadow: 1px 1px 2px rgba(255,255,255,0.8);">ƒë·ªÉ gi·ªØ c∆° th·ªÉ kh·ªèe m·∫°nh</span></h1>
            <div class="subtitle">üåü Kh√°m ph√° 7 c∆° quan quan tr·ªçng v√† h·ªçc c√°ch b·∫£o v·ªá ch√∫ng üåü</div>
            <div class="menu-buttons">
                <button class="btn btn-primary" onclick="startGame()">üéÆ B·∫Øt ƒë·∫ßu h√†nh tr√¨nh</button>
                <button class="btn btn-secondary" onclick="showInstructions()">üìñ H∆∞·ªõng d·∫´n ch∆°i</button>
                <button class="btn btn-tertiary" onclick="exitGame()">üö™ Tho√°t</button>
            </div>
            <div class="author-info">
                <div class="author-line"></div>
                <div class="author-text">
                    <span class="author-title">T√°c gi·∫£:</span><br>
                    <span class="author-name">Th·∫ßy gi√°o Th√°i Minh Nguy√™n</span><br>
                    <span class="author-school">Tr∆∞·ªùng THPT Yersin ƒê√† L·∫°t</span>
                </div>
                <div class="author-line"></div>
            </div>
        </div>
    </div>

    <!-- Instructions Screen -->
    <div class="screen" id="instructionsScreen">
        <div class="instructions">
            <h2>üìã H∆∞·ªõng d·∫´n ch∆°i</h2>
            <p><strong>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi tr√≤ ch∆°i gi√°o d·ª•c v·ªÅ s·ª©c kh·ªèe!</strong></p>
            
            <h3>üéØ M·ª•c ti√™u:</h3>
            <p>T√¨m hi·ªÉu t√°c h·∫°i c·ªßa thu·ªëc l√° v√† thu·ªëc l√° ƒëi·ªán t·ª≠ ƒë·ªëi v·ªõi c∆° th·ªÉ, ƒë·ªìng th·ªùi h·ªçc c√°ch b·∫£o v·ªá s·ª©c kh·ªèe.</p>
            
            <h3>üéÆ C·∫•u tr√∫c game:</h3>
            <ul>
                <li><strong>Ph·∫ßn 1: Kh√°m ph√° c∆° th·ªÉ</strong> - T√¨m hi·ªÉu vai tr√≤ c·ªßa 7 c∆° quan quan tr·ªçng.</li>
                <li><strong>Ph·∫ßn 2: Game B·∫Øn S√∫ng üöÄ</strong> - Chi·∫øn ƒë·∫•u v·ªõi c√°c ch·∫•t ƒë·ªôc h·∫°i.</li>
                <li><strong>Ph·∫ßn 3: Game C√¢u H·ªèi üß†</strong> - Ki·ªÉm tra ki·∫øn th·ª©c c·ªßa b·∫°n.</li>
            </ul>
            
            <h3>‚≠ê C√°ch ch∆°i:</h3>
            <ul>
                <li>Ho√†n th√†nh c√°c ph·∫ßn ch∆°i ƒë·ªÉ t√≠ch l≈©y ƒëi·ªÉm.</li>
                <li>ƒê·ªçc k·ªπ th√¥ng tin ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi v√† v∆∞·ª£t qua th·ª≠ th√°ch.</li>
                <li>H√£y tham gia t√≠ch c·ª±c ƒë·ªÉ nh·∫≠n ƒë∆∞·ª£c ƒëi·ªÉm s·ªë cao nh·∫•t!</li>
            </ul>
            
            <div class="menu-buttons">
                <button class="btn btn-primary" onclick="startGame()">B·∫Øt ƒë·∫ßu ngay</button>
                <button class="btn btn-secondary" onclick="showMainMenu()">Quay l·∫°i</button>
            </div>
        </div>
    </div>

    <!-- Part 1 Intro Screen -->
    <div class="screen game-part1" id="part1Intro">
        <div class="intro-text" style="text-align: center;">
             <h2>‚ù§Ô∏èüß†ü´Åü´Äü´òüåÄüëÅÔ∏è G·∫∑p g·ª° 7 ng∆∞·ªùi b·∫°n ƒë·ªìng h√†nh</h2>
             <p>"Ch√∫ng t√¥i l√† 7 c∆° quan quan tr·ªçng nh·∫•t c·ªßa c∆° th·ªÉ ‚Äì h√£y t√¨m hi·ªÉu v√† b·∫£o v·ªá ch√∫ng t√¥i kh·ªèi t√°c h·∫°i c·ªßa thu·ªëc l√°!"</p>
        </div>
        <div class="menu-buttons">
            <button class="btn btn-primary" onclick="startPart1Game()">B·∫Øt ƒë·∫ßu kh√°m ph√°</button>
        </div>
    </div>

    <!-- Game Part 1 Screen -->
    <div class="screen" id="gamePart1">
        <div class="game-area">
            <!-- Spotlight Effect -->
            <div class="spotlight" id="spotlight"></div>
            
            <!-- Character -->
            <div class="character" id="character">üßë‚Äç‚öïÔ∏è</div>
            
            <!-- Organs -->
            <div class="organ organ-heart" id="heartOrgan">
                <div class="organ-glow"></div><div class="organ-icon">‚ù§Ô∏è</div><div class="organ-name">TIM</div>
                <div class="interaction-hint" id="heartHint">Nh·∫•n SPACE ƒë·ªÉ n√≥i chuy·ªán!</div>
            </div>
            <div class="organ organ-brain" id="brainOrgan">
                <div class="organ-glow"></div><div class="organ-icon">üß†</div><div class="organ-name">N√ÉO</div>
                <div class="interaction-hint" id="brainHint">Nh·∫•n SPACE ƒë·ªÉ n√≥i chuy·ªán!</div>
            </div>
            <div class="organ organ-lungs" id="lungsOrgan">
                <div class="organ-glow"></div><div class="organ-icon">ü´Å</div><div class="organ-name">PH·ªîI</div>
                <div class="interaction-hint" id="lungsHint">Nh·∫•n SPACE ƒë·ªÉ n√≥i chuy·ªán!</div>
            </div>
            <div class="organ organ-liver" id="liverOrgan">
                <div class="organ-glow"></div><div class="organ-icon">ü´Ä</div><div class="organ-name">GAN</div>
                <div class="interaction-hint" id="liverHint">Nh·∫•n SPACE ƒë·ªÉ n√≥i chuy·ªán!</div>
            </div>
            <div class="organ organ-kidney" id="kidneyOrgan">
                <div class="organ-glow"></div><div class="organ-icon">ü´ò</div><div class="organ-name">TH·∫¨N</div>
                <div class="interaction-hint" id="kidneyHint">Nh·∫•n SPACE ƒë·ªÉ n√≥i chuy·ªán!</div>
            </div>
            <div class="organ organ-stomach" id="stomachOrgan">
                <div class="organ-glow"></div><div class="organ-icon">üåÄ</div><div class="organ-name">RU·ªòT</div>
                <div class="interaction-hint" id="stomachHint">Nh·∫•n SPACE ƒë·ªÉ n√≥i chuy·ªán!</div>
            </div>
            <div class="organ organ-eyes" id="eyesOrgan">
                <div class="organ-glow"></div><div class="organ-icon">üëÅÔ∏è</div><div class="organ-name">M·∫ÆT</div>
                <div class="interaction-hint" id="eyesHint">Nh·∫•n SPACE ƒë·ªÉ n√≥i chuy·ªán!</div>
            </div>

            <!-- Game Controls Inside Game Area -->
            <div class="game-controls">
                <div class="control-hint">üéÆ ƒêi·ªÅu khi·ªÉn</div>
                <div class="movement-buttons">
                    <div></div>
                    <button class="move-btn" onmousedown="moveCharacter('up')" onmouseup="stopMoving()">‚Üë</button>
                    <div></div>
                    <button class="move-btn" onmousedown="moveCharacter('left')" onmouseup="stopMoving()">‚Üê</button>
                    <button class="move-btn" onmousedown="moveCharacter('down')" onmouseup="stopMoving()">‚Üì</button>
                    <button class="move-btn" onmousedown="moveCharacter('right')" onmouseup="stopMoving()">‚Üí</button>
                    <div></div>
                    <button class="move-btn" onclick="interactWithNearbyOrgan()">üí¨</button>
                    <div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Completion Screen for Part 1-->
    <div class="screen" id="completionScreen">
        <div class="completion-content">
            <h2>üéâ Ch√∫c m·ª´ng!</h2>
            <p>B·∫°n ƒë√£ ho√†n th√†nh Ph·∫ßn 1 v√† kh√°m ph√° vai tr√≤ quan tr·ªçng c·ªßa c√°c c∆° quan s·ªëng c√≤n.</p>
            <p><strong>H√£y b·∫£o v·ªá ch√∫ng b·∫±ng c√°ch tr√°nh xa thu·ªëc l√° v√† thu·ªëc l√° ƒëi·ªán t·ª≠!</strong></p>
            <p>ƒêi·ªÉm s·ªë c·ªßa b·∫°n: <span id="finalScore">0</span></p>
            
            <div class="menu-buttons">
                <button class="btn btn-primary" onclick="startPart2Intro()">Ti·∫øp t·ª•c Ph·∫ßn 2 üöÄ</button>
                <button class="btn btn-secondary" onclick="showMainMenu()">V·ªÅ menu ch√≠nh</button>
            </div>
        </div>
    </div>

    <!-- Part 2 Intro Screen (Shooting Game) -->
    <div class="screen part-intro-screen" id="part2Intro">
        <div class="part-intro-content">
            <h2>PH·∫¶N 2: TI√äU DI·ªÜT CH·∫§T ƒê·ªòC üöÄ</h2>
            <p style="font-size: 1.3rem; margin-bottom: 30px;">
                üö® <strong>C·∫©n th·∫≠n! K·∫ª th√π ƒëang ·ªì ·∫°t t·∫•n c√¥ng t·ª´ thu·ªëc l√° v√† thu·ªëc l√° ƒëi·ªán t·ª≠!</strong>
            </p>
            <p style="font-size: 1.1rem; margin-bottom: 30px;">
                üéØ <strong>Nhi·ªám v·ª•:</strong> Ti√™u di·ªát c√°c ch·∫•t ƒë·ªôc h·∫°i tr∆∞·ªõc khi ch√∫ng ph√° h·ªßy c∆° th·ªÉ b·∫°n!
            </p>
            <div style="margin: 30px 0;">
                <p style="font-size: 1rem; color: #fbbf24;">
                    üéÆ <strong>ƒêi·ªÅu khi·ªÉn:</strong> ‚Üê ‚Üí ƒë·ªÉ di chuy·ªÉn, SPACE ƒë·ªÉ b·∫Øn
                </p>
            </div>
            <div class="menu-buttons">
                <button class="btn btn-primary" onclick="startActualShootingGame()">B·∫Øt ƒë·∫ßu chi·∫øn ƒë·∫•u!</button>
                <button class="btn btn-secondary" onclick="showScreen('completionScreen')">üîô Quay l·∫°i</button>
            </div>
        </div>
        <div class="falling-toxins" id="fallingToxinsIntro"></div>
    </div>

    <!-- Shooting Game Screen -->
    <div class="screen" id="shootingGame">
        <div class="game-canvas" id="gameCanvas">
            <!-- Game HUD -->
            <div class="game-hud">
                <div class="lives-display" id="livesDisplay">
                    <span class="life-icon" id="life1">üíñ</span>
                    <span class="life-icon" id="life2">üåü</span>
                    <span class="life-icon" id="life3">‚ú®</span>
                </div>
                <div class="score-hud">
                    <span>ƒêi·ªÉm: </span><span id="gameScore">0</span>
                </div>
            </div>
            
            <!-- Player Ship -->
            <div class="player-ship" id="playerShip">ü¶∏‚Äç‚ôÄÔ∏è</div>
            
            <!-- Wave Indicator -->
            <div class="wave-indicator" id="waveIndicator"></div>
            
            <!-- Game Over Screen -->
            <div class="game-over-screen" id="gameOverScreen">
                <div class="game-over-content">
                    <h2 id="gameOverTitle">üíÄ Th·∫•t b·∫°i...</h2>
                    <p id="gameOverMessage">B·∫°n ƒë√£ b·ªã c√°c ch·∫•t ƒë·ªôc h·∫°i ƒë√°nh b·∫°i! ƒê·ª´ng lo, h√£y d√πng ki·∫øn th·ª©c ƒë·ªÉ ph·ª•c th√π!</p>
                </div>
            </div>
        </div>
        
        <div class="game-controls-info">
            üéÆ ‚Üê ‚Üí Di chuy·ªÉn | SPACE B·∫Øn | ESC T·∫°m d·ª´ng
        </div>
    </div>

    <!-- Part 3 Intro Screen (Quiz Game) -->
    <div class="screen part-intro-screen" id="part3Intro">
        <div class="part-intro-content">
            <h2>PH·∫¶N 3: TH·ª¨ TH√ÅCH TR√ç TU·ªÜ üß†</h2>
            <p style="font-size: 1.3rem; margin-bottom: 30px;">
                ‚ú® <strong>B·∫°n ƒë√£ s·∫µn s√†ng ƒë·ªÉ ki·ªÉm tra ki·∫øn th·ª©c c·ªßa m√¨nh ch∆∞a?</strong>
            </p>
            <p style="font-size: 1.1rem; margin-bottom: 30px;">
                üéØ <strong>Nhi·ªám v·ª•:</strong> Tr·∫£ l·ªùi ƒë√∫ng c√°c c√¢u h·ªèi ƒë·ªÉ ch·ª©ng t·ªè b·∫°n l√† m·ªôt chuy√™n gia v·ªÅ s·ª©c kh·ªèe!
            </p>
            <div class="menu-buttons">
                <button class="btn btn-primary" style="background: #059669;" onclick="startQuizGame()">B·∫Øt ƒë·∫ßu tr·∫£ l·ªùi!</button>
                <button class="btn btn-secondary" onclick="showScreen('victoryScreen')">üîô Quay l·∫°i</button>
            </div>
        </div>
    </div>

    <!-- Quiz Game Screen -->
    <div class="screen quiz-game" id="quizGame">
        <div class="quiz-container">
            <div class="quiz-progress" id="quizProgress">C√¢u 1 / 10</div>
            <h2 class="quiz-question" id="quizQuestion">C√¢u h·ªèi s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y...</h2>
            <div class="answer-options" id="answerOptions">
                <button class="answer-btn">ƒê√°p √°n A</button>
                <button class="answer-btn">ƒê√°p √°n B</button>
                <button class="answer-btn">ƒê√°p √°n C</button>
                <button class="answer-btn">ƒê√°p √°n D</button>
            </div>
            <div class="quiz-feedback" id="quizFeedback"></div>
            <button class="btn btn-primary next-question-btn" id="nextQuestionBtn" onclick="nextQuizQuestion()">C√¢u ti·∫øp theo</button>
        </div>
    </div>

    <!-- Victory Screen (Shared for all game modes) -->
    <div class="screen" id="victoryScreen">
        <div class="victory-content">
            <h2 id="victoryTitle">üéâ Chi·∫øn th·∫Øng!</h2>
            <p id="victoryMessage" style="font-size: 1.3rem; margin-bottom: 20px;">
                B·∫°n ƒë√£ ho√†n th√†nh th·ª≠ th√°ch!
            </p>
            <p style="font-size: 1.1rem; margin-bottom: 30px;">
                ‚ö†Ô∏è <strong>Nh∆∞ng hi·ªÉm h·ªça v·∫´n c√≤n...</strong><br>
                Trong th·ª±c t·∫ø, thu·ªëc l√° v√† thu·ªëc l√° ƒëi·ªán t·ª≠ t·∫•n c√¥ng c∆° th·ªÉ 24/7.<br>
                C√°ch duy nh·∫•t ƒë·ªÉ th·∫Øng l√† <strong>KH√îNG BAO GI·ªú H√öT!</strong>
            </p>
            <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px; margin: 20px 0;">
                <p id="victoryStats" style="font-size: 1rem;">
                    üèÜ <strong>ƒêi·ªÉm s·ªë cu·ªëi c√πng:</strong> <span id="finalGameScore">0</span>
                </p>
            </div>
            <div class="menu-buttons" id="victoryButtons">
                <!-- Buttons will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="nav-buttons" id="navButtons" style="display: none;">
        <button class="nav-btn" onclick="goBack()">‚¨ÖÔ∏è Quay l·∫°i</button>
        <button class="nav-btn" onclick="showMainMenu()">üè† Menu ch√≠nh</button>
    </div>

    <!-- Modal for Organ Information -->
    <div class="modal" id="organModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <div class="modal-header">
                <span class="modal-icon" id="modalIcon"></span>
                <span id="modalTitle"></span>
            </div>
            <div class="conversation-progress" id="conversationProgress"></div>
            <div class="modal-text" id="modalText"></div>
            <div class="conversation-controls">
                <div class="conversation-hint" id="conversationHint">Nh·∫•n SPACE ƒë·ªÉ ti·∫øp t·ª•c cu·ªôc tr√≤ chuy·ªán...</div>
                <div class="menu-buttons">
                    <button class="btn btn-secondary" id="nextMessageBtn" onclick="nextMessage()">Ti·∫øp t·ª•c (SPACE)</button>
                    <button class="btn btn-primary" id="finishConversationBtn" onclick="closeModal()" style="display: none;">K·∫øt th√∫c</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State Variables
        let currentScreen = 'mainMenu';
        let score = 0;
        let visitedOrgans = new Set();
        let progress = 0;
        
        // Character movement variables
        let characterPosition = { x: 50, y: 80 }; // Percentage positions
        let isMoving = false;
        let moveInterval = null;
        let currentDirection = null;
        let nearbyOrgan = null;

        // Sound System using Tone.js
        const soundSystem = {
            isInitialized: false,
            synths: {},

            async init() {
                if (this.isInitialized) return;
                try {
                    await Tone.start();
                    this.setupSynths();
                    this.isInitialized = true;
                    console.log("Audio context started successfully!");
                } catch (e) {
                    console.error("Could not start audio context:", e);
                }
            },

            setupSynths() {
                this.synths.click = new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.1 } }).toDestination();
                this.synths.shoot = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.05, sustain: 0.1, release: 0.2 } }).toDestination();
                this.synths.explosion = new Tone.NoiseSynth({ noise: { type: 'white' }, envelope: { attack: 0.01, decay: 0.1, sustain: 0 } }).toDestination();
                this.synths.playerHit = new Tone.Synth({ oscillator: { type: 'square' }, envelope: { attack: 0.01, decay: 0.3, sustain: 0, release: 0.1 } }).toDestination();
                this.synths.correct = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.2 } }).toDestination();
                this.synths.wrong = new Tone.Synth({ oscillator: { type: 'sawtooth' }, envelope: { attack: 0.01, decay: 0.5, sustain: 0, release: 0.1 } }).toDestination();
                this.synths.victory = new Tone.PolySynth(Tone.Synth, { oscillator: { type: 'sine' }, envelope: { attack: 0.05, decay: 0.2, sustain: 0.3, release: 0.5 } }).toDestination();
                this.synths.interaction = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.1, sustain: 0.1, release: 0.1 } }).toDestination();
                this.synths.move = new Tone.MembraneSynth({ pitchDecay: 0.01, octaves: 2, envelope: { attack: 0.001, decay: 0.1, sustain: 0 } }).toDestination();
                this.synths.wave = new Tone.Synth({ oscillator: { type: 'fatsawtooth' }, envelope: { attack: 0.1, decay: 0.3, sustain: 0.2, release: 0.5 } }).toDestination();
            },

            playClick() { if (this.isInitialized) this.synths.click.triggerAttackRelease('C5', '8n'); },
            playShoot() { if (this.isInitialized) this.synths.shoot.triggerAttackRelease('G5', '16n'); },
            playExplosion() { if (this.isInitialized) this.synths.explosion.triggerAttackRelease('4n'); },
            playPlayerHit() { if (this.isInitialized) this.synths.playerHit.triggerAttackRelease('C3', '8n'); },
            playCorrect() { if (this.isInitialized) { this.synths.correct.triggerAttackRelease('C5', '16n', Tone.now()); this.synths.correct.triggerAttackRelease('G5', '16n', Tone.now() + 0.1); } },
            playWrong() { if (this.isInitialized) this.synths.wrong.triggerAttackRelease('C3', '4n'); },
            playVictory() { if (this.isInitialized) { const now = Tone.now(); this.synths.victory.triggerAttackRelease(['C4', 'E4', 'G4'], '4n', now); this.synths.victory.triggerAttackRelease(['G4', 'B4', 'D5'], '4n', now + 0.4); this.synths.victory.triggerAttackRelease(['C5', 'E5', 'G5'], '2n', now + 0.8); } },
            playGameOver() { if (this.isInitialized) { const now = Tone.now(); this.synths.wrong.triggerAttackRelease('G2', '8n', now); this.synths.wrong.triggerAttackRelease('F#2', '8n', now + 0.2); this.synths.wrong.triggerAttackRelease('F2', '4n', now + 0.4); } },
            playInteraction() { if (this.isInitialized) this.synths.interaction.triggerAttackRelease('E5', '8n'); },
            playMove() { if (this.isInitialized) this.synths.move.triggerAttackRelease('C2', '16n'); },
            playWave() { if (this.isInitialized) { const now = Tone.now(); this.synths.wave.triggerAttackRelease('C3', '4n', now); this.synths.wave.triggerAttackRelease('G3', '4n', now + 0.2); } }
        };

        const organInfo = {
            heart: {
                icon: '‚ù§Ô∏è',
                title: 'Tim - Tr√°i tim c·ªßa b·∫°n',
                messages: [
                    "Xin ch√†o! M√¨nh l√† Tim ‚Äì tr√°i tim c·ªßa b·∫°n. üíì",
                    "M·ªói ng√†y, m√¨nh ƒë·∫≠p kho·∫£ng 100.000 l·∫ßn, b∆°m h∆°n 7.500 l√≠t m√°u ƒëi kh·∫Øp c∆° th·ªÉ ƒë·ªÉ nu√¥i d∆∞·ª°ng t·ª´ng t·∫ø b√†o.",
                    "Nh·ªù m√¨nh, n√£o c√≥ ƒë·ªß oxy ƒë·ªÉ suy nghƒ©, ph·ªïi ho·∫°t ƒë·ªông tr∆°n tru, v√† c√°c c∆° quan kh√°c duy tr√¨ s·ª± s·ªëng.",
                    "Nh∆∞ng n·∫øu b·∫°n h√∫t thu·ªëc, ch·∫•t nicotine s·∫Ω l√†m tƒÉng nh·ªãp tim v√† huy·∫øt √°p... üò∞",
                    "Carbon monoxide chi·∫øm ch·ªó oxy trong m√°u, khi·∫øn m√¨nh ph·∫£i l√†m vi·ªác qu√° s·ª©c v√† d·ªÖ b·ªã nh·ªìi m√°u c∆° tim.",
                    "M√¨nh mu·ªën s·ªëng kh·ªèe m·∫°nh ƒë·ªÉ ƒë·ªìng h√†nh c√πng b·∫°n c·∫£ ƒë·ªùi. ƒê·ª´ng ƒë·ªÉ kh√≥i thu·ªëc ph√° h·ªßy m√¨nh nh√©! ‚ù§Ô∏è"
                ]
            },
            brain: {
                icon: 'üß†',
                title: 'N√£o - Trung t√¢m ƒëi·ªÅu khi·ªÉn',
                messages: [
                    "Xin ch√†o! M√¨nh l√† N√£o ‚Äì trung t√¢m ƒëi·ªÅu khi·ªÉn c·ªßa c∆° th·ªÉ. üß†",
                    "M√¨nh ch·ª©a kho·∫£ng 86 t·ª∑ t·∫ø b√†o th·∫ßn kinh, x·ª≠ l√Ω h√†ng tri·ªáu th√¥ng tin m·ªói gi√¢y...",
                    "M√¨nh gi√∫p b·∫°n suy nghƒ©, h·ªçc t·∫≠p, v√† c·∫£m nh·∫≠n cu·ªôc s·ªëng m·ªôt c√°ch tuy·ªát v·ªùi!",
                    "Nh∆∞ng nicotine trong thu·ªëc l√° v√† thu·ªëc l√° ƒëi·ªán t·ª≠ c√≥ th·ªÉ thay ƒë·ªïi c·∫•u tr√∫c v√† ch·ª©c nƒÉng c·ªßa m√¨nh... üòµ",
                    "ƒê·∫∑c bi·ªát nguy hi·ªÉm ·ªü tu·ªïi v·ªã th√†nh ni√™n khi m√¨nh ƒëang ph√°t tri·ªÉn.",
                    "M√¨nh s·∫Ω b·ªã r·ªëi lo·∫°n t·∫≠p trung, gi·∫£m tr√≠ nh·ªõ, th·∫≠m ch√≠ m·∫•t ki·ªÉm so√°t h√†nh vi khi ph·ª• thu·ªôc v√†o ch·∫•t g√¢y nghi·ªán n√†y.",
                    "H√£y cho m√¨nh m√¥i tr∆∞·ªùng trong l√†nh, kh√¥ng kh√≥i thu·ªëc ƒë·ªÉ m√¨nh c√≥ th·ªÉ gi√∫p b·∫°n ƒë·∫°t ƒë∆∞·ª£c m·ªçi ∆∞·ªõc m∆°! üåü"
                ]
            },
            lungs: {
                icon: 'ü´Å',
                title: 'Ph·ªïi - L√° ph·ªïi c·ªßa b·∫°n',
                messages: [
                    "Xin ch√†o! M√¨nh l√† Ph·ªïi ‚Äì l√° ph·ªïi c·ªßa b·∫°n. ü´Å",
                    "M·ªói ng√†y, m√¨nh trao ƒë·ªïi h∆°n 6.000 l√≠t kh√¥ng kh√≠, ƒë∆∞a oxy v√†o m√°u v√† lo·∫°i b·ªè CO‚ÇÇ.",
                    "M√¨nh l√† 'm√°y l·ªçc kh√¥ng kh√≠' t·ª± nhi√™n c·ªßa c∆° th·ªÉ b·∫°n ƒë·∫•y!",
                    "N·∫øu b·∫°n h√≠t kh√≥i thu·ªëc, tar (h·∫Øc √≠n) s·∫Ω b√°m ch·∫∑t v√†o m√¨nh... üò∑",
                    "Tar l√†m gi·∫£m di·ªán t√≠ch trao ƒë·ªïi kh√≠, formaldehyde c√≥ th·ªÉ g√¢y ung th∆∞...",
                    "Hydrogen cyanide s·∫Ω ph√° h·ªßy l√¥ng mao ‚Äì h·ªá th·ªëng t·ª± l√†m s·∫°ch c·ªßa m√¨nh.",
                    "Khi m√¨nh b·ªã t·ªïn th∆∞∆°ng, b·∫°n s·∫Ω kh√≥ th·ªü, m·ªát m·ªèi v√† kh√¥ng th·ªÉ tham gia nh·ªØng ho·∫°t ƒë·ªông y√™u th√≠ch.",
                    "Xin h√£y ƒë·ªÉ m√¨nh ƒë∆∞·ª£c h√≠t th·ªü kh√¥ng kh√≠ trong l√†nh! üå¨Ô∏èüíö"
                ]
            },
            liver: {
                icon: 'ü´Ä',
                title: 'Gan - Nh√† m√°y h√≥a h·ªçc c·ªßa c∆° th·ªÉ',
                messages: [
                    "Xin ch√†o! M√¨nh l√† Gan ‚Äì nh√† m√°y h√≥a h·ªçc c·ªßa c∆° th·ªÉ b·∫°n. ü´Ä",
                    "M√¨nh th·ª±c hi·ªán h∆°n 500 ch·ª©c nƒÉng kh√°c nhau, t·ª´ l·ªçc ƒë·ªôc t·ªë ƒë·∫øn s·∫£n xu·∫•t protein quan tr·ªçng.",
                    "M√¨nh c√≥ kh·∫£ nƒÉng t√°i sinh tuy·ªát v·ªùi ‚Äì c√≥ th·ªÉ ph·ª•c h·ªìi 75% kh·ªëi l∆∞·ª£ng khi b·ªã t·ªïn th∆∞∆°ng!",
                    "Nh∆∞ng khi b·∫°n h√∫t thu·ªëc, m√¨nh ph·∫£i l√†m vi·ªác qu√° t·∫£i ƒë·ªÉ lo·∫°i b·ªè c√°c ch·∫•t ƒë·ªôc... üòµ‚Äçüí´",
                    "Nicotine, tar v√† h√†ng trƒÉm h√≥a ch·∫•t kh√°c l√†m m√¨nh vi√™m nhi·ªÖm v√† x∆° h√≥a.",
                    "Benzopyrene v√† formaldehyde c√≥ th·ªÉ g√¢y ung th∆∞ gan, khi·∫øn m√¨nh kh√¥ng th·ªÉ t√°i sinh.",
                    "M√¨nh c·∫ßn b·∫°n tr√°nh xa thu·ªëc l√° ƒë·ªÉ c√≥ th·ªÉ b·∫£o v·ªá c∆° th·ªÉ kh·ªèi ƒë·ªôc t·ªë m·ªói ng√†y! üí™"
                ]
            },
            kidney: {
                icon: 'ü´ò',
                title: 'Th·∫≠n - B·ªô l·ªçc si√™u vi·ªát',
                messages: [
                    "Xin ch√†o! M√¨nh l√† Th·∫≠n ‚Äì b·ªô l·ªçc si√™u vi·ªát c·ªßa c∆° th·ªÉ. ü´ò",
                    "M·ªói ng√†y, m√¨nh l·ªçc kho·∫£ng 180 l√≠t m√°u, lo·∫°i b·ªè ch·∫•t th·∫£i v√† gi·ªØ l·∫°i nh·ªØng g√¨ c·∫ßn thi·∫øt.",
                    "M√¨nh ƒëi·ªÅu h√≤a huy·∫øt √°p, s·∫£n xu·∫•t h·ªìng c·∫ßu v√† c√¢n b·∫±ng n∆∞·ªõc trong c∆° th·ªÉ.",
                    "Khi b·∫°n h√∫t thu·ªëc, nicotine l√†m co m·∫°ch m√°u, gi·∫£m l∆∞u l∆∞·ª£ng m√°u ƒë·∫øn m√¨nh... üò∞",
                    "Cadmium v√† ch√¨ trong kh√≥i thu·ªëc t√≠ch t·ª• trong m√¨nh, g√¢y t·ªïn th∆∞∆°ng kh√¥ng th·ªÉ ph·ª•c h·ªìi.",
                    "M√¨nh c√≥ th·ªÉ b·ªã suy th·∫≠n m√£n t√≠nh, bu·ªôc b·∫°n ph·∫£i l·ªçc m√°u su·ªët ƒë·ªùi.",
                    "H√£y gi√∫p m√¨nh ho·∫°t ƒë·ªông t·ªët b·∫±ng c√°ch u·ªëng ƒë·ªß n∆∞·ªõc v√† tr√°nh xa thu·ªëc l√°! üíß"
                ]
            },
            stomach: {
                icon: 'üåÄ',
                title: 'Ru·ªôt - H·ªá th·ªëng ti√™u h√≥a',
                messages: [
                    "Xin ch√†o! M√¨nh l√† Ru·ªôt ‚Äì h·ªá th·ªëng ti√™u h√≥a d√†i 7-8 m√©t c·ªßa c∆° th·ªÉ b·∫°n. üåÄ",
                    "M√¨nh g·ªìm ru·ªôt non v√† ru·ªôt gi√†, h·∫•p th·ª• dinh d∆∞·ª°ng v√† n∆∞·ªõc t·ª´ th·ª©c ƒÉn ƒë√£ ti√™u h√≥a.",
                    "M√¨nh c√≥ h√†ng tri·ªáu vi khu·∫©n c√≥ √≠ch gi√∫p ti√™u h√≥a v√† tƒÉng c∆∞·ªùng mi·ªÖn d·ªãch!",
                    "Nh∆∞ng nicotine v√† c√°c ch·∫•t ƒë·ªôc trong thu·ªëc l√° l√†m r·ªëi lo·∫°n h·ªá vi sinh c·ªßa m√¨nh... üò£",
                    "Kh√≥i thu·ªëc tƒÉng nguy c∆° vi√™m ru·ªôt, lo√©t ru·ªôt v√† ung th∆∞ ƒë·∫°i tr·ª±c tr√†ng.",
                    "M√¨nh s·∫Ω co th·∫Øt b·∫•t th∆∞·ªùng, g√¢y ƒëau b·ª•ng, ti√™u ch·∫£y ho·∫∑c t√°o b√≥n.",
                    "H√£y cho m√¨nh th·ª©c ƒÉn gi√†u ch·∫•t x∆° v√† tr√°nh xa thu·ªëc l√° ƒë·ªÉ m√¨nh ho·∫°t ƒë·ªông t·ªët! ü•¨"
                ]
            },
            eyes: {
                icon: 'üëÅÔ∏è',
                title: 'M·∫Øt - C·ª≠a s·ªï t√¢m h·ªìn',
                messages: [
                    "Xin ch√†o! M√¨nh l√† M·∫Øt ‚Äì c·ª≠a s·ªï t√¢m h·ªìn c·ªßa b·∫°n. üëÅÔ∏è",
                    "M√¨nh gi√∫p b·∫°n nh√¨n th·∫•y th·∫ø gi·ªõi tuy·ªát ƒë·∫πp v·ªõi h√†ng tri·ªáu m√†u s·∫Øc v√† chi ti·∫øt.",
                    "M√¨nh x·ª≠ l√Ω 80% th√¥ng tin m√† n√£o b·ªô nh·∫≠n ƒë∆∞·ª£c m·ªói ng√†y!",
                    "Nh∆∞ng kh√≥i thu·ªëc ch·ª©a c√°c g·ªëc t·ª± do t·∫•n c√¥ng v√µng m·∫°c c·ªßa m√¨nh... üòµ",
                    "M√¨nh c√≥ th·ªÉ b·ªã tho√°i h√≥a ƒëi·ªÉm v√†ng, ƒë·ª•c th·ªßy tinh th·ªÉ (ƒë·ª•c m·∫Øt).",
                    "Nicotine l√†m gi·∫£m l∆∞u l∆∞·ª£ng m√°u ƒë·∫øn th·∫ßn kinh th·ªã gi√°c, c√≥ th·ªÉ g√¢y m√π l√≤a.",
                    "M√¨nh mu·ªën gi√∫p b·∫°n nh√¨n th·∫•y v·∫ª ƒë·∫πp cu·ªôc s·ªëng ‚Äì h√£y b·∫£o v·ªá m√¨nh kh·ªèi kh√≥i thu·ªëc! ‚ú®"
                ]
            }
        };

        // Conversation state
        let currentConversation = null;
        let conversationStep = 0;
        
        // Shooting Game State
        let shootingGameState = {
            isPlaying: false, isPaused: false, lives: 3, gameScore: 0,
            playerPosition: 50, enemies: [], bullets: [], wave: 1,
            enemiesDestroyed: 0, gameSpeed: 1, lastEnemySpawn: 0,
            enemySpawnRate: 2000, nextWaveThreshold: 10, gameLoop: null
        };

        // Toxin data with detailed information
        const toxinData = {
            'benzen': { icon: 'üß™', name: 'Benzen', info: 'C√≥ trong xƒÉng v√† kh√≥i thu·ªëc l√°/thu·ªëc l√° ƒëi·ªán t·ª≠. G√¢y b·ªánh b·∫°ch c·∫ßu (ung th∆∞ m√°u).' },
            'formaldehyde': { icon: 'üß¥', name: 'Formaldehyde', info: 'D√πng trong ∆∞·ªõp x√°c, c√≥ trong kh√≥i thu·ªëc. G√¢y ung th∆∞ m≈©i, h·ªçng v√† c√°c b·ªánh h√¥ h·∫•p.' },
            'arsenic': { icon: '‚ò†Ô∏è', name: 'Arsenic (Th·∫°ch t√≠n)', info: 'Kim lo·∫°i n·∫∑ng c·ª±c ƒë·ªôc c√≥ trong thu·ªëc l√°, g√¢y ung th∆∞ da, ph·ªïi, v√† t·ªïn th∆∞∆°ng tim.' },
            'cadmium': { icon: 'üîã', name: 'Cadmium', info: 'Kim lo·∫°i n·∫∑ng trong pin, c≈©ng c√≥ trong thu·ªëc l√°. G√¢y ung th∆∞ ph·ªïi v√† suy th·∫≠n nghi√™m tr·ªçng.' },
            'nicotine': { icon: '‚ö°', name: 'Nicotine', info: 'Ch·∫•t g√¢y nghi·ªán ch√≠nh trong thu·ªëc l√° & thu·ªëc l√° ƒëi·ªán t·ª≠, l√†m tƒÉng huy·∫øt √°p, nh·ªãp tim, v√† h·∫°i n√£o.' },
            'carbon_monoxide': { icon: 'üí®', name: 'Carbon Monoxide (CO)', info: 'Kh√≠ ƒë·ªôc trong kh√≥i xe v√† thu·ªëc l√°. N√≥ chi·∫øm ch·ªó oxy trong m√°u, khi·∫øn tim v√† n√£o thi·∫øu d∆∞·ª°ng kh√≠.' },
            'tar': { icon: 'ü™∂', name: 'Tar (H·∫Øc √≠n)', info: 'Ch·∫•t d√≠nh m√†u ƒëen trong kh√≥i thu·ªëc l√°, b√°m v√†o ph·ªïi, g√¢y vi√™m ph·∫ø qu·∫£n v√† ung th∆∞.' },
            'diacetyl': { icon: 'üçø', name: 'Diacetyl', info: 'H∆∞∆°ng li·ªáu trong m·ªôt s·ªë thu·ªëc l√° ƒëi·ªán t·ª≠, g√¢y b·ªánh "ph·ªïi b·∫Øp rang" kh√¥ng th·ªÉ ch·ªØa kh·ªèi.' },
        };

        // Quiz Game State
        const quizData = [
            {
                question: "Ch·∫•t n√†o trong thu·ªëc l√° g√¢y nghi·ªán m·∫°nh nh·∫•t, khi·∫øn ng∆∞·ªùi d√πng kh√≥ b·ªè?",
                options: ["H·∫Øc √≠n (Tar)", "Nicotine", "Carbon Monoxide", "Formaldehyde"],
                correct: 1,
                explanation: "Nicotine l√† ch·∫•t g√¢y nghi·ªán ch√≠nh trong thu·ªëc l√°, t√°c ƒë·ªông l√™n n√£o b·ªô v√† t·∫°o ra c·∫£m gi√°c th√®m mu·ªën."
            },
            {
                question: "C∆° quan n√†o b·ªã \"H·∫Øc √≠n\" (Tar) trong kh√≥i thu·ªëc b√°m v√†o v√† g√¢y t·ªïn th∆∞∆°ng nghi√™m tr·ªçng nh·∫•t?",
                options: ["N√£o", "Tim", "Gan", "Ph·ªïi"],
                correct: 3,
                explanation: "H·∫Øc √≠n l√† m·ªôt h·ªón h·ª£p d√≠nh, m√†u ƒëen, b√°m v√†o ph·ªïi, g√¢y ung th∆∞ v√† c√°c b·ªánh h√¥ h·∫•p m√£n t√≠nh."
            },
            {
                question: "Ch·∫•t ƒë·ªôc n√†o trong kh√≥i thu·ªëc chi·∫øm ch·ªó c·ªßa Oxy trong m√°u, khi·∫øn tim ph·∫£i l√†m vi·ªác v·∫•t v·∫£ h∆°n?",
                options: ["Arsenic (Th·∫°ch t√≠n)", "Cadmium", "Carbon Monoxide (CO)", "Ammonia"],
                correct: 2,
                explanation: "Carbon Monoxide (CO) li√™n k·∫øt v·ªõi hemoglobin trong m√°u m·∫°nh h∆°n oxy, l√†m gi·∫£m l∆∞·ª£ng oxy ƒë·∫øn c√°c c∆° quan."
            },
            {
                question: "B·ªánh \"ph·ªïi b·∫Øp rang\" (popcorn lung) l√† m·ªôt t·ªïn th∆∞∆°ng ph·ªïi kh√¥ng th·ªÉ ph·ª•c h·ªìi, li√™n quan ƒë·∫øn ch·∫•t n√†o trong thu·ªëc l√° ƒëi·ªán t·ª≠?",
                options: ["Nicotine l·ªèng", "Kim lo·∫°i n·∫∑ng", "Vitamin E Acetate", "Diacetyl"],
                correct: 3,
                explanation: "Diacetyl l√† m·ªôt ch·∫•t t·∫°o h∆∞∆°ng v·ªã (b∆°) ƒë∆∞·ª£c t√¨m th·∫•y trong m·ªôt s·ªë lo·∫°i tinh d·∫ßu vape, c√≥ th·ªÉ g√¢y vi√™m ti·ªÉu ph·∫ø qu·∫£n t·∫Øc ngh·∫Ωn."
            },
            {
                question: "H√∫t thu·ªëc l√° l√†m tƒÉng nguy c∆° m·∫Øc b·ªánh n√†o ·ªü M·∫Øt, c√≥ th·ªÉ d·∫´n ƒë·∫øn m√π l√≤a?",
                options: ["C·∫≠n th·ªã", "ƒê·ª•c th·ªßy tinh th·ªÉ", "Lo·∫°n th·ªã", "Vi·ªÖn th·ªã"],
                correct: 1,
                explanation: "H√∫t thu·ªëc l√†m tƒÉng ƒë√°ng k·ªÉ nguy c∆° b·ªã ƒë·ª•c th·ªßy tinh th·ªÉ v√† tho√°i h√≥a ƒëi·ªÉm v√†ng, hai nguy√™n nh√¢n h√†ng ƒë·∫ßu g√¢y m√π l√≤a."
            },
            {
                question: "Nicotine ƒë·∫∑c bi·ªát nguy hi·ªÉm cho c∆° quan n√†o khi n√≥ ƒëang trong giai ƒëo·∫°n ph√°t tri·ªÉn ·ªü tu·ªïi v·ªã th√†nh ni√™n?",
                options: ["Tim", "Ph·ªïi", "N√£o", "Th·∫≠n"],
                correct: 2,
                explanation: "N√£o b·ªô c·ªßa thanh thi·∫øu ni√™n v·∫´n ƒëang ph√°t tri·ªÉn, v√† nicotine c√≥ th·ªÉ l√†m thay ƒë·ªïi vƒ©nh vi·ªÖn c·∫•u tr√∫c n√£o, ·∫£nh h∆∞·ªüng ƒë·∫øn s·ª± t·∫≠p trung v√† ki·ªÉm so√°t h√†nh vi."
            },
            {
                question: "Ch·∫•t Cadmium, m·ªôt kim lo·∫°i n·∫∑ng c√≥ trong pin, c≈©ng ƒë∆∞·ª£c t√¨m th·∫•y trong kh√≥i thu·ªëc. N√≥ g√¢y h·∫°i ch·ªß y·∫øu cho c∆° quan n√†o?",
                options: ["M·∫Øt v√† Ru·ªôt", "Gan v√† Ph·ªïi", "N√£o v√† Tim", "Th·∫≠n v√† Ph·ªïi"],
                correct: 3,
                explanation: "Cadmium t√≠ch t·ª• trong c∆° th·ªÉ, ƒë·∫∑c bi·ªát g√¢y h·∫°i cho th·∫≠n v√† l√† m·ªôt trong nh·ªØng nguy√™n nh√¢n g√¢y ung th∆∞ ph·ªïi."
            },
            {
                question: "Nh√† m√°y h√≥a h·ªçc c·ªßa c∆° th·ªÉ, ch·ªãu tr√°ch nhi·ªám l·ªçc b·ªè ƒë·ªôc t·ªë l√† c∆° quan n√†o?",
                options: ["Gan", "Th·∫≠n", "L√° l√°ch", "Ru·ªôt"],
                correct: 0,
                explanation: "Gan th·ª±c hi·ªán h∆°n 500 ch·ª©c nƒÉng, trong ƒë√≥ c√≥ vi·ªác chuy·ªÉn h√≥a v√† lo·∫°i b·ªè c√°c ch·∫•t ƒë·ªôc h·∫°i ra kh·ªèi c∆° th·ªÉ."
            },
             {
                question: "Ch·∫•t n√†o ƒë∆∞·ª£c th√™m v√†o thu·ªëc l√° ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô h·∫•p th·ª• Nicotine, khi·∫øn ng∆∞·ªùi d√πng nghi·ªán nhanh h∆°n?",
                options: ["ƒê∆∞·ªùng", "Menthol (B·∫°c h√†)", "Ammonia", "Cacao"],
                correct: 2,
                explanation: "Ammonia l√†m tƒÉng ƒë·ªô pH c·ªßa kh√≥i thu·ªëc, gi√∫p nicotine chuy·ªÉn sang d·∫°ng t·ª± do (freebase) d·ªÖ d√†ng h·∫•p th·ª• v√†o ph·ªïi v√† n√£o h∆°n."
            },
            {
                question: "C√°ch duy nh·∫•t ƒë·ªÉ chi·∫øn th·∫Øng ho√†n to√†n c√°c ch·∫•t ƒë·ªôc h·∫°i t·ª´ thu·ªëc l√° l√† g√¨?",
                options: ["H√∫t √≠t ƒëi", "Chuy·ªÉn sang thu·ªëc l√° ƒëi·ªán t·ª≠", "T·∫≠p th·ªÉ d·ª•c nhi·ªÅu h∆°n", "Kh√¥ng bao gi·ªù h√∫t thu·ªëc"],
                correct: 3,
                explanation: "Kh√¥ng c√≥ m·ª©c ƒë·ªô h√∫t thu·ªëc n√†o l√† an to√†n. C√°ch t·ªët nh·∫•t ƒë·ªÉ b·∫£o v·ªá s·ª©c kh·ªèe l√† kh√¥ng bao gi·ªù b·∫Øt ƒë·∫ßu ho·∫∑c b·ªè thu·ªëc ho√†n to√†n."
            }
        ];
        let quizState = {
            currentQuestionIndex: 0,
            quizScore: 0,
            shuffledQuestions: []
        };

        // General Functions
        function showScreen(screenId) {
            soundSystem.playClick();
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            currentScreen = screenId;
            document.getElementById('navButtons').style.display = (screenId === 'mainMenu') ? 'none' : 'flex';
            updateProgress();

            if (screenId === 'quizGame') {
                createFloatingBubbles();
            }
        }

        function showMainMenu() { showScreen('mainMenu'); }
        function showInstructions() { showScreen('instructionsScreen'); }
        function startGame() {
            soundSystem.init(); // Initialize sound on first user interaction
            soundSystem.playClick();
            score = 0;
            visitedOrgans.clear();
            updateScore();
            resetCharacterPosition();
            document.querySelectorAll('.organ').forEach(organ => {
                organ.classList.remove('visited');
            });
            showScreen('part1Intro');
        }
        function exitGame() {
            soundSystem.playClick();
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën tho√°t kh·ªèi tr√≤ ch∆°i?')) {
                alert('C·∫£m ∆°n b·∫°n ƒë√£ tham gia! H√£y nh·ªõ b·∫£o v·ªá s·ª©c kh·ªèe nh√©! üåü');
            }
        }
        function updateScore() {
            document.getElementById('scoreDisplay').textContent = `ƒêi·ªÉm: ${score}`;
        }
        function updateProgress() {
            // Placeholder for progress logic
        }
        function goBack() {
            soundSystem.playClick();
            if (currentScreen === 'shootingGame') {
                showScreen('part2Intro');
            } else if (currentScreen === 'part2Intro') {
                showScreen('completionScreen');
            } else if (currentScreen === 'quizGame') {
                showScreen('part3Intro');
            } else if (currentScreen === 'part3Intro') {
                victory('shooting');
            } else if (currentScreen === 'completionScreen' || currentScreen === 'part1Intro') {
                showScreen('mainMenu');
            } else if (currentScreen === 'gamePart1') {
                showScreen('part1Intro');
            } else {
                showMainMenu();
            }
        }

        // Part 1: Organ Discovery
        function startPart1Game() {
            showScreen('gamePart1');
        }
        function resetCharacterPosition() {
            characterPosition = { x: 50, y: 80 };
            updateCharacterPosition();
            checkNearbyOrgans();
        }
        function updateCharacterPosition() {
            const character = document.getElementById('character');
            const spotlight = document.getElementById('spotlight');
            character.style.left = characterPosition.x + '%';
            character.style.top = characterPosition.y + '%';
            spotlight.style.left = characterPosition.x + '%';
            spotlight.style.top = characterPosition.y + '%';
        }
        function moveCharacter(direction) {
            if (currentScreen !== 'gamePart1' || isMoving) return;
            currentDirection = direction;
            isMoving = true;
            soundSystem.playMove();
            moveInterval = setInterval(() => {
                const moveSpeed = 1.5;
                if (currentDirection === 'up' && characterPosition.y > 5) characterPosition.y -= moveSpeed;
                if (currentDirection === 'down' && characterPosition.y < 90) characterPosition.y += moveSpeed;
                if (currentDirection === 'left' && characterPosition.x > 10) characterPosition.x -= moveSpeed;
                if (currentDirection === 'right' && characterPosition.x < 90) characterPosition.x += moveSpeed;
                updateCharacterPosition();
                checkNearbyOrgans();
            }, 30);
        }
        function stopMoving() {
            isMoving = false;
            clearInterval(moveInterval);
        }
        function checkNearbyOrgans() {
            const organs = [
                { id: 'eyes', x: 15, y: 10 }, { id: 'brain', x: 50, y: 10 }, { id: 'lungs', x: 85, y: 10 },
                { id: 'heart', x: 15, y: 40 }, { id: 'liver', x: 50, y: 40 }, { id: 'stomach', x: 85, y: 40 },
                { id: 'kidney', x: 50, y: 70 }
            ];
            let foundNearby = null;
            organs.forEach(organ => {
                const organEl = document.getElementById(`${organ.id}Organ`);
                const hintEl = document.getElementById(`${organ.id}Hint`);
                const distance = Math.sqrt(Math.pow(characterPosition.x - organ.x, 2) + Math.pow(characterPosition.y - organ.y, 2));
                if (distance < 18) {
                    foundNearby = organ.id;
                    organEl.classList.add('nearby');
                    hintEl.classList.add('show');
                } else {
                    organEl.classList.remove('nearby');
                    hintEl.classList.remove('show');
                }
            });
            document.getElementById('spotlight').classList.toggle('active', !!foundNearby);
            nearbyOrgan = foundNearby;
        }
        function interactWithNearbyOrgan() {
            if (nearbyOrgan) {
                soundSystem.playInteraction();
                showOrganInfo(nearbyOrgan);
            }
        }
        function showOrganInfo(organType) {
            const info = organInfo[organType];
            currentConversation = organType;
            conversationStep = 0;
            document.getElementById('modalIcon').textContent = info.icon;
            document.getElementById('modalTitle').textContent = info.title;
            createProgressDots(info.messages.length + 1); 
            showCurrentMessage();
            document.getElementById('organModal').classList.add('active');
            
            if (!visitedOrgans.has(organType)) {
                visitedOrgans.add(organType);
                score += 10;
                updateScore();
            }
        }
        function createProgressDots(total) {
            const container = document.getElementById('conversationProgress');
            container.innerHTML = Array.from({ length: total }, (_, i) => `<div class="progress-dot"></div>`).join('');
        }
        function showCurrentMessage() {
            const info = organInfo[currentConversation];
            const isLastMessage = conversationStep >= info.messages.length;
            
            if (isLastMessage) {
                document.getElementById('modalText').textContent = "H√£y nh·ªõ l·ªùi m√¨nh d·∫∑n nh√©. T·∫°m bi·ªát!";
            } else {
                document.getElementById('modalText').textContent = info.messages[conversationStep];
            }

            document.querySelectorAll('.progress-dot').forEach((dot, i) => {
                dot.classList.remove('active', 'completed');
                if (i < conversationStep) dot.classList.add('completed');
                if (i === conversationStep) dot.classList.add('active');
            });

            document.getElementById('nextMessageBtn').style.display = isLastMessage ? 'none' : 'inline-block';
            document.getElementById('finishConversationBtn').style.display = isLastMessage ? 'inline-block' : 'none';
            
            if (isLastMessage && visitedOrgans.size === 7) {
                setTimeout(() => {
                    closeModal();
                    setTimeout(showCompletionScreen, 500);
                }, 1500);
            }
        }
        function nextMessage() {
            soundSystem.playClick();
            const info = organInfo[currentConversation];
            if (conversationStep < info.messages.length) { 
                conversationStep++;
                showCurrentMessage();
            }
        }
        function closeModal() {
            soundSystem.playClick();
            if (currentConversation && organInfo[currentConversation]) {
                const organElement = document.getElementById(currentConversation + 'Organ');
                if (organElement) {
                    organElement.classList.add('visited');
                }
            }
            document.getElementById('organModal').classList.remove('active');
            currentConversation = null;
        }
        function showCompletionScreen() {
            document.getElementById('finalScore').textContent = score;
            showScreen('completionScreen');
        }
        
        // Part 2: Shooting Game
        function startPart2Intro() {
            showScreen('part2Intro');
            initializeFallingToxins('fallingToxinsIntro');
        }
        function startActualShootingGame() {
            showScreen('shootingGame');
            resetShootingGameState();
            startGameLoop();
        }
        function resetShootingGameState() {
            shootingGameState = {
                isPlaying: true, isPaused: false, lives: 3, gameScore: 0,
                playerPosition: 50, enemies: [], bullets: [], wave: 1,
                enemiesDestroyed: 0, gameSpeed: 1, lastEnemySpawn: 0,
                enemySpawnRate: 2000, nextWaveThreshold: 10, gameLoop: null
            };
            updateGameHUD();
            document.getElementById('gameCanvas').querySelectorAll('.enemy, .bullet, .explosion').forEach(el => el.remove());
        }
        function startGameLoop() {
            if (shootingGameState.gameLoop) clearInterval(shootingGameState.gameLoop);
            shootingGameState.gameLoop = setInterval(updateGame, 33);
        }
        function updateGame() {
            if (!shootingGameState.isPlaying || shootingGameState.isPaused) return;
            const now = Date.now();
            if (now - shootingGameState.lastEnemySpawn > shootingGameState.enemySpawnRate) {
                spawnEnemy();
                shootingGameState.lastEnemySpawn = now;
            }
            updateEnemies();
            updateBullets();
            checkCollisions();

            if (shootingGameState.enemiesDestroyed >= shootingGameState.nextWaveThreshold) {
                shootingGameState.wave++;
                shootingGameState.nextWaveThreshold += 10; 
                shootingGameState.gameSpeed += 0.2;
                shootingGameState.enemySpawnRate = Math.max(500, shootingGameState.enemySpawnRate - 250);
                showWaveIndicator(`L√†n s√≥ng ${shootingGameState.wave}`);
            }

            if (shootingGameState.lives <= 0) gameOver();
        }
        function spawnEnemy() {
            const keys = Object.keys(toxinData);
            const key = keys[Math.floor(Math.random() * keys.length)];
            const enemy = document.createElement('div');
            enemy.className = 'enemy';
            enemy.textContent = toxinData[key].icon;
            enemy.style.left = Math.random() * 90 + '%';
            enemy.style.top = '0px';
            enemy.dataset.toxinKey = key;
            enemy.dataset.speed = (1 + Math.random() * 1.5) * shootingGameState.gameSpeed;
            document.getElementById('gameCanvas').appendChild(enemy);
            shootingGameState.enemies.push(enemy);
        }
        function updateEnemies() {
            shootingGameState.enemies.forEach((enemy, i) => {
                let top = parseFloat(enemy.style.top);
                top += parseFloat(enemy.dataset.speed);
                enemy.style.top = top + 'px';
                if (top > 600 || (top > 520 && isColliding(document.getElementById('playerShip'), enemy))) {
                    if (top < 600) playerHit();
                    enemy.remove();
                    shootingGameState.enemies.splice(i, 1);
                }
            });
        }
        function updateBullets() {
            shootingGameState.bullets.forEach((bullet, i) => {
                let top = parseFloat(bullet.style.top);
                top -= 12;
                bullet.style.top = top + 'px';
                if (top < 0) {
                    bullet.remove();
                    shootingGameState.bullets.splice(i, 1);
                }
            });
        }
        function checkCollisions() {
            for (let i = shootingGameState.bullets.length - 1; i >= 0; i--) {
                for (let j = shootingGameState.enemies.length - 1; j >= 0; j--) {
                    const bullet = shootingGameState.bullets[i];
                    const enemy = shootingGameState.enemies[j];
                    if (bullet && enemy && isColliding(bullet, enemy)) {
                        createExplosion(enemy);
                        showToxinPopup(toxinData[enemy.dataset.toxinKey]);
                        shootingGameState.gameScore += 10;
                        shootingGameState.enemiesDestroyed++;
                        updateGameHUD();
                        bullet.remove();
                        enemy.remove();
                        shootingGameState.bullets.splice(i, 1);
                        shootingGameState.enemies.splice(j, 1);
                        if (shootingGameState.enemiesDestroyed >= 30) victory('shooting');
                        break; 
                    }
                }
            }
        }
        function showToxinPopup(toxin) {
            document.querySelectorAll('.toxin-info-popup').forEach(p => p.remove());
            const popup = document.createElement('div');
            popup.className = 'toxin-info-popup';
            popup.innerHTML = `<h3><span>${toxin.icon}</span> ${toxin.name}</h3><p>${toxin.info}</p>`;
            document.body.appendChild(popup);
            setTimeout(() => { if (popup.parentNode) { popup.remove(); } }, 3000);
        }
        function showWaveIndicator(text) {
            soundSystem.playWave();
            const indicator = document.getElementById('waveIndicator');
            indicator.textContent = text;
            indicator.style.animation = 'none';
            void indicator.offsetWidth; 
            indicator.style.animation = 'waveAnnounce 2s ease-out forwards';
        }
        function isColliding(a, b) {
            const rectA = a.getBoundingClientRect();
            const rectB = b.getBoundingClientRect();
            return !(rectA.right < rectB.left || rectA.left > rectB.right || rectA.bottom < rectB.top || rectA.top > rectB.bottom);
        }
        function playerHit() {
            soundSystem.playPlayerHit();
            shootingGameState.lives--;
            updateGameHUD();
            const player = document.getElementById('playerShip');
            player.style.animation = 'playerHit 0.3s ease';
            setTimeout(() => player.style.animation = '', 300);
        }
        function gameOver() {
            soundSystem.playGameOver();
            shootingGameState.isPlaying = false;
            clearInterval(shootingGameState.gameLoop);
            const gameOverScreen = document.getElementById('gameOverScreen');
            gameOverScreen.classList.add('show');
            setTimeout(() => {
                gameOverScreen.classList.remove('show');
                startPart3Intro();
            }, 3000);
        }
        function restartShootingGame() {
            soundSystem.playClick();
            document.getElementById('gameOverScreen').classList.remove('show');
            resetShootingGameState();
            startGameLoop();
        }
        function updateGameHUD() {
            document.getElementById('gameScore').textContent = shootingGameState.gameScore;
            ['life1', 'life2', 'life3'].forEach((id, i) => {
                document.getElementById(id).classList.toggle('lost', i >= shootingGameState.lives);
            });
        }
        function shootBullet() {
            if (!shootingGameState.isPlaying || shootingGameState.isPaused) return;
            soundSystem.playShoot();
            const bullet = document.createElement('div');
            bullet.className = 'bullet';
            bullet.style.left = shootingGameState.playerPosition + '%';
            bullet.style.top = '520px';
            document.getElementById('gameCanvas').appendChild(bullet);
            shootingGameState.bullets.push(bullet);
        }
        function createExplosion(enemy) {
            soundSystem.playExplosion();
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.textContent = 'üí•';
            explosion.style.left = enemy.style.left;
            explosion.style.top = enemy.style.top;
            document.getElementById('gameCanvas').appendChild(explosion);
            setTimeout(() => explosion.remove(), 500);
        }

        // Part 3: Quiz Game
        function startPart3Intro() {
            showScreen('part3Intro');
        }

        function createFloatingBubbles() {
            const quizScreen = document.getElementById('quizGame');
            quizScreen.querySelectorAll('.bubble').forEach(b => b.remove());
            for(let i = 0; i < 15; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                const size = Math.random() * 60 + 20 + 'px';
                bubble.style.width = size;
                bubble.style.height = size;
                bubble.style.left = Math.random() * 100 + 'vw';
                bubble.style.animationDuration = Math.random() * 5 + 8 + 's';
                bubble.style.animationDelay = Math.random() * 5 + 's';
                quizScreen.appendChild(bubble);
            }
        }

        function startQuizGame() {
            soundSystem.playClick();
            quizState.shuffledQuestions = [...quizData].sort(() => 0.5 - Math.random());
            quizState.currentQuestionIndex = 0;
            quizState.quizScore = 0;
            showScreen('quizGame');
            displayQuizQuestion();
        }
        function displayQuizQuestion() {
            const questionData = quizState.shuffledQuestions[quizState.currentQuestionIndex];
            document.getElementById('quizProgress').textContent = `C√¢u ${quizState.currentQuestionIndex + 1} / ${quizState.shuffledQuestions.length}`;
            document.getElementById('quizQuestion').textContent = questionData.question;
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            questionData.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
            document.getElementById('quizFeedback').textContent = '';
            document.getElementById('nextQuestionBtn').classList.remove('visible');
        }
        function selectAnswer(selectedIndex) {
            const questionData = quizState.shuffledQuestions[quizState.currentQuestionIndex];
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach(button => button.disabled = true);

            const feedbackEl = document.getElementById('quizFeedback');
            if (selectedIndex === questionData.correct) {
                soundSystem.playCorrect();
                buttons[selectedIndex].classList.add('correct');
                feedbackEl.innerHTML = "üéâ Ch√≠nh x√°c! Tuy·ªát v·ªùi! <br>" + questionData.explanation;
                feedbackEl.style.color = '#2e7d32';
                quizState.quizScore += 10;
            } else {
                soundSystem.playWrong();
                buttons[selectedIndex].classList.add('wrong');
                buttons[questionData.correct].classList.add('correct');
                feedbackEl.innerHTML = "üò• Ti·∫øc qu√°! C·ªë g·∫Øng l·∫ßn sau nh√©! <br>" + questionData.explanation;
                feedbackEl.style.color = '#d32f2f';
            }
            document.getElementById('nextQuestionBtn').classList.add('visible');
        }
        function nextQuizQuestion() {
            soundSystem.playClick();
            quizState.currentQuestionIndex++;
            if (quizState.currentQuestionIndex < quizState.shuffledQuestions.length) {
                displayQuizQuestion();
            } else {
                victory('quiz');
            }
        }

        // Victory Logic
        function victory(gameMode) {
            soundSystem.playVictory();
            const victoryButtons = document.getElementById('victoryButtons');
            victoryButtons.innerHTML = ''; 

            if (gameMode === 'shooting') {
                shootingGameState.isPlaying = false;
                clearInterval(shootingGameState.gameLoop);
                score += shootingGameState.gameScore;
                updateScore();
                document.getElementById('victoryTitle').textContent = "üöÄ Chi·∫øn Th·∫Øng Ph·∫ßn 2!";
                document.getElementById('victoryMessage').textContent = "B·∫°n ƒë√£ ƒë·∫©y l√πi th√†nh c√¥ng l√†n s√≥ng ch·∫•t ƒë·ªôc!";
                document.getElementById('victoryStats').innerHTML = `üèÜ ƒêi·ªÉm game: <span id="finalGameScore">${shootingGameState.gameScore}</span><br>üéØ Ch·∫•t ƒë·ªôc ti√™u di·ªát: ${shootingGameState.enemiesDestroyed}`;
                
                victoryButtons.innerHTML = `
                    <button class="btn btn-primary" onclick="startPart3Intro()">Ti·∫øp t·ª•c Ph·∫ßn 3 üß†</button>
                    <button class="btn btn-secondary" onclick="showMainMenu()">üè† Menu ch√≠nh</button>
                `;
            } else if (gameMode === 'quiz') {
                score += quizState.quizScore;
                updateScore();
                document.getElementById('victoryTitle').textContent = "üåü CH√öC M·ª™NG B·∫†N ƒê√É HO√ÄN TH√ÄNH! üåü";
                document.getElementById('victoryMessage').textContent = "B·∫°n ƒë√£ ho√†n th√†nh xu·∫•t s·∫Øc t·∫•t c·∫£ c√°c th·ª≠ th√°ch v√† ch·ª©ng t·ªè m√¨nh l√† m·ªôt ng∆∞·ªùi h√πng b·∫£o v·ªá s·ª©c kh·ªèe!";
                document.getElementById('victoryStats').innerHTML = `üèÜ T·ªïng ƒëi·ªÉm cu·ªëi c√πng: <span id="finalGameScore">${score}</span>`;

                 victoryButtons.innerHTML = `
                    <button class="btn btn-primary" onclick="startGame()">Ch∆°i l·∫°i t·ª´ ƒë·∫ßu</button>
                    <button class="btn btn-secondary" onclick="showMainMenu()">üè† Menu ch√≠nh</button>
                `;
            }
            showScreen('victoryScreen');
        }

        // Event Listeners
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('organModal').classList.contains('active')) {
                if (e.code === 'Space' || e.key === 'Enter') {
                    e.preventDefault();
                    const info = organInfo[currentConversation];
                    if (currentConversation && conversationStep < info.messages.length) {
                        nextMessage();
                    } else {
                        closeModal();
                    }
                }
                return;
            }
            if (currentScreen === 'gamePart1') {
                if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                    moveCharacter(e.key.replace('Arrow', '').toLowerCase());
                }
                if (e.code === 'Space' || e.key === 'Enter') {
                    e.preventDefault();
                    interactWithNearbyOrgan();
                }
            } else if (currentScreen === 'shootingGame' && shootingGameState.isPlaying) {
                if (e.key === 'ArrowLeft') startPlayerMovement('left', true);
                if (e.key === 'ArrowRight') startPlayerMovement('right', true);
                if (e.code === 'Space') shootBullet();
            }
        });
        document.addEventListener('keyup', function(e) {
            if (currentScreen === 'gamePart1') {
                stopMoving();
            } else if (currentScreen === 'shootingGame') {
                if (e.key === 'ArrowLeft') startPlayerMovement('left', false);
                if (e.key === 'ArrowRight') startPlayerMovement('right', false);
            }
        });
        
        let playerMovement = { left: false, right: false, interval: null };
        function startPlayerMovement(dir, isDown) {
            playerMovement[dir] = isDown;
            if (isDown && !playerMovement.interval) {
                playerMovement.interval = setInterval(() => {
                    if (playerMovement.left) shootingGameState.playerPosition = Math.max(2, shootingGameState.playerPosition - 2);
                    if (playerMovement.right) shootingGameState.playerPosition = Math.min(98, shootingGameState.playerPosition + 2);
                    document.getElementById('playerShip').style.left = shootingGameState.playerPosition + '%';
                }, 16);
            } else if (!playerMovement.left && !playerMovement.right) {
                clearInterval(playerMovement.interval);
                playerMovement.interval = null;
            }
        }
        
        document.getElementById('organModal').addEventListener('click', (e) => { if (e.target === e.currentTarget) closeModal(); });
        document.addEventListener('DOMContentLoaded', updateScore);
    </script>
</body>
</html>
