<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảo vệ sức khỏe - Nói không với thuốc lá</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .smoke-animation {
            animation: smokeDisappear 3s ease-out forwards;
        }
        
        @keyframes smokeDisappear {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.2); }
        }
        
        .organ-glow {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
            to { box-shadow: 0 0 30px rgba(59, 130, 246, 0.8); }
        }
        
        .character {
            transition: all 0.3s ease;
            z-index: 10;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
            animation: characterFloat 3s ease-in-out infinite;
        }
        
        .character:hover {
            transform: scale(1.2) rotate(5deg);
            filter: drop-shadow(0 8px 20px rgba(59, 130, 246, 0.4));
        }
        
        .character.moving {
            transition: all 0.5s ease;
            animation: characterWalk 0.5s ease-in-out;
        }
        
        @keyframes characterFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }
        
        @keyframes characterWalk {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-3deg); }
            75% { transform: scale(1.1) rotate(3deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        .game-area-animated {
            position: relative;
            overflow: hidden;
        }
        
        .game-area-animated::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(255, 255, 255, 0.1) 50%, 
                transparent 70%);
            animation: gameAreaShimmer 8s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        @keyframes gameAreaShimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(0%) translateY(0%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        @keyframes particleFade {
            0% { 
                opacity: 1; 
                transform: scale(1) translateY(0px); 
            }
            100% { 
                opacity: 0; 
                transform: scale(0.3) translateY(-20px); 
            }
        }
        
        .organ-interactive {
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 20px;
            padding: 8px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .organ-interactive.near-character {
            transform: scale(1.5) rotate(8deg) translateY(-10px);
            filter: drop-shadow(0 0 40px rgba(59, 130, 246, 1)) drop-shadow(0 0 80px rgba(59, 130, 246, 0.8));
            animation: organGlow 1.2s ease-in-out infinite alternate;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 51, 234, 0.1));
            border: 3px solid rgba(59, 130, 246, 0.6);
        }
        
        @keyframes organGlow {
            from { 
                filter: drop-shadow(0 0 40px rgba(59, 130, 246, 1)) drop-shadow(0 0 80px rgba(59, 130, 246, 0.8));
                transform: scale(1.5) rotate(8deg) translateY(-10px);
                box-shadow: 0 20px 60px rgba(59, 130, 246, 0.4);
            }
            to { 
                filter: drop-shadow(0 0 60px rgba(147, 51, 234, 1)) drop-shadow(0 0 120px rgba(59, 130, 246, 1));
                transform: scale(1.55) rotate(-8deg) translateY(-15px);
                box-shadow: 0 25px 80px rgba(147, 51, 234, 0.5);
            }
        }
        
        .organ-interactive:hover {
            transform: scale(1.15) rotate(2deg) translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            border: 2px solid rgba(255, 255, 255, 0.4);
        }
        
        .organ-sparkle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #fff 0%, rgba(59, 130, 246, 0.8) 50%, transparent 100%);
            border-radius: 50%;
            animation: sparkle 2.5s ease-in-out infinite;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.6);
        }
        
        @keyframes sparkle {
            0%, 100% { 
                opacity: 0; 
                transform: scale(0) rotate(0deg); 
                box-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.2) rotate(180deg); 
                box-shadow: 0 0 20px rgba(59, 130, 246, 1);
            }
        }
        
        .interaction-hint {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .interaction-hint.show {
            opacity: 1;
        }
        
        .popup-enter {
            animation: popupEnter 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes popupEnter {
            from { 
                opacity: 0; 
                transform: scale(0.5) rotate(-10deg) translateY(50px);
                filter: blur(10px);
            }
            to { 
                opacity: 1; 
                transform: scale(1) rotate(0deg) translateY(0px);
                filter: blur(0px);
            }
        }
        
        .fade-in {
            animation: fadeIn 1s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* New animations for title screen */
        @keyframes text-shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        .animated-gradient-text {
            background-image: linear-gradient(
                to right,
                #4f46e5,
                #7c3aed,
                #db2777,
                #f59e0b,
                #db2777,
                #7c3aed,
                #4f46e5
            );
            background-size: 200% auto;
            color: #000;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: text-shimmer 5s linear infinite;
        }

        @keyframes subtle-pulse {
            0%, 100% {
                text-shadow: 0 0 5px rgba(37, 99, 235, 0.4);
            }
            50% {
                text-shadow: 0 0 15px rgba(37, 99, 235, 0.8);
            }
        }
        .subtitle-pulse {
            animation: subtle-pulse 3s ease-in-out infinite;
        }

    
/* Logo sáng liên tục */
#schoolLogo {
    animation: logoGlow 2s ease-in-out infinite alternate;
    cursor: pointer;
    transition: transform 0.3s ease;
}
#schoolLogo:hover {
    transform: scale(1.1);
}
@keyframes logoGlow {
    from { filter: drop-shadow(0 0 8px rgba(255,165,0,0.6)); }
    to { filter: drop-shadow(0 0 18px rgba(255,165,0,1)); }
}

</style>

<style>
#schoolLogo {
    display: block !important;
    margin: 20px auto !important;
    max-width: 200px;
    height: auto;
    position: relative;
    z-index: 999;
    transition: transform 0.3s ease, filter 0.3s ease;
}
#schoolLogo:hover {
    transform: scale(1.1);
    filter: brightness(1.1);
}
/* Center in title screen */
#titleScreen #schoolLogo {
    margin-top: 20px;
}
</style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-green-50 min-h-screen">

<!-- Logo trường --><!-- Popup thông tin trường -->
<div id="schoolPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-[999]">
    <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 popup-enter border-2 border-orange-300 relative">
        <!-- Nút đóng -->
        <button onclick="closeSchoolPopup()" class="absolute top-2 right-3 text-2xl text-gray-500 hover:text-red-500">&times;</button>
        
        <!-- Nội dung -->
        <div class="text-center">
            <img src="logo.png" alt="Logo Yersin" class="h-20 mx-auto mb-4">
            <h2 class="text-2xl font-bold text-orange-600 mb-4">Trường THPT Yersin Đà Lạt</h2>
            <p class="text-gray-700 leading-relaxed">
                Trường THPT Yersin Đà Lạt - ngôi trường duy nhất trên địa bàn Tỉnh Lâm Đồng trực thuộc Đại học Yersin Đà Lạt. 
                Được thành lập với sứ mệnh đào tạo thế hệ trẻ năng động, sáng tạo và giàu lòng nhân ái, hướng tới phát triển toàn diện về tri thức, kỹ năng và nhân cách.
            </p>
        </div>
    </div>
</div>

    <!-- Thông tin tác giả cố định -->
    <div class="fixed top-4 left-4 bg-white/90 backdrop-blur-lg rounded-xl p-3 shadow-lg border border-white/20 z-40">
        <div class="text-center">
            <div class="text-sm font-bold text-blue-800">👨‍🏫 Thầy Thái Minh Nguyên</div>
            <div class="text-xs text-gray-600">🏫 THPT Yersin Đà Lạt</div>
        </div>
    </div>

    <!-- Nút Toàn màn hình và Gợi ý -->
    <div class="fixed top-4 right-4 z-50 flex flex-col items-end gap-2">
        <button id="fullscreenBtn" class="bg-white/80 backdrop-blur-sm p-3 rounded-full shadow-lg hover:bg-white transition-all">
            <svg id="fullscreenIconOpen" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-700"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
            <svg id="fullscreenIconClose" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-700 hidden"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>
        </button>
        <div id="fullscreenHint" class="text-center text-xs font-semibold text-red-600 animate-pulse bg-white/80 backdrop-blur-sm p-2 rounded-lg shadow-md">
            <p>Vui lòng bấm vào đây</p>
            <p>để có trải nghiệm tốt nhất!</p>
        </div>
    </div>


    <!-- Màn hình tiêu đề -->
    <div id="titleScreen" class="min-h-screen flex flex-col items-center justify-center p-8 relative overflow-hidden">
<div id="schoolLogoWrap" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 text-center cursor-pointer" onclick="showSchoolInfo()">
    <img src="logo.png" alt="Logo" class="h-24 md:h-28 mb-16">
</div>

        <!-- Background hiệu ứng -->
        <div class="absolute inset-0 bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 opacity-20"></div>
        <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23ffffff%22%20fill-opacity%3D%220.1%22%3E%3Ccircle%20cx%3D%2230%22%20cy%3D%2230%22%20r%3D%222%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E')] animate-pulse"></div>
        
        <div class="text-center max-w-5xl mx-auto relative z-10">
            <div class="mb-12 fade-in mt-24">
                <h1 class="text-6xl md:text-8xl font-black mb-4 animated-gradient-text">
                    Cuộc Chiến Không Khói
                </h1>
                <h2 class="text-xl md:text-2xl font-semibold italic text-blue-700 mb-12 drop-shadow-lg subtitle-pulse">
                    Bảo vệ từng nhịp thở — Nói không với thuốc lá
                </h2>
            </div>
            
            <div class="flex flex-col items-center gap-6 slide-up">
                <button onclick="showInstructions()" class="group bg-gradient-to-br from-blue-500 via-blue-600 to-purple-700 hover:from-blue-600 hover:via-purple-600 hover:to-pink-700 text-white font-bold py-6 px-12 rounded-2xl shadow-2xl transition-all duration-500 transform hover:scale-110 hover:rotate-1 border-2 border-white/20 text-2xl">
                    <span class="mr-3">🎮</span> Bắt đầu chơi
                </button>
<button onclick="showFlashcardGame()" class="group bg-gradient-to-br from-blue-500 via-blue-600 to-purple-700 hover:from-blue-600 hover:via-purple-600 hover:to-pink-700 text-white font-bold py-6 px-12 rounded-2xl shadow-2xl transition-all duration-500 transform hover:scale-110 hover:rotate-1 border-2 border-white/20 text-2xl">
                    <span class="mr-3">🎴</span> Game Flashcard giáo dục
                </button>

                <button onclick="showGuidePopup()" class="bg-white/80 backdrop-blur-sm text-gray-700 font-semibold py-3 px-6 rounded-xl transition-all duration-300 border border-gray-300 shadow-md hover:bg-white hover:shadow-xl hover:scale-105">
                    <span class="mr-2">📖</span> Hướng dẫn chơi
                </button>
                <button onclick="showProjectInfo()" class="bg-white/80 backdrop-blur-sm text-gray-700 font-semibold py-3 px-6 rounded-xl transition-all duration-300 border border-gray-300 shadow-md hover:bg-white hover:shadow-xl hover:scale-105">
                    <span class="mr-2">ℹ️</span> Thông tin dự án
                </button>
</div>

            <div class="mt-12 text-center text-gray-500 text-sm">
                <p>“Hãy chơi ngay — học thật — truyền cảm hứng cho cộng đồng”</p>
            </div>
        </div>
    </div>

    <!-- Popup Thông tin dự án -->
    <div id="projectInfoPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full popup-enter border-2 border-blue-200">
            <div class="bg-gradient-to-r from-blue-500 to-purple-500 p-4 rounded-t-2xl text-white flex justify-between items-center">
                <h2 class="text-xl font-bold">Thông tin dự án</h2>
                <button onclick="closeProjectInfoPopup()" class="text-white hover:text-red-200 text-2xl transition-colors">&times;</button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <p class="font-bold text-gray-800">👨‍🏫 Tác giả:</p>
                    <p class="text-gray-600">Thầy Thái Minh Nguyên</p>
                </div>
                <div class="mb-4">
                    <p class="font-bold text-gray-800">🏫 Đơn vị:</p>
                    <p class="text-gray-600">Trường THPT Yersin Đà Lạt</p>
                </div>
                <div class="mb-4">
                    <p class="font-bold text-gray-800">💡 Mục tiêu:</p>
                    <p class="text-gray-600">Dự án là sản phẩm tâm huyết của thầy để mong muốn tuyên truyền cho các em học sinh nhận biết tác hại và cách phòng chống thuốc lá, thuốc lá điện tử.</p>
                </div>
                 <div>
                    <p class="font-bold text-gray-800">📚 Tài liệu tham khảo:</p>
                    <p class="text-gray-600 text-sm">WHO, Bộ Y tế Việt Nam, CDC</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Popup Hướng dẫn chơi -->
    <div id="guidePopup" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full popup-enter border-2 border-blue-200">
            <div class="bg-gradient-to-r from-blue-500 to-purple-500 p-4 rounded-t-2xl text-white flex justify-between items-center">
                <h2 class="text-xl font-bold">Hướng dẫn chơi</h2>
                <button onclick="closeGuidePopup()" class="text-white hover:text-red-200 text-2xl transition-colors">&times;</button>
            </div>
            <div class="p-6 space-y-4">
<div class="p-6 space-y-4">
  <div>
    <h3 class="font-bold text-lg text-blue-700">🎮 Game 1: Cuộc Chiến Không Khói</h3>
    <ul class="list-disc pl-5 text-gray-600 space-y-1">
      <li><strong>Màn 1:</strong> Di chuyển bằng phím mũi tên, nhấn <span class="font-semibold">Space</span> để xem thông tin cơ quan. Hoàn thành khi khám phá đủ 8 cơ quan.</li>
      <li><strong>Màn 2:</strong> Mũi tên trái/phải để di chuyển, <span class="font-semibold">Space</span> để bắn chất độc. Mục tiêu đạt 5000 điểm hoặc sống sót.</li>
      <li><strong>Màn 3:</strong> Trả lời 15 câu hỏi trắc nghiệm về tác hại của thuốc lá.</li>
    </ul>
  </div>

  <div>
    <h3 class="font-bold text-lg text-pink-700">🎴 Game 2: Flashcard giáo dục</h3>
    <ul class="list-disc pl-5 text-gray-600 space-y-1">
      <li>Lật thẻ để ghi nhớ và ghép đúng các cặp thông tin.</li>
      <li>Hoàn thành nhanh để được điểm cao.</li>
    </ul>
  </div>
</div>
</div>
            </div>
        </div>
    </div>


    <!-- Màn hình hướng dẫn -->
    <div id="instructionScreen" class="hidden min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">
        <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-xl p-8 max-w-3xl mx-auto border border-white/20 relative z-10">
            <!-- Header đơn giản -->
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4">
                    Hướng dẫn
                </h2>
                <p class="text-gray-600">Đơn giản và dễ hiểu!</p>
            </div>
            
            <!-- Nội dung chính gọn gàng -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- Mục tiêu -->
                <div class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">🎯</div>
                        <h3 class="font-bold text-blue-800 text-lg">Mục tiêu</h3>
                    </div>
                    <p class="text-gray-700 text-center">Khám phá <span class="font-bold text-blue-600">8 cơ quan</span> và tìm hiểu tác hại của thuốc lá</p>
                </div>

                <!-- Điều khiển -->
                <div class="bg-green-50 p-6 rounded-xl border border-green-200">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">🕹️</div>
                        <h3 class="font-bold text-green-800 text-lg">Điều khiển</h3>
                    </div>
                    <div class="space-y-2 text-center">
                        <div class="flex items-center justify-center space-x-2">
                            <span class="bg-white px-2 py-1 rounded text-sm">⬅️➡️⬆️⬇️</span>
                            <span class="text-gray-700 text-sm">Di chuyển</span>
                        </div>
                        <div class="flex items-center justify-center space-x-2">
                            <span class="bg-white px-2 py-1 rounded text-sm font-bold">SPACE</span>
                            <span class="text-gray-700 text-sm">Tương tác</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Cách chơi đơn giản -->
            <div class="bg-purple-50 rounded-xl p-6 mb-8 border border-purple-200">
                <div class="text-center">
                    <div class="text-3xl mb-2">✨</div>
                    <h3 class="font-bold text-purple-800 text-lg mb-3">Cách chơi</h3>
                    <div class="flex items-center justify-center space-x-2 text-sm">
                        <span class="bg-purple-200 text-purple-800 px-2 py-1 rounded">Đến gần cơ quan</span>
                        <span>→</span>
                        <span class="bg-pink-200 text-pink-800 px-2 py-1 rounded">Nhấn SPACE</span>
                        <span>→</span>
                        <span class="bg-green-200 text-green-800 px-2 py-1 rounded">Đọc thông tin</span>
                    </div>
                </div>
            </div>
            
            <!-- Nút hành động -->
            <div class="flex flex-col items-center gap-4">
                <button onclick="startGame()" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-4 px-10 rounded-2xl shadow-2xl transition-all duration-300 transform hover:scale-110 text-xl">
                    🚀 BẮT ĐẦU CHƠI NGAY!
                </button>
                <button onclick="backToTitle()" class="bg-white hover:bg-gray-50 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-all duration-300 border border-gray-300 shadow-md">
                    ← Quay lại menu
                </button>
            </div>
        </div>
    </div>

    <!-- Phần chơi chính -->
    <div id="gameScreen" class="hidden min-h-screen p-8 flex items-center justify-center">

        <!-- Bản đồ cơ thể -->
        <div class="max-w-5xl mx-auto">
            <div id="gameArea" class="relative bg-gradient-to-br from-blue-50 via-purple-50 to-green-50 rounded-3xl p-8 overflow-hidden shadow-2xl border-4 border-white game-area-animated" style="height: 550px; width: 900px;">
                <!-- Nhân vật điều khiển -->
                <div id="character" class="character absolute text-6xl cursor-pointer select-none drop-shadow-lg" style="left: 30px; top: 420px; transition: all 0.3s ease;">
                    🦸
                </div>

                <!-- Hàng 1 (Trên) - 3 cơ quan -->
                <!-- Não -->
                <div id="brain-organ" class="organ-interactive absolute cursor-pointer transition-all duration-500 text-center transform hover:scale-125" style="left: 150px; top: 20px; width: 140px; height: 120px;">
                    <div class="text-7xl mb-2 animate-pulse drop-shadow-lg">🧠</div>
                    <h3 class="text-sm font-bold text-purple-900 bg-white/80 rounded-lg px-2 py-1 shadow-md">Não</h3>
                    <p class="text-purple-700 text-xs font-medium bg-white/60 rounded px-1 mt-1">Trung tâm điều khiển</p>
                    <div class="interaction-hint bg-purple-800">Nhấn SPACE để tương tác</div>
                    <div class="organ-sparkle" style="top: 15%; left: 20%; animation-delay: 0s;"></div>
                    <div class="organ-sparkle" style="top: 25%; right: 15%; animation-delay: 0.7s;"></div>
                    <div class="organ-sparkle" style="bottom: 30%; left: 30%; animation-delay: 1.4s;"></div>
                </div>

                <!-- Hệ miễn dịch -->
                <div id="immune-organ" class="organ-interactive absolute cursor-pointer transition-all duration-500 text-center transform hover:scale-125" style="left: 380px; top: 20px; width: 140px; height: 120px;">
                    <div class="text-7xl mb-2 animate-bounce drop-shadow-lg">🛡️</div>
                    <h3 class="text-sm font-bold text-yellow-900 bg-white/80 rounded-lg px-2 py-1 shadow-md">Miễn dịch</h3>
                    <p class="text-yellow-700 text-xs font-medium bg-white/60 rounded px-1 mt-1">Lá chắn bảo vệ</p>
                    <div class="interaction-hint bg-yellow-800">Nhấn SPACE để tương tác</div>
                    <div class="organ-sparkle" style="top: 20%; left: 25%; animation-delay: 0.3s;"></div>
                    <div class="organ-sparkle" style="top: 30%; right: 20%; animation-delay: 1s;"></div>
                    <div class="organ-sparkle" style="bottom: 35%; left: 35%; animation-delay: 1.7s;"></div>
                </div>

                <!-- Da -->
                <div id="skin-organ" class="organ-interactive absolute cursor-pointer transition-all duration-500 text-center transform hover:scale-125" style="left: 610px; top: 20px; width: 140px; height: 120px;">
                    <div class="text-7xl mb-2 animate-pulse drop-shadow-lg">🌸</div>
                    <h3 class="text-sm font-bold text-pink-900 bg-white/80 rounded-lg px-2 py-1 shadow-md">Da</h3>
                    <p class="text-pink-700 text-xs font-medium bg-white/60 rounded px-1 mt-1">Lớp bảo vệ</p>
                    <div class="interaction-hint bg-pink-800">Nhấn SPACE để tương tác</div>
                    <div class="organ-sparkle" style="top: 18%; left: 30%; animation-delay: 0.6s;"></div>
                    <div class="organ-sparkle" style="top: 35%; right: 25%; animation-delay: 1.3s;"></div>
                    <div class="organ-sparkle" style="bottom: 32%; left: 40%; animation-delay: 2s;"></div>
                </div>

                <!-- Hàng 2 (Giữa) - 3 cơ quan -->
                <!-- Tim -->
                <div id="heart-organ" class="organ-interactive absolute cursor-pointer transition-all duration-500 text-center transform hover:scale-125" style="left: 150px; top: 170px; width: 140px; height: 120px;">
                    <div class="text-7xl mb-2 animate-pulse drop-shadow-lg" style="animation-duration: 1s;">❤️</div>
                    <h3 class="text-sm font-bold text-red-900 bg-white/80 rounded-lg px-2 py-1 shadow-md">Tim</h3>
                    <p class="text-red-700 text-xs font-medium bg-white/60 rounded px-1 mt-1">Trung tâm tuần hoàn</p>
                    <div class="interaction-hint bg-red-800">Nhấn SPACE để tương tác</div>
                    <div class="organ-sparkle" style="top: 22%; left: 28%; animation-delay: 0.2s;"></div>
                    <div class="organ-sparkle" style="top: 40%; right: 22%; animation-delay: 0.9s;"></div>
                    <div class="organ-sparkle" style="bottom: 28%; left: 38%; animation-delay: 1.6s;"></div>
                </div>

                <!-- Phổi -->
                <div id="lungs-organ" class="organ-interactive absolute cursor-pointer transition-all duration-500 text-center transform hover:scale-125" style="left: 380px; top: 170px; width: 140px; height: 120px;">
                    <div class="text-7xl mb-2 animate-pulse drop-shadow-lg" style="animation-duration: 2s;">🫁</div>
                    <h3 class="text-sm font-bold text-blue-900 bg-white/80 rounded-lg px-2 py-1 shadow-md">Phổi</h3>
                    <p class="text-blue-700 text-xs font-medium bg-white/60 rounded px-1 mt-1">Hệ hô hấp</p>
                    <div class="interaction-hint bg-blue-800">Nhấn SPACE để tương tác</div>
                    <div class="organ-sparkle" style="top: 25%; left: 32%; animation-delay: 0.5s;"></div>
                    <div class="organ-sparkle" style="top: 38%; right: 28%; animation-delay: 1.2s;"></div>
                    <div class="organ-sparkle" style="bottom: 30%; left: 42%; animation-delay: 1.9s;"></div>
                </div>

                <!-- Dạ dày -->
                <div id="stomach-organ" class="organ-interactive absolute cursor-pointer transition-all duration-500 text-center transform hover:scale-125" style="left: 610px; top: 170px; width: 140px; height: 120px;">
                    <div class="text-7xl mb-2 animate-bounce drop-shadow-lg" style="animation-duration: 1.5s;">🥗</div>
                    <h3 class="text-sm font-bold text-orange-900 bg-white/80 rounded-lg px-2 py-1 shadow-md">Dạ dày</h3>
                    <p class="text-orange-700 text-xs font-medium bg-white/60 rounded px-1 mt-1">Tiêu hóa thức ăn</p>
                    <div class="interaction-hint bg-orange-800">Nhấn SPACE để tương tác</div>
                    <div class="organ-sparkle" style="top: 28%; left: 26%; animation-delay: 0.8s;"></div>
                    <div class="organ-sparkle" style="top: 42%; right: 30%; animation-delay: 1.5s;"></div>
                    <div class="organ-sparkle" style="bottom: 34%; left: 36%; animation-delay: 2.2s;"></div>
                </div>

                <!-- Hàng 3 (Dưới) - 2 cơ quan ở giữa -->
                <!-- Gan -->
                <div id="liver-organ" class="organ-interactive absolute cursor-pointer transition-all duration-500 text-center transform hover:scale-125" style="left: 265px; top: 320px; width: 140px; height: 120px;">
                    <div class="text-7xl mb-2 animate-pulse drop-shadow-lg" style="animation-duration: 1.8s;">🍀</div>
                    <h3 class="text-sm font-bold text-green-900 bg-white/80 rounded-lg px-2 py-1 shadow-md">Gan</h3>
                    <p class="text-green-700 text-xs font-medium bg-white/60 rounded px-1 mt-1">Nhà máy xử lý</p>
                    <div class="interaction-hint bg-green-800">Nhấn SPACE để tương tác</div>
                    <div class="organ-sparkle" style="top: 24%; left: 34%; animation-delay: 0.4s;"></div>
                    <div class="organ-sparkle" style="top: 36%; right: 26%; animation-delay: 1.1s;"></div>
                    <div class="organ-sparkle" style="bottom: 36%; left: 44%; animation-delay: 1.8s;"></div>
                </div>

                <!-- Thận -->
                <div id="kidney-organ" class="organ-interactive absolute cursor-pointer transition-all duration-500 text-center transform hover:scale-125" style="left: 495px; top: 320px; width: 140px; height: 120px;">
                    <div class="text-7xl mb-2 animate-bounce drop-shadow-lg" style="animation-duration: 2.2s;">💧</div>
                    <h3 class="text-sm font-bold text-cyan-900 bg-white/80 rounded-lg px-2 py-1 shadow-md">Thận</h3>
                    <p class="text-cyan-700 text-xs font-medium bg-white/60 rounded px-1 mt-1">Bộ lọc máu</p>
                    <div class="interaction-hint bg-cyan-800">Nhấn SPACE để tương tác</div>
                    <div class="organ-sparkle" style="top: 26%; left: 38%; animation-delay: 0.7s;"></div>
                    <div class="organ-sparkle" style="top: 44%; right: 32%; animation-delay: 1.4s;"></div>
                    <div class="organ-sparkle" style="bottom: 38%; left: 48%; animation-delay: 2.1s;"></div>
                </div>

                <!-- Đường viền trang trí -->
                <div class="absolute inset-4 border-2 border-dashed border-blue-200 rounded-2xl opacity-30 pointer-events-none"></div>
                
                <!-- Hiệu ứng ánh sáng -->
                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-white/20 via-transparent to-transparent pointer-events-none rounded-3xl"></div>
                
                <!-- Thanh tiến độ (trong game) -->
                <div id="progressContainer" class="absolute bottom-4 left-4 right-4 bg-black/20 backdrop-blur-sm rounded-2xl p-3 shadow-lg border border-white/20 z-20">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-white text-sm flex items-center">
                            🎯 <span class="ml-2">Tiến độ</span>
                        </span>
                        <span id="progressText" class="text-lg font-bold text-white">0/8</span>
                    </div>
                    <div class="w-full bg-white/20 rounded-full h-2.5 overflow-hidden shadow-inner">
                        <div id="progressBar" class="bg-gradient-to-r from-yellow-400 via-green-400 to-cyan-400 h-full rounded-full transition-all duration-700 ease-out" style="width: 0%">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nút tiếp tục (ẩn ban đầu) -->
            <div id="continueButton" class="hidden text-center mt-8">
                <button onclick="completePart1()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                    🎉 Hoàn thành phần 1 → Tiếp tục
                </button>
            </div>
        </div>
    </div>

    <!-- Popup trò chuyện dễ thương -->
    <div id="organPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full popup-enter border-2 border-blue-200">
            <!-- Header đơn giản -->
            <div class="bg-gradient-to-r from-blue-500 to-purple-500 p-4 rounded-t-2xl text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="text-2xl animate-bounce">🦸</div>
                        <h2 class="text-lg font-bold">Khám phá cơ thể</h2>
                    </div>
                    <button onclick="closeOrganPopup()" class="text-white hover:text-red-200 text-xl transition-colors">
                        ✕
                    </button>
                </div>
            </div>
            
            <!-- Nội dung chính gọn -->
            <div id="organContent" class="p-6">
                <!-- Nội dung sẽ được thêm bằng JavaScript -->
            </div>
            
            <!-- Footer đơn giản -->
            <div class="p-4 bg-gray-50 rounded-b-2xl border-t">
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-500">
                        💡 Nhấn Space để tiếp tục
                    </div>
                    <button id="dialogueButton" onclick="nextDialogue()" class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold py-2 px-6 rounded-lg transition-all duration-300 transform hover:scale-105">
                        Tiếp tục →
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Màn hình kết thúc phần 1 -->
    <div id="part1Complete" class="hidden min-h-screen flex flex-col items-center justify-center p-8 relative">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-4xl mx-auto text-center">
            <div class="text-6xl mb-6">🎉</div>
            <h2 class="text-3xl font-bold text-green-800 mb-4">Chúc mừng!</h2>
            <p class="text-xl text-gray-700 mb-8">
                Bạn đã khám phá vai trò quan trọng của các cơ quan sống còn. 
                Hãy bảo vệ chúng bằng cách tránh xa thuốc lá!
            </p>
            <div class="bg-green-50 p-6 rounded-xl mb-8">
                <h3 class="text-lg font-semibold text-green-800 mb-2">Điểm số phần 1:</h3>
                <div class="text-3xl font-bold text-green-600" id="part1Score">100/100</div>
            </div>
            <button onclick="startPart2()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                🚀 Bắt đầu phần 2
            </button>
        </div>
        

    </div>

    <!-- Màn hình mở đầu phần 2 -->
    <div id="part2Intro" class="hidden min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">
        <!-- Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-800 opacity-95"></div>
        <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%220%200%2040%2040%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23ffffff%22%20fill-opacity%3D%220.1%22%3E%3Cpath%20d%3D%22M20%2020c0-5.5-4.5-10-10-10s-10%204.5-10%2010%204.5%2010%2010%2010%2010-4.5%2010-10z%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E')] animate-pulse"></div>
        
        <div class="relative z-10 text-center max-w-3xl mx-auto">
            <!-- Header gọn -->
            <div class="mb-8">
                <div class="flex items-center justify-center mb-4">
                    <div class="text-5xl animate-bounce mr-2">🦸‍♂️</div>
                    <div class="text-3xl animate-pulse">⚔️</div>
                    <div class="text-5xl animate-bounce ml-2">🦠</div>
                </div>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-yellow-300 via-orange-300 to-red-400 bg-clip-text text-transparent mb-2">
                    Nhiệm vụ bảo vệ cơ thể!
                </h1>
                <p class="text-white/90">Tiêu diệt các chất độc hại từ thuốc lá</p>
            </div>
            
            <!-- Thông tin cơ bản -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-4 mb-6 border border-white/20">
                <div class="grid grid-cols-3 gap-3 text-center text-sm">
                    <div class="bg-red-500/20 rounded-lg p-3 border border-red-400/30">
                        <div class="text-2xl mb-1">🎯</div>
                        <div class="font-bold text-white">Mục tiêu</div>
                        <div class="text-red-200 text-xs">Đạt 5000 điểm</div>
                    </div>
                    <div class="bg-blue-500/20 rounded-lg p-3 border border-blue-400/30">
                        <div class="text-2xl mb-1">🕹️</div>
                        <div class="font-bold text-white">Điều khiển</div>
                        <div class="text-blue-200 text-xs">⬅️➡️ + SPACE</div>
                    </div>
                    <div class="bg-green-500/20 rounded-lg p-3 border border-green-400/30">
                        <div class="text-2xl mb-1">❤️</div>
                        <div class="font-bold text-white">Sức khỏe</div>
                        <div class="text-green-200 text-xs">3 cơ quan</div>
                    </div>
                </div>
            </div>
            
            <!-- Kẻ thù gọn -->
            <div class="bg-black/20 backdrop-blur-lg rounded-xl p-4 mb-8 border border-white/20">
                <h3 class="text-white font-bold mb-3 flex items-center justify-center">
                    <span class="text-xl mr-2">⚠️</span>
                    Kẻ thù cần tiêu diệt
                </h3>
                <div class="grid grid-cols-3 gap-2 text-xs">
                    <div class="bg-purple-600/30 rounded-lg p-2 border border-purple-400/40">
                        <div class="text-lg mb-1">🧪</div>
                        <div class="font-semibold text-white text-xs">Gây ung thư</div>
                    </div>
                    <div class="bg-yellow-600/30 rounded-lg p-2 border border-yellow-400/40">
                        <div class="text-lg mb-1">⚡</div>
                        <div class="font-semibold text-white text-xs">Độc thần kinh</div>
                    </div>
                    <div class="bg-gray-600/30 rounded-lg p-2 border border-gray-400/40">
                        <div class="text-lg mb-1">🌫️</div>
                        <div class="font-semibold text-white text-xs">Phá hủy phổi</div>
                    </div>
                </div>
            </div>
            
            <!-- Nút tên lửa ở giữa -->
            <div class="flex flex-col items-center gap-6">
                <button onclick="startPart2Game()" class="rocket-button relative bg-gradient-to-t from-red-600 via-orange-500 to-yellow-400 hover:from-red-700 hover:via-orange-600 hover:to-yellow-500 text-white font-bold py-10 px-16 rounded-full shadow-2xl transition-all duration-300 transform hover:scale-115 hover:-translate-y-3 border-4 border-white/30 group">
                    <!-- Thân tên lửa -->
                    <div class="flex flex-col items-center">
                        <div class="text-6xl mb-3 group-hover:animate-bounce">🚀</div>
                        <div class="text-2xl font-black mb-1">BẮT ĐẦU</div>
                        <div class="text-lg opacity-90">NHIỆM VỤ</div>
                    </div>
                    
                    <!-- Hiệu ứng lửa -->
                    <div class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <div class="flex space-x-1">
                            <div class="w-3 h-8 bg-gradient-to-t from-red-500 to-orange-400 rounded-full animate-pulse"></div>
                            <div class="w-3 h-10 bg-gradient-to-t from-orange-500 to-yellow-400 rounded-full animate-pulse" style="animation-delay: 0.1s;"></div>
                            <div class="w-3 h-8 bg-gradient-to-t from-red-500 to-orange-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                        </div>
                    </div>
                    
                    <!-- Hiệu ứng ánh sáng -->
                    <div class="absolute inset-0 rounded-full bg-gradient-to-t from-transparent via-white/10 to-white/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                </button>
                
                <button onclick="backToTitle()" class="text-white/70 hover:text-white text-sm underline transition-colors">
                    ← Quay lại menu chính
                </button>
            </div>
        </div>
    </div>

    <!-- Màn hình phần 2 - Game bắn súng -->
    <div id="part2Screen" class="hidden min-h-screen p-4 bg-gradient-to-b from-purple-900 via-blue-900 to-black relative overflow-hidden">
        <!-- Background hiệu ứng -->
        <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%220%200%2040%2040%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23ffffff%22%20fill-opacity%3D%220.05%22%3E%3Ccircle%20cx%3D%2220%22%20cy%3D%2220%22%20r%3D%221%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E')] animate-pulse"></div>
        
        <!-- Header game đơn giản -->
        <div class="relative z-10 mb-6">
            <div class="bg-black/50 backdrop-blur-lg rounded-2xl p-4 max-w-4xl mx-auto border border-white/20">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <!-- Tiêu đề -->
                    <div class="text-center md:text-left">
                        <h2 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-yellow-400 to-red-500 bg-clip-text text-transparent">
                            🦸‍♂️ Siêu nhân bảo vệ sức khỏe
                        </h2>
                        <p class="text-white/80 text-sm">Tiêu diệt các chất độc hại!</p>
                    </div>
                    
                    <!-- Thống kê game -->
                    <div class="flex gap-4 text-center">
                        <div class="bg-red-500/20 rounded-lg p-3 border border-red-500/30">
                            <div class="text-red-400 text-xs mb-1">Máu</div>
                            <div id="healthDisplay" class="text-white font-bold text-lg">❤️🧠🫁</div>
                        </div>
                        <div class="bg-yellow-500/20 rounded-lg p-3 border border-yellow-500/30">
                            <div class="text-yellow-400 text-xs mb-1">Điểm</div>
                            <div id="scoreDisplay" class="text-white font-bold text-lg">0</div>
                        </div>
                    </div>
                    
                    <!-- Nút điều khiển -->
                    <div class="flex gap-2">
                        <button id="pauseButton" onclick="togglePause()" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded-lg transition-all duration-300">
                            ⏸️ Tạm dừng
                        </button>
                        <button onclick="backToStart()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300">
                            🏠 Menu
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Khu vực chơi game -->
        <div class="relative z-10 max-w-4xl mx-auto">
            <div id="gameCanvas" class="relative bg-gradient-to-b from-blue-900/30 to-purple-900/30 rounded-2xl overflow-hidden border-2 border-white/20 backdrop-blur-sm" style="height: 500px;">
                <!-- Nhân vật siêu nhân -->
                <div id="hero" class="absolute text-6xl transition-all duration-100 z-20" style="left: 50%; bottom: 20px; transform: translateX(-50%);">
                    🦸‍♂️
                </div>
                
                <!-- Container cho đạn -->
                <div id="bulletsContainer" class="absolute inset-0 pointer-events-none z-15"></div>
                
                <!-- Container cho chất độc -->
                <div id="toxinsContainer" class="absolute inset-0 pointer-events-none z-10"></div>
                
                <!-- Container cho hiệu ứng nổ -->
                <div id="explosionsContainer" class="absolute inset-0 pointer-events-none z-25"></div>

                <!-- Container cho vật phẩm -->
                <div id="powerUpsContainer" class="absolute inset-0 pointer-events-none z-15"></div>
                
                <!-- Hướng dẫn điều khiển -->
                <div class="absolute top-4 left-4 bg-black/70 rounded-lg p-3 text-white text-sm">
                    <div class="font-bold mb-2 text-center">🎮 Điều khiển</div>
                    <div class="flex items-center gap-2 mb-1">
                        <span class="bg-white/20 px-2 py-1 rounded text-xs">⬅️➡️</span>
                        <span>Di chuyển</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="bg-white/20 px-2 py-1 rounded text-xs">SPACE</span>
                        <span>Bắn 💥</span>
                    </div>
                </div>
                
                <!-- Mục tiêu game -->
                <div class="absolute top-4 right-4 bg-black/70 rounded-lg p-3 text-white text-sm text-center">
                    <div class="font-bold mb-2">🎯 Mục tiêu</div>
                    <div class="text-xs text-green-400 mb-1">✅ Đạt 5000 điểm</div>
                    <div class="text-xs text-red-400">❌ Không để hết máu</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup hoàn thành phần 1 -->
    <div id="part1CompletePopup" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-green-900 to-blue-900 rounded-2xl shadow-2xl max-w-lg w-full popup-enter border-2 border-green-500/50">
            <div class="p-8 text-center">
                <div class="text-8xl mb-6 animate-bounce">🎉</div>
                <h2 class="text-3xl font-bold text-white mb-4">Xuất sắc!</h2>
                <p class="text-green-200 mb-6 text-lg leading-relaxed">
                    Bạn đã khám phá thành công tất cả <span class="font-bold text-yellow-300">8 cơ quan</span> quan trọng!
                    <br>Giờ đây bạn hiểu rõ tác hại của thuốc lá.
                </p>
                
                <div class="bg-black/30 rounded-xl p-6 mb-6">
                    <div class="text-yellow-400 font-bold text-xl mb-2">Điểm số phần 1</div>
                    <div class="text-4xl font-bold text-white" id="part1PopupScore">100/100</div>
                    <div class="text-green-300 text-sm mt-2">Hoàn thành xuất sắc!</div>
                </div>
                
                <div class="bg-red-900/50 rounded-xl p-4 mb-6 border border-red-500/30">
                    <div class="text-2xl mb-2">⚠️</div>
                    <p class="text-red-200 font-semibold">
                        Nhưng cuộc chiến chưa kết thúc!<br>
                        Các chất độc hại đang tấn công cơ thể...
                    </p>
                </div>
                
                <div class="flex flex-col items-center gap-4">
                    <button onclick="proceedToPart2()" class="bg-gradient-to-r from-red-600 via-orange-600 to-yellow-600 hover:from-red-700 hover:via-orange-700 hover:to-yellow-700 text-white font-bold py-5 px-10 rounded-2xl shadow-2xl transition-all duration-300 transform hover:scale-110 text-xl">
                        🚀 TIẾP TỤC CHIẾN ĐẤU!
                    </button>
                    <button onclick="closePart1Popup()" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-6 rounded-lg transition-all duration-300">
                        Để sau
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup đạt 5000 điểm -->
    <div id="scoreGoalPopup" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-yellow-800 to-green-800 rounded-2xl shadow-2xl max-w-md w-full popup-enter border-2 border-yellow-500/50">
            <div class="p-6 text-center">
                <div class="text-6xl mb-4">🎉</div>
                <h2 class="text-2xl font-bold text-white mb-2">Mục tiêu đạt được!</h2>
                <p class="text-yellow-200 mb-4">Bạn đã đạt 5000 điểm! Bạn muốn làm gì tiếp theo?</p>
                <div class="flex gap-3 justify-center">
                    <button onclick="continuePlaying()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300">
                        🚀 Chơi tiếp
                    </button>
                    <button onclick="proceedToQuizFromScore()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300">
                        🧠 Qua phần câu hỏi
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup chuyển cảnh từ phần 2 sang phần 3 -->
    <div id="transitionPopup" class="hidden fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 rounded-2xl shadow-2xl max-w-2xl w-full popup-enter border-2 border-purple-500/50">
            <div class="p-8 text-center">
                <!-- Animation chuyển cảnh -->
                <div class="mb-6">
                    <div class="flex items-center justify-center space-x-4 mb-4">
                        <div class="text-6xl animate-pulse">🦸‍♂️</div>
                        <div class="text-4xl animate-bounce">→</div>
                        <div class="text-6xl animate-pulse">🧠</div>
                    </div>
                    <div class="w-full bg-purple-800/30 rounded-full h-2 mb-4">
                        <div class="bg-gradient-to-r from-purple-400 to-blue-400 h-2 rounded-full animate-pulse" style="width: 67%;"></div>
                    </div>
                </div>
                
                <h2 id="transitionTitle" class="text-3xl font-bold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent mb-4">
                    Nhiệm vụ hoàn thành!
                </h2>
                
                <p id="transitionMessage" class="text-purple-200 mb-6 text-lg leading-relaxed">
                    Bạn đã bảo vệ thành công cơ thể khỏi các chất độc hại từ thuốc lá!<br>
                    Giờ đây, hãy kiểm tra kiến thức đã học được.
                </p>
                
                <!-- Thống kê tổng kết -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-green-500/20 rounded-xl p-4 border border-green-400/30">
                        <div class="text-3xl mb-2">✅</div>
                        <div class="text-white font-bold text-lg">Phần 1</div>
                        <div class="text-green-200 text-sm">Khám phá cơ thể</div>
                    </div>
                    <div class="bg-blue-500/20 rounded-xl p-4 border border-blue-400/30">
                        <div class="text-3xl mb-2">✅</div>
                        <div class="text-white font-bold text-lg">Phần 2</div>
                        <div class="text-blue-200 text-sm">Tiêu diệt chất độc</div>
                    </div>
                </div>
                
                <!-- Phần 3 sắp tới -->
                <div class="bg-gradient-to-r from-purple-800/50 to-pink-800/50 rounded-xl p-6 mb-6 border border-purple-400/30">
                    <div class="text-4xl mb-3">🧠</div>
                    <h3 class="text-xl font-bold text-white mb-2">Phần 3: Quiz Kiến thức</h3>
                    <p class="text-purple-200 text-sm mb-3">
                        15 câu hỏi về tác hại của thuốc lá và thuốc lá điện tử
                    </p>
                    <div class="flex items-center justify-center space-x-4 text-sm">
                        <div class="bg-yellow-500/20 px-3 py-1 rounded-full border border-yellow-400/30">
                            <span class="text-yellow-200">🏆 Điểm cao</span>
                        </div>
                        <div class="bg-green-500/20 px-3 py-1 rounded-full border border-green-400/30">
                            <span class="text-green-200">📚 Học hỏi</span>
                        </div>
                    </div>
                </div>
                
                <!-- Nút tiếp tục -->
                <div class="flex flex-col items-center gap-4">
                    <button onclick="startQuizFromTransition()" class="bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 hover:from-purple-700 hover:via-pink-700 hover:to-red-700 text-white font-bold py-5 px-10 rounded-2xl shadow-2xl transition-all duration-300 transform hover:scale-110 text-xl">
                        🚀 BẮT ĐẦU QUIZ!
                    </button>
                    <button onclick="closeTransitionPopup()" class="text-purple-300 hover:text-white text-sm underline transition-colors">
                        Để sau
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Màn hình giới thiệu Quiz -->
    <div id="quizIntroScreen" class="hidden min-h-screen p-6 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23ffffff%22%20fill-opacity%3D%220.1%22%3E%3Cpath%20d%3D%22M30%2030c0-8.3-6.7-15-15-15s-15%206.7-15%2015%206.7%2015%2015%2015%2015-6.7%2015-15z%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E')] animate-pulse"></div>
        <div class="relative z-10 max-w-4xl mx-auto text-center">
             <!-- Header quiz -->
            <div class="mb-8">
                <div class="text-6xl mb-4 animate-bounce">🧠</div>
                <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-yellow-400 via-orange-400 to-red-500 bg-clip-text text-transparent mb-4">
                    Quiz Kiến Thức
                </h1>
                <p class="text-white/90 text-lg mb-6">Kiểm tra hiểu biết về tác hại của thuốc lá</p>
                
                <!-- Thống kê quiz -->
                <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-4 border border-white/20 max-w-2xl mx-auto">
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div class="bg-blue-500/20 rounded-xl p-3 border border-blue-400/30">
                            <div class="text-2xl mb-1">📊</div>
                            <div class="text-white font-bold text-lg">0</div>
                            <div class="text-blue-200 text-sm">Điểm số</div>
                        </div>
                        <div class="bg-green-500/20 rounded-xl p-3 border border-green-400/30">
                            <div class="text-2xl mb-1">✅</div>
                            <div class="text-white font-bold text-lg">0</div>
                            <div class="text-green-200 text-sm">Đúng</div>
                        </div>
                        <div class="bg-purple-500/20 rounded-xl p-3 border border-purple-400/30">
                            <div class="text-2xl mb-1">📝</div>
                            <div class="text-white font-bold text-lg">15</div>
                            <div class="text-purple-200 text-sm">Câu hỏi</div>
                        </div>
                    </div>
                </div>
            </div>
            <button onclick="startQuizGame()" class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all duration-300 transform hover:scale-110 text-xl">
                🚀 Bắt đầu
            </button>
        </div>
    </div>


    <!-- Màn hình phần 3 - Quiz -->
    <div id="part3Screen" class="hidden min-h-screen p-6 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23ffffff%22%20fill-opacity%3D%220.1%22%3E%3Cpath%20d%3D%22M30%2030c0-8.3-6.7-15-15-15s-15%206.7-15%2015%206.7%2015%2015%2015%2015-6.7%2015-15z%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E')] animate-pulse"></div>
        
        <div class="relative z-10 max-w-4xl mx-auto w-full">
            <!-- Khu vực câu hỏi -->
            <div id="quizContainer" class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl border border-white/20 overflow-hidden">
                <!-- Thanh tiến độ -->
                <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2">
                    <div id="quizProgressBar" class="bg-gradient-to-r from-yellow-400 to-green-500 h-full transition-all duration-500" style="width: 6.67%"></div>
                </div>
                
                <!-- Nội dung câu hỏi -->
                <div class="p-8">
                    <!-- Header trong quiz -->
                    <div class="flex justify-between items-center mb-6">
                         <div class="flex items-center space-x-2">
                            <span class="font-bold text-gray-700">Câu hỏi:</span>
                            <span id="questionProgress" class="font-bold text-lg text-blue-600">1/15</span>
                         </div>
                         <div class="flex items-center space-x-2">
                            <span class="font-bold text-gray-700">Điểm:</span>
                            <span id="quizScore" class="font-bold text-lg text-green-600">0</span>
                         </div>
                    </div>

                    <!-- Câu hỏi -->
                    <div class="text-center mb-8">
                        <h2 id="questionText" class="text-2xl md:text-3xl font-bold text-gray-800 leading-relaxed">
                            <!-- Câu hỏi sẽ được load bằng JavaScript -->
                        </h2>
                    </div>
                    
                    <!-- Các lựa chọn -->
                    <div id="answersContainer" class="space-y-4 max-w-3xl mx-auto">
                        <!-- Các đáp án sẽ được tạo bằng JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Nút thoát -->
            <div class="text-center mt-6">
                <button onclick="backToTitle()" class="text-white/70 hover:text-white text-sm underline transition-colors">
                    ← Quay lại menu chính
                </button>
            </div>
        </div>
    </div>
    
    <!-- Popup kết quả câu hỏi -->
    <div id="questionResultPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full popup-enter">
            <!-- Header based on result -->
            <div id="popupHeader" class="p-4 rounded-t-2xl text-white">
                 <h2 id="popupTitle" class="text-2xl font-bold text-center">Kết quả</h2>
            </div>
            <!-- Content -->
            <div class="p-6 text-center">
                <p id="popupExplanation" class="text-gray-700 mb-6"></p>
                <button id="popupNextButton" onclick="closeQuestionResultPopup()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                    Câu tiếp theo →
                </button>
            </div>
        </div>
    </div>


    <!-- Màn hình kết quả quiz -->
    <div id="quizResultScreen" class="hidden min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">
        <!-- Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-green-600 via-blue-600 to-purple-700 opacity-95"></div>
        <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%220%200%2040%2040%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23ffffff%22%20fill-opacity%3D%220.1%22%3E%3Ccircle%20cx%3D%2220%22%20cy%3D%2220%22%20r%3D%223%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E')] animate-pulse"></div>
        
        <div class="relative z-10 text-center max-w-4xl mx-auto">
            <!-- Kết quả -->
            <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8 border border-white/20">
                <div id="resultIcon" class="text-8xl mb-6">🏆</div>
                <h1 id="resultTitle" class="text-4xl font-bold text-gray-800 mb-4">Xuất sắc!</h1>
                <p id="resultMessage" class="text-xl text-gray-700 mb-6">
                    <!-- Thông điệp sẽ được tạo bằng JavaScript -->
                </p>
                
                <!-- Thống kê chi tiết -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-blue-50 rounded-xl p-6 border border-blue-200">
                        <div class="text-4xl mb-2">📊</div>
                        <div class="text-3xl font-bold text-blue-600" id="finalQuizScore">0</div>
                        <div class="text-blue-800 font-semibold">Điểm tổng</div>
                    </div>
                    <div class="bg-green-50 rounded-xl p-6 border border-green-200">
                        <div class="text-4xl mb-2">✅</div>
                        <div class="text-3xl font-bold text-green-600" id="finalCorrect">0/15</div>
                        <div class="text-green-800 font-semibold">Câu đúng</div>
                    </div>
                    <div class="bg-purple-50 rounded-xl p-6 border border-purple-200">
                        <div class="text-4xl mb-2">🎯</div>
                        <div class="text-3xl font-bold text-purple-600" id="finalAccuracy">0%</div>
                        <div class="text-purple-800 font-semibold">Độ chính xác</div>
                    </div>
                </div>
                
                <!-- Thông điệp cuối -->
                <div id="finalMessage" class="bg-gradient-to-r from-red-50 to-orange-50 rounded-xl p-6 border-2 border-red-200 mb-6">
                    <!-- Thông điệp sẽ được tạo bằng JavaScript -->
                </div>
                
                <!-- Nút hành động -->
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="restartQuiz()" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                        🔄 Làm lại quiz
                    </button>
                    <button onclick="backToTitle()" class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                        🏠 Về menu chính
                    </button>
                </div>
            </div>
            
            <!-- Lời cảm ơn -->
            <div class="bg-white/90 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div class="text-3xl mb-3">💚</div>
                <p class="text-gray-800 font-semibold text-lg">
                    Cảm ơn bạn đã quan tâm đến sức khỏe!<br>
                    Hãy chia sẻ kiến thức này với bạn bè và gia đình.
                </p>
                <div class="mt-4 text-sm text-gray-600">
                    <p>🚭 <strong>Nhớ:</strong> Không có mức độ "an toàn" nào khi sử dụng thuốc lá!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State variables for the entire game
        let visitedOrgans = new Set();
        let totalScore = 0;
        let characterPosition = { x: 30, y: 420 };
        let nearOrgan = null;

        // Organ positions and data
        const organPositions = {
            brain: { x: 150, y: 20, width: 140, height: 120 },
            immune: { x: 380, y: 20, width: 140, height: 120 },
            skin: { x: 610, y: 20, width: 140, height: 120 },
            heart: { x: 150, y: 170, width: 140, height: 120 },
            lungs: { x: 380, y: 170, width: 140, height: 120 },
            stomach: { x: 610, y: 170, width: 140, height: 120 },
            liver: { x: 265, y: 320, width: 140, height: 120 },
            kidney: { x: 495, y: 320, width: 140, height: 120 }
        };

        const organData = {
            heart: {
                title: "❤️ Tim",
                dialogues: [
                    "Xin chào! Mình là Tim – trái tim của bạn.",
                    "Mỗi ngày, mình đập khoảng 100.000 lần, bơm hơn 7.500 lít máu đi khắp cơ thể để cung cấp oxy và dinh dưỡng cho mọi tế bào.",
                    "Nếu bạn hút thuốc, nicotine sẽ làm tăng nhịp tim và huyết áp, còn carbon monoxide sẽ chiếm chỗ oxy trong máu, khiến mình phải làm việc quá sức.",
                    "Hậu quả có thể là xơ vữa động mạch, nhồi máu cơ tim hoặc đột quỵ.",
                    "Hãy giữ mình khỏe mạnh bằng cách tránh xa thuốc lá và rèn luyện thể chất mỗi ngày!"
                ]
            },
            brain: {
                title: "🧠 Não",
                dialogues: [
                    "Xin chào! Mình là Não – trung tâm điều khiển cơ thể.",
                    "Mình có khoảng 86 tỷ tế bào thần kinh, xử lý thông tin liên tục để bạn học tập, sáng tạo và ghi nhớ.",
                    "Nicotine có trong thuốc lá và thuốc lá điện tử có thể thay đổi cấu trúc não, đặc biệt nguy hiểm ở tuổi thiếu niên vì ảnh hưởng đến khả năng học tập, trí nhớ và kiểm soát cảm xúc.",
                    "Khi bị tổn thương, bạn sẽ dễ lo âu, trầm cảm, mất tập trung.",
                    "Hãy bảo vệ mình bằng môi trường không khói thuốc."
                ]
            },
            lungs: {
                title: "🫁 Phổi",
                dialogues: [
                    "Xin chào! Mình là Phổi – lá phổi của bạn.",
                    "Mỗi ngày, mình hít và thở ra hơn 6.000 lít không khí để cung cấp oxy và loại bỏ CO₂.",
                    "Khói thuốc chứa tar (hắc ín) sẽ bám chặt vào mình, formaldehyde gây ung thư, và hydrogen cyanide phá hủy lông mao làm giảm khả năng tự làm sạch.",
                    "Hậu quả là viêm phế quản mạn, khí phế thũng và ung thư phổi.",
                    "Hãy để mình hít thở không khí trong lành nhé!"
                ]
            },
            liver: {
                title: "🩸 Gan",
                dialogues: [
                    "Xin chào! Mình là Gan – nhà máy lọc máu của cơ thể.",
                    "Mình chuyển hóa dinh dưỡng, sản xuất protein và loại bỏ độc tố.",
                    "Hóa chất độc trong thuốc lá, như arsenic và benzene, sẽ làm mình bị viêm, xơ gan, thậm chí ung thư gan.",
                    "Hãy bảo vệ mình bằng chế độ ăn lành mạnh, hạn chế đồ uống có cồn và tránh xa khói thuốc."
                ]
            },
            stomach: {
                title: "🫃 Dạ dày",
                dialogues: [
                    "Chào bạn! Mình là Dạ dày – nơi tiêu hóa và nghiền nát thức ăn.",
                    "Khói thuốc kích thích tăng tiết acid dịch vị, gây viêm loét dạ dày – tá tràng và cản trở hấp thu dinh dưỡng.",
                    "Nicotine còn làm giảm lưu lượng máu đến ni-mạc dạ dày, khiến vết loét lâu lành.",
                    "Hãy ăn uống điều độ và tránh xa thuốc lá để mình làm việc hiệu quả."
                ]
            },
            kidney: {
                title: "🫘 Thận",
                dialogues: [
                    "Xin chào! Mình là Thận – bộ lọc máu và điều hòa nước của cơ thể.",
                    "Nicotine và các kim loại nặng như cadmium từ khói thuốc sẽ làm hỏng các đơn vị lọc của mình (nephron), dẫn đến suy thận.",
                    "Một khi suy giảm chức năng, mình không thể hồi phục hoàn toàn.",
                    "Hãy uống đủ nước và tránh các chất độc để bảo vệ mình."
                ]
            },
            immune: {
                title: "🛡️ Hệ miễn dịch",
                dialogues: [
                    "Xin chào! Mình là Hệ miễn dịch – lá chắn của cơ thể.",
                    "Mình bảo vệ bạn khỏi vi khuẩn, virus và tế bào bất thường.",
                    "Khói thuốc làm mình yếu đi, khiến cơ thể dễ bị nhiễm trùng và giảm khả năng chống ung thư.",
                    "Một cơ thể không khói thuốc sẽ giúp mình mạnh mẽ hơn để bảo vệ bạn."
                ]
            },
            skin: {
                title: "👩 Da",
                dialogues: [
                    "Chào bạn! Mình là Da – lớp bảo vệ bên ngoài của cơ thể.",
                    "Khói thuốc làm giảm collagen và elastin, khiến mình nhanh lão hóa, xuất hiện nếp nhăn và vết nám.",
                    "Nicotine còn làm giảm lưu lượng máu dưới da, khiến da xỉn màu.",
                    "Hãy yêu thương mình bằng cách sống lành mạnh và không hút thuốc."
                ]
            }
        };

        let currentDialogue = null;
        let currentDialogueIndex = 0;

        // --- Screen Management ---
        function showScreen(screenId) {
            document.querySelectorAll('[id$="Screen"], [id$="Intro"], [id$="Popup"]').forEach(el => {
                if (!el.id.includes('Popup')) { // Don't hide popups when changing screens
                    el.classList.add('hidden');
                }
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function showInstructions() { showScreen('instructionScreen'); }
        function showGuide() { showScreen('instructionScreen'); }
        function startGame() { 
            showScreen('gameScreen');
            initializeGame();
        }
        function backToTitle() { showScreen('titleScreen'); }
        
        function showQuizIntro() {
            showScreen('quizIntroScreen');
        }

        function startQuizGame() {
            showScreen('part3Screen');
            initializeQuiz();
        }

        function backToStart() { // For part 2
            gameState.isPlaying = false;
            showScreen('titleScreen');
        }


        function showProjectInfo() {
            document.getElementById('projectInfoPopup').classList.remove('hidden');
        }

        function closeProjectInfoPopup() {
            document.getElementById('projectInfoPopup').classList.add('hidden');
        }
        
        function showGuidePopup() {
            document.getElementById('guidePopup').classList.remove('hidden');
        }

        function closeGuidePopup() {
            document.getElementById('guidePopup').classList.add('hidden');
        }

        // --- Part 1: Exploration Game ---
        function initializeGame() {
            visitedOrgans.clear();
            nearOrgan = null;
            characterPosition = { x: 30, y: 420 };
            
            const character = document.getElementById('character');
            character.style.left = characterPosition.x + 'px';
            character.style.top = characterPosition.y + 'px';
            
            document.querySelectorAll('.organ-interactive').forEach(organ => {
                organ.classList.remove('near-character');
                organ.style.opacity = '1';
                organ.style.visibility = 'visible';
                organ.style.animation = '';
                organ.querySelector('.interaction-hint').classList.remove('show');
            });
            
            updateProgress();
            document.getElementById('gameArea').focus();
        }

        function moveCharacter(x, y) {
            const gameArea = document.getElementById('gameArea');
            const character = document.getElementById('character');
            
            const maxX = gameArea.offsetWidth - 60;
            // Giới hạn di chuyển để không che thanh tiến độ
            const maxY = gameArea.offsetHeight - 120; // Trừ kích thước nhân vật (60) và khu vực thanh tiến độ (60)
            
            characterPosition.x = Math.max(20, Math.min(x, maxX));
            characterPosition.y = Math.max(20, Math.min(y, maxY));
            
            AudioSystem.playMoveSound();
            
            character.classList.add('moving');
            character.style.left = characterPosition.x + 'px';
            character.style.top = characterPosition.y + 'px';
            
            createMovementParticles(characterPosition.x + 30, characterPosition.y + 40);
            
            setTimeout(() => character.classList.remove('moving'), 500);
            
            checkNearOrgan();
        }

        function createMovementParticles(x, y) {
            const gameArea = document.getElementById('gameArea');
            for (let i = 0; i < 3; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: absolute; left: ${x + (Math.random() - 0.5) * 20}px; top: ${y + (Math.random() - 0.5) * 20}px;
                    width: 4px; height: 4px; background: radial-gradient(circle, rgba(59, 130, 246, 0.8), transparent);
                    border-radius: 50%; pointer-events: none; z-index: 5; animation: particleFade 1s ease-out forwards;`;
                gameArea.appendChild(particle);
                setTimeout(() => particle.remove(), 1000);
            }
        }

        function checkNearOrgan() {
            let currentNearOrgan = null;
            const interactionDistance = 80;
            
            for (const [organName, pos] of Object.entries(organPositions)) {
                const distance = Math.hypot(characterPosition.x - (pos.x + pos.width/2), characterPosition.y - (pos.y + pos.height/2));
                if (distance < interactionDistance) {
                    currentNearOrgan = organName;
                    break;
                }
            }
            
            if (currentNearOrgan !== nearOrgan) {
                if (nearOrgan) {
                    const oldOrgan = document.getElementById(nearOrgan + '-organ');
                    oldOrgan.classList.remove('near-character');
                    oldOrgan.querySelector('.interaction-hint').classList.remove('show');
                }
                if (currentNearOrgan && !visitedOrgans.has(currentNearOrgan)) {
                    const newOrgan = document.getElementById(currentNearOrgan + '-organ');
                    newOrgan.classList.add('near-character');
                    newOrgan.querySelector('.interaction-hint').classList.add('show');
                }
                nearOrgan = currentNearOrgan;
            }
        }

        function interactWithOrgan() {
            if (nearOrgan && !visitedOrgans.has(nearOrgan)) {
                showOrganInfo(nearOrgan);
            }
        }

        function showOrganInfo(organType) {
            if (visitedOrgans.has(organType)) return;
            AudioSystem.playInteractSound();
            currentDialogue = organType;
            currentDialogueIndex = 0;
            showDialogue();
            visitedOrgans.add(organType);
            updateProgress();
            const organ = document.getElementById(organType + '-organ');
            organ.classList.remove('near-character');
            organ.querySelector('.interaction-hint').classList.remove('show');
        }

        function showDialogue() {
            if (!currentDialogue) return;
            const data = organData[currentDialogue];
            const currentText = data.dialogues[currentDialogueIndex];
            document.getElementById('organContent').innerHTML = `
                <div class="text-center">
                    <div class="flex items-center justify-center mb-4">
                        <div class="text-3xl mr-2">${data.title.split(' ')[0]}</div>
                        <h3 class="text-xl font-bold text-gray-800">${data.title.split(' ')[1]}</h3>
                    </div>
                    <div class="bg-blue-50 rounded-xl p-4 mb-4">
                        <p class="text-gray-700 leading-relaxed">${currentText}</p>
                    </div>
                    <div class="flex items-center justify-center space-x-2 text-sm text-gray-500">
                        <span>${currentDialogueIndex + 1}/${data.dialogues.length}</span>
                        <div class="w-20 bg-gray-200 rounded-full h-1">
                            <div class="bg-blue-500 h-1 rounded-full transition-all duration-300" style="width: ${((currentDialogueIndex + 1) / data.dialogues.length) * 100}%"></div>
                        </div>
                    </div>
                </div>`;
            document.getElementById('dialogueButton').textContent = currentDialogueIndex < data.dialogues.length - 1 ? 'Tiếp tục →' : 'Hoàn thành ✓';
            document.getElementById('organPopup').classList.remove('hidden');
        }

        function nextDialogue() {
            if (!currentDialogue) return;
            const data = organData[currentDialogue];
            if (currentDialogueIndex < data.dialogues.length - 1) {
                currentDialogueIndex++;
                showDialogue();
            } else {
                closeOrganPopup();
            }
        }

        function closeOrganPopup() {
            document.getElementById('organPopup').classList.add('hidden');
            AudioSystem.playOrganCompleteSound();
            if (currentDialogue) {
                const organElement = document.getElementById(currentDialogue + '-organ');
                if (organElement) {
                    organElement.style.animation = 'organDisappear 1.5s ease-out forwards';
                    createOrganDisappearEffect(organElement);
                    setTimeout(() => {
                        organElement.style.visibility = 'hidden';
                        organElement.style.opacity = '0';
                    }, 1500);
                }
            }
            currentDialogue = null;
        }

        function createOrganDisappearEffect(organElement) {
            const rect = organElement.getBoundingClientRect();
            const gameArea = document.getElementById('gameArea');
            const gameRect = gameArea.getBoundingClientRect();
            const x = rect.left - gameRect.left + rect.width / 2;
            const y = rect.top - gameRect.top + rect.height / 2;
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                const angle = (i / 12) * Math.PI * 2;
                const distance = 80 + Math.random() * 40;
                particle.style.cssText = `
                    position: absolute; left: ${x}px; top: ${y}px; width: 8px; height: 8px;
                    background: radial-gradient(circle, #ffd700, #ff6b6b, #4ecdc4); border-radius: 50%;
                    pointer-events: none; z-index: 25; box-shadow: 0 0 15px #ffd700;
                    animation: particleExplode 1.5s ease-out forwards;
                    --end-x: ${x + Math.cos(angle) * distance}px; --end-y: ${y + Math.sin(angle) * distance}px;`;
                gameArea.appendChild(particle);
                setTimeout(() => particle.remove(), 1500);
            }
        }

        function updateProgress() {
            const progress = visitedOrgans.size;
            const total = 8;
            const percentage = (progress / total) * 100;
            document.getElementById('progressText').textContent = `${progress}/${total}`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
            if (progress === total) {
                totalScore = 100; // Part 1 score
                setTimeout(() => showPart1CompletePopup(), 2000);
            }
        }

        function showPart1CompletePopup() {
            AudioSystem.playPart1CompleteSound();
            document.getElementById('part1PopupScore').textContent = `${totalScore}/100`;
            document.getElementById('part1CompletePopup').classList.remove('hidden');
        }

        function proceedToPart2() {
            document.getElementById('part1CompletePopup').classList.add('hidden');
            showScreen('part2Intro');
        }
        function closePart1Popup() { document.getElementById('part1CompletePopup').classList.add('hidden'); }

        // --- Part 2: Shooter Game ---
        let gameState = {};
        const toxinTypes = [
            { emoji: '🧪', name: 'Benzene', color: 'text-purple-500', points: 25, category: 'Chất gây ung thư', info: 'Gây ung thư máu (bạch cầu) và tổn thương tủy xương.' },
            { emoji: '⚗️', name: 'Formaldehyde', color: 'text-purple-400', points: 30, category: 'Chất gây ung thư', info: 'Chất bảo quản xác chết! Gây ung thư mũi, họng.' },
            { emoji: '☢️', name: 'Arsenic', color: 'text-purple-600', points: 35, category: 'Chất gây ung thư', info: 'Chất độc chuột! Gây ung thư da, phổi, gan.' },
            { emoji: '⚡', name: 'Nicotine', color: 'text-yellow-500', points: 15, category: 'Chất độc thần kinh', info: 'Gây nghiện mạnh, tăng nhịp tim, huyết áp.' },
            { emoji: '💨', name: 'Carbon Monoxide', color: 'text-yellow-400', points: 20, category: 'Chất độc thần kinh', info: 'Thay thế oxy trong máu, gây thiếu oxy não và tim.' },
            { emoji: '🌫️', name: 'Tar (Hắc ín)', color: 'text-gray-500', points: 20, category: 'Phá hủy phổi', info: 'Bám chặt vào phổi, gây ung thư và làm đen phổi.' },
            { emoji: '💀', name: 'Hydrogen Cyanide', color: 'text-gray-600', points: 40, category: 'Phá hủy phổi', info: 'Phá hủy lông mao phổi, ngăn tế bào dùng oxy.' },
            { emoji: '💨', name: 'Diacetyl', color: 'text-blue-500', points: 25, category: 'Chất độc trong Vape', info: 'Gây "bệnh phổi bỏng ngô" - xơ hóa phổi không hồi phục.' },
            { emoji: '🔩', name: 'Kim loại nặng', color: 'text-blue-400', points: 20, category: 'Chất độc trong Vape', info: 'Chì, niken từ cuộn dây nung nóng, gây tổn thương não, thận.' },
            { emoji: '🔬', name: 'Hạt siêu nhỏ', color: 'text-green-500', points: 35, category: 'Hạt siêu nhỏ', info: 'Xâm nhập sâu vào máu, gây viêm và bệnh tim mạch.' }
        ];

        const powerUpTypes = [
            { type: 'double-shot', emoji: '🥈', duration: 10000 },
            { type: 'bomb', emoji: '💥', duration: 0 } // Instant
        ];

        function startPart2Game() {
            showScreen('part2Screen');
            initializePart2();
        }

        function initializePart2() {
            gameState = {
                isPlaying: true, isPaused: false, score: 0, health: 3, maxHealth: 3,
                heroPosition: 50, bullets: [], toxins: [], powerUps: [],
                lastShot: 0,
                wave: 0,
                waveDirection: 1,
                waveSpeedX: 0.5,
                goalReached: false,
                bulletLevel: 1,
                powerUpTimeout: null
            };
            AudioSystem.playGameAmbient();
            updateGameDisplay();
            startNextWave();
            startGameLoop();
            document.getElementById('gameCanvas').focus();
        }
        
        function startNextWave() {
            gameState.wave++;
            gameState.bullets.forEach(b => document.getElementById('bullet-' + b.id)?.remove());
            gameState.bullets = [];

            const rows = 2 + Math.floor(gameState.wave / 2);
            const cols = 6 + gameState.wave;
            const waveWidth = cols * 50;
            const startX = (document.getElementById('gameCanvas').offsetWidth - waveWidth) / 2;

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const toxinType = toxinTypes[Math.floor(Math.random() * toxinTypes.length)];
                    const toxin = {
                        id: Date.now() + Math.random(),
                        x: startX + c * 50,
                        y: 50 + r * 50,
                        type: toxinType
                    };
                    gameState.toxins.push(toxin);
                    
                    const toxinElement = document.createElement('div');
                    toxinElement.id = 'toxin-' + toxin.id;
                    toxinElement.className = `absolute text-4xl ${toxin.type.color}`;
                    toxinElement.style.cssText = `left: ${toxin.x}px; top: ${toxin.y}px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4)); z-index: 15; transition: all 0.1s linear;`;
                    toxinElement.textContent = toxin.type.emoji;
                    document.getElementById('toxinsContainer').appendChild(toxinElement);
                }
            }
            gameState.waveSpeedX = 0.5 + gameState.wave * 0.1;
        }

        function updateGameDisplay() {
            document.getElementById('scoreDisplay').textContent = gameState.score;
            const healthIcons = ['❤️', '🧠', '🫁'];
            let healthDisplay = Array.from({length: gameState.maxHealth}, (_, i) => i < gameState.health ? healthIcons[i] : '💀').join('');
            document.getElementById('healthDisplay').textContent = healthDisplay;
            document.getElementById('hero').style.left = gameState.heroPosition + '%';
        }

        function startGameLoop() {
            if (!gameState.isPlaying || gameState.isPaused) return;
            
            moveToxins();
            moveBullets();
            movePowerUps();
            checkCollisions();
            
            if (gameState.toxins.length === 0) {
                startNextWave();
            }
            
            if (gameState.score >= 5000 && !gameState.goalReached) {
                gameState.goalReached = true;
                gameState.isPaused = true;
                document.getElementById('scoreGoalPopup').classList.remove('hidden');
                return;
            }

            if (gameState.health <= 0) {
                endGameAndProceedToQuiz();
                return;
            }
            
            requestAnimationFrame(startGameLoop);
        }

        function shootBullet() {
            const now = Date.now();
            if (now - gameState.lastShot < 300) return; 
            gameState.lastShot = now;
            AudioSystem.playShootSound();
            const heroRect = document.getElementById('hero').getBoundingClientRect();
            const canvasRect = document.getElementById('gameCanvas').getBoundingClientRect();
            const startX = heroRect.left - canvasRect.left + heroRect.width / 2;
            const startY = heroRect.top - canvasRect.top;

            const createBullet = (offsetX, offsetY) => {
                const bullet = {
                    id: Date.now() + Math.random(),
                    x: startX + offsetX,
                    y: startY + offsetY,
                    speed: 10
                };
                gameState.bullets.push(bullet);
                
                const el = document.createElement('div');
                el.id = 'bullet-' + bullet.id;
                el.style.cssText = `position: absolute; left: ${bullet.x - 3}px; top: ${bullet.y}px; width: 6px; height: 24px; background: linear-gradient(to top, #44aaff, #ffffff); border-radius: 3px; box-shadow: 0 0 12px #44aaff; z-index: 20;`;
                document.getElementById('bulletsContainer').appendChild(el);
            };

            if (gameState.bulletLevel === 1) {
                createBullet(0, 0);
            } else if (gameState.bulletLevel >= 2) {
                createBullet(-10, 0);
                createBullet(10, 0);
            }
        }

        function moveBullets() {
            gameState.bullets = gameState.bullets.filter(bullet => {
                bullet.y -= bullet.speed;
                const el = document.getElementById('bullet-' + bullet.id);
                if (bullet.y < -30) {
                    el?.remove();
                    return false;
                }
                if (el) {
                    el.style.top = bullet.y + 'px';
                }
                return true;
            });
        }

        function moveToxins() {
            let reverse = false;
            const gameCanvas = document.getElementById('gameCanvas');
            const canvasWidth = gameCanvas.offsetWidth;

            for(const toxin of gameState.toxins) {
                toxin.x += gameState.waveSpeedX * gameState.waveDirection;
                if (toxin.x <= 10 || toxin.x >= canvasWidth - 40) {
                    reverse = true;
                }
            }

            if (reverse) {
                gameState.waveDirection *= -1;
                for(const toxin of gameState.toxins) {
                    toxin.y += 20; // Move down
                }
            }
            
            // Update DOM
            for(const toxin of gameState.toxins) {
                const el = document.getElementById('toxin-' + toxin.id);
                if(el) {
                    el.style.left = toxin.x + 'px';
                    el.style.top = toxin.y + 'px';
                }
            }
        }
        
        function checkCollisions() {
            // Bullet-Toxin Collisions
            for (let i = gameState.bullets.length - 1; i >= 0; i--) {
                const bullet = gameState.bullets[i];
                for (let j = gameState.toxins.length - 1; j >= 0; j--) {
                    const toxin = gameState.toxins[j];
                    if (Math.hypot(bullet.x - (toxin.x + 25), bullet.y - (toxin.y + 25)) < 35) {
                        createExplosion(toxin.x + 25, toxin.y + 25);
                        showToxinInfo(toxin.type);
                        gameState.score += toxin.type.points;
                        document.getElementById('toxin-' + toxin.id)?.remove();
                        gameState.toxins.splice(j, 1);
                        document.getElementById('bullet-' + bullet.id)?.remove();
                        gameState.bullets.splice(i, 1);
                        updateGameDisplay();
                        if (Math.random() < 0.15) { // 15% chance to drop power-up
                            spawnPowerUp(toxin.x, toxin.y);
                        }
                        break; 
                    }
                }
            }

            // Toxin-Hero Collisions
            const heroRect = document.getElementById('hero').getBoundingClientRect();
            const canvasRect = document.getElementById('gameCanvas').getBoundingClientRect();
            const heroX = heroRect.left - canvasRect.left + heroRect.width / 2;
            const heroY = heroRect.top - canvasRect.top + heroRect.height / 2;
            for (let i = gameState.toxins.length - 1; i >= 0; i--) {
                const toxin = gameState.toxins[i];
                 if (Math.hypot(heroX - (toxin.x + 25), heroY - (toxin.y + 25)) < 40) {
                    createHitEffect(heroX, heroY);
                    document.getElementById('toxin-' + toxin.id)?.remove();
                    gameState.toxins.splice(i, 1);
                    takeDamage();
                }
            }

            // PowerUp-Hero Collisions
            for (let i = gameState.powerUps.length - 1; i >= 0; i--) {
                const powerUp = gameState.powerUps[i];
                if (Math.hypot(heroX - (powerUp.x + 20), heroY - (powerUp.y + 20)) < 40) {
                    activatePowerUp(powerUp.type);
                    document.getElementById('powerup-' + powerUp.id)?.remove();
                    gameState.powerUps.splice(i, 1);
                }
            }
        }

        function createExplosion(x, y) {
            AudioSystem.playExplosionSound();
            const explosion = document.createElement('div');
            explosion.className = 'absolute text-4xl pointer-events-none';
            explosion.style.cssText = `left: ${x}px; top: ${y}px; z-index: 30; animation: explosionFade 0.5s ease-out forwards; transform: translate(-50%, -50%);`;
            explosion.textContent = '💥';
            document.getElementById('explosionsContainer').appendChild(explosion);
            setTimeout(() => explosion.remove(), 500);
        }

        function createHitEffect(x, y) {
            AudioSystem.playHitSound();
            const hitEffect = document.createElement('div');
            hitEffect.className = 'absolute text-5xl pointer-events-none';
            hitEffect.style.cssText = `left: ${x - 25}px; top: ${y - 25}px; z-index: 35; animation: hitEffectFade 0.8s ease-out forwards;`;
            hitEffect.textContent = '💔';
            document.getElementById('explosionsContainer').appendChild(hitEffect);
            const heroElement = document.getElementById('hero');
            heroElement.style.animation = 'heroShake 0.5s ease-in-out';
            setTimeout(() => {
                hitEffect.remove();
                heroElement.style.animation = '';
            }, 800);
        }

        function showToxinInfo(toxinType) {
            const popup = document.createElement('div');
            popup.className = 'fixed top-4 right-4 bg-gradient-to-br from-red-900 to-yellow-900 text-white p-5 rounded-2xl shadow-2xl border-2 border-red-400/60 max-w-sm z-50 transform translate-x-full backdrop-blur-lg';
            popup.style.animation = 'slideInRight 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards, slideOutRight 0.4s ease-in 2.6s forwards';
            popup.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="text-4xl animate-pulse">${toxinType.emoji}</div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-bold text-lg text-white">${toxinType.name}</h4>
                            <div class="text-sm text-yellow-300 font-bold">+${toxinType.points} điểm</div>
                        </div>
                        <p class="text-sm text-gray-100 leading-tight">${toxinType.info}</p>
                        <div class="mt-3 w-full bg-black/30 rounded-full h-1"><div class="bg-gradient-to-r from-yellow-400 to-red-500 h-1 rounded-full animate-countdown"></div></div>
                    </div>
                </div>`;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 3000);
        }

        function takeDamage() {
            gameState.health--;
            const healthDisplay = document.getElementById('healthDisplay');
            healthDisplay.style.animation = 'healthLoss 0.5s ease-in-out';
            setTimeout(() => healthDisplay.style.animation = '', 500);
            updateGameDisplay();
        }

        function endGameAndProceedToQuiz() {
            gameState.isPlaying = false;
            AudioSystem.playPart1CompleteSound(); 
            
            if (gameState.score >= 5000) {
                document.getElementById('transitionTitle').textContent = "Chiến thắng!";
                document.getElementById('transitionMessage').innerHTML = `Bạn đã đạt ${gameState.score} điểm và bảo vệ thành công cơ thể!<br>Giờ hãy kiểm tra kiến thức của mình.`;
            } else {
                document.getElementById('transitionTitle').textContent = "Nhiệm vụ chưa hoàn thành!";
                document.getElementById('transitionMessage').innerHTML = `Bạn đã chiến đấu dũng cảm nhưng cơ thể đã bị tổn thương.<br>Hãy củng cố kiến thức để chiến đấu tốt hơn!`;
            }

            showScreen('transitionPopup');

            document.getElementById('bulletsContainer').innerHTML = '';
            document.getElementById('toxinsContainer').innerHTML = '';
            document.getElementById('explosionsContainer').innerHTML = '';
        }

        function continuePlaying() {
            document.getElementById('scoreGoalPopup').classList.add('hidden');
            gameState.isPaused = false;
            startGameLoop(); 
        }

        function proceedToQuizFromScore() {
            document.getElementById('scoreGoalPopup').classList.add('hidden');
            endGameAndProceedToQuiz();
        }
        
        function startQuizFromTransition() {
            document.getElementById('transitionPopup').classList.add('hidden');
            showScreen('quizIntroScreen');
        }

        function closeTransitionPopup() {
            document.getElementById('transitionPopup').classList.add('hidden');
            backToTitle();
        }

        function restartPart2() {
            document.getElementById('gameOverPopup').classList.add('hidden');
            initializePart2();
        }

        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            document.getElementById('pauseButton').textContent = gameState.isPaused ? '▶️ Tiếp tục' : '⏸️ Tạm dừng';
            if (!gameState.isPaused) requestAnimationFrame(startGameLoop);
        }

        function proceedToPart3() {
            document.getElementById('part2CompletePopup').classList.add('hidden');
            showScreen('part3Screen');
            initializeQuiz();
        }
        function closePart2Popup() { document.getElementById('part2CompletePopup').classList.add('hidden'); }
        
        function spawnPowerUp(x, y) {
            const type = powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];
            const powerUp = {
                id: Date.now(),
                x: x,
                y: y,
                type: type,
                speed: 2
            };
            gameState.powerUps.push(powerUp);

            const el = document.createElement('div');
            el.id = 'powerup-' + powerUp.id;
            el.className = 'absolute text-4xl animate-bounce';
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.textContent = type.emoji;
            document.getElementById('powerUpsContainer').appendChild(el);
        }

        function movePowerUps() {
            gameState.powerUps = gameState.powerUps.filter(p => {
                p.y += p.speed;
                const el = document.getElementById('powerup-' + p.id);
                if (p.y > 550) {
                    el?.remove();
                    return false;
                }
                if (el) el.style.top = p.y + 'px';
                return true;
            });
        }

        function activatePowerUp(type) {
            clearTimeout(gameState.powerUpTimeout);
            
            if (type.type === 'bomb') {
                gameState.toxins.forEach(t => {
                    createExplosion(t.x + 25, t.y + 25);
                    document.getElementById('toxin-' + t.id)?.remove();
                });
                gameState.toxins = [];
                return;
            }

            if (type.type === 'double-shot') {
                gameState.bulletLevel = 2;
            }

            gameState.powerUpTimeout = setTimeout(() => {
                gameState.bulletLevel = 1;
            }, type.duration);
        }

        // --- Part 3: Quiz ---
        let quizState = {};
        const quizQuestions = [
            { question: "Thuốc lá thường chứa bao nhiêu chất hóa học độc hại?", answers: ["Khoảng 100 chất", "Khoảng 500 chất", "Hơn 7.000 chất", "Khoảng 50 chất"], correct: 2, explanation: "Thuốc lá chứa hơn 7.000 chất hóa học, trong đó có ít nhất 250 chất độc hại và 70 chất gây ung thư." },
            { question: "Chất nào trong thuốc lá được gọi là 'chất bảo quản xác chết'?", answers: ["Nicotine", "Formaldehyde", "Tar", "Ammonia"], correct: 1, explanation: "Formaldehyde là chất bảo quản xác chết, gây ung thư mũi, họng và kích ứng đường hô hấp." },
            { question: "Nicotine ảnh hưởng đến não bộ như thế nào?", answers: ["Chỉ gây nghiện nhẹ", "Thay đổi cấu trúc não và gây nghiện mạnh", "Không ảnh hưởng gì", "Chỉ ảnh hưởng ở người lớn"], correct: 1, explanation: "Nicotine thay đổi cấu trúc não, đặc biệt nguy hiểm ở tuổi thiếu niên, ảnh hưởng đến khả năng học tập, trí nhớ và kiểm soát cảm xúc." },
            { question: "Thuốc lá điện tử (vape) có an toàn hơn thuốc lá thường không?", answers: ["Có, hoàn toàn an toàn", "Có, an toàn hơn 95%", "Không, vẫn có nhiều chất độc", "Chỉ an toàn cho người trẻ"], correct: 2, explanation: "Thuốc lá điện tử vẫn chứa nicotine, kim loại nặng, diacetyl và các chất độc khác. Không có mức độ 'an toàn' nào!" },
            { question: "Chất nào gây ra 'bệnh phổi bỏng ngô' trong thuốc lá điện tử?", answers: ["Nicotine", "Diacetyl", "PG/VG", "Hương liệu"], correct: 1, explanation: "Diacetyl trong hương liệu thuốc lá điện tử gây 'bệnh phổi bỏng ngô' - xơ hóa phổi không hồi phục." },
            { question: "Tim đập bao nhiêu lần mỗi ngày?", answers: ["50.000 lần", "75.000 lần", "100.000 lần", "150.000 lần"], correct: 2, explanation: "Tim đập khoảng 100.000 lần mỗi ngày, bơm hơn 7.500 lít máu để cung cấp oxy cho cơ thể." },
            { question: "Chất nào trong thuốc lá được gọi là 'chất độc chuột'?", answers: ["Benzene", "Arsenic", "Cadmium", "DDT"], correct: 1, explanation: "Arsenic là chất độc chuột, gây ung thư da, phổi, gan và bàng quang khi tích tụ từ thuốc lá." },
            { question: "Phổi hít thở bao nhiêu lít không khí mỗi ngày?", answers: ["3.000 lít", "6.000 lít", "9.000 lít", "12.000 lít"], correct: 1, explanation: "Phổi hít và thở ra hơn 6.000 lít không khí mỗi ngày để cung cấp oxy và loại bỏ CO₂." },
            { question: "Chất phóng xạ nào có trong thuốc lá?", answers: ["Uranium", "Polonium-210", "Radium", "Cesium"], correct: 1, explanation: "Polonium-210 là chất phóng xạ cực độc trong thuốc lá, gây ung thư phổi và các cơ quan khác." },
            { question: "Khói thuốc lá thụ động có nguy hiểm không?", answers: ["Không nguy hiểm", "Chỉ nguy hiểm cho trẻ em", "Rất nguy hiểm cho mọi người", "Chỉ gây khó chịu"], correct: 2, explanation: "Khói thuốc lá thụ động chứa cùng các chất độc, gây ung thư phổi, bệnh tim và nhiều vấn đề sức khỏe khác." },
            { question: "Hạt siêu nhỏ (ultrafine particles) trong khói thuốc có kích thước như thế nào?", answers: ["< 0.1 micron", "< 1 micron", "< 10 micron", "< 100 micron"], correct: 0, explanation: "Hạt siêu nhỏ (<0.1 micron) xâm nhập sâu vào phổi và máu, gây viêm và bệnh tim mạch." },
            { question: "Gan có thể hồi phục sau khi bỏ thuốc lá không?", answers: ["Không thể hồi phục", "Hồi phục một phần", "Hồi phục hoàn toàn", "Chỉ hồi phục ở người trẻ"], correct: 1, explanation: "Gan có thể hồi phục một phần sau khi bỏ thuốc lá, nhưng tổn thương nặng có thể không hồi phục hoàn toàn." },
            { question: "Tuổi nào dễ bị ảnh hưởng não bộ nhất bởi nicotine?", answers: ["Dưới 10 tuổi", "10-18 tuổi", "18-25 tuổi", "Trên 25 tuổi"], correct: 2, explanation: "Não bộ phát triển đến 25 tuổi, nên tuổi 18-25 vẫn rất dễ bị ảnh hưởng bởi nicotine." },
            { question: "Cách tốt nhất để bảo vệ sức khỏe khỏi tác hại của thuốc lá là gì?", answers: ["Hút ít hơn", "Chuyển sang thuốc lá điện tử", "Không bao giờ bắt đầu hút", "Hút thuốc lá nhẹ"], correct: 2, explanation: "Cách tốt nhất là không bao giờ bắt đầu hút thuốc lá. Không có mức độ 'an toàn' nào khi sử dụng thuốc lá!" },
            { question: "Thông điệp quan trọng nhất về thuốc lá là gì?", answers: ["Thuốc lá chỉ hại phổi", "Thuốc lá điện tử an toàn", "Không có mức độ an toàn nào", "Chỉ người lớn mới bị ảnh hưởng"], correct: 2, explanation: "KHÔNG CÓ MỨC ĐỘ 'AN TOÀN' NÀO khi sử dụng thuốc lá hay thuốc lá điện tử. Hãy bảo vệ sức khỏe bằng cách tránh xa hoàn toàn!" }
        ];

        function initializeQuiz() {
            quizState = { currentQuestion: 0, score: 0, correctAnswers: 0, isAnswered: false };
            updateQuizDisplay();
            showQuestion();
        }

        function updateQuizDisplay() {
            document.getElementById('quizScore').textContent = quizState.score;
            document.getElementById('questionProgress').textContent = `${quizState.currentQuestion + 1}/15`;
        }

        function showQuestion() {
            const question = quizQuestions[quizState.currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            const container = document.getElementById('answersContainer');
            container.innerHTML = '';
            question.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'w-full p-4 text-left bg-white hover:bg-blue-50 border-2 border-gray-200 hover:border-blue-300 rounded-xl transition-all duration-300 transform hover:scale-105 hover:shadow-lg';
                button.innerHTML = `<div class="flex items-center space-x-3"><div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center font-bold text-blue-600">${String.fromCharCode(65 + index)}</div><span class="text-gray-800 font-medium">${answer}</span></div>`;
                button.onclick = () => selectAnswer(index, button);
                container.appendChild(button);
            });
            quizState.isAnswered = false;
        }

        function selectAnswer(answerIndex, buttonElement) {
            if (quizState.isAnswered) return;
            quizState.isAnswered = true;
            const question = quizQuestions[quizState.currentQuestion];
            const isCorrect = answerIndex === question.correct;
            
            // Update score
            if (isCorrect) {
                quizState.correctAnswers++;
                quizState.score += 100;
                AudioSystem.playCorrectAnswerSound();
            } else {
                AudioSystem.playWrongAnswerSound();
            }
            updateQuizDisplay();
            
            // Highlight answers
            document.querySelectorAll('#answersContainer button').forEach((btn, index) => {
                btn.disabled = true;
                if (index === question.correct) {
                    btn.className = btn.className.replace('bg-white hover:bg-blue-50 border-gray-200 hover:border-blue-300', 'bg-green-100 border-green-500');
                } else if (index === answerIndex && !isCorrect) {
                    btn.className = btn.className.replace('bg-white hover:bg-blue-50 border-gray-200 hover:border-blue-300', 'bg-red-100 border-red-500');
                }
            });

            // Show result popup
            const popup = document.getElementById('questionResultPopup');
            const popupHeader = document.getElementById('popupHeader');
            const popupTitle = document.getElementById('popupTitle');
            const popupExplanation = document.getElementById('popupExplanation');
            const popupNextButton = document.getElementById('popupNextButton');

            if(isCorrect) {
                popupHeader.className = 'p-4 rounded-t-2xl text-white bg-gradient-to-r from-green-500 to-blue-500';
                popupTitle.textContent = '✅ Chính xác!';
            } else {
                popupHeader.className = 'p-4 rounded-t-2xl text-white bg-gradient-to-r from-red-500 to-orange-500';
                popupTitle.textContent = '✗ Sai rồi!';
            }

            popupExplanation.textContent = question.explanation;

            if (quizState.currentQuestion < quizQuestions.length - 1) {
                popupNextButton.textContent = 'Câu tiếp theo →';
            } else {
                popupNextButton.textContent = 'Xem kết quả 🏆';
            }
            
            popup.classList.remove('hidden');
        }

        function closeQuestionResultPopup() {
            document.getElementById('questionResultPopup').classList.add('hidden');
            if (quizState.currentQuestion < quizQuestions.length - 1) {
                nextQuestion();
            } else {
                showQuizResult();
            }
        }

        function nextQuestion() {
            quizState.currentQuestion++;
            showQuestion();
            updateQuizDisplay();
        }

        function showQuizResult() {
            showScreen('quizResultScreen');
            AudioSystem.playQuizCompleteSound();
            const accuracy = Math.round((quizState.correctAnswers / quizQuestions.length) * 100);
            document.getElementById('finalQuizScore').textContent = quizState.score;
            document.getElementById('finalCorrect').textContent = `${quizState.correctAnswers}/${quizQuestions.length}`;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
            
            let resultIcon, resultTitle, resultMessage, finalMessage;
            if (accuracy >= 90) {
                resultIcon = '🏆'; resultTitle = 'Xuất sắc!'; resultMessage = 'Bạn đã nắm vững kiến thức về tác hại của thuốc lá!';
                finalMessage = `<div class="text-center"><div class="text-4xl mb-3">🌟</div><h3 class="text-xl font-bold text-green-800 mb-3">Bạn là Đại sứ Sức khỏe!</h3><p class="text-gray-700 mb-4">Hãy chia sẻ thông điệp: <strong>"Không có mức độ an toàn nào khi sử dụng thuốc lá!"</strong></p></div>`;
            } else if (accuracy >= 70) {
                resultIcon = '👍'; resultTitle = 'Tốt lắm!'; resultMessage = 'Bạn đã hiểu được nhiều kiến thức quan trọng.';
                finalMessage = `<div class="text-center"><div class="text-4xl mb-3">📚</div><h3 class="text-xl font-bold text-blue-800 mb-3">Tiếp tục học hỏi!</h3><p class="text-gray-700 mb-4">Hãy nhớ: <strong>Không có mức độ "an toàn" nào!</strong></p></div>`;
            } else {
                resultIcon = '💪'; resultTitle = 'Cần cố gắng thêm!'; resultMessage = 'Hãy xem lại các kiến thức về tác hại của thuốc lá.';
                finalMessage = `<div class="text-center"><div class="text-4xl mb-3">🔄</div><h3 class="text-xl font-bold text-orange-800 mb-3">Đừng bỏ cuộc!</h3><p class="text-gray-700 mb-4">Điều quan trọng nhất: <strong>Tránh xa thuốc lá và thuốc lá điện tử!</strong></p></div>`;
            }
            document.getElementById('resultIcon').textContent = resultIcon;
            document.getElementById('resultTitle').textContent = resultTitle;
            document.getElementById('resultMessage').textContent = resultMessage;
            document.getElementById('finalMessage').innerHTML = finalMessage;
        }

        function restartQuiz() {
            showScreen('quizIntroScreen');
        }

        // --- Audio System ---
        const AudioSystem = {
            audioContext: null, masterVolume: 0.3,
            init() { try { this.audioContext = new (window.AudioContext || window.webkitAudioContext)(); } catch (e) { console.warn('Web Audio API not supported'); } },
            createTone(freq, dur, type = 'sine', vol = 0.3) {
                if (!this.audioContext) return;
                const osc = this.audioContext.createOscillator();
                const gain = this.audioContext.createGain();
                osc.connect(gain);
                gain.connect(this.audioContext.destination);
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.audioContext.currentTime);
                gain.gain.setValueAtTime(0, this.audioContext.currentTime);
                gain.gain.linearRampToValueAtTime(vol * this.masterVolume, this.audioContext.currentTime + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + dur);
                osc.start();
                osc.stop(this.audioContext.currentTime + dur);
            },
            createChord(freqs, dur, type, vol) { freqs.forEach(f => this.createTone(f, dur, type, vol)); },
            createNoise(dur, vol = 0.1) {
                if (!this.audioContext) return;
                const bufferSize = this.audioContext.sampleRate * dur;
                const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
                const source = this.audioContext.createBufferSource();
                const gain = this.audioContext.createGain();
                source.buffer = buffer;
                source.connect(gain);
                gain.connect(this.audioContext.destination);
                gain.gain.setValueAtTime(vol * this.masterVolume, this.audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + dur);
                source.start();
            },
            playMoveSound() { this.createTone(200, 0.1, 'square', 0.1); },
            playInteractSound() { this.createChord([523, 659, 784], 0.3, 'sine', 0.2); },
            playOrganCompleteSound() { [523, 659, 784, 1047].forEach((f, i) => setTimeout(() => this.createTone(f, 0.2 + i*0.1, 'sine', 0.3), i * 100)); },
            playPart1CompleteSound() { [523, 659, 784, 1047, 1319].forEach((f, i) => setTimeout(() => this.createTone(f, 0.5, 'triangle', 0.4), i * 150)); },
            playShootSound() { this.createTone(800, 0.1, 'square', 0.2); setTimeout(() => this.createTone(1200, 0.05, 'square', 0.15), 50); },
            playExplosionSound() { this.createNoise(0.3, 0.3); this.createTone(100, 0.2, 'sawtooth', 0.4); },
            playHitSound() { this.createTone(150, 0.5, 'sawtooth', 0.4); },
            playLevelUpSound() { [262, 330, 392, 523, 659].forEach((f, i) => setTimeout(() => this.createTone(f, 0.3, 'triangle', 0.3), i * 100)); },
            playGameOverSound() { [523, 466, 415, 349, 294].forEach((f, i) => setTimeout(() => this.createTone(f, 0.6, 'triangle', 0.3), i * 200)); },
            playCorrectAnswerSound() { this.createChord([523, 659, 784], 0.4, 'sine', 0.3); },
            playWrongAnswerSound() { this.createTone(200, 0.6, 'sawtooth', 0.3); },
            playQuizCompleteSound() { [523, 523, 523, 415, 466, 523, 466, 523].forEach((f, i) => setTimeout(() => this.createTone(f, 0.2, 'triangle', 0.3), i * 150)); },
            playGameAmbient() { /* Logic to play ambient sound */ },
            playClickSound() { this.createTone(1000, 0.1, 'square', 0.1); },
            playHoverSound() { this.createTone(800, 0.05, 'sine', 0.05); }
        };

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            // --- Fullscreen Functionality ---
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const fullscreenIconOpen = document.getElementById('fullscreenIconOpen');
            const fullscreenIconClose = document.getElementById('fullscreenIconClose');
            const fullscreenHint = document.getElementById('fullscreenHint');

            fullscreenBtn.addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`Lỗi toàn màn hình: ${err.message}`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            });

            document.addEventListener('fullscreenchange', () => {
                const isFullscreen = !!document.fullscreenElement;
                fullscreenIconOpen.classList.toggle('hidden', isFullscreen);
                fullscreenIconClose.classList.toggle('hidden', !isFullscreen);
                fullscreenHint.classList.toggle('hidden', isFullscreen);
            });

            // --- Other Event Listeners ---
            document.addEventListener('keydown', function(e) {
                if (!document.getElementById('gameScreen').classList.contains('hidden')) {
                    const moveSpeed = 20;
                    let newX = characterPosition.x, newY = characterPosition.y;
                    if (e.key === 'ArrowLeft') newX -= moveSpeed;
                    else if (e.key === 'ArrowRight') newX += moveSpeed;
                    else if (e.key === 'ArrowUp') newY -= moveSpeed;
                    else if (e.key === 'ArrowDown') newY += moveSpeed;
                    else if (e.key === ' ') {
                        e.preventDefault();
                        if (document.getElementById('organPopup').classList.contains('hidden')) {
                            interactWithOrgan();
                        } else {
                            nextDialogue();
                        }
                        return;
                    }
                    if (newX !== characterPosition.x || newY !== characterPosition.y) {
                        moveCharacter(newX, newY);
                    }
                }
                
                if (!document.getElementById('part2Screen').classList.contains('hidden') && gameState.isPlaying && !gameState.isPaused) {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        gameState.heroPosition = Math.max(2, gameState.heroPosition - 4);
                    } else if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        gameState.heroPosition = Math.min(98, gameState.heroPosition + 4);
                    } else if (e.key === ' ') { 
                        e.preventDefault(); 
                        shootBullet(); 
                    }
                    updateGameDisplay();
                }
            });

            document.getElementById('gameArea').addEventListener('click', function(e) {
                const rect = this.getBoundingClientRect();
                moveCharacter(e.clientX - rect.left - 30, e.clientY - rect.top - 30);
            });

            document.addEventListener('click', (e) => (e.target.closest('button')) && AudioSystem.playClickSound());
            document.addEventListener('mouseover', (e) => (e.target.closest('button')) && AudioSystem.playHoverSound());

            document.addEventListener('click', function initAudio() {
                AudioSystem.init();
                document.removeEventListener('click', initAudio);
            }, { once: true });
        });


        // Add CSS for animations not covered by Tailwind
        const styleSheet = document.createElement("style");
        styleSheet.type = "text/css";
        styleSheet.innerText = `
            @keyframes explosionFade { 0% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(2.5); } }
            @keyframes chickenInvadersBullet { 0% { filter: brightness(1.5); } 100% { filter: brightness(2); } }
            @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
            @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
            .animate-countdown { animation: countdown 3s linear forwards; }
            @keyframes countdown { from { width: 100%; } to { width: 0%; } }
            @keyframes hitEffectFade { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(2.5); } }
            @keyframes heroShake { 0%, 100% { transform: translateX(-50%); } 10%, 30% { transform: translateX(-55%) rotate(-2deg); } 20%, 40% { transform: translateX(-45%) rotate(2deg); } }
            @keyframes healthLoss { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); filter: brightness(2); } }
            @keyframes scoreIncrease { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); color: #10b981; } }
            @keyframes organDisappear { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(2) rotate(360deg); filter: blur(10px); } }
            @keyframes particleExplode { from { opacity: 1; transform: translate(0, 0) scale(1); } to { opacity: 0; transform: translate(var(--end-x), var(--end-y)) scale(0.5); } }
            @keyframes toxinGlow { from { filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4)); } to { filter: drop-shadow(0 0 15px #ff6b6b) brightness(1.3); } }
        `;
        document.head.appendChild(styleSheet);
    
// --- Logo visibility helpers ---

</script>

<!-- Flashcard Overlay (isolated via iframe, keeps original game intact) -->
<div id="flashcardOverlay" style="display:none; position:fixed; inset:0; z-index:9999; background:#111;">
    <button onclick="returnToMainGame()" style="position:fixed; top:12px; left:12px; z-index:10000; background:#ffffff; padding:10px 14px; border-radius:10px; border:none; box-shadow:0 2px 8px rgba(0,0,0,0.25); font-weight:700; cursor:pointer;">
        ← Quay lại game chính
    </button>
    <iframe id="flashcardFrame" src="data:text/html;charset=utf-8;base64,PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9InZpIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+Rmxhc2hjYXJkIFBow7JuZyBDaOG7kW5nIFRodeG7kWMgTMOhIC0gR2lhbyBkaeG7h24gbeG7m2k8L3RpdGxlPgogICAgPCEtLSBUb25lLmpzIGZvciBXZWIgQXVkaW8gLS0+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvdG9uZS8xNC43Ljc3L1RvbmUuanMiPjwvc2NyaXB0PgogICAgPHN0eWxlPgogICAgICAgIC8qIEltcG9ydCBHb29nbGUgRm9udCAqLwogICAgICAgIEBpbXBvcnQgdXJsKCdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PUJlK1ZpZXRuYW0rUHJvOndnaHRANDAwOzcwMDs5MDAmZGlzcGxheT1zd2FwJyk7CgogICAgICAgIC8qIEdlbmVyYWwgU3R5bGVzICovCiAgICAgICAgKiB7CiAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgcGFkZGluZzogMDsKICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgICB9CgogICAgICAgIGJvZHkgewogICAgICAgICAgICBmb250LWZhbWlseTogJ0JlIFZpZXRuYW0gUHJvJywgc2Fucy1zZXJpZjsgLyogQXBwbHkgbmV3IGZvbnQgKi8KICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzg5ZjdmZSAwJSwgIzY2YTZmZiAxMDAlKTsKICAgICAgICAgICAgaGVpZ2h0OiAxMDB2aDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGNvbG9yOiAjMzMzOwogICAgICAgIH0KCiAgICAgICAgLyogLS0tIEFuaW1hdGVkIEJhY2tncm91bmQgU1RBUlQgLS0tICovCiAgICAgICAgLmJhY2tncm91bmQtY29udGFpbmVyIHsKICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICAgICAgICB0b3A6IDA7CiAgICAgICAgICAgIGxlZnQ6IDA7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIHotaW5kZXg6IDA7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgfQoKICAgICAgICAuYmFja2dyb3VuZC1wYXJ0aWNsZXMgewogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIHRvcDogMDsKICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICAgICAgcGFkZGluZzogMDsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgIH0KCiAgICAgICAgLmJhY2tncm91bmQtcGFydGljbGVzIGxpIHsKICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgbGlzdC1zdHlsZTogbm9uZTsKICAgICAgICAgICAgd2lkdGg6IDIwcHg7CiAgICAgICAgICAgIGhlaWdodDogMjBweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpOwogICAgICAgICAgICBhbmltYXRpb246IGFuaW1hdGUtcGFydGljbGVzIDI1cyBsaW5lYXIgaW5maW5pdGU7CiAgICAgICAgICAgIGJvdHRvbTogLTE1MHB4OwogICAgICAgIH0KCiAgICAgICAgLmJhY2tncm91bmQtcGFydGljbGVzIGxpOm50aC1jaGlsZCgxKXsgbGVmdDogMjUlOyB3aWR0aDogODBweDsgaGVpZ2h0OiA4MHB4OyBhbmltYXRpb24tZGVsYXk6IDBzOyB9CiAgICAgICAgLmJhY2tncm91bmQtcGFydGljbGVzIGxpOm50aC1jaGlsZCgyKXsgbGVmdDogMTAlOyB3aWR0aDogMjBweDsgaGVpZ2h0OiAyMHB4OyBhbmltYXRpb24tZGVsYXk6IDJzOyBhbmltYXRpb24tZHVyYXRpb246IDEyczsgfQogICAgICAgIC5iYWNrZ3JvdW5kLXBhcnRpY2xlcyBsaTpudGgtY2hpbGQoMyl7IGxlZnQ6IDcwJTsgd2lkdGg6IDIwcHg7IGhlaWdodDogMjBweDsgYW5pbWF0aW9uLWRlbGF5OiA0czsgfQogICAgICAgIC5iYWNrZ3JvdW5kLXBhcnRpY2xlcyBsaTpudGgtY2hpbGQoNCl7IGxlZnQ6IDQwJTsgd2lkdGg6IDYwcHg7IGhlaWdodDogNjBweDsgYW5pbWF0aW9uLWRlbGF5OiAwczsgYW5pbWF0aW9uLWR1cmF0aW9uOiAxOHM7IH0KICAgICAgICAuYmFja2dyb3VuZC1wYXJ0aWNsZXMgbGk6bnRoLWNoaWxkKDUpeyBsZWZ0OiA2NSU7IHdpZHRoOiAyMHB4OyBoZWlnaHQ6IDIwcHg7IGFuaW1hdGlvbi1kZWxheTogMHM7IH0KICAgICAgICAuYmFja2dyb3VuZC1wYXJ0aWNsZXMgbGk6bnRoLWNoaWxkKDYpeyBsZWZ0OiA3NSU7IHdpZHRoOiAxMTBweDsgaGVpZ2h0OiAxMTBweDsgYW5pbWF0aW9uLWRlbGF5OiAzczsgfQogICAgICAgIC5iYWNrZ3JvdW5kLXBhcnRpY2xlcyBsaTpudGgtY2hpbGQoNyl7IGxlZnQ6IDM1JTsgd2lkdGg6IDE1MHB4OyBoZWlnaHQ6IDE1MHB4OyBhbmltYXRpb24tZGVsYXk6IDdzOyB9CiAgICAgICAgLmJhY2tncm91bmQtcGFydGljbGVzIGxpOm50aC1jaGlsZCg4KXsgbGVmdDogNTAlOyB3aWR0aDogMjVweDsgaGVpZ2h0OiAyNXB4OyBhbmltYXRpb24tZGVsYXk6IDE1czsgYW5pbWF0aW9uLWR1cmF0aW9uOiA0NXM7IH0KICAgICAgICAuYmFja2dyb3VuZC1wYXJ0aWNsZXMgbGk6bnRoLWNoaWxkKDkpeyBsZWZ0OiAyMCU7IHdpZHRoOiAxNXB4OyBoZWlnaHQ6IDE1cHg7IGFuaW1hdGlvbi1kZWxheTogMnM7IGFuaW1hdGlvbi1kdXJhdGlvbjogMzVzOyB9CiAgICAgICAgLmJhY2tncm91bmQtcGFydGljbGVzIGxpOm50aC1jaGlsZCgxMCl7IGxlZnQ6IDg1JTsgd2lkdGg6IDE1MHB4OyBoZWlnaHQ6IDE1MHB4OyBhbmltYXRpb24tZGVsYXk6IDBzOyBhbmltYXRpb24tZHVyYXRpb246IDExczsgfQoKICAgICAgICBAa2V5ZnJhbWVzIGFuaW1hdGUtcGFydGljbGVzIHsKICAgICAgICAgICAgMCV7CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCkgcm90YXRlKDBkZWcpOwogICAgICAgICAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgMTAwJXsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMTAwMHB4KSByb3RhdGUoNzIwZGVnKTsKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDA7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyogLS0tIEFuaW1hdGVkIEJhY2tncm91bmQgRU5EIC0tLSAqLwoKICAgICAgICAuYXBwLWNvbnRhaW5lciB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMHZoOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgcGFkZGluZzogMjBweDsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOyAvKiBFbnN1cmUgYXBwIGNvbnRlbnQgaXMgYWJvdmUgYmFja2dyb3VuZCAqLwogICAgICAgICAgICB6LWluZGV4OiAxOwogICAgICAgIH0KCiAgICAgICAgLyogV2VsY29tZSBTY3JlZW4gKi8KICAgICAgICAud2VsY29tZS1zY3JlZW4gewogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIG1heC13aWR0aDogNTAwcHg7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgIH0KCiAgICAgICAgLndlbGNvbWUtY2FyZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC42KTsKICAgICAgICAgICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDI1cHgpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAyNXB4OwogICAgICAgICAgICBwYWRkaW5nOiA0MHB4IDMwcHg7CiAgICAgICAgICAgIGJvcmRlcjogMnB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC44KTsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAyMHB4IDQwcHggcmdiYSgwLDAsMCwwLjEpOwogICAgICAgICAgICBjb2xvcjogIzQ0NDsKICAgICAgICB9CgogICAgICAgIC53ZWxjb21lLWljb24gewogICAgICAgICAgICBmb250LXNpemU6IDRyZW07CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDIwcHg7CiAgICAgICAgICAgIGFuaW1hdGlvbjogYm91bmNlIDJzIGluZmluaXRlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBAa2V5ZnJhbWVzIGJvdW5jZSB7CiAgICAgICAgICAgIDAlLCAyMCUsIDUwJSwgODAlLCAxMDAlIHt0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7fQogICAgICAgICAgICA0MCUge3RyYW5zZm9ybTogdHJhbnNsYXRlWSgtMjBweCk7fQogICAgICAgICAgICA2MCUge3RyYW5zZm9ybTogdHJhbnNsYXRlWSgtMTBweCk7fQogICAgICAgIH0KCiAgICAgICAgLndlbGNvbWUtdGl0bGUgewogICAgICAgICAgICBmb250LXNpemU6IDIuNXJlbTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDkwMDsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTVweDsKICAgICAgICAgICAgY29sb3I6ICMxYTIzN2U7CiAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAtMXB4OwogICAgICAgIH0KCiAgICAgICAgLndlbGNvbWUtc3VidGl0bGUgewogICAgICAgICAgICBmb250LXNpemU6IDEuMXJlbTsKICAgICAgICAgICAgY29sb3I6ICM1NTU7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDMwcHg7CiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjY7CiAgICAgICAgfQoKICAgICAgICAud2VsY29tZS1mZWF0dXJlcyB7CiAgICAgICAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgICAgICAgIGdhcDogMTJweDsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMzBweDsKICAgICAgICB9CgogICAgICAgIC5mZWF0dXJlIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGdhcDogMTJweDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjlyZW07CiAgICAgICAgICAgIHBhZGRpbmc6IDEwcHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC41KTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTJweDsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjcpOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjJzLCBib3gtc2hhZG93IDAuMnM7CiAgICAgICAgfQogICAgICAgIC5mZWF0dXJlOmhvdmVyIHsKICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0ycHgpOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDVweCAxNXB4IHJnYmEoMCwwLDAsMC4xKTsKICAgICAgICB9CgogICAgICAgIC5zdGFydC1idG4gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjZmY3ZTVmLCAjZmViNDdiKTsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIHBhZGRpbmc6IDE1cHggMzBweDsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjFyZW07CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwcHg7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBnYXA6IDEwcHg7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7CiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAxcHg7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMTBweCAyMHB4IHJnYmEoMjU1LCAxMjYsIDk1LCAwLjMpOwogICAgICAgIH0KCiAgICAgICAgLnN0YXJ0LWJ0bjpob3ZlciB7CiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtM3B4KSBzY2FsZSgxLjA1KTsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAxMnB4IDI1cHggcmdiYSgyNTUsIDEyNiwgOTUsIDAuNCk7CiAgICAgICAgfQoKICAgICAgICAvKiBHYW1lIFNjcmVlbiAqLwogICAgICAgIC5nYW1lLXNjcmVlbiB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBtYXgtd2lkdGg6IDcwMHB4OwogICAgICAgICAgICBoZWlnaHQ6IDEwMHZoOwogICAgICAgICAgICBkaXNwbGF5OiBub25lOyAvKiBJbml0aWFsbHkgaGlkZGVuICovCiAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtcm93czogYXV0byAxZnIgYXV0bzsKICAgICAgICAgICAgZ2FwOiAxNXB4OwogICAgICAgICAgICBwYWRkaW5nOiAyMHB4IDA7CiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICB9CgogICAgICAgIC5nYW1lLWhlYWRlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC41KTsKICAgICAgICAgICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEwcHgpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAyMHB4OwogICAgICAgICAgICBwYWRkaW5nOiAyMHB4OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuNik7CiAgICAgICAgICAgIGNvbG9yOiAjNDQ0OwogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICNtdXRlQnRuIHsKICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICB0b3A6IDE1cHg7CiAgICAgICAgICAgIHJpZ2h0OiAxNXB4OwogICAgICAgICAgICBmb250LXNpemU6IDEuNXJlbTsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiBub25lOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIG9wYWNpdHk6IDAuNzsKICAgICAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjJzLCB0cmFuc2Zvcm0gMC4yczsKICAgICAgICB9CiAgICAgICAgI211dGVCdG46aG92ZXIgewogICAgICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CiAgICAgICAgfQoKICAgICAgICAucHJvZ3Jlc3MtYmFyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjEpOwogICAgICAgICAgICBoZWlnaHQ6IDIwcHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE1cHg7CiAgICAgICAgfQoKICAgICAgICAucHJvZ3Jlc3MtZmlsbCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgIzU2YWIyZiwgI2E4ZTA2Myk7CiAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICAgICAgd2lkdGg6IDAlOwogICAgICAgICAgICB0cmFuc2l0aW9uOiB3aWR0aCAwLjhzIGN1YmljLWJlemllcigwLjI1LCAxLCAwLjUsIDEpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5wcm9ncmVzcy1maWxsOjphZnRlciB7CiAgICAgICAgICAgIGNvbnRlbnQ6ICcnOwogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIHRvcDogMDsKICAgICAgICAgICAgcmlnaHQ6IDA7CiAgICAgICAgICAgIGJvdHRvbTogMDsKICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCByZ2JhKDI1NSwyNTUsMjU1LDApIDAlLCByZ2JhKDI1NSwyNTUsMjU1LDAuNSkgNTAlLCByZ2JhKDI1NSwyNTUsMjU1LDApIDEwMCUpOwogICAgICAgICAgICBhbmltYXRpb246IHByb2dyZXNzLXNoaW5lIDJzIGluZmluaXRlOwogICAgICAgIH0KICAgICAgICBAa2V5ZnJhbWVzIHByb2dyZXNzLXNoaW5lIHsKICAgICAgICAgICAgMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTEwMCUpOyB9CiAgICAgICAgICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMTAwJSk7IH0KICAgICAgICB9CgoKICAgICAgICAuc3RhdHMgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC45cmVtOwogICAgICAgICAgICBwYWRkaW5nLXJpZ2h0OiAzMHB4OyAvKiBTcGFjZSBmb3IgbXV0ZSBidXR0b24gKi8KICAgICAgICB9CgogICAgICAgIC5jYXJkLXNlY3Rpb24gewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiAyMHB4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuY2FyZC1pbmZvIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgbWF4LXdpZHRoOiA1MDBweDsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogLTVweDsKICAgICAgICAgICAgY29sb3I6ICMxYTIzN2U7CiAgICAgICAgICAgIHRleHQtc2hhZG93OiAxcHggMXB4IDNweCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMik7CiAgICAgICAgfQoKICAgICAgICAuY2FyZC1oaW50IHsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjlyZW07CiAgICAgICAgICAgIG9wYWNpdHk6IDAuOTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDQwMDsKICAgICAgICB9CgogICAgICAgIC5jYXJkLWNvbnRhaW5lciB7CiAgICAgICAgICAgIHBlcnNwZWN0aXZlOiAxMDAwcHg7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBtYXgtd2lkdGg6IDUwMHB4OwogICAgICAgICAgICBoZWlnaHQ6IDMyMHB4OwogICAgICAgIH0KCiAgICAgICAgLmZsYXNoY2FyZCB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICAgICAgdHJhbnNmb3JtLXN0eWxlOiBwcmVzZXJ2ZS0zZDsKICAgICAgICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuOHMgY3ViaWMtYmV6aWVyKDAuMjUsIDEsIDAuNSwgMSk7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICB9CgogICAgICAgIC5mbGFzaGNhcmQuZmxpcHBlZCB7CiAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlWSgxODBkZWcpOwogICAgICAgIH0KCiAgICAgICAgLmZsYXNoY2FyZC5mYWRlLW91dCB7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFkZU91dCAwLjVzIGVhc2UtaW4tb3V0IGZvcndhcmRzOwogICAgICAgIH0KCiAgICAgICAgQGtleWZyYW1lcyBmYWRlT3V0IHsKICAgICAgICAgICAgZnJvbSB7IHRyYW5zZm9ybTogc2NhbGUoMSkgcm90YXRlWSh2YXIoLS1mbGlwLWFuZ2xlLCAwZGVnKSk7IG9wYWNpdHk6IDE7IH0KICAgICAgICAgICAgdG8geyB0cmFuc2Zvcm06IHNjYWxlKDAuOCkgcm90YXRlWSh2YXIoLS1mbGlwLWFuZ2xlLCAwZGVnKSk7IG9wYWNpdHk6IDA7IH0KICAgICAgICB9CgogICAgICAgIC5mbGFzaGNhcmQuZmFkZS1pbiB7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFkZUluIDAuNXMgZWFzZS1vdXQgZm9yd2FyZHM7CiAgICAgICAgfQoKICAgICAgICBAa2V5ZnJhbWVzIGZhZGVJbiB7CiAgICAgICAgICAgIGZyb20geyB0cmFuc2Zvcm06IHNjYWxlKDAuOCk7IG9wYWNpdHk6IDA7IH0KICAgICAgICAgICAgdG8geyB0cmFuc2Zvcm06IHNjYWxlKDEpOyBvcGFjaXR5OiAxOyB9CiAgICAgICAgfQoKICAgICAgICAuY2FyZC1mYWNlIHsKICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICBiYWNrZmFjZS12aXNpYmlsaXR5OiBoaWRkZW47CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDIwcHg7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIHBhZGRpbmc6IDMwcHg7CiAgICAgICAgICAgIGJvcmRlcjogM3B4IHNvbGlkIHdoaXRlOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGJveC1zaGFkb3cgMC44cyBlYXNlOwogICAgICAgIH0KCiAgICAgICAgLyogLS0tIFRoZW1lIENvbG9ycyBTVEFSVCAtLS0gKi8KICAgICAgICAvKiBEYW5nZXIgVGhlbWUgKFJlZC9PcmFuZ2UpICovCiAgICAgICAgLmNhcmQtZmFjZS5kYW5nZXItdGhlbWUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjZmY2YjZiLCAjZTkxZTYzKTsKICAgICAgICAgICAgYW5pbWF0aW9uLW5hbWU6IGdsb3ctZGFuZ2VyOwogICAgICAgICAgICBhbmltYXRpb24tZHVyYXRpb246IDIuNXM7CiAgICAgICAgICAgIGFuaW1hdGlvbi1pdGVyYXRpb24tY291bnQ6IGluZmluaXRlOwogICAgICAgICAgICBhbmltYXRpb24tZGlyZWN0aW9uOiBhbHRlcm5hdGU7CiAgICAgICAgfQogICAgICAgIC5jYXJkLWZhY2UuZGFuZ2VyLXRoZW1lLmNhcmQtYmFjayB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICNmZjhhNjUsICNmZjcwNDMpOwogICAgICAgIH0KICAgICAgICBAa2V5ZnJhbWVzIGdsb3ctZGFuZ2VyIHsKICAgICAgICAgICAgZnJvbSB7IGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMjU1LDEwNywxMDcsMC40KSwgMCAwIDIwcHggcmdiYSgyMzMsMzAsOTksMC4zKTsgfQogICAgICAgICAgICB0byB7IGJveC1zaGFkb3c6IDAgMCAyNXB4IHJnYmEoMjU1LDEwNywxMDcsMC44KSwgMCAwIDQwcHggcmdiYSgyMzMsMzAsOTksMC42KTsgfQogICAgICAgIH0KCiAgICAgICAgLyogQmVuZWZpdCBUaGVtZSAoR3JlZW4pICovCiAgICAgICAgLmNhcmQtZmFjZS5iZW5lZml0LXRoZW1lIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzU2YWIyZiwgI2E4ZTA2Myk7CiAgICAgICAgICAgIGFuaW1hdGlvbi1uYW1lOiBnbG93LWJlbmVmaXQ7CiAgICAgICAgICAgIGFuaW1hdGlvbi1kdXJhdGlvbjogMi41czsKICAgICAgICAgICAgYW5pbWF0aW9uLWl0ZXJhdGlvbi1jb3VudDogaW5maW5pdGU7CiAgICAgICAgICAgIGFuaW1hdGlvbi1kaXJlY3Rpb246IGFsdGVybmF0ZTsKICAgICAgICB9CiAgICAgICAgLmNhcmQtZmFjZS5iZW5lZml0LXRoZW1lLmNhcmQtYmFjayB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM2NmJiNmEsICM5Y2NjNjUpOwogICAgICAgIH0KICAgICAgICBAa2V5ZnJhbWVzIGdsb3ctYmVuZWZpdCB7CiAgICAgICAgICAgIGZyb20geyBib3gtc2hhZG93OiAwIDAgMTBweCByZ2JhKDg2LDE3MSw0NywwLjQpLCAwIDAgMjBweCByZ2JhKDE2OCwyMjQsOTksMC4zKTsgfQogICAgICAgICAgICB0byB7IGJveC1zaGFkb3c6IDAgMCAyNXB4IHJnYmEoODYsMTcxLDQ3LDAuOCksIDAgMCA0MHB4IHJnYmEoMTY4LDIyNCw5OSwwLjYpOyB9CiAgICAgICAgfQoKICAgICAgICAvKiBJbmZvIFRoZW1lIChCbHVlKSAqLwogICAgICAgIC5jYXJkLWZhY2UuaW5mby10aGVtZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM0OGM2ZWYsICM2Zjg2ZDYpOwogICAgICAgICAgICBhbmltYXRpb24tbmFtZTogZ2xvdy1pbmZvOwogICAgICAgICAgICBhbmltYXRpb24tZHVyYXRpb246IDIuNXM7CiAgICAgICAgICAgIGFuaW1hdGlvbi1pdGVyYXRpb24tY291bnQ6IGluZmluaXRlOwogICAgICAgICAgICBhbmltYXRpb24tZGlyZWN0aW9uOiBhbHRlcm5hdGU7CiAgICAgICAgfQogICAgICAgIC5jYXJkLWZhY2UuaW5mby10aGVtZS5jYXJkLWJhY2sgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjMjliNmY2LCAjNWM2YmMwKTsKICAgICAgICB9CiAgICAgICAgQGtleWZyYW1lcyBnbG93LWluZm8gewogICAgICAgICAgICBmcm9tIHsgYm94LXNoYWRvdzogMCAwIDEwcHggcmdiYSg3MiwxOTgsMjM5LDAuNCksIDAgMCAyMHB4IHJnYmEoMTExLDEzNCwyMTQsMC4zKTsgfQogICAgICAgICAgICB0byB7IGJveC1zaGFkb3c6IDAgMCAyNXB4IHJnYmEoNzIsMTk4LDIzOSwwLjgpLCAwIDAgNDBweCByZ2JhKDExMSwxMzQsMjE0LDAuNik7IH0KICAgICAgICB9CiAgICAgICAgLyogLS0tIFRoZW1lIENvbG9ycyBFTkQgLS0tICovCgogICAgICAgIC5jYXJkLWJhY2sgewogICAgICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZVkoMTgwZGVnKTsKICAgICAgICB9CgogICAgICAgIC5jYXJkLWNvbnRlbnQgeyB3aWR0aDogMTAwJTsgfQoKICAgICAgICAuY2FyZC1mcm9udCAuY2FyZC1jb250ZW50IHsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjZyZW07CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA5MDA7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGdhcDogMTVweDsKICAgICAgICAgICAgdGV4dC1zaGFkb3c6IDBweCAycHggNXB4IHJnYmEoMCwgMCwgMCwgMC40KTsKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuNDsKICAgICAgICB9CgogICAgICAgIC5jYXJkLWJhY2sgLmNhcmQtY29udGVudCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS4xcmVtOwogICAgICAgICAgICBsaW5lLWhlaWdodDogMS43OwogICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgICAgICAgICB0ZXh0LXNoYWRvdzogMHB4IDJweCA1cHggcmdiYSgwLCAwLCAwLCAwLjQpOwogICAgICAgIH0KCiAgICAgICAgLmNhcmQtaWNvbiB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMi44cmVtOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDE1cHggcmdiYSgyNTUsMjU1LDI1NSwwLjUpLCAwcHggMnB4IDVweCByZ2JhKDAsIDAsIDAsIDAuNCk7CiAgICAgICAgfQoKICAgICAgICAuY2FyZC1jYXRlZ29yeSB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgdG9wOiAxNXB4OwogICAgICAgICAgICByaWdodDogMTVweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjIpOwogICAgICAgICAgICBwYWRkaW5nOiA1cHggMTJweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTVweDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjdyZW07CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIENvbnRyb2xzICovCiAgICAgICAgLmdhbWUtY29udHJvbHMgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiAxNXB4OwogICAgICAgICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDEwcHg7CiAgICAgICAgfQoKICAgICAgICAuYnRuIHsKICAgICAgICAgICAgcGFkZGluZzogMTJweCAyNXB4OwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwcHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMXJlbTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlLW91dDsKICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuNXB4OwogICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiA4cHg7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogNHB4IHNvbGlkIHJnYmEoMCwwLDAsMC4yKTsKICAgICAgICB9CgogICAgICAgIC5idG46aG92ZXIgewogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMTBweCAyMHB4IHJnYmEoMCwwLDAsMC4xKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmJ0bjphY3RpdmUgewogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMXB4KTsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbS13aWR0aDogMnB4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuYnRuOmRpc2FibGVkIHsKICAgICAgICAgICAgb3BhY2l0eTogMC42OwogICAgICAgICAgICBjdXJzb3I6IG5vdC1hbGxvd2VkOwogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNhYWE7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6ICM3Nzc7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5idG4tc3VjY2VzcyB7IGJhY2tncm91bmQtY29sb3I6ICMyZWNjNzE7IGJvcmRlci1ib3R0b20tY29sb3I6ICMyN2FlNjA7IH0KICAgICAgICAuYnRuLXdhcm5pbmcgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjM5YzEyOyBib3JkZXItYm90dG9tLWNvbG9yOiAjZDM1NDAwOyB9CiAgICAgICAgLmJ0bi1wcmltYXJ5IHsgYmFja2dyb3VuZC1jb2xvcjogIzM0OThkYjsgYm9yZGVyLWJvdHRvbS1jb2xvcjogIzI5ODBiOTsgfQoKCiAgICAgICAgLyogQ29tcGxldGlvbiBNZXNzYWdlICovCiAgICAgICAgLmNvbXBsZXRpb24tbWVzc2FnZSB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICAgICAgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuNik7CiAgICAgICAgICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxMHB4KTsKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIHotaW5kZXg6IDEwMDA7CiAgICAgICAgICAgIG9wYWNpdHk6IDA7CiAgICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC40cyBlYXNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuY29tcGxldGlvbi1tZXNzYWdlLnNob3cgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgIH0KCiAgICAgICAgLmNvbXBsZXRpb24tY29udGVudCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM1NmFiMmYsICNhOGUwNjMpOwogICAgICAgICAgICBwYWRkaW5nOiA0MHB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAyMHB4OwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMjBweCA0MHB4IHJnYmEoMCwwLDAsMC4zKTsKICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgwLjcpOwogICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC40cyBjdWJpYy1iZXppZXIoMC4zNCwgMS41NiwgMC42NCwgMSk7CiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmNvbXBsZXRpb24tbWVzc2FnZS5zaG93IC5jb21wbGV0aW9uLWNvbnRlbnQgewogICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEpOwogICAgICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgIH0KCiAgICAgICAgLmNvbXBsZXRpb24taWNvbiB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogM3JlbTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTVweDsKICAgICAgICAgICAgYW5pbWF0aW9uOiB0YWRhIDEuNXMgaW5maW5pdGU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIEBrZXlmcmFtZXMgdGFkYSB7CiAgICAgICAgICAgMCUge3RyYW5zZm9ybTogc2NhbGUoMSk7fQogICAgICAgICAgIDEwJSwgMjAlIHt0cmFuc2Zvcm06IHNjYWxlKDAuOSkgcm90YXRlKC0zZGVnKTt9CiAgICAgICAgICAgMzAlLCA1MCUsIDcwJSwgOTAlIHt0cmFuc2Zvcm06IHNjYWxlKDEuMSkgcm90YXRlKDNkZWcpO30KICAgICAgICAgICA0MCUsIDYwJSwgODAlIHt0cmFuc2Zvcm06IHNjYWxlKDEuMSkgcm90YXRlKC0zZGVnKTt9CiAgICAgICAgICAgMTAwJSB7dHJhbnNmb3JtOiBzY2FsZSgxKSByb3RhdGUoMCk7fQogICAgICAgIH0KCiAgICAgICAgLmNvbXBsZXRpb24tY29udGVudCBoMiB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMi41cmVtOwogICAgICAgICAgICBmb250LXdlaWdodDogOTAwOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxNXB4OwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIHRleHQtc2hhZG93OiAycHggMnB4IDRweCByZ2JhKDAsMCwwLDAuMik7CiAgICAgICAgfQogICAgICAgIC5jb21wbGV0aW9uLWNvbnRlbnQgcCB7IGNvbG9yOiB3aGl0ZTsgfQoKICAgICAgICAuY29tcGxldGlvbi1idXR0b25zIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZ2FwOiAxNXB4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICAgICAgICBtYXJnaW4tdG9wOiAyMHB4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBDb25mZXR0aSAqLwogICAgICAgIC5jb25mZXR0aSB7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgd2lkdGg6IDEwcHg7IGhlaWdodDogMTBweDsgYmFja2dyb3VuZC1jb2xvcjogI2YwMDsgb3BhY2l0eTogMDsgfQogICAgICAgIC5jb25mZXR0aS5hbmltYXRlIHsgYW5pbWF0aW9uOiBjb25mZXR0aS1mYWxsIDNzIGxpbmVhciBmb3J3YXJkczsgfQogICAgICAgIEBrZXlmcmFtZXMgY29uZmV0dGktZmFsbCB7CiAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xMDBweCkgcm90YXRlWigwZGVnKTsgb3BhY2l0eTogMTsgfQogICAgICAgICAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDMwMHB4KSByb3RhdGVaKDM2MGRlZyk7IG9wYWNpdHk6IDA7IH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogSW5mbyBQb3B1cCBNb2RhbCAqLwogICAgICAgIC5pbmZvLW1vZGFsLW92ZXJsYXkgewogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgICAgICAgIHRvcDogMDsKICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjYpOwogICAgICAgICAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCk7CiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICB6LWluZGV4OiAyMDAwOwogICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuM3MgZWFzZTsKICAgICAgICB9CiAgICAgICAgLmluZm8tbW9kYWwtb3ZlcmxheS5zaG93IHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICB9CiAgICAgICAgLmluZm8tbW9kYWwgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICAgICAgY29sb3I6ICMzMzM7CiAgICAgICAgICAgIHBhZGRpbmc6IDMwcHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDIwcHg7CiAgICAgICAgICAgIG1heC13aWR0aDogNDUwcHg7CiAgICAgICAgICAgIHdpZHRoOiA5MCU7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMTBweCAzMHB4IHJnYmEoMCwwLDAsMC4yKTsKICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgwLjgpOwogICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlOwogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgfQogICAgICAgIC5pbmZvLW1vZGFsLW92ZXJsYXkuc2hvdyAuaW5mby1tb2RhbCB7CiAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMSk7CiAgICAgICAgICAgIG9wYWNpdHk6IDE7CiAgICAgICAgfQogICAgICAgIC5pbmZvLW1vZGFsLXRpdGxlIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjVyZW07CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA5MDA7CiAgICAgICAgICAgIGNvbG9yOiAjMWEyMzdlOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxNXB4OwogICAgICAgIH0KICAgICAgICAuaW5mby1tb2RhbC1jb250ZW50IHsKICAgICAgICAgICAgZm9udC1zaXplOiAxcmVtOwogICAgICAgICAgICBsaW5lLWhlaWdodDogMS42OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgIH0KICAgICAgICAuaW5mby1tb2RhbC1jbG9zZSB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgdG9wOiAxNXB4OwogICAgICAgICAgICByaWdodDogMTVweDsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjVyZW07CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgYmFja2dyb3VuZDogbm9uZTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBjb2xvcjogI2FhYTsKICAgICAgICB9CiAgICAgICAgLmluZm8tbW9kYWwtY2xvc2U6aG92ZXIgewogICAgICAgICAgICBjb2xvcjogIzMzMzsKICAgICAgICB9CgoKICAgICAgICBAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHsKICAgICAgICAgICAgLmFwcC1jb250YWluZXIgeyBwYWRkaW5nOiAxNXB4OyB9CiAgICAgICAgICAgIC53ZWxjb21lLWNhcmQgeyBwYWRkaW5nOiAzMHB4IDIwcHg7IH0KICAgICAgICAgICAgLndlbGNvbWUtdGl0bGUgeyBmb250LXNpemU6IDJyZW07IH0KICAgICAgICAgICAgLmNhcmQtY29udGFpbmVyIHsgaGVpZ2h0OiAzMDBweDsgfQogICAgICAgICAgICAuY2FyZC1mcm9udCAuY2FyZC1jb250ZW50IHsgZm9udC1zaXplOiAxLjNyZW07IH0KICAgICAgICAgICAgLmNhcmQtYmFjayAuY2FyZC1jb250ZW50IHsgZm9udC1zaXplOiAxcmVtOyB9CiAgICAgICAgICAgIC5idG4geyBwYWRkaW5nOiAxMHB4IDE2cHg7IGZvbnQtc2l6ZTogMC44cmVtOyB9CiAgICAgICAgICAgIC5nYW1lLWNvbnRyb2xzIHsgZ2FwOiAxMHB4OyB9CiAgICAgICAgfQogICAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KPCEtLSBOw7p0IHbDoG8gZ2FtZSBjaMOtbmggKGNo4buJIHRow6ptLCBraMO0bmcgc+G7rWEgZ8OsIGtow6FjKSAtLT4KPGJ1dHRvbiBpZD0iYnRuR29NYWluRnJvbUZsYXNoY2FyZCIgCiAgICAgICAgc3R5bGU9InBvc2l0aW9uOmZpeGVkOyByaWdodDoxNnB4OyBib3R0b206MTZweDsgei1pbmRleDo5OTk5OTsgcGFkZGluZzo4cHggMTJweDsgYm9yZGVyOm5vbmU7IGJvcmRlci1yYWRpdXM6OTk5OXB4OyBiYWNrZ3JvdW5kOiMyNTYzZWI7IGNvbG9yOndoaXRlOyBmb250LXNpemU6MTNweDsgZm9udC13ZWlnaHQ6NjAwOyBib3gtc2hhZG93OjAgNnB4IDE2cHggcmdiYSgwLDAsMCwwLjIpOyBjdXJzb3I6cG9pbnRlcjsgb3BhY2l0eTowLjk7Ij4KICAgIOKGkCBWw6BvIGdhbWUgY2jDrW5oCjwvYnV0dG9uPgo8c2NyaXB0PgooZnVuY3Rpb24oKXsKICAgIHZhciBiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bkdvTWFpbkZyb21GbGFzaGNhcmQnKTsKICAgIGlmKGIpewogICAgICAgIGIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpewogICAgICAgICAgICB0cnkgeyB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKCdmbGFzaGNhcmRHb01haW4nLCcqJyk7IH0gY2F0Y2goZSl7fQogICAgICAgIH0pOwogICAgfQp9KSgpOwo8L3NjcmlwdD4KCiAgICA8ZGl2IGNsYXNzPSJiYWNrZ3JvdW5kLWNvbnRhaW5lciI+CiAgICAgICAgPHVsIGNsYXNzPSJiYWNrZ3JvdW5kLXBhcnRpY2xlcyI+CiAgICAgICAgICAgIDxsaT48L2xpPjxsaT48L2xpPjxsaT48L2xpPjxsaT48L2xpPjxsaT48L2xpPjxsaT48L2xpPjxsaT48L2xpPjxsaT48L2xpPjxsaT48L2xpPjxsaT48L2xpPgogICAgICAgIDwvdWw+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImFwcC1jb250YWluZXIiPgogICAgICAgIDwhLS0gV2VsY29tZSBTY3JlZW4gLS0+CiAgICAgICAgPGRpdiBjbGFzcz0id2VsY29tZS1zY3JlZW4iIGlkPSJ3ZWxjb21lU2NyZWVuIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0id2VsY29tZS1jYXJkIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9IndlbGNvbWUtaWNvbiI+8J+arTwvZGl2PgogICAgICAgICAgICAgICAgPGgxIGNsYXNzPSJ3ZWxjb21lLXRpdGxlIj5GbGFzaGNhcmQgUGjhu5VpIEto4buPZTwvaDE+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0id2VsY29tZS1zdWJ0aXRsZSI+Q8O5bmcga2jDoW0gcGjDoSBraeG6v24gdGjhu6ljIHbhu4EgcGjDsm5nIGNo4buRbmcgdGh14buRYyBsw6EgbeG7mXQgY8OhY2ggdGjhuq10IHZ1aSE8L3A+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9IndlbGNvbWUtZmVhdHVyZXMiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZlYXR1cmUiIG9uY2xpY2s9InNob3dJbmZvUG9wdXAoJ3NjaWVuY2UnKSI+PHNwYW4+8J+nqjwvc3Bhbj48c3Bhbj5LaeG6v24gdGjhu6ljIHkga2hvYTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmZWF0dXJlIiBvbmNsaWNrPSJzaG93SW5mb1BvcHVwKCd2YXBlJykiPjxzcGFuPuKaoTwvc3Bhbj48c3Bhbj5T4buxIHRo4bqtdCB24buBIFZhcGU8L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVhdHVyZSIgb25jbGljaz0ic2hvd0luZm9Qb3B1cCgnc3RhdHMnKSI+PHNwYW4+8J+Tijwvc3Bhbj48c3Bhbj5UaOG7kW5nIGvDqiBXSE88L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ic3RhcnQtYnRuIiBvbmNsaWNrPSJzdGFydEdhbWUoKSI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4+QuG6r3QgxJHhuqd1IG5nYXk8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4+4oaSPC9zcGFuPgogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8IS0tIEdhbWUgU2NyZWVuIC0tPgogICAgICAgIDxkaXYgY2xhc3M9ImdhbWUtc2NyZWVuIiBpZD0iZ2FtZVNjcmVlbiI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdhbWUtaGVhZGVyIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb2dyZXNzLWJhciI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvZ3Jlc3MtZmlsbCIgaWQ9InByb2dyZXNzRmlsbCI+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InN0YXRzIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2PsSQw6MgaOG7jWM6IDxzcGFuIGlkPSJzdHVkaWVkQ291bnQiPjA8L3NwYW4+LzI0PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdj5UaeG6v24gdHLDrG5oOiA8c3BhbiBpZD0icHJvZ3Jlc3NQZXJjZW50Ij4wPC9zcGFuPiU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2PlRo4bq7OiA8c3BhbiBpZD0iY3VycmVudENhcmRTdGF0Ij4xPC9zcGFuPi8yNDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ibXV0ZUJ0biI+8J+UijwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtc2VjdGlvbiI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWluZm8iPgogICAgICAgICAgICAgICAgICAgIDxkaXY+VGjhursgPHNwYW4gaWQ9ImNhcmROdW1iZXIiPjE8L3NwYW4+IC8gMjQ8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWhpbnQiPvCfkYYgQuG6pW0gdsOgbyB0aOG6uyDEkeG7gyBs4bqtdDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1jb250YWluZXIiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsYXNoY2FyZCIgaWQ9ImZsYXNoY2FyZCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtZmFjZSBjYXJkLWZyb250IiBpZD0iY2FyZEZyb250Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtY2F0ZWdvcnkiPkPDonUgaOG7j2k8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtY29udGVudCIgaWQ9ImZyb250Q29udGVudCI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWZhY2UgY2FyZC1iYWNrIiBpZD0iY2FyZEJhY2siPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1jYXRlZ29yeSI+VHLhuqMgbOG7nWk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtY29udGVudCIgaWQ9ImJhY2tDb250ZW50Ij48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJnYW1lLWNvbnRyb2xzIj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4td2FybmluZyIgaWQ9InByZXZCdG4iIG9uY2xpY2s9InByZXZpb3VzQ2FyZFdpdGhBbmltYXRpb24oKSI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4+4oaQPC9zcGFuPiBRdWF5IGzhuqFpCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc3VjY2VzcyIgaWQ9Im5leHRCdG4iIG9uY2xpY2s9Im5leHRDYXJkV2l0aEFuaW1hdGlvbigpIj4KICAgICAgICAgICAgICAgICAgICBUaeG6v3AgdGhlbyA8c3Bhbj7ihpI8L3NwYW4+CiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDwhLS0gQ29tcGxldGlvbiBNZXNzYWdlIC0tPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbXBsZXRpb24tbWVzc2FnZSIgaWQ9ImNvbXBsZXRpb25NZXNzYWdlIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29tcGxldGlvbi1jb250ZW50IiBpZD0iY29tcGxldGlvbkNvbnRlbnQiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29tcGxldGlvbi1pY29uIj7wn46JPC9kaXY+CiAgICAgICAgICAgICAgICA8aDI+VHV54buHdCB24budaSE8L2gyPgogICAgICAgICAgICAgICAgPHA+QuG6oW4gxJHDoyBob8OgbiB0aMOgbmggYuG7mSB0aOG6uyBQaOG7lWkgS2jhu49lITwvcD4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbXBsZXRpb24tYnV0dG9ucyI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiBvbmNsaWNrPSJyZXNldFByb2dyZXNzKCkiPvCflIQgSOG7jWMgbOG6oWk8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXdhcm5pbmciIG9uY2xpY2s9ImNvbnRpbnVlR2FtZSgpIj7vv70gWMOhbyB0cuG7mW48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICAKICAgICAgICA8IS0tIEluZm8gUG9wdXAgTW9kYWwgLS0+CiAgICAgICAgPGRpdiBjbGFzcz0iaW5mby1tb2RhbC1vdmVybGF5IiBpZD0iaW5mb01vZGFsT3ZlcmxheSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImluZm8tbW9kYWwiIGlkPSJpbmZvTW9kYWwiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaW5mby1tb2RhbC1jbG9zZSIgb25jbGljaz0iaGlkZUluZm9Qb3B1cCgpIj7DlzwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJpbmZvLW1vZGFsLXRpdGxlIiBpZD0iaW5mb01vZGFsVGl0bGUiPjwvaDI+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0iaW5mby1tb2RhbC1jb250ZW50IiBpZD0iaW5mb01vZGFsQ29udGVudCI+PC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICA8L2Rpdj4KCiAgICA8c2NyaXB0PgogICAgICAgIC8vIC0tLSBEQVRBIC0tLQogICAgICAgIGNvbnN0IGZsYXNoY2FyZHMgPSBbCiAgICAgICAgICAgIHsgZnJvbnQ6ICLwn6eqIE5pY290aW5lIGzDoCBnw6w/IiwgYmFjazogIvCfkoAgTmljb3RpbmUgbMOgIGNo4bqldCBnw6J5IG5naGnhu4duIGPDsyB0cm9uZyB0aHXhu5FjIGzDoSB2w6AgdGh14buRYyBsw6EgxJFp4buHbiB04butLiBDaOG7iSBj4bqnbiAxMCBnacOieSDEkeG7gyBuaWNvdGluZSDEkeG6v24gbsOjbywgZ8OieSBuZ2hp4buHbiBuaGFuaCBjaMOzbmcgdsOgIHLhuqV0IGtow7MgY2FpLiDEkMOieSBsw6AgbMO9IGRvIGNow61uaCBraGnhur9uIG5nxrDhu51pIGjDunQgdGh14buRYyBraMOzIGLhu48gxJHGsOG7o2MgdGjDs2kgcXVlbiBuw6B5LiIsIGNhdGVnb3J5OiAiaW5mbyIgfSwKICAgICAgICAgICAgeyBmcm9udDogIuKaoSBUaHXhu5FjIGzDoSDEkWnhu4duIHThu60gKFZhcGUpIGPDsyBhbiB0b8OgbiBraMO0bmc/IiwgYmFjazogIuKdjCBLSMOUTkcgQU4gVE/DgE4hIFRodeG7kWMgbMOhIMSRaeG7h24gdOG7rSB24bqrbiBjaOG7qWEgbmljb3RpbmUgZ8OieSBuZ2hp4buHbiB2w6Agbmhp4buBdSBjaOG6pXQgxJHhu5ljIGjhuqFpIG5oxrAgZm9ybWFsZGVoeWRlLiBXSE8ga2jhurNuZyDEkeG7i25oIHRodeG7kWMgbMOhIMSRaeG7h24gdOG7rSBraMO0bmcgYW4gdG/DoG4gdsOgIGPDsyB0aOG7gyBnw6J5IGLhu4duaCBwaOG7lWkgbmdoacOqbSB0cuG7jW5nLiIsIGNhdGVnb3J5OiAiZGFuZ2VyIiB9LAogICAgICAgICAgICB7IGZyb250OiAi8J+MrO+4jyBLaMOzaSB0aHXhu5FjIHRo4bulIMSR4buZbmcgY8OzIGjhuqFpIG5oxrAgdGjhur8gbsOgbz8iLCBiYWNrOiAi4pig77iPIEtow7NpIHRodeG7kWMgdGjhu6UgxJHhu5luZyBjaOG7qWEgaMahbiAyNTAgY2jhuqV0IMSR4buZYyBo4bqhaSwgZ8OieSB1bmcgdGjGsCBwaOG7lWksIGLhu4duaCB0aW0gbeG6oWNoLCBoZW4gc3V54buFbiDhu58gdHLhursgZW0uIEtow7RuZyBjw7MgbeG7qWMgxJHhu5kgdGnhur9wIHjDumMgbsOgbyDEkcaw4bujYyBjb2kgbMOgIGFuIHRvw6BuISIsIGNhdGVnb3J5OiAiZGFuZ2VyIiB9LAogICAgICAgICAgICB7IGZyb250OiAi8J+OryBUaHXhu5FjIGzDoSBnw6J5IHJhIG5o4buvbmcgYuG7h25oIHVuZyB0aMawIG7DoG8/IiwgYmFjazogIvCflKIgw410IG5o4bqldCAxNiBsb+G6oWkgdW5nIHRoxrA6IHBo4buVaSwgaOG7jW5nLCB0aOG7sWMgcXXhuqNuLCBiw6BuZyBxdWFuZywgZ2FuLCBk4bqhIGTDoHksIHThu6V5LCB0aOG6rW4sIGPhu5UgdOG7rSBjdW5nIHbDoCBuaGnhu4F1IGPGoSBxdWFuIGtow6FjLiBOZ3V5IGPGoSBt4bqvYyB1bmcgdGjGsCB0xINuZyAxNS0zMCBs4bqnbiBzbyB24bubaSBuZ8aw4budaSBraMO0bmcgaMO6dCB0aHXhu5FjISIsIGNhdGVnb3J5OiAiZGFuZ2VyIiB9LAogICAgICAgICAgICB7IGZyb250OiAi8J+RtiBIw7p0IHRodeG7kWMg4bqjbmggaMaw4bufbmcgxJHhur9uIGto4bqjIG7Eg25nIHNpbmggc+G6o24/IiwgYmFjazogIvCfkpQgSMO6dCB0aHXhu5FjIGdp4bqjbSBraOG6oyBuxINuZyBzaW5oIHPhuqNuIOG7nyBj4bqjIG5hbSB2w6AgbuG7rywgY8OzIHRo4buDIGfDonkgdsO0IHNpbmguIOG7niBwaOG7pSBu4buvIG1hbmcgdGhhaSBjw7MgdGjhu4MgZOG6q24gxJHhur9uIHPhuqN5IHRoYWksIHNpbmggbm9uIHbDoCBuaGnhu4F1IGJp4bq/biBjaOG7qW5nIG5ndXkgaGnhu4NtIGtow6FjLiIsIGNhdGVnb3J5OiAiZGFuZ2VyIiB9LAogICAgICAgICAgICB7IGZyb250OiAi4o+wIEPGoSB0aOG7gyBo4buTaSBwaOG7pWMgbmjGsCB0aOG6vyBuw6BvIGtoaSBi4buPIHRodeG7kWM/IiwgYmFjazogIvCfmoAgMjAgcGjDunQ6IG5o4buLcCB0aW0gdsOgIGh1eeG6v3Qgw6FwIGdp4bqjbS4gMTIgZ2nhu506IGtow60gQ08gdHLhu58gduG7gSBiw6xuaCB0aMaw4budbmcuIDIgdHXhuqduOiB0deG6p24gaG/DoG4gbcOhdSBj4bqjaSB0aGnhu4duLiAxIHRow6FuZzogY2jhu6ljIG7Eg25nIHBo4buVaSB0xINuZyAzMCUuIDEgbsSDbTogbmd1eSBjxqEgYuG7h25oIHRpbSBnaeG6o20gNTAlISIsIGNhdGVnb3J5OiAiYmVuZWZpdCIgfSwKICAgICAgICAgICAgeyBmcm9udDogIuKYoO+4jyBUaHXhu5FjIGzDoSBjaOG7qWEgYmFvIG5oacOqdSBjaOG6pXQgxJHhu5ljIGjhuqFpPyIsIGJhY2s6ICLwn6eqIEjGoW4gNy4wMDAgY2jhuqV0IGjDs2EgaOG7jWMsIHRyb25nIMSRw7MgY8OzIDcwKyBjaOG6pXQgZ8OieSB1bmcgdGjGsCBuaMawIGJlbnplbmUsIGZvcm1hbGRlaHlkZSwgcG9sb25pdW0tMjEwLCBoeWRyb2dlbiBjeWFuaWRlLiBIw7p0IHRodeG7kWMgZ2nhu5FuZyBuaMawIGjDrXQga2jDrSB0aOG6o2kgw7QgdMO0ISIsIGNhdGVnb3J5OiAiaW5mbyIgfSwKICAgICAgICAgICAgeyBmcm9udDogIvCfpJQgVGh14buRYyBsw6EgxJFp4buHbiB04butIGPDsyBnacO6cCBjYWkgdGh14buRYyBraMO0bmc/IiwgYmFjazogIuKaoO+4jyBDaMawYSBjw7MgYuG6sW5nIGNo4bupbmcga2hvYSBo4buNYyDEkeG7pyBt4bqhbmghIE5oaeG7gXUgbmfGsOG7nWkgc+G7rSBk4bulbmcgY+G6oyB0aHXhu5FjIGzDoSB0aMaw4budbmcgdsOgIMSRaeG7h24gdOG7rSwgbMOgbSB0xINuZyBuZ3V5IGPGoS4gTGnhu4d1IHBow6FwIHRoYXkgdGjhur8gbmljb3RpbmUgxJHGsOG7o2MgY2jhu6luZyBtaW5oIGFuIHRvw6BuIGjGoW4hIiwgY2F0ZWdvcnk6ICJpbmZvIiB9LAogICAgICAgICAgICB7IGZyb250OiAi4pyoIEjDunQgdGh14buRYyBsw6BtIGzDo28gaMOzYSBkYSBuaMawIHRo4bq/IG7DoG8/IiwgYmFjazogIvCfkbUgR2nhuqNtIGzGsHUgbMaw4bujbmcgbcOhdSDEkeG6v24gZGEsIHBow6EgaOG7p3kgY29sbGFnZW4gZ8OieSBsw6NvIGjDs2Egc+G7m20sIG7hur9wIG5oxINuLCBkYSB44buJbiBtw6B1IHbDoCBjaOG6rW0gbMOgbmggduG6v3QgdGjGsMahbmcuIE5nxrDhu51pIGjDunQgdGh14buRYyB0aMaw4budbmcgY8OzIG7hur9wIG5oxINuIHF1YW5oIG3DtGkgdsOgIG3huq90IHLDtSBy4buHdCEiLCBjYXRlZ29yeTogImRhbmdlciIgfSwKICAgICAgICAgICAgeyBmcm9udDogIvCfprQgSMO6dCB0aHXhu5FjIOG6o25oIGjGsOG7n25nIMSR4bq/biB4xrDGoW5nIGto4bubcD8iLCBiYWNrOiAi8J+SgCBHaeG6o20gbeG6rXQgxJHhu5kgeMawxqFuZywgdMSDbmcgbmd1eSBjxqEgbG/Do25nIHjGsMahbmcgdsOgIGfDo3kgeMawxqFuZywgxJHhurdjIGJp4buHdCDhu58gcGjhu6UgbuG7ryBtw6NuIGtpbmguIEzDoG0gY2jhuq1tIHF1w6EgdHLDrG5oIGzDoG5oIHjGsMahbmcgc2F1IGNo4bqlbiB0aMawxqFuZyBob+G6t2MgcGjhuqt1IHRodeG6rXQuIiwgY2F0ZWdvcnk6ICJkYW5nZXIiIH0sCiAgICAgICAgICAgIHsgZnJvbnQ6ICLwn6egIFThuqFpIHNhbyB0aGFuaCB0aGnhur91IG5pw6puIGtow7RuZyBuw6puIGTDuW5nIHRodeG7kWMgbMOhIMSRaeG7h24gdOG7rT8iLCBiYWNrOiAi4pqg77iPIE7Do28gYuG7mSBwaMOhdCB0cmnhu4NuIMSR4bq/biAyNSB0deG7lWkhIE5pY290aW5lIGfDonkgdOG7lW4gdGjGsMahbmcgdsSpbmggdmnhu4VuIGNobyBuw6NvIMSRYW5nIHBow6F0IHRyaeG7g24sIGThuqtuIMSR4bq/biB24bqlbiDEkeG7gSB24buBIHRyw60gbmjhu5ssIGNow7ogw70gdsOgIGjhu41jIHThuq1wLiBOw6NvIHRoYW5oIHRoaeG6v3UgbmnDqm4gZOG7hSBuZ2hp4buHbiBn4bqlcCAzIGzhuqduISIsIGNhdGVnb3J5OiAiZGFuZ2VyIiB9LAogICAgICAgICAgICB7IGZyb250OiAi8J+boe+4jyBIw7p0IHRodeG7kWMg4bqjbmggaMaw4bufbmcgxJHhur9uIGjhu4cgbWnhu4VuIGThu4tjaD8iLCBiYWNrOiAi8J+moCBMw6BtIHN1eSB54bq/dSBtaeG7hW4gZOG7i2NoLCB0xINuZyBuZ3V5IGPGoSBuaGnhu4VtIHRyw7luZyDEkcaw4budbmcgaMO0IGjhuqVwLCB2acOqbSBwaOG7lWksIGPDum0gdsOgIGPDoWMgdHJp4buHdSBjaOG7qW5nIENPVklELTE5IG7hurduZy4gTMOgbSBjaOG6rW0gcXXDoSB0csOsbmggbMOgbmggduG6v3QgdGjGsMahbmcuIiwgY2F0ZWdvcnk6ICJkYW5nZXIiIH0sCiAgICAgICAgICAgIHsgZnJvbnQ6ICLwn5KwIENoaSBwaMOtIGtpbmggdOG6vyBj4bunYSB2aeG7h2MgaMO6dCB0aHXhu5FjPyIsIGJhY2s6ICLwn5OKIFZp4buHdCBOYW06IGjGoW4gMyB04bu3IFVTRC9uxINtIGNobyBjaGkgcGjDrSB5IHThur8uIFRvw6BuIGPhuqd1OiAxLjQgbmdow6xuIHThu7cgVVNEL27Eg20uIEJhbyBn4buTbSBt4bqldCBuxINuZyBzdeG6pXQgbGFvIMSR4buZbmcsIHThu60gdm9uZyBz4bubbSwgY2hpIHBow60gxJFp4buBdSB0cuG7iy4gTOG7o2kgw61jaCBraW5oIHThur8ga2hpIGLhu48gdGh14buRYyBy4bqldCBs4bubbiEiLCBjYXRlZ29yeTogImluZm8iIH0sCiAgICAgICAgICAgIHsgZnJvbnQ6ICLwn5GB77iPIEjDunQgdGh14buRYyDhuqNuaCBoxrDhu59uZyDEkeG6v24gdGjhu4sgbOG7sWM/IiwgYmFjazogIvCfmLUgVMSDbmcgbmd1eSBjxqEgdGhvw6FpIGjDs2EgxJFp4buDbSB2w6BuZywgxJHhu6VjIHRo4buneSB0aW5oIHRo4buDLCBi4buHbmggdsO1bmcgbeG6oWMgdGnhu4N1IMSRxrDhu51uZywgdOG7lW4gdGjGsMahbmcgZMOieSB0aOG6p24ga2luaCB0aOG7iyBnacOhYyBjw7MgdGjhu4MgZOG6q24gxJHhur9uIG3DuSBsw7JhLiBOZ8aw4budaSBow7p0IHRodeG7kWMgY8OzIG5ndXkgY8ahIG3DuSBn4bqlcCAyIGzhuqduISIsIGNhdGVnb3J5OiAiZGFuZ2VyIiB9LAogICAgICAgICAgICB7IGZyb250OiAi8J+ksSBQaOG7pSBu4buvIG1hbmcgdGhhaSBow7p0IHRodeG7kWMgY8OzIHTDoWMgaOG6oWkgZ8OsPyIsIGJhY2s6ICLwn5G2IFPhuqN5IHRoYWksIHRoYWkgY2jhur90IGzGsHUsIHNpbmggbm9uLCB0cuG6uyBuaOG6uSBjw6JuLCBk4buLIHThuq10IGLhuqltIHNpbmgsIGjhu5lpIGNo4bupbmcgxJHhu5l0IHThu60g4bufIHRy4bq7IHPGoSBzaW5oLCBjaOG6rW0gcGjDoXQgdHJp4buDbi4gS2jDs2kgdGh14buRYyBnacOhbiB0aeG6v3AgY8WpbmcgY8OzIGjhuqFpIGNobyBlbSBiw6khIiwgY2F0ZWdvcnk6ICJkYW5nZXIiIH0sCiAgICAgICAgICAgIHsgZnJvbnQ6ICLwn6a3IEjDunQgdGh14buRYyDhuqNuaCBoxrDhu59uZyDEkeG6v24gc+G7qWMga2jhu49lIHLEg25nIG1p4buHbmc/IiwgYmFjazogIvCfmKwgVW5nIHRoxrAgbWnhu4duZywgYuG7h25oIG7GsOG7m3UsIG3huqV0IHLEg25nLCBow7RpIG1p4buHbmcsIHLEg25nIOG7kSB2w6BuZywgY2jhuq1tIGzDoG5oIHNhdSBwaOG6q3UgdGh14bqtdCBuaGEga2hvYS4gTmfGsOG7nWkgaMO6dCB0aHXhu5FjIG3huqV0IHLEg25nIGfhuqVwIDItMyBs4bqnbiBuZ8aw4budaSBraMO0bmcgaMO6dCEiLCBjYXRlZ29yeTogImRhbmdlciIgfSwKICAgICAgICAgICAgeyBmcm9udDogIvCfmLAgVHJp4buHdSBjaOG7qW5nIGNhaSB0aHXhu5FjIGzDoCBnw6w/IiwgYmFjazogIvCfjqIgTG8gw6J1LCBjw6F1IGvhu4luaCwga2jDsyB04bqtcCB0cnVuZywgdMSDbmcgY8OibiwgbeG6pXQgbmfhu6csIHRow6htIHRodeG7kWMuIMSQ4buJbmggxJFp4buDbSB0cm9uZyAzIG5nw6B5IMSR4bqndSwgZ2nhuqNtIGThuqduIHNhdSAyLTQgdHXhuqduLiBIw6N5IG5o4bubOiBraMOzIGtoxINuIHThuqFtIHRo4budaSwgbOG7o2kgw61jaCB2xKluaCB2aeG7hW4hIiwgY2F0ZWdvcnk6ICJpbmZvIiB9LAogICAgICAgICAgICB7IGZyb250OiAi8J+qtCBTaGlzaGEvSG9va2FoIGPDsyBhbiB0b8OgbiBoxqFuIGtow7RuZz8iLCBiYWNrOiAi4p2MIEhPw4BOIFRPw4BOIFNBSSEgQ2jhu6lhIGPDuW5nIGPDoWMgY2jhuqV0IMSR4buZYyBuaMawIHRodeG7kWMgbMOhIHRoxrDhu51uZy4gMSBs4bqnbiBow7p0IHNoaXNoYSA9IDEwMCDEkWnhur91IHRodeG7kWMgduG7gSBsxrDhu6NuZyBraMOzaS4gTsaw4bubYyBraMO0bmcgbOG7jWMgxJHGsOG7o2MgY2jhuqV0IMSR4buZYy4gRMO5bmcgY2h1bmcgdsOyaSBjw7Mgbmd1eSBjxqEgbMOieSBuaGnhu4VtISIsIGNhdGVnb3J5OiAiZGFuZ2VyIiB9LAogICAgICAgICAgICB7IGZyb250OiAi4p2k77iPIEjDunQgdGh14buRYyDhuqNuaCBoxrDhu59uZyDEkeG6v24gdGltIG3huqFjaCBuaMawIHRo4bq/IG7DoG8/IiwgYmFjazogIvCfkpQgVMSDbmcgbmd1eSBjxqEgxJFhdSB0aW0gMi00IGzhuqduLCDEkeG7mXQgcXXhu7UgMi00IGzhuqduLCBi4buHbmggxJHhu5luZyBt4bqhY2ggbmdv4bqhaSBiacOqbiwgdMSDbmcgaHV54bq/dCDDoXAsIHRpbSDEkeG6rXAgbmhhbmgsIGdp4bqjbSBveHkgdHJvbmcgbcOhdS4gWMahIHbhu69hIMSR4buZbmcgbeG6oWNoIG5oYW5oIGNow7NuZyEiLCBjYXRlZ29yeTogImRhbmdlciIgfSwKICAgICAgICAgICAgeyBmcm9udDogIvCfjq8gQ8OhY2ggY2FpIHRodeG7kWMgaGnhu4d1IHF14bqjIG5o4bqldD8iLCBiYWNrOiAi8J+SqiBQaMawxqFuZyBwaMOhcCBr4bq/dCBo4bujcDogaOG7lyB0cuG7oyB5IHThur8sIGxp4buHdSBwaMOhcCB0aGF5IHRo4bq/IG5pY290aW5lLCB0xrAgduG6pW4gdMOibSBsw70sIG5ow7NtIGjhu5cgdHLhu6MsIMSRxrDhu51uZyBkw6J5IG7Ds25nIGNhaSB0aHXhu5FjLCDhu6luZyBk4bulbmcgZGkgxJHhu5luZywgxJHhurd0IG5nw6B5IGNhaSB0aHXhu5FjLCB0csOhbmggY8OhYyB54bq/dSB04buRIGvDrWNoIHRow61jaCEiLCBjYXRlZ29yeTogImJlbmVmaXQiIH0sCiAgICAgICAgICAgIHsgZnJvbnQ6ICLwn42sIEjGsMahbmcgbGnhu4d1IHRyb25nIFZhcGUgY8OzIGFuIHRvw6BuIGtow7RuZz8iLCBiYWNrOiAi4p2MIEtIw5RORyEgTmhp4buBdSBoxrDGoW5nIGxp4buHdSAobmjGsCBkaWFjZXR5bCkgYW4gdG/DoG4ga2hpIMSDbiBuaMawbmcgbOG6oWkgY+G7sWMga+G7syDEkeG7mWMgaOG6oWkga2hpIGjDrXQgdsOgbyBwaOG7lWksIGfDonkgcmEgYuG7h25oICdwaOG7lWkgYuG7j25nIG5nw7QnICh2acOqbSB0aeG7g3UgcGjhur8gcXXhuqNuIHThuq9jIG5naOG6vW4pIGtow7RuZyB0aOG7gyBo4buTaSBwaOG7pWMgdsOgIGPDoWMgdOG7lW4gdGjGsMahbmcgbmdoacOqbSB0cuG7jW5nIGtow6FjLiIsIGNhdGVnb3J5OiAiZGFuZ2VyIiB9LAogICAgICAgICAgICB7IGZyb250OiAi8J+MjSBUaOG7kW5nIGvDqiBk4buLY2ggdGh14buRYyBsw6EgdG/DoG4gY+G6p3U/IiwgYmFjazogIvCfk4ggOCB0cmnhu4d1IG5nxrDhu51pIGNo4bq/dC9uxINtIHRvw6BuIGPhuqd1LCAxLjMgdOG7tyBuZ8aw4budaSBz4butIGThu6VuZy4gVGh14buRYyBsw6EgZ2nhur90IGNo4bq/dCA1MCUgbmfGsOG7nWkgc+G7rSBk4bulbmcuIEThu7EgYsOhbyDEkeG6v24gMjAzMDogOC4zIHRyaeG7h3UgbmfGsOG7nWkgY2jhur90IG7hur91IGtow7RuZyBow6BuaCDEkeG7mW5nLiDEkOG6oWkgZOG7i2NoIHRyb25nIMSR4bqhaSBk4buLY2ghIiwgY2F0ZWdvcnk6ICJpbmZvIiB9LAogICAgICAgICAgICB7IGZyb250OiAi8J+nrCBUw6FjIMSR4buZbmcgZGkgdHJ1eeG7gW4gY+G7p2Egdmnhu4djIGjDunQgdGh14buRYz8iLCBiYWNrOiAi8J+UrCBIw7p0IHRodeG7kWMgdGhheSDEkeG7lWkgYmnhu4N1IGhp4buHbiBnZW4sIGPDsyB0aOG7gyB0cnV54buBbiBzYW5nIHRo4bq/IGjhu4cgdGnhur9wIHRoZW8uIFR1eSBuaGnDqm4sIGLhu48gdGh14buRYyBjw7MgdGjhu4MgxJHhuqNvIG5nxrDhu6NjIG3hu5l0IHPhu5EgdGhheSDEkeG7lWkgZGkgdHJ1eeG7gW4gbsOgeSEiLCBjYXRlZ29yeTogImluZm8iIH0sCiAgICAgICAgICAgIHsgZnJvbnQ6ICLwn5KoIEtow7NpIHRodeG7kWMgdMOgbiBsxrB1IGzDoCBnw6w/IiwgYmFjazogIvCfj6AgQ2jhuqV0IMSR4buZYyB04burIGtow7NpIHRodeG7kWMgYsOhbSB0csOqbiBi4buBIG3hurd0LCBxdeG6p24gw6FvLCB0w7NjLiBU4buTbiB04bqhaSBow6BuZyB0aMOhbmcvbsSDbS4gxJDhurdjIGJp4buHdCBjw7MgaOG6oWkgY2hvIHRy4bq7IHPGoSBzaW5oIHbDoCB0cuG6uyBuaOG7jy4gS2jDtG5nIGPDsyBt4bupYyDEkeG7mSB0aeG6v3AgeMO6YyBuw6BvIMSRxrDhu6NjIGNvaSBsw6AgYW4gdG/DoG4hIiwgY2F0ZWdvcnk6ICJkYW5nZXIiIH0KICAgICAgICBdOwoKICAgICAgICAvLyAtLS0gU1RBVEUgJiBET00gRUxFTUVOVFMgLS0tCiAgICAgICAgbGV0IGN1cnJlbnRDYXJkSW5kZXggPSAwOwogICAgICAgIGxldCBzdHVkaWVkQ2FyZHMgPSBuZXcgU2V0KCk7CiAgICAgICAgbGV0IGlzRmxpcHBlZCA9IGZhbHNlOwogICAgICAgIGxldCBpc0FuaW1hdGluZyA9IGZhbHNlOwogICAgICAgIGxldCBpc011dGVkID0gdHJ1ZTsgLy8gQXVkaW8gaXMgbXV0ZWQgYnkgZGVmYXVsdAogICAgICAgIGxldCBhdWRpb0luaXRpYWxpemVkID0gZmFsc2U7CiAgICAgICAgCiAgICAgICAgY29uc3Qgd2VsY29tZVNjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWxjb21lU2NyZWVuJyk7CiAgICAgICAgY29uc3QgZ2FtZVNjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lU2NyZWVuJyk7CiAgICAgICAgY29uc3QgZmxhc2hjYXJkRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxhc2hjYXJkJyk7CiAgICAgICAgY29uc3QgY2FyZEZyb250RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyZEZyb250Jyk7CiAgICAgICAgY29uc3QgY2FyZEJhY2tFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkQmFjaycpOwogICAgICAgIGNvbnN0IGZyb250Q29udGVudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zyb250Q29udGVudCcpOwogICAgICAgIGNvbnN0IGJhY2tDb250ZW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFja0NvbnRlbnQnKTsKICAgICAgICBjb25zdCBjYXJkTnVtYmVyRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyZE51bWJlcicpOwogICAgICAgIGNvbnN0IGN1cnJlbnRDYXJkU3RhdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1cnJlbnRDYXJkU3RhdCcpOwogICAgICAgIGNvbnN0IHN0dWRpZWRDb3VudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRpZWRDb3VudCcpOwogICAgICAgIGNvbnN0IHByb2dyZXNzUGVyY2VudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzUGVyY2VudCcpOwogICAgICAgIGNvbnN0IHByb2dyZXNzRmlsbEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzRmlsbCcpOwogICAgICAgIGNvbnN0IGNvbXBsZXRpb25NZXNzYWdlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGxldGlvbk1lc3NhZ2UnKTsKICAgICAgICBjb25zdCBjb21wbGV0aW9uQ29udGVudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBsZXRpb25Db250ZW50Jyk7CiAgICAgICAgY29uc3QgcHJldkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2QnRuJyk7CiAgICAgICAgY29uc3QgbmV4dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0QnRuJyk7CiAgICAgICAgY29uc3QgbXV0ZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtdXRlQnRuJyk7CiAgICAgICAgY29uc3QgaW5mb01vZGFsT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvTW9kYWxPdmVybGF5Jyk7CiAgICAgICAgY29uc3QgaW5mb01vZGFsVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb01vZGFsVGl0bGUnKTsKICAgICAgICBjb25zdCBpbmZvTW9kYWxDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luZm9Nb2RhbENvbnRlbnQnKTsKCiAgICAgICAgLy8gLS0tIEFVRElPIFNFVFVQIChUb25lLmpzKSAtLS0KICAgICAgICBsZXQgZmxpcFNvdW5kLCBjbGlja1NvdW5kLCBjb21wbGV0aW9uU291bmQ7CgogICAgICAgIGZ1bmN0aW9uIGluaXRBdWRpbygpIHsKICAgICAgICAgICAgaWYgKGF1ZGlvSW5pdGlhbGl6ZWQpIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIFRvbmUuc3RhcnQoKTsKCiAgICAgICAgICAgIGZsaXBTb3VuZCA9IG5ldyBUb25lLk5vaXNlU3ludGgoeyBub2lzZTogeyB0eXBlOiAnd2hpdGUnIH0sIGVudmVsb3BlOiB7IGF0dGFjazogMC4wMDUsIGRlY2F5OiAwLjEsIHN1c3RhaW46IDAgfSB9KS50b0Rlc3RpbmF0aW9uKCk7CiAgICAgICAgICAgIGNsaWNrU291bmQgPSBuZXcgVG9uZS5NZW1icmFuZVN5bnRoKHsgcGl0Y2hEZWNheTogMC4wMSwgb2N0YXZlczogMiwgZW52ZWxvcGU6IHsgYXR0YWNrOiAwLjAwMSwgZGVjYXk6IDAuMiwgc3VzdGFpbjogMCB9IH0pLnRvRGVzdGluYXRpb24oKTsKICAgICAgICAgICAgY29tcGxldGlvblNvdW5kID0gbmV3IFRvbmUuUG9seVN5bnRoKFRvbmUuU3ludGgsIHsgb3NjaWxsYXRvcjogeyB0eXBlOiAic2luZSIgfSwgZW52ZWxvcGU6IHsgYXR0YWNrOiAwLjA1LCBkZWNheTogMC4yLCBzdXN0YWluOiAwLjMsIHJlbGVhc2U6IDEgfSB9KS50b0Rlc3RpbmF0aW9uKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBhdWRpb0luaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgICAgICAgaXNNdXRlZCA9IGZhbHNlOwogICAgICAgICAgICBtdXRlQnRuLnRleHRDb250ZW50ID0gJ/CflIonOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcGxheVNvdW5kKHNvdW5kLCBub3RlLCBkdXJhdGlvbiwgdGltZSkgewogICAgICAgICAgICBpZiAoaXNNdXRlZCB8fCAhYXVkaW9Jbml0aWFsaXplZCkgcmV0dXJuOwogICAgICAgICAgICBzb3VuZC50cmlnZ2VyQXR0YWNrUmVsZWFzZShub3RlLCBkdXJhdGlvbiwgdGltZSk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gRlVOQ1RJT05TIC0tLQogICAgICAgIGZ1bmN0aW9uIHN0YXJ0R2FtZSgpIHsKICAgICAgICAgICAgaWYgKCFhdWRpb0luaXRpYWxpemVkKSBpbml0QXVkaW8oKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHNodWZmbGVDYXJkcygpOwogICAgICAgICAgICB3ZWxjb21lU2NyZWVuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIGdhbWVTY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdncmlkJzsKICAgICAgICAgICAgZmxhc2hjYXJkRWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmbGlwQ2FyZCk7CiAgICAgICAgICAgIHVwZGF0ZURpc3BsYXkoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZURpc3BsYXkoKSB7CiAgICAgICAgICAgIGlzQW5pbWF0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgY2FyZCA9IGZsYXNoY2FyZHNbY3VycmVudENhcmRJbmRleF07CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBmcm9udFBhcnRzID0gY2FyZC5mcm9udC5zcGxpdCgnICcpOwogICAgICAgICAgICBmcm9udENvbnRlbnRFbC5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0iY2FyZC1pY29uIj4ke2Zyb250UGFydHNbMF19PC9kaXY+PGRpdj4ke2Zyb250UGFydHMuc2xpY2UoMSkuam9pbignICcpfTwvZGl2PmA7CiAgICAgICAgICAgIGJhY2tDb250ZW50RWwudGV4dENvbnRlbnQgPSBjYXJkLmJhY2s7CiAgICAgICAgICAgIAogICAgICAgICAgICBjYXJkTnVtYmVyRWwudGV4dENvbnRlbnQgPSBjdXJyZW50Q2FyZEluZGV4ICsgMTsKICAgICAgICAgICAgY3VycmVudENhcmRTdGF0RWwudGV4dENvbnRlbnQgPSBjdXJyZW50Q2FyZEluZGV4ICsgMTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHRoZW1lQ2xhc3MgPSBgJHtjYXJkLmNhdGVnb3J5fS10aGVtZWA7CiAgICAgICAgICAgIGNvbnN0IHRoZW1lQ2xhc3NlcyA9IFsnZGFuZ2VyLXRoZW1lJywgJ2JlbmVmaXQtdGhlbWUnLCAnaW5mby10aGVtZSddOwogICAgICAgICAgICBjYXJkRnJvbnRFbC5jbGFzc0xpc3QucmVtb3ZlKC4uLnRoZW1lQ2xhc3Nlcyk7CiAgICAgICAgICAgIGNhcmRCYWNrRWwuY2xhc3NMaXN0LnJlbW92ZSguLi50aGVtZUNsYXNzZXMpOwogICAgICAgICAgICBjYXJkRnJvbnRFbC5jbGFzc0xpc3QuYWRkKHRoZW1lQ2xhc3MpOwogICAgICAgICAgICBjYXJkQmFja0VsLmNsYXNzTGlzdC5hZGQodGhlbWVDbGFzcyk7CgogICAgICAgICAgICBpc0ZsaXBwZWQgPSBmYWxzZTsKICAgICAgICAgICAgZmxhc2hjYXJkRWwuY2xhc3NMaXN0LnJlbW92ZSgnZmxpcHBlZCcsICdmYWRlLW91dCcpOwogICAgICAgICAgICBmbGFzaGNhcmRFbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1mbGlwLWFuZ2xlJywgJzBkZWcnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZsYXNoY2FyZEVsLmNsYXNzTGlzdC5hZGQoJ2ZhZGUtaW4nKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBmbGFzaGNhcmRFbC5jbGFzc0xpc3QucmVtb3ZlKCdmYWRlLWluJyk7CiAgICAgICAgICAgICAgICBpc0FuaW1hdGluZyA9IGZhbHNlOwogICAgICAgICAgICB9LCA1MDApOwoKICAgICAgICAgICAgcHJldkJ0bi5kaXNhYmxlZCA9IGN1cnJlbnRDYXJkSW5kZXggPT09IDA7CiAgICAgICAgICAgIGlmIChjdXJyZW50Q2FyZEluZGV4ID09PSBmbGFzaGNhcmRzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgIG5leHRCdG4uaW5uZXJIVE1MID0gJ0hvw6BuIHRow6BuaCA8c3Bhbj7inJQ8L3NwYW4+JzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5leHRCdG4uaW5uZXJIVE1MID0gJ1Rp4bq/cCB0aGVvIDxzcGFuPuKGkjwvc3Bhbj4nOwogICAgICAgICAgICB9CgogICAgICAgICAgICB1cGRhdGVQcm9ncmVzcygpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlUHJvZ3Jlc3MoKSB7CiAgICAgICAgICAgIGNvbnN0IHN0dWRpZWRDb3VudCA9IHN0dWRpZWRDYXJkcy5zaXplOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzc1BlcmNlbnQgPSBNYXRoLnJvdW5kKChzdHVkaWVkQ291bnQgLyBmbGFzaGNhcmRzLmxlbmd0aCkgKiAxMDApOwogICAgICAgICAgICAKICAgICAgICAgICAgc3R1ZGllZENvdW50RWwudGV4dENvbnRlbnQgPSBzdHVkaWVkQ291bnQ7CiAgICAgICAgICAgIHByb2dyZXNzUGVyY2VudEVsLnRleHRDb250ZW50ID0gcHJvZ3Jlc3NQZXJjZW50OwogICAgICAgICAgICBwcm9ncmVzc0ZpbGxFbC5zdHlsZS53aWR0aCA9IHByb2dyZXNzUGVyY2VudCArICclJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChzdHVkaWVkQ291bnQgPT09IGZsYXNoY2FyZHMubGVuZ3RoICYmICFjb21wbGV0aW9uTWVzc2FnZUVsLmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpKSB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uTWVzc2FnZUVsLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyQ29uZmV0dGkoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTXV0ZWQgJiYgYXVkaW9Jbml0aWFsaXplZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBub3cgPSBUb25lLm5vdygpOwogICAgICAgICAgICAgICAgICAgICAgICBwbGF5U291bmQoY29tcGxldGlvblNvdW5kLCBbIkM0IiwgIkU0IiwgIkc0Il0sICI4biIsIG5vdyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlTb3VuZChjb21wbGV0aW9uU291bmQsICJDNSIsICI4biIsIG5vdyArIDAuMik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZmxpcENhcmQoKSB7CiAgICAgICAgICAgIGlmIChpc0FuaW1hdGluZykgcmV0dXJuOwogICAgICAgICAgICBpc0ZsaXBwZWQgPSAhaXNGbGlwcGVkOwogICAgICAgICAgICBmbGFzaGNhcmRFbC5jbGFzc0xpc3QudG9nZ2xlKCdmbGlwcGVkJywgaXNGbGlwcGVkKTsKICAgICAgICAgICAgcGxheVNvdW5kKGZsaXBTb3VuZCwgJzhuJyk7CiAgICAgICAgICAgIGlmIChpc0ZsaXBwZWQgJiYgIXN0dWRpZWRDYXJkcy5oYXMoY3VycmVudENhcmRJbmRleCkpIHsKICAgICAgICAgICAgICAgIHN0dWRpZWRDYXJkcy5hZGQoY3VycmVudENhcmRJbmRleCk7CiAgICAgICAgICAgICAgICB1cGRhdGVQcm9ncmVzcygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBuZXh0Q2FyZFdpdGhBbmltYXRpb24oKSB7CiAgICAgICAgICAgIGlmIChpc0FuaW1hdGluZykgcmV0dXJuOwogICAgICAgICAgICBwbGF5U291bmQoY2xpY2tTb3VuZCwgJ0MyJywgJzhuJyk7CiAgICAgICAgICAgIGlmIChjdXJyZW50Q2FyZEluZGV4ID49IGZsYXNoY2FyZHMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgdXBkYXRlUHJvZ3Jlc3MoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaXNBbmltYXRpbmcgPSB0cnVlOwogICAgICAgICAgICBmbGFzaGNhcmRFbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1mbGlwLWFuZ2xlJywgaXNGbGlwcGVkID8gJzE4MGRlZycgOiAnMGRlZycpOwogICAgICAgICAgICBmbGFzaGNhcmRFbC5jbGFzc0xpc3QuYWRkKCdmYWRlLW91dCcpOwoKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBjdXJyZW50Q2FyZEluZGV4Kys7CiAgICAgICAgICAgICAgICB1cGRhdGVEaXNwbGF5KCk7CiAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwcmV2aW91c0NhcmRXaXRoQW5pbWF0aW9uKCkgewogICAgICAgICAgICBpZiAoaXNBbmltYXRpbmcgfHwgY3VycmVudENhcmRJbmRleCA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICBwbGF5U291bmQoY2xpY2tTb3VuZCwgJ0MyJywgJzhuJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpc0FuaW1hdGluZyA9IHRydWU7CiAgICAgICAgICAgIGZsYXNoY2FyZEVsLnN0eWxlLnNldFByb3BlcnR5KCctLWZsaXAtYW5nbGUnLCBpc0ZsaXBwZWQgPyAnMTgwZGVnJyA6ICcwZGVnJyk7CiAgICAgICAgICAgIGZsYXNoY2FyZEVsLmNsYXNzTGlzdC5hZGQoJ2ZhZGUtb3V0Jyk7CgogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGN1cnJlbnRDYXJkSW5kZXgtLTsKICAgICAgICAgICAgICAgIHVwZGF0ZURpc3BsYXkoKTsKICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNodWZmbGVDYXJkcygpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IGZsYXNoY2FyZHMubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3QgaiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpOwogICAgICAgICAgICAgICAgW2ZsYXNoY2FyZHNbaV0sIGZsYXNoY2FyZHNbal1dID0gW2ZsYXNoY2FyZHNbal0sIGZsYXNoY2FyZHNbaV1dOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZXNldFByb2dyZXNzKHNob3VsZFNodWZmbGUgPSBmYWxzZSkgewogICAgICAgICAgICBwbGF5U291bmQoY2xpY2tTb3VuZCwgJ0MyJywgJzhuJyk7CiAgICAgICAgICAgIHN0dWRpZWRDYXJkcy5jbGVhcigpOwogICAgICAgICAgICBjdXJyZW50Q2FyZEluZGV4ID0gMDsKICAgICAgICAgICAgY29tcGxldGlvbk1lc3NhZ2VFbC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICAgIGlmIChzaG91bGRTaHVmZmxlKSB7CiAgICAgICAgICAgICAgICBzaHVmZmxlQ2FyZHMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1cGRhdGVEaXNwbGF5KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGNvbnRpbnVlR2FtZSgpIHsKICAgICAgICAgICAgcmVzZXRQcm9ncmVzcyh0cnVlKTsgLy8gUmVzZXQgYW5kIHNodWZmbGUKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gdHJpZ2dlckNvbmZldHRpKCkgewogICAgICAgICAgICBjb25zdCBjb2xvcnMgPSBbJyNmMzljMTInLCAnI2U3NGMzYycsICcjMzQ5OGRiJywgJyMyZWNjNzEnLCAnIzliNTliNiddOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb25mZXR0aSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgY29uZmV0dGkuY2xhc3NOYW1lID0gJ2NvbmZldHRpJzsKICAgICAgICAgICAgICAgIGNvbmZldHRpLnN0eWxlLmxlZnQgPSBNYXRoLnJhbmRvbSgpICogMTAwICsgJyUnOwogICAgICAgICAgICAgICAgY29uZmV0dGkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3JzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNvbG9ycy5sZW5ndGgpXTsKICAgICAgICAgICAgICAgIGNvbmZldHRpLnN0eWxlLmFuaW1hdGlvbkRlbGF5ID0gTWF0aC5yYW5kb20oKSAqIDMgKyAncyc7CiAgICAgICAgICAgICAgICBjb25mZXR0aS5zdHlsZS50cmFuc2Zvcm0gPSBgc2NhbGUoJHtNYXRoLnJhbmRvbSgpICogMC41ICsgMC41fSlgOwogICAgICAgICAgICAgICAgY29tcGxldGlvbkNvbnRlbnRFbC5hcHBlbmRDaGlsZChjb25mZXR0aSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gY29uZmV0dGkuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZScpLCAxMCk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGNvbmZldHRpLnJlbW92ZSgpLCAzMDAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyAtLS0gSW5mbyBQb3B1cCBGdW5jdGlvbnMgLS0tCiAgICAgICAgY29uc3QgcG9wdXBDb250ZW50ID0gewogICAgICAgICAgICBzY2llbmNlOiB7CiAgICAgICAgICAgICAgICB0aXRsZTogJ/Cfp6ogVuG7gSBLaeG6v24gdGjhu6ljIHkga2hvYScsCiAgICAgICAgICAgICAgICBjb250ZW50OiAnQuG7mSB0aOG6uyBuw6B5IMSRxrDhu6NjIHjDonkgZOG7sW5nIGThu7FhIHRyw6puIGPDoWMgbmdoacOqbiBj4bupdSB2w6Aga2h1eeG6v24gY8OhbyB04burIFThu5UgY2jhu6ljIFkgdOG6vyBUaOG6vyBnaeG7m2kgKFdITykgdsOgIGPDoWMgY8ahIHF1YW4geSB04bq/IHV5IHTDrW4uIE3hu41pIHRow7RuZyB0aW4gxJHhu4F1IMSRxrDhu6NjIGtp4buDbSBjaOG7qW5nIMSR4buDIMSR4bqjbSBi4bqjbyB0w61uaCBjaMOtbmggeMOhYyBraG9hIGjhu41jLCBnacO6cCBi4bqhbiBoaeG7g3UgcsO1IHbhu4EgY8OhYyB0w6FjIMSR4buZbmcgY+G7p2EgdGh14buRYyBsw6EgxJHhur9uIGPGoSB0aOG7gy4nCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZhcGU6IHsKICAgICAgICAgICAgICAgIHRpdGxlOiAn4pqhIFPhu7EgdGjhuq10IHbhu4EgVmFwZScsCiAgICAgICAgICAgICAgICBjb250ZW50OiAnVGh14buRYyBsw6EgxJFp4buHbiB04butIChWYXBlKSB0aMaw4budbmcgxJHGsOG7o2MgcXXhuqNuZyBjw6FvIGzDoCBt4buZdCBnaeG6o2kgcGjDoXAgYW4gdG/DoG4gaMahbiwgbmjGsG5nIGNow7puZyB24bqrbiBjaOG7qWEgbmljb3RpbmUgZ8OieSBuZ2hp4buHbiB2w6Agbmhp4buBdSBow7NhIGNo4bqldCDEkeG7mWMgaOG6oWkga2hpIMSRxrDhu6NjIMSRdW4gbsOzbmcuIFBo4bqnbiBuw6B5IHPhur0gY3VuZyBj4bqlcCBuaOG7r25nIHPhu7EgdGjhuq10IGtob2EgaOG7jWMgduG7gSBjw6FjIG5ndXkgY8ahIHRp4buBbSDhuqluIGPhu6dhIHZhcGUuJwogICAgICAgICAgICB9LAogICAgICAgICAgICBzdGF0czogewogICAgICAgICAgICAgICAgdGl0bGU6ICfwn5OKIFRo4buRbmcga8OqIHThu6sgV0hPJywKICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdDw6FjIGNvbiBz4buRIGtow7RuZyBiaeG6v3QgbsOzaSBk4buRaS4gTmjhu69uZyB0aOG7kW5nIGvDqiB0cm9uZyBi4buZIHRo4bq7IG7DoHkgxJHGsOG7o2MgY+G6rXAgbmjhuq10IHThu6sgY8OhYyBiw6FvIGPDoW8gbeG7m2kgbmjhuqV0IGPhu6dhIFdITywgY2hvIHRo4bqleSBxdXkgbcO0IHRvw6BuIGPhuqd1IGPhu6dhIMSR4bqhaSBk4buLY2ggdGh14buRYyBsw6EgdsOgIG5o4buvbmcgdGhp4buHdCBo4bqhaSBu4bq3bmcgbuG7gSB24buBIG5nxrDhu51pIHbDoCBj4bunYSBtw6AgbsOzIGfDonkgcmEgbeG7l2kgbsSDbS4nCiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBzaG93SW5mb1BvcHVwKHR5cGUpIHsKICAgICAgICAgICAgcGxheVNvdW5kKGNsaWNrU291bmQsICdDMycsICc4bicpOwogICAgICAgICAgICBjb25zdCBkYXRhID0gcG9wdXBDb250ZW50W3R5cGVdOwogICAgICAgICAgICBpbmZvTW9kYWxUaXRsZS50ZXh0Q29udGVudCA9IGRhdGEudGl0bGU7CiAgICAgICAgICAgIGluZm9Nb2RhbENvbnRlbnQudGV4dENvbnRlbnQgPSBkYXRhLmNvbnRlbnQ7CiAgICAgICAgICAgIGluZm9Nb2RhbE92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaGlkZUluZm9Qb3B1cCgpIHsKICAgICAgICAgICAgaW5mb01vZGFsT3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gRVZFTlQgTElTVEVORVJTIC0tLQogICAgICAgIG11dGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIGlmICghYXVkaW9Jbml0aWFsaXplZCkgewogICAgICAgICAgICAgICAgaW5pdEF1ZGlvKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpc011dGVkID0gIWlzTXV0ZWQ7CiAgICAgICAgICAgICAgICBtdXRlQnRuLnRleHRDb250ZW50ID0gaXNNdXRlZCA/ICfwn5SHJyA6ICfwn5SKJzsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgaWYgKGdhbWVTY3JlZW4uc3R5bGUuZGlzcGxheSAhPT0gJ2dyaWQnKSByZXR1cm47CgogICAgICAgICAgICBzd2l0Y2goZXZlbnQua2V5KSB7CiAgICAgICAgICAgICAgICBjYXNlICcgJzogZXZlbnQucHJldmVudERlZmF1bHQoKTsgZmxpcENhcmQoKTsgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdBcnJvd1JpZ2h0JzogbmV4dENhcmRXaXRoQW5pbWF0aW9uKCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnQXJyb3dMZWZ0JzogcHJldmlvdXNDYXJkV2l0aEFuaW1hdGlvbigpOyBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpbmZvTW9kYWxPdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gaW5mb01vZGFsT3ZlcmxheSkgewogICAgICAgICAgICAgICAgaGlkZUluZm9Qb3B1cCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgCiAgICA8L3NjcmlwdD4KCjxzY3JpcHQ+CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBmdW5jdGlvbigpewogICAgdmFyIGNvbXBsZXRlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNvbXBsZXRpb24tbWVzc2FnZSBidXR0b24sIC5jb21wbGV0aW9uLWJ1dHRvbnMgLmJ0bi1zdWNjZXNzIik7CiAgICBpZihjb21wbGV0ZUJ0bil7CiAgICAgICAgY29tcGxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbigpewogICAgICAgICAgICAvLyBOb3RpZnkgcGFyZW50IHdpbmRvdwogICAgICAgICAgICBpZih3aW5kb3cucGFyZW50KXsKICAgICAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoImZsYXNoY2FyZENvbXBsZXRlIiwgIioiKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9KTsKPC9zY3JpcHQ+Cgo8L2JvZHk+CjwvaHRtbD4K77+9Cg==" style="position:absolute; inset:0; width:100%; height:100%; border:0;"></iframe>
</div>


<script>
function showFlashcardGame(){
    try { setLogoVisible(false); } catch(e) {}

    var overlay = document.getElementById('flashcardOverlay');
    if(overlay){ overlay.style.display = 'block'; }
}
function returnToMainGame(){

    var overlay = document.getElementById('flashcardOverlay');
    if(overlay){ overlay.style.display = 'none'; 
    try { 
        var isOnTitle = !document.getElementById('titleScreen').classList.contains('hidden');
        setLogoVisible(isOnTitle);
    } catch(e) {}
}
}
</script>


<script>
window.addEventListener("message", function(event){
    if(event.data === "flashcardComplete"){
        // Hide flashcard overlay
        document.getElementById('flashcardOverlay').style.display = 'none';
        // Hide title screen and show instruction screen
        var title = document.getElementById('titleScreen');
        var instr = document.getElementById('instructionScreen');
        if(title) title.classList.add('hidden');
        if(instr) instr.classList.remove('hidden');
    }
});

// Mở popup khi click logo
document.getElementById("schoolLogo").addEventListener("click", function() {
    document.getElementById("schoolPopup").classList.remove("hidden");
});

// Đóng popup
function closeSchoolPopup() {
    document.getElementById("schoolPopup").classList.add("hidden");
}


function showSchoolInfo() {
    var el = document.getElementById('schoolPopup');
    if(el) el.classList.remove('hidden');
}
function closeSchoolInfo() {
    var el = document.getElementById('schoolPopup');
    if(el) el.classList.add('hidden');
}
</script>


<script>
// Lắng nghe nút "Vào game chính" từ game Flashcard (iframe)
window.addEventListener('message', function(event){
    if(event && event.data === 'flashcardGoMain'){
        try {
            
            // Ẩn overlay Flashcard
            var overlay = document.getElementById('flashcardOverlay');
            if(overlay){ overlay.style.display = 'none'; }

            // Ẩn tiêu đề, ẩn game nếu đang mở
            var title = document.getElementById('titleScreen');
            if(title) title.classList.add('hidden');
            var game = document.getElementById('gameScreen');
            if(game) game.classList.add('hidden');

            // Hiện màn Hướng dẫn chơi (phần giới thiệu trước khi vào game 8 cơ quan)
            var instr = document.getElementById('instructionScreen');
            if(instr) instr.classList.remove('hidden');

            // KHÔNG tự động startGame() ở đây.
} catch(e){}
    }
}, false);
</script>

</body>
</html>
