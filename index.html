<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMN Math Lab - Thầy Thái Minh Nguyên</title>
    
    <!-- LIBRARIES -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;900&family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- STYLES -->
    <style>
        :root {
            --bg-deep: #020617; /* Slate 950 - Đậm hơn để tăng tương phản */
            --neon-cyan: #06b6d4;
            --neon-purple: #a855f7;
            --neon-amber: #f59e0b;
            --neon-rose: #f43f5e;
        }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: var(--bg-deep);
            color: #f8fafc;
            margin: 0; padding: 0;
            overflow-x: hidden;
        }

        .font-math { font-family: 'Space Grotesk', sans-serif; }

        /* BACKGROUND */
        .math-universe {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 90%);
            overflow: hidden;
        }
        .grid-floor {
            position: absolute; width: 200%; height: 200%; bottom: -50%; left: -50%;
            background-image: 
                linear-gradient(rgba(34, 211, 238, 0.07) 1px, transparent 1px), 
                linear-gradient(90deg, rgba(34, 211, 238, 0.07) 1px, transparent 1px);
            background-size: 80px 80px;
            transform: perspective(500px) rotateX(60deg);
            animation: gridMove 30s linear infinite;
            mask-image: linear-gradient(to top, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 60%);
        }
        @keyframes gridMove {
            0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
            100% { transform: perspective(500px) rotateX(60deg) translateY(80px); }
        }

        /* GLASS CARD - Tăng độ mờ nền để chữ rõ hơn */
        .glass-card {
            background: rgba(15, 23, 42, 0.7); /* Tối hơn */
            backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08); 
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative; overflow: hidden;
        }
        .glass-card::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(105deg, transparent 0%, rgba(255,255,255,0.05) 40%, transparent 60%);
            transform: translateX(-100%); transition: 0.6s;
        }
        .glass-card:hover {
            transform: translateY(-6px) scale(1.01);
            border-color: rgba(255, 255, 255, 0.25);
            box-shadow: 0 20px 40px -5px rgba(0,0,0,0.5), 0 0 15px rgba(34, 211, 238, 0.15);
            background: rgba(30, 41, 59, 0.8);
        }
        .glass-card:hover::before { transform: translateX(100%); }

        /* ICON BOX */
        .icon-box {
            position: relative; display: flex; align-items: center; justify-content: center;
            border-radius: 20px; overflow: hidden; transition: all 0.4s ease;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }
        .glass-card:hover .icon-box { transform: scale(1.05); }

        /* VIEWER MODAL */
        .viewer-overlay {
            position: fixed; inset: 0; z-index: 100;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(12px);
            display: flex; justify-content: center; align-items: center;
            animation: fadeIn 0.2s ease-out;
        }
        .viewer-container {
            width: 95%; height: 95%; max-width: 1600px;
            background: #0f172a; border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            animation: zoomIn 0.3s ease-out;
        }
        
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #22d3ee;
            border-radius: 50%;
            width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .fade-in-up { animation: fadeInUp 0.5s ease-out forwards; opacity: 0; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; border: 2px solid #020617; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, Fragment, useMemo } = React;

        // --- CẤU HÌNH DỮ LIỆU ---
        const DATA_CONFIG = {
            documents: [
                { filename: "De-thi-thu-2025-L1.pdf", title: "Đề thi thử THPT 2025 - Lần 1", tag: "Mới", size: "2.4 MB", type: "PDF" },
                { filename: "Hinh-khong-gian-12.pdf", title: "Chuyên đề Hình Không Gian", tag: "Hot", size: "5.1 MB", type: "PDF" },
                { filename: "Ly-thuyet-Xac-suat.docx", title: "Lý thuyết Xác suất thống kê", tag: "Cơ bản", size: "1.5 MB", type: "DOCX" },
                { filename: "Cong-thuc-Giai-tich.pdf", title: "Tổng hợp công thức Giải tích", tag: "Cơ bản", size: "1.2 MB", type: "PDF" },
            ],
            games: [
                { filename: "snake.html", title: "Rắn Săn Số", category: "Phản xạ", iconType: "GameSnake", color: "from-emerald-500 to-teal-500", plays: "12k" },
                { filename: "sudoku.html", title: "Sudoku Logic", category: "Tư duy", iconType: "GameSudoku", color: "from-violet-500 to-fuchsia-500", plays: "8.5k" },
                { filename: "quiz.html", title: "Đố Vui Hình Học", category: "Trực quan", iconType: "GameGeo", color: "from-orange-500 to-amber-500", plays: "5k" },
                { filename: "iq-test.html", title: "Thử Thách IQ", category: "Logic", iconType: "GameBrain", color: "from-rose-500 to-pink-500", plays: "15k" },
            ],
            tools: [
                { filename: "graph.html", title: "Máy Tính Đồ Thị", desc: "Vẽ hàm số 2D/3D", iconType: "ToolGraph", color: "text-cyan-400" },
                { filename: "solver.html", title: "Giải Phương Trình", desc: "Hệ PT & Bất PT", iconType: "ToolEquation", color: "text-emerald-400" },
                { filename: "formulas.html", title: "Tra Cứu Công Thức", desc: "Toán - Lý - Hóa", iconType: "ToolFormula", color: "text-violet-400" },
                { filename: "converter.html", title: "Chuyển Đổi Đơn Vị", desc: "Độ dài, Diện tích...", iconType: "ToolUnit", color: "text-amber-400" },
                { filename: "tkb.html", title: "Trích Xuất TKB", desc: "Xem thời khóa biểu", iconType: "ToolCalendar", color: "text-rose-400" },
            ]
        };

        // --- ICON SYSTEM ---
        const LucideIcon = ({ name, size = 24, className = "", ...props }) => {
            const iconRef = React.useRef(null);
            React.useEffect(() => {
                if (iconRef.current && window.lucide && window.lucide.icons) {
                    const iconNode = window.lucide.icons[name];
                    if (iconNode) {
                        iconRef.current.innerHTML = iconNode.toSvg({ width: size, height: size, class: className, ...props });
                    }
                }
            }, [name, size, className]);
            return <span ref={iconRef} style={{ display: 'inline-flex', alignItems: 'center' }} />;
        };

        // CUSTOM HIGH-FIDELITY ANIMATED SVGs
        const CustomIcons = {
            // Game: Snake (Rõ ràng hơn: Grid + Rắn + Mồi đỏ)
            GameSnake: ({ size = 48, className }) => (
                <svg width={size} height={size} viewBox="0 0 100 100" className={className} fill="none">
                    <defs>
                        <linearGradient id="snakeBody" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stopColor="#10b981"/><stop offset="100%" stopColor="#34d399"/></linearGradient>
                        <filter id="glowGreen"><feGaussianBlur stdDeviation="3" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                    </defs>
                    {/* Grid Background */}
                    <pattern id="smallGrid" width="20" height="20" patternUnits="userSpaceOnUse">
                        <path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth="1"/>
                    </pattern>
                    <rect width="100" height="100" fill="url(#smallGrid)" rx="10"/>
                    {/* Snake Body */}
                    <path d="M20,50 H40 Q50,50 50,40 V30 Q50,20 60,20 H70" stroke="url(#snakeBody)" strokeWidth="10" strokeLinecap="round" strokeLinejoin="round" filter="url(#glowGreen)">
                        <animate attributeName="d" values="M20,50 H40 Q50,50 50,40 V30 Q50,20 60,20 H70; M30,50 H50 Q60,50 60,40 V30 Q60,20 70,20 H80; M20,50 H40 Q50,50 50,40 V30 Q50,20 60,20 H70" dur="2s" repeatCount="indefinite" />
                    </path>
                    {/* Food */}
                    <circle cx="80" cy="50" r="6" fill="#ef4444">
                        <animate attributeName="r" values="6;8;6" dur="1s" repeatCount="indefinite"/>
                        <animate attributeName="opacity" values="1;0.7;1" dur="1s" repeatCount="indefinite"/>
                    </circle>
                </svg>
            ),
            // Game: Sudoku (Rõ ràng hơn: Số hiện lên)
            GameSudoku: ({ size = 48, className }) => (
                <svg width={size} height={size} viewBox="0 0 100 100" className={className}>
                    <rect x="10" y="10" width="80" height="80" rx="8" fill="#2e1065" stroke="#a855f7" strokeWidth="3"/>
                    <line x1="50" y1="10" x2="50" y2="90" stroke="#a855f7" strokeWidth="2"/>
                    <line x1="10" y1="50" x2="90" y2="50" stroke="#a855f7" strokeWidth="2"/>
                    {/* Numbers */}
                    <text x="30" y="40" fill="#d8b4fe" fontSize="24" textAnchor="middle" fontWeight="bold">1</text>
                    <text x="70" y="40" fill="#d8b4fe" fontSize="24" textAnchor="middle" fontWeight="bold" opacity="0.3">
                        <animate attributeName="opacity" values="0.3;1;0.3" dur="2s" repeatCount="indefinite"/>4
                    </text>
                    <text x="30" y="80" fill="#d8b4fe" fontSize="24" textAnchor="middle" fontWeight="bold" opacity="0.3">
                        <animate attributeName="opacity" values="0.3;1;0.3" dur="2s" begin="1s" repeatCount="indefinite"/>2
                    </text>
                    <text x="70" y="80" fill="#d8b4fe" fontSize="24" textAnchor="middle" fontWeight="bold">9</text>
                </svg>
            ),
            // Game: Quiz (Rõ ràng hơn: Hình khối xoay)
            GameGeo: ({ size = 48, className }) => (
                <svg width={size} height={size} viewBox="0 0 100 100" className={className}>
                    <defs><filter id="glowOrange"><feGaussianBlur stdDeviation="2" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs>
                    <g transform="translate(50,50)">
                        <g>
                            <animateTransform attributeName="transform" type="rotate" from="0" to="360" dur="10s" repeatCount="indefinite"/>
                            <rect x="-30" y="-30" width="60" height="60" rx="4" stroke="#fbbf24" strokeWidth="3" fill="none" strokeDasharray="5 5"/>
                        </g>
                        <polygon points="0,-20 17,10 -17,10" fill="#f59e0b" filter="url(#glowOrange)">
                            <animateTransform attributeName="transform" type="rotate" from="360" to="0" dur="5s" repeatCount="indefinite"/>
                        </polygon>
                    </g>
                </svg>
            ),
            // Game: IQ (Rõ ràng hơn: Não bộ kết nối)
            GameBrain: ({ size = 48, className }) => (
                <svg width={size} height={size} viewBox="0 0 100 100" className={className} fill="none">
                    <path d="M30,50 Q30,20 50,20 Q70,20 70,50 Q70,80 50,80 Q30,80 30,50" stroke="#fb7185" strokeWidth="3" fill="#881337" fillOpacity="0.3"/>
                    <circle cx="50" cy="50" r="5" fill="#f43f5e"><animate attributeName="r" values="5;7;5" dur="1s" repeatCount="indefinite"/></circle>
                    <circle cx="35" cy="40" r="3" fill="#f43f5e"><animate attributeName="opacity" values="0.2;1;0.2" dur="1.5s" repeatCount="indefinite"/></circle>
                    <circle cx="65" cy="40" r="3" fill="#f43f5e"><animate attributeName="opacity" values="0.2;1;0.2" dur="1.2s" repeatCount="indefinite"/></circle>
                    <circle cx="50" cy="70" r="3" fill="#f43f5e"><animate attributeName="opacity" values="0.2;1;0.2" dur="1.8s" repeatCount="indefinite"/></circle>
                    <line x1="50" y1="50" x2="35" y2="40" stroke="#f43f5e" strokeWidth="1"/>
                    <line x1="50" y1="50" x2="65" y2="40" stroke="#f43f5e" strokeWidth="1"/>
                    <line x1="50" y1="50" x2="50" y2="70" stroke="#f43f5e" strokeWidth="1"/>
                </svg>
            ),
            // Tool: Graph
            ToolGraph: ({ size = 48, className }) => (
                <svg width={size} height={size} viewBox="0 0 100 100" className={className}>
                    <line x1="10" y1="90" x2="90" y2="90" stroke="#22d3ee" strokeWidth="2" />
                    <line x1="10" y1="90" x2="10" y2="10" stroke="#22d3ee" strokeWidth="2" />
                    <path d="M10,50 Q30,10 50,50 T90,50" fill="none" stroke="#67e8f9" strokeWidth="3">
                        <animate attributeName="d" values="M10,50 Q30,10 50,50 T90,50; M10,50 Q30,90 50,50 T90,50; M10,50 Q30,10 50,50 T90,50" dur="4s" repeatCount="indefinite" />
                    </path>
                </svg>
            ),
            // Tool: Equation
            ToolEquation: ({ size = 48, className }) => (
                <svg width={size} height={size} viewBox="0 0 100 100" className={className}>
                    <text x="50" y="60" textAnchor="middle" fill="#34d399" fontSize="50" fontWeight="bold" fontFamily="monospace">
                        √x
                        <animate attributeName="opacity" values="1;0.5;1" dur="3s" repeatCount="indefinite"/>
                    </text>
                </svg>
            ),
            // Tool: Formula
            ToolFormula: ({ size = 48, className }) => (
                <svg width={size} height={size} viewBox="0 0 100 100" className={className}>
                    <text x="50" y="65" textAnchor="middle" fill="#a78bfa" fontSize="60" fontWeight="bold" fontFamily="serif">∫</text>
                    <circle cx="50" cy="50" r="30" stroke="#8b5cf6" strokeWidth="2" fill="none" strokeDasharray="10 10">
                        <animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="10s" repeatCount="indefinite"/>
                    </circle>
                </svg>
            ),
            // Tool: Unit
            ToolUnit: ({ size = 48, className }) => (
                <svg width={size} height={size} viewBox="0 0 100 100" className={className}>
                    <rect x="20" y="30" width="60" height="40" rx="4" stroke="#fbbf24" strokeWidth="2" fill="none" />
                    <path d="M10,50 L30,50 M90,50 L70,50" stroke="#fbbf24" strokeWidth="2"/>
                    <text x="50" y="55" textAnchor="middle" fill="#fbbf24" fontSize="20" fontWeight="bold">kg</text>
                </svg>
            ),
            // Tool: Calendar (TKB)
            ToolCalendar: ({ size = 48, className }) => (
                <svg width={size} height={size} viewBox="0 0 100 100" className={className}>
                    <rect x="15" y="20" width="70" height="70" rx="5" stroke="#f43f5e" strokeWidth="3" fill="none" />
                    <line x1="15" y1="35" x2="85" y2="35" stroke="#f43f5e" strokeWidth="2" />
                    <line x1="38" y1="35" x2="38" y2="90" stroke="#f43f5e" strokeWidth="2" />
                    <line x1="62" y1="35" x2="62" y2="90" stroke="#f43f5e" strokeWidth="2" />
                    <path d="M30,10 V25 M70,10 V25" stroke="#f43f5e" strokeWidth="4" strokeLinecap="round" />
                    <rect x="42" y="45" width="16" height="10" fill="#f43f5e" opacity="0.5">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/>
                    </rect>
                    <rect x="19" y="65" width="15" height="10" fill="#f43f5e" opacity="0.3">
                        <animate attributeName="opacity" values="0.3;0.8;0.3" dur="2s" begin="1s" repeatCount="indefinite"/>
                    </rect>
                </svg>
            ),
            // Doc Types
            DocPDF: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="#f43f5e" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><text x="8" y="18" fontSize="6" fill="#f43f5e" fontWeight="bold">PDF</text></svg>,
            DocWord: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="#3b82f6" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><text x="6" y="18" fontSize="6" fill="#3b82f6" fontWeight="bold">DOC</text></svg>,
        };

        const Icons = {
            ...CustomIcons, 
            Gamepad2: (p) => <LucideIcon name="Gamepad2" {...p} />,
            BookOpen: (p) => <LucideIcon name="BookOpen" {...p} />,
            Calculator: (p) => <LucideIcon name="Calculator" {...p} />,
            Search: (p) => <LucideIcon name="Search" {...p} />,
            Download: (p) => <LucideIcon name="Download" {...p} />,
            Menu: (p) => <LucideIcon name="Menu" {...p} />,
            X: (p) => <LucideIcon name="X" {...p} />,
            Home: (p) => <LucideIcon name="Home" {...p} />,
            Grid: (p) => <LucideIcon name="Grid" {...p} />,
            Bell: (p) => <LucideIcon name="Bell" {...p} />,
            User: (p) => <LucideIcon name="User" {...p} />,
            Filter: (p) => <LucideIcon name="Filter" {...p} />,
            Play: (p) => <LucideIcon name="Play" {...p} />,
            Maximize: (p) => <LucideIcon name="Maximize" {...p} />,
            ExternalLink: (p) => <LucideIcon name="ExternalLink" {...p} />,
            Sparkles: (p) => <LucideIcon name="Sparkles" {...p} />,
            FileText: (p) => <LucideIcon name="FileText" {...p} />
        };

        // --- RESOURCE VIEWER MODAL ---
        const ResourceViewer = ({ resource, onClose }) => {
            const [loading, setLoading] = useState(true);
            const [loadError, setLoadError] = useState(false);

            if (!resource) return null;

            const getBasePath = () => {
                switch(resource.category) {
                    case 'doc': return 'tai-lieu/';
                    case 'game': return 'game/';
                    case 'tool': return 'app/';
                    default: return '';
                }
            };

            const relativePath = getBasePath() + resource.filename;
            const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
            const absoluteUrl = baseUrl + relativePath;

            const extension = resource.filename.split('.').pop().toLowerCase();
            const isOffice = ['docx', 'doc', 'xlsx', 'xls', 'pptx', 'ppt'].includes(extension);
            const isLocal = window.location.hostname === '' || window.location.hostname === 'localhost' || window.location.protocol === 'file:';

            let viewerUrl = relativePath;
            if (isOffice) {
                viewerUrl = `https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(absoluteUrl)}`;
            }

            return (
                <div className="viewer-overlay" onClick={onClose}>
                    <div className="viewer-container" onClick={e => e.stopPropagation()}>
                        <div className="h-16 bg-[#0b1121] border-b border-white/10 flex items-center justify-between px-6 shrink-0">
                            <div className="flex items-center gap-4">
                                <div className="p-2 bg-cyan-500/10 rounded-xl border border-cyan-500/20 text-cyan-400">
                                    {resource.category === 'game' ? <Icons.Gamepad2 size={20}/> : 
                                     resource.category === 'tool' ? <Icons.Calculator size={20}/> : <Icons.DocPDF size={20}/>}
                                </div>
                                <div>
                                    <h3 className="font-bold text-white font-math tracking-wide text-lg">{resource.title}</h3>
                                    <p className="text-xs text-slate-400 font-mono">{resource.filename}</p>
                                </div>
                            </div>
                            <div className="flex gap-3">
                                <button onClick={() => window.open(relativePath, '_blank')} className="flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm text-slate-300 transition-colors"><Icons.ExternalLink size={16}/> Mở tab mới</button>
                                <button onClick={onClose} className="p-2 bg-rose-500/10 hover:bg-rose-500/20 text-rose-400 rounded-lg transition-colors"><Icons.X size={24}/></button>
                            </div>
                        </div>
                        <div className="flex-1 bg-[#1e293b] relative w-full h-full">
                            {loading && !loadError && (
                                <div className="absolute inset-0 flex flex-col items-center justify-center z-10 bg-[#0f172a]"><div className="loading-spinner mb-4"></div><p className="text-slate-400 animate-pulse">Đang tải tài nguyên...</p></div>
                            )}
                            {isOffice && isLocal ? (
                                <div className="absolute inset-0 flex flex-col items-center justify-center bg-[#0f172a] text-center p-8 z-20">
                                    <div className="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mb-6"><Icons.DocWord size={40}/></div>
                                    <h3 className="text-2xl font-bold text-white mb-2">Chế độ xem trước không khả dụng Offline</h3>
                                    <p className="text-slate-400 mb-8 max-w-md">File Word/Excel cần được đưa lên GitHub Pages để xem online.</p>
                                    <a href={relativePath} download className="px-8 py-4 bg-cyan-600 text-white rounded-xl font-bold hover:bg-cyan-500 flex items-center gap-2 shadow-lg shadow-cyan-500/20 transition-all hover:-translate-y-1"><Icons.Download size={20}/> Tải về máy</a>
                                </div>
                            ) : (
                                <iframe src={viewerUrl} className="w-full h-full border-0 block" title="Content Viewer" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen onLoad={() => setLoading(false)} onError={() => { setLoading(false); setLoadError(true); }} />
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- SUB-COMPONENTS ---
        const Sidebar = ({ currentView, setView, mobileOpen, setMobileOpen }) => {
            const menuItems = [
                { id: 'dashboard', label: 'Tổng Quan', icon: Icons.Home },
                { id: 'documents', label: 'Kho Tài Liệu', icon: Icons.BookOpen },
                { id: 'games', label: 'Game Tư Duy', icon: Icons.Gamepad2 },
                { id: 'tools', label: 'Công Cụ', icon: Icons.Calculator },
            ];

            return (
                <Fragment>
                {mobileOpen && (
                    <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden animate-fade-in" onClick={() => setMobileOpen(false)}/>
                )}
                <aside className={`fixed md:static inset-y-0 left-0 z-50 w-72 bg-[#020617]/95 backdrop-blur-xl border-r border-white/10 transform transition-transform duration-300 ease-in-out flex flex-col ${mobileOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}`}>
                    <div className="h-24 flex items-center px-8 border-b border-white/5 relative overflow-hidden shrink-0">
                        <div className="absolute inset-0 bg-gradient-to-r from-cyan-500/10 to-transparent opacity-50"></div>
                        <div className="relative z-10 flex items-center gap-4">
                            <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white font-black text-3xl shadow-lg shadow-cyan-500/30">π</div>
                            <div>
                                <span className="text-xl font-bold text-white tracking-tight block leading-none font-math">TMN</span>
                                <span className="text-[10px] font-bold text-cyan-400 tracking-[0.2em] uppercase">Math Lab</span>
                            </div>
                        </div>
                        <button className="md:hidden ml-auto text-slate-400 hover:text-white" onClick={() => setMobileOpen(false)}><Icons.X size={24} /></button>
                    </div>
                    <nav className="flex-1 px-4 py-8 space-y-3 overflow-y-auto">
                        <p className="px-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">Điều Hướng</p>
                        {menuItems.map((item) => (
                        <button key={item.id} onClick={() => { setView(item.id); setMobileOpen(false); }} className={`w-full flex items-center gap-4 px-4 py-4 rounded-xl transition-all font-bold text-sm group relative overflow-hidden ${currentView === item.id ? 'text-white bg-white/10 border border-white/10 shadow-[0_0_20px_rgba(34,211,238,0.1)]' : 'text-slate-400 hover:bg-white/5 hover:text-white'}`}>
                            {currentView === item.id && <div className="absolute left-0 top-0 w-1 h-full bg-cyan-400 shadow-[0_0_10px_#22d3ee]"></div>}
                            <span className={currentView === item.id ? 'text-cyan-400' : 'group-hover:text-cyan-400 transition-colors'}>{item.icon({size: 22})}</span>
                            <span className="relative z-10">{item.label}</span>
                        </button>
                        ))}
                    </nav>
                    <div className="p-6 border-t border-white/5 shrink-0">
                        <div className="flex items-center gap-4 p-4 rounded-2xl bg-gradient-to-r from-white/5 to-transparent border border-white/10 hover:border-cyan-500/30 transition-all cursor-pointer group">
                            <div className="w-10 h-10 rounded-full bg-gradient-to-tr from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold shadow-lg group-hover:scale-110 transition-transform">N</div>
                            <div className="flex-1 min-w-0">
                                <p className="text-sm font-bold text-white truncate group-hover:text-cyan-300 transition-colors">Thầy Nguyên</p>
                                <p className="text-xs text-slate-400 truncate">Admin</p>
                            </div>
                        </div>
                    </div>
                </aside>
                </Fragment>
            );
        };

        const Header = ({ title, setMobileOpen, searchQuery, setSearchQuery }) => (
            <header className="h-24 sticky top-0 z-30 px-6 md:px-10 flex items-center justify-between backdrop-blur-sm shrink-0 bg-[#020617]/80 border-b border-white/5">
                <div className="flex items-center gap-4">
                    <button className="md:hidden p-2 text-slate-400 hover:text-white bg-white/5 rounded-lg border border-white/10" onClick={() => setMobileOpen(true)}><Icons.Menu size={24} /></button>
                    <div className="hidden md:block">
                        <h2 className="text-3xl font-black text-white tracking-tight font-math flex items-center gap-2">{title} <Icons.Sparkles size={18} className="text-amber-400 animate-pulse"/></h2>
                        <p className="text-sm text-slate-400 font-medium">Hôm nay bạn muốn giải bài toán nào?</p>
                    </div>
                </div>
                <div className="flex items-center gap-4 md:gap-6">
                    <div className="relative hidden md:block group">
                        <div className="absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-xl opacity-30 group-hover:opacity-100 transition duration-500 blur"></div>
                        <div className="relative flex items-center bg-[#0b1121] rounded-xl px-4 py-2.5 w-80 border border-white/10">
                            <Icons.Search className="text-slate-500 mr-3" size={20} />
                            <input type="text" placeholder="Tìm tài liệu, game..." className="bg-transparent border-none text-white text-sm w-full focus:outline-none placeholder:text-slate-600 font-medium" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)}/>
                        </div>
                    </div>
                    <button className="relative p-3 rounded-xl bg-white/5 hover:bg-white/10 text-slate-300 hover:text-white transition-all border border-white/10"><Icons.Bell size={22} /><span className="absolute top-2 right-2 w-2.5 h-2.5 bg-rose-500 rounded-full border-2 border-[#0b1121] shadow-[0_0_10px_#f43f5e]"></span></button>
                </div>
            </header>
        );

        /* VIEWS */
        const DocumentsView = ({ searchQuery, openViewer }) => {
            const filtered = DATA_CONFIG.documents.filter(d => d.title.toLowerCase().includes(searchQuery.toLowerCase()) || d.tag.toLowerCase().includes(searchQuery.toLowerCase()));
            return (
                <div className="p-6 md:p-10 max-w-7xl mx-auto w-full fade-in-up">
                    <div className="glass-card rounded-[32px] p-1">
                        <table className="w-full text-left">
                            <thead className="bg-white/5 text-slate-300 uppercase font-bold text-xs tracking-wider border-b border-white/10">
                                <tr><th className="px-8 py-6">Tài liệu</th><th className="px-8 py-6">Loại</th><th className="px-8 py-6">Tag</th><th className="px-8 py-6 text-right"></th></tr>
                            </thead>
                            <tbody className="divide-y divide-white/5">
                                {filtered.length > 0 ? filtered.map((doc, i) => {
                                    const ext = doc.filename.split('.').pop().toUpperCase();
                                    return (
                                        <tr key={i} className="hover:bg-white/5 transition-colors group cursor-pointer" onClick={() => openViewer({...doc, category: 'doc'})}>
                                            <td className="px-8 py-6"><div className="flex items-center gap-4"><div className="icon-box w-14 h-14 bg-[#0b1121] text-cyan-400 border border-white/10 group-hover:border-cyan-500/50">
                                                {ext === 'PDF' ? <Icons.DocPDF size={28}/> : <Icons.DocWord size={28}/>}
                                            </div><span className="font-bold text-white text-lg group-hover:text-cyan-300 transition-colors">{doc.title}</span></div></td>
                                            <td className="px-8 py-6"><span className="font-mono text-slate-400 bg-white/5 px-3 py-1.5 rounded-lg text-sm font-bold">{ext}</span></td>
                                            <td className="px-8 py-6"><span className={`px-3 py-1 rounded-full text-xs font-bold border ${doc.tag === 'Hot' ? 'bg-rose-500/20 text-rose-400 border-rose-500/30' : 'bg-cyan-500/20 text-cyan-400 border-cyan-500/30'}`}>{doc.tag}</span></td>
                                            <td className="px-8 py-6 text-right"><button className="p-3 hover:bg-cyan-500 hover:text-black rounded-xl transition-all text-slate-400"><Icons.BookOpen size={20} /></button></td>
                                        </tr>
                                    )
                                }) : <tr><td colSpan="4" className="px-8 py-6 text-center text-slate-500">Không tìm thấy tài liệu.</td></tr>}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const GamesView = ({ searchQuery, openViewer }) => {
            const filtered = DATA_CONFIG.games.filter(g => g.title.toLowerCase().includes(searchQuery.toLowerCase()));
            return (
                <div className="p-6 md:p-10 max-w-7xl mx-auto w-full fade-in-up">
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                        {filtered.length > 0 ? filtered.map((game, i) => {
                            const GameIcon = CustomIcons[game.iconType] || Icons.Gamepad2;
                            return (
                                <div key={i} onClick={() => openViewer({...game, category: 'game'})} className="group relative rounded-[32px] p-1 overflow-hidden hover:-translate-y-3 transition-transform duration-500 cursor-pointer">
                                    <div className={`absolute inset-0 bg-gradient-to-br ${game.color} opacity-0 group-hover:opacity-100 transition-opacity duration-500 blur-md`}></div>
                                    <div className="relative h-full bg-[#0f172a] rounded-[30px] p-8 flex flex-col items-center text-center overflow-hidden border border-white/10 group-hover:border-transparent">
                                        <div className="w-24 h-24 mb-6 relative flex items-center justify-center">
                                            <div className={`absolute inset-0 bg-gradient-to-br ${game.color} opacity-20 blur-xl rounded-full group-hover:opacity-40 transition-opacity`}></div>
                                            <GameIcon size={80} className="relative z-10 drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]"/>
                                        </div>
                                        <h3 className="text-2xl font-bold text-white mb-2 relative z-10">{game.title}</h3>
                                        <span className="text-sm font-bold text-slate-400 uppercase tracking-widest mb-8 relative z-10 px-3 py-1 rounded-full border border-white/10">{game.category}</span>
                                        <button className="mt-auto w-full py-4 rounded-xl bg-white/5 hover:bg-white text-white hover:text-black font-bold text-sm transition-all border border-white/10 flex items-center justify-center gap-3 relative z-10 shadow-lg"><Icons.Play size={18} fill="currentColor"/> CHƠI NGAY</button>
                                    </div>
                                </div>
                            )
                        }) : <div className="col-span-4 text-center text-slate-500">Không tìm thấy trò chơi.</div>}
                    </div>
                </div>
            );
        };

        const ToolsView = ({ searchQuery, openViewer }) => {
            const filtered = DATA_CONFIG.tools.filter(t => t.title.toLowerCase().includes(searchQuery.toLowerCase()));
            return (
                <div className="p-6 md:p-10 max-w-7xl mx-auto w-full fade-in-up">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                        {filtered.length > 0 ? filtered.map((tool, i) => {
                            const ToolIcon = CustomIcons[tool.iconType] || Icons.Calculator;
                            return (
                                <div key={i} onClick={() => openViewer({...tool, category: 'tool'})} className="glass-card p-10 rounded-[32px] flex flex-col gap-6 group cursor-pointer hover:bg-white/5 border border-white/10">
                                    <div className={`icon-box w-20 h-20 bg-[#0b1121] ${tool.color} border border-white/10 shadow-lg group-hover:border-current p-4`}>
                                        <ToolIcon size={48} />
                                    </div>
                                    <div className="flex-1"><h3 className="text-2xl font-bold text-white mb-2 group-hover:text-purple-300 transition-colors">{tool.title}</h3><p className="text-slate-400 text-sm mb-6 leading-relaxed font-medium">{tool.desc}</p><div className="w-full h-1 bg-slate-800 rounded-full overflow-hidden group-hover:h-2 transition-all"><div className={`h-full w-1/3 bg-current ${tool.color} group-hover:w-full transition-all duration-700`}></div></div></div>
                                </div>
                            )
                        }) : <div className="col-span-3 text-center text-slate-500">Không tìm thấy công cụ.</div>}
                    </div>
                </div>
            );
        };

        /* MAIN APP */
        const App = () => {
            const [currentView, setCurrentView] = useState('dashboard');
            const [mobileOpen, setMobileOpen] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [viewingResource, setViewingResource] = useState(null);

            const getTitle = () => {
                switch(currentView) {
                    case 'dashboard': return 'Tổng Quan';
                    case 'documents': return 'Tài Liệu';
                    case 'games': return 'Game Zone';
                    case 'tools': return 'Công Cụ';
                    default: return 'Trang Chủ';
                }
            };

            return (
                <div className="min-h-screen flex relative overflow-hidden">
                    <div className="math-universe"><div className="grid-floor"></div><div className="absolute inset-0 bg-gradient-to-t from-[#020617] via-transparent to-transparent"></div></div>
                    
                    <Sidebar currentView={currentView} setView={setCurrentView} mobileOpen={mobileOpen} setMobileOpen={setMobileOpen} />

                    <div className="flex-1 flex flex-col min-w-0 h-screen overflow-hidden backdrop-blur-[2px]">
                        <Header title={getTitle()} setMobileOpen={setMobileOpen} searchQuery={searchQuery} setSearchQuery={setSearchQuery} />
                        <main className="flex-1 overflow-y-auto scroll-smooth">
                            {currentView === 'dashboard' && <GamesView searchQuery="" openViewer={setViewingResource} />} 
                            {currentView === 'documents' && <DocumentsView searchQuery={searchQuery} openViewer={setViewingResource} />}
                            {currentView === 'games' && <GamesView searchQuery={searchQuery} openViewer={setViewingResource} />}
                            {currentView === 'tools' && <ToolsView searchQuery={searchQuery} openViewer={setViewingResource} />}
                        </main>
                    </div>

                    {/* VIEWER MODAL */}
                    {viewingResource && <ResourceViewer resource={viewingResource} onClose={() => setViewingResource(null)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
